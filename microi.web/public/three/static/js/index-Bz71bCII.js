import{d as Vn,_ as Le,u as $t,s as Vt,e as me,f as te,g as ne,r as x,h as fn,i as ae,j as Z,o as U,k as d,l as r,w as u,m as k,v as de,F as fe,n as _e,p as ue,c as oe,q as j,E as ce,t as De,x as He,y as mn,z as Be,A as ve,a as xe,B as gn,b as _n,C as Un,D as yn,G as mt,H as Dn,I as On,J as Ut,L as Fn,M as zn,N as Hn,O as Nn,P as pt,Q as St,R as jn,S as Bn,T as Gn}from"./main-DrxgF003.js";import{P as Ge,U as Ee,m as Nt,a as Se,I as Yn,R as vt,M as jt,C as Xn,b as Wn,E as Bt,c as Gt,O as Zn,d as qn,S as Yt,F as Qn,e as Kn,f as Jn,v as eo,g as it,h as to,i as no}from"./RGBELoader-DNv9Vp1K.js";import{g as Dt,C as re,M as wt,V as q,Q as Ce,B as Re,R as vn,a as Ct,S as oo,N as wn,b as Pt,c as xn,I as so,D as je,P as gt,d as io,e as et,f as ot,h as ao,i as ro,j as lo,L as Ve,k as co,l as uo,m as po,n as ho,o as nt,p as fo,s as Mn,z as mo,q as go,T as $e,E as Ot,r as Ft,A as bn,G as ht,t as zt,u as _t,v as xt,w as _o,x as Sn,O as kt,y as Cn,F as yo,H as ye,J as ge,K as Xt,U as Wt,W as F,X as at,Y as Pe,Z as Ye,_ as vo,$ as wo,a0 as An,a1 as xo,a2 as Mo,a3 as Tn,a4 as Zt,a5 as bo,a6 as So,a7 as Co,a8 as rt,a9 as Ao,aa as To,ab as Lo,ac as Eo,ad as Io,ae as At,af as Po,ag as ko,ah as Ro,ai as $o,aj as qt,ak as Qt,al as Xe,am as Vo,an as Uo,ao as Do,ap as Oo,aq as Fo,ar as zo,as as Ho,at as No,au as Kt,av as jo}from"./DRACOLoader-DSa8Sn_h.js";const Bo="/three/favicon.ico",be=Vn("useMeshEditStore",{state:()=>({modelApi:{},selectMesh:{},modelType:"oneModel"}),getters:{selectMeshUuid:t=>t.selectMesh.uuid},actions:{setModelApi(t){this.modelApi=t},selectMeshAction(t){this.selectMesh=t},setActiveEditModelType(t){this.modelType=t}}}),Go={class:"edit-box"},Yo={class:"header"},Xo={class:"icon-name"},Wo={class:"action-txt"},Zo={class:"check"},qo={class:"icon-name"},Qo={class:"action"},Ko={class:"check"},Jo={class:"icon-name"},es={class:"action-txt"},ts={class:"check"},ns={class:"option"},os={class:"icon-name"},ss={class:"texture-add"},is={class:"icon"},as={class:"texture-add"},rs={class:"icon"},ls={class:"options"},ds={class:"option"},cs={class:"grid-txt"},us={class:"grid-sidle"},ps={class:"option"},hs={class:"grid-txt"},fs={class:"grid-sidle"},ms={__name:"EditBackground",setup(t,{expose:e}){var L,_;const o=$t(),{backgroundList:s,viewImageList:n}=Vt(o),a=be(),i=me({visible:!0,type:3,image:(L=n.value[0])==null?void 0:L.cover,viewImg:(_=n.value[0])==null?void 0:_.url,color:"#000",blurriness:0,intensity:1}),l=te(!1),c=te(1),h=te(1),g=ne(()=>{const{visible:T}=i;return T?"":"disabled"}),v=Ge,y=T=>{switch(Object.assign(i,{type:T,intensity:1,blurriness:0}),T){case 1:a.modelApi.onSetSceneColor(i.color);break;case 2:a.modelApi.onSetSceneImage(i.image);break;case 3:a.modelApi.onSetSceneViewImage(i);break}},f=({id:T,url:w})=>{i.image=w,c.value=T,a.modelApi.onSetSceneImage(w)},p=async({id:T,url:w})=>{try{l.value=!0,i.viewImg=w,h.value=T,await a.modelApi.onSetSceneViewImage(i)}finally{l.value=!1,ce.success("操作成功")}},M=async T=>{const w=URL.createObjectURL(T.raw);await a.modelApi.onSetStorageViewImage(w,Dt(T.name)),URL.revokeObjectURL(w),ce.success("操作成功")},S=async T=>{await a.modelApi.onSetStorageViewVideo(T),ce.success("操作成功")},E=T=>{i.color=T,a.modelApi.onSetSceneColor(i.color)},C=()=>{a.modelApi.onSetSceneColor(i.color)},P=()=>{a.modelApi.onSetSceneViewConfig(i)},m=()=>{const{type:T,visible:w,image:I,viewImg:Y}=i;if(!w)return a.modelApi.onSetSceneColor("#000");switch(T){case 1:a.modelApi.onSetSceneColor(i.color);break;case 2:a.modelApi.onSetSceneImage(I);break;case 3:a.modelApi.onSetSceneViewImage(i);break}};return e({config:i}),(T,w)=>{const I=x("el-switch"),Y=x("Picture"),R=x("el-icon"),b=x("el-space"),A=x("el-button"),V=x("Check"),H=x("el-image"),D=x("el-col"),N=x("el-row"),$=x("el-scrollbar"),B=x("DataAnalysis"),ie=x("el-color-picker"),we=x("CameraFilled"),G=x("UploadFilled"),z=x("el-tooltip"),O=x("el-upload"),X=x("VideoCameraFilled"),W=x("el-slider"),Q=fn("zLoading");return ae((U(),Z("div",Go,[d("div",Yo,[w[7]||(w[7]=d("span",null,"背景",-1)),r(I,{modelValue:i.visible,"onUpdate:modelValue":w[0]||(w[0]=ee=>i.visible=ee),onChange:m},null,8,["modelValue"])]),d("div",{class:j(["options",g.value])},[d("div",{class:"option",onClick:w[1]||(w[1]=ee=>y(2))},[r(b,null,{default:u(()=>[d("div",Xo,[r(b,null,{default:u(()=>[r(R,null,{default:u(()=>[r(Y)]),_:1}),w[8]||(w[8]=d("span",null," 图片",-1))]),_:1,__:[8]})]),d("div",Wo,[r(A,{type:"primary",link:""},{default:u(()=>w[9]||(w[9]=[k("选择图片")])),_:1,__:[9]})]),ae(d("div",Zo,[r(R,{size:"20px",color:"#2a3ff6"},{default:u(()=>[r(V)]),_:1})],512),[[de,i.type==2]])]),_:1})]),ae(r($,{"max-height":"250px"},{default:u(()=>[r(N,null,{default:u(()=>[(U(!0),Z(fe,null,_e(ue(s),ee=>(U(),oe(D,{style:{textAlign:"center"},span:6,key:ee.id},{default:u(()=>[r(H,{onClick:K=>f(ee),class:j(["el-img",c.value==ee.id?"active":""]),src:ee.url,fit:"cover"},null,8,["onClick","class","src"])]),_:2},1024))),128))]),_:1})]),_:1},512),[[de,i.type==2]])],2),d("div",{class:j(["options",g.value])},[d("div",{class:"option",onClick:w[3]||(w[3]=ee=>y(1))},[r(b,null,{default:u(()=>[d("div",qo,[r(b,null,{default:u(()=>[r(R,null,{default:u(()=>[r(B)]),_:1}),w[10]||(w[10]=d("span",null," 颜色",-1))]),_:1,__:[10]})]),d("div",Qo,[r(ie,{predefine:ue(v),onChange:C,onActiveChange:E,modelValue:i.color,"onUpdate:modelValue":w[2]||(w[2]=ee=>i.color=ee)},null,8,["predefine","modelValue"])]),ae(d("div",Ko,[r(R,{size:"20px",color:"#2a3ff6"},{default:u(()=>[r(V)]),_:1})],512),[[de,i.type==1]])]),_:1})])],2),d("div",{class:j(["options",g.value])},[d("div",{class:"option",onClick:w[4]||(w[4]=ee=>y(3))},[r(b,null,{default:u(()=>[d("div",Jo,[r(b,null,{default:u(()=>[r(R,null,{default:u(()=>[r(we)]),_:1}),w[11]||(w[11]=d("span",null," 全景图",-1))]),_:1,__:[11]})]),d("div",es,[r(A,{type:"primary",link:""},{default:u(()=>w[12]||(w[12]=[k("选择图片")])),_:1,__:[12]})]),ae(d("div",ts,[r(R,{size:"20px",color:"#2a3ff6"},{default:u(()=>[r(V)]),_:1})],512),[[de,i.type==3]])]),_:1})]),ae(r($,{"max-height":"600px"},{default:u(()=>[r(N,null,{default:u(()=>[(U(!0),Z(fe,null,_e(ue(n),ee=>(U(),oe(D,{span:6,style:{textAlign:"center"},key:ee.id},{default:u(()=>[r(H,{onClick:K=>p(ee),class:j(["el-view",h.value==ee.id?"active":""]),src:ee.cover,fit:"cover"},null,8,["onClick","class","src"])]),_:2},1024))),128))]),_:1}),ae(r(N,null,{default:u(()=>[r(D,null,{default:u(()=>[d("div",ns,[d("div",os,[r(b,null,{default:u(()=>w[13]||(w[13]=[d("span",null,"外部资源",-1)])),_:1,__:[13]})])])]),_:1}),r(D,{span:10,offset:4},{default:u(()=>[r(b,{spacer:""},{default:u(()=>[r(O,{action:"",accept:".jpg,.png,.hdr","show-file-list":!1,"auto-upload":!1,"on-change":M},{default:u(()=>[d("div",ss,[d("div",is,[r(z,{effect:"dark",content:"该功能仅作预览，数据无法保存",placement:"top"},{default:u(()=>[r(R,{size:"60"},{default:u(()=>[r(G)]),_:1})]),_:1}),w[14]||(w[14]=d("span",null,"加载外部全景图",-1))])])]),_:1}),r(O,{action:"",accept:".mp4","show-file-list":!1,"auto-upload":!1,"on-change":S},{default:u(()=>[d("div",as,[d("div",rs,[r(z,{effect:"dark",content:"该功能仅作预览，数据无法保存",placement:"top"},{default:u(()=>[r(R,{size:"60"},{default:u(()=>[r(X)]),_:1})]),_:1}),w[15]||(w[15]=d("span",null,"加载外部视频",-1))])])]),_:1})]),_:1})]),_:1})]),_:1},512),[[de,i.type==3]]),ae(r(N,null,{default:u(()=>[r(D,null,{default:u(()=>[d("div",ls,[d("div",ds,[r(b,null,{default:u(()=>[d("div",cs,[r(A,{type:"primary",link:""},{default:u(()=>w[16]||(w[16]=[k("强度")])),_:1,__:[16]})])]),_:1}),d("div",us,[r(W,{"show-input":"",onInput:P,modelValue:i.intensity,"onUpdate:modelValue":w[5]||(w[5]=ee=>i.intensity=ee),min:0,max:1,step:.01},null,8,["modelValue"])])]),d("div",ps,[r(b,null,{default:u(()=>[d("div",hs,[r(A,{type:"primary",link:""},{default:u(()=>w[17]||(w[17]=[k(" 模糊")])),_:1,__:[17]})])]),_:1}),d("div",fs,[r(W,{"show-input":"",onInput:P,modelValue:i.blurriness,"onUpdate:modelValue":w[6]||(w[6]=ee=>i.blurriness=ee),min:0,max:1,step:.01},null,8,["modelValue"])])])])]),_:1})]),_:1},512),[[de,i.type==3]])]),_:1},512),[[de,i.type==3]])],2)])),[[Q,l.value]])}}},gs=Le(ms,[["__scopeId","data-v-d707634f"]]),_s={class:"edit-box"},ys={class:"header"},vs={class:"options"},ws={class:"option"},xs={class:"options"},Ms=["onClick"],bs={class:"icon-name"},Ss={class:"check"},Cs={class:"option space-between"},As={class:"option"},Ts={class:"grid-txt"},Ls={class:"grid-sidle"},Es={class:"options"},Is={key:0,class:"select"},Ps=["onClick"],ks={key:0,class:"select"},Rs={__name:"EditMaterial",setup(t,{expose:e}){const o=$t(),{mapImageList:s}=Vt(o),n=be(),{$bus:a}=De().proxy,i=me({meshName:null,color:null,wireframe:!1,depthWrite:!0,opacity:1}),l=te(!1),c=te(""),h=te(null),g=te(null),v=ne(()=>(y.modelMaterialList.find(w=>w.uuid==y.selectMeshUuid)||{}).uuid?"":"disabled"),y=me({modelMaterialList:ne(()=>n.modelApi.modelMaterialList),originalMaterials:ne(()=>n.modelApi.originalMaterials),modelApi:ne(()=>n.modelApi),selectMeshUuid:ne(()=>n.selectMeshUuid)});He(async()=>{a.on(Ee,()=>{Object.assign(i,{color:null,wireframe:!1,depthWrite:!0,opacity:1})})}),mn(()=>n.selectMeshUuid,T=>{const w=y.modelMaterialList.find(I=>I.uuid==T)||{};if(g.value=w.mapId,w.mapId){const{color:I,wireframe:Y,depthWrite:R,opacity:b}=w.material,A=new re(I).getStyle();Object.assign(i,{color:A,wireframe:Y,depthWrite:R,opacity:b});const V=y.originalMaterials.get(w.uuid);h.value={url:M(w),name:w.name,mapId:V.userData.mapId,material:w.material}}else h.value=null});const f=T=>{const w=Nt.find(I=>I.type==T);y.modelApi.onChangeModelMeshType(w)},p=T=>{const{name:w}=T;i.meshName=w;const I=y.modelApi.onChangeModelMaterial(w),{color:Y,wireframe:R,depthWrite:b,opacity:A}=I.material;Object.assign(i,{color:new re(Y).getStyle(),wireframe:R,depthWrite:b,opacity:A});const V=y.originalMaterials.get(T.uuid);h.value={url:M(T),name:T.name,mapId:T.mapId,material:V}},M=T=>{const w=y.originalMaterials.get(T.uuid),I=Array.isArray(w)?w:[w];let Y;return I.forEach(R=>{if(R.map&&R.map.image){const b=document.createElement("canvas"),{width:A,height:V}=R.map.image;b.width=A,b.height=V,b.getContext("2d").drawImage(R.map.image,0,0),Y=b.toDataURL("image/png",.5),b.remove()}}),Y},S=()=>{y.modelApi.onSetModelMaterial(i)},E=T=>{T.visible=!T.visible,y.modelApi.onSetMeshVisible(T)},C=T=>{g.value=T.mapId,y.modelApi.onSetModelMap(T),ce.success("当前材质贴图修改成功")},P=async T=>{try{l.value=!0,g.value=T.id;const w=y.modelMaterialList.find(I=>I.uuid==n.selectMeshUuid)||{};w.mapId=T.id,y.modelApi.onSetSystemModelMap(T),ce.success("当前材质贴图修改成功")}finally{l.value=!1}},m=async T=>{const w=URL.createObjectURL(T.raw);await y.modelApi.onSetStorageModelMap(w,Dt(T.name)),URL.revokeObjectURL(w),ce.success("当前材质贴图修改成功")},L=()=>{Object.assign(i,{meshName:null,color:"#fff",wireframe:!1,depthWrite:!0,opacity:1}),c.value="",g.value=null,y.modelApi.initModelMaterial()};return e({getMeshConfig:()=>({materialType:c.value,meshList:y.modelApi.onGetEditMeshList()})}),(T,w)=>{const I=x("el-button"),Y=x("el-option"),R=x("el-select"),b=x("el-space"),A=x("View"),V=x("el-icon"),H=x("Hide"),D=x("Check"),N=x("el-scrollbar"),$=x("el-color-picker"),B=x("WarnTriangleFilled"),ie=x("el-tooltip"),we=x("el-switch"),G=x("el-slider"),z=x("el-image"),O=x("Select"),X=x("el-col"),W=x("el-upload"),Q=x("el-row"),ee=fn("zLoading");return ae((U(),Z("div",_s,[d("div",ys,[w[7]||(w[7]=d("span",null,"材质类型",-1)),r(I,{type:"primary",icon:"Refresh",onClick:L,plain:""},{default:u(()=>w[6]||(w[6]=[k(" 重置 ")])),_:1,__:[6]})]),d("div",vs,[d("div",ws,[r(b,null,{default:u(()=>[w[8]||(w[8]=d("span",null,"当前材质类型：",-1)),r(R,{modelValue:c.value,"onUpdate:modelValue":w[0]||(w[0]=K=>c.value=K),onChange:f,placeholder:"请选择",size:"small",style:{width:"200px"}},{default:u(()=>[(U(!0),Z(fe,null,_e(ue(Nt),K=>(U(),oe(Y,{key:K.type,label:`${K.type?K.type:""}(${K.describe})`,value:K.type},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1,__:[8]})])]),w[14]||(w[14]=d("div",{class:"header"},[d("span",null,"材质")],-1)),d("div",xs,[r(N,{"max-height":"200px"},{default:u(()=>[(U(!0),Z(fe,null,_e(y.modelMaterialList,K=>(U(),Z("div",{class:j(["option",y.selectMeshUuid==K.uuid?"option-active":""]),onClick:Be(st=>p(K),["stop"]),key:K.uuid},[r(b,null,{default:u(()=>[K.visible?(U(),oe(V,{key:0,onClick:st=>E(K),size:"18",color:"#409eff"},{default:u(()=>[r(A)]),_:2},1032,["onClick"])):(U(),oe(V,{key:1,size:"18",onClick:st=>E(K)},{default:u(()=>[r(H)]),_:2},1032,["onClick"])),d("div",bs,ve(K.name),1),ae(d("div",Ss,[r(V,{size:"20px",color:"#2a3ff6"},{default:u(()=>[r(D)]),_:1})],512),[[de,y.selectMeshUuid==K.uuid]])]),_:2},1024)],10,Ms))),128))]),_:1})]),w[15]||(w[15]=d("div",{class:"header"},"材质属性",-1)),d("div",{class:j(["options",v.value])},[d("div",Cs,[r(b,null,{default:u(()=>[r(I,{type:"primary",link:""},{default:u(()=>w[9]||(w[9]=[k("材质颜色")])),_:1,__:[9]}),r($,{"color-format":"rgb",predefine:ue(Ge),onChange:S,modelValue:i.color,"onUpdate:modelValue":w[1]||(w[1]=K=>i.color=K)},null,8,["predefine","modelValue"])]),_:1}),r(b,null,{default:u(()=>[r(ie,{effect:"dark",content:"注意：深度写入属性不支持模型“导出” ",placement:"top"},{default:u(()=>[r(V,null,{default:u(()=>[r(B,{size:20,color:"#ffb940"})]),_:1})]),_:1}),r(I,{type:"primary",link:""},{default:u(()=>w[10]||(w[10]=[k("深度写入")])),_:1,__:[10]}),r(we,{onChange:S,modelValue:i.depthWrite,"onUpdate:modelValue":w[2]||(w[2]=K=>i.depthWrite=K)},null,8,["modelValue"])]),_:1}),r(b,null,{default:u(()=>[r(ie,{effect:"dark",content:"注意：网格属性不支持模型“导出” ",placement:"top"},{default:u(()=>[r(V,null,{default:u(()=>[r(B,{size:20,color:"#ffb940"})]),_:1})]),_:1}),r(I,{type:"primary",link:""},{default:u(()=>w[11]||(w[11]=[k("网格")])),_:1,__:[11]}),r(we,{onChange:S,modelValue:i.wireframe,"onUpdate:modelValue":w[3]||(w[3]=K=>i.wireframe=K)},null,8,["modelValue"])]),_:1})]),d("div",As,[d("div",Ts,[r(I,{type:"primary",link:""},{default:u(()=>w[12]||(w[12]=[k("透明度 ")])),_:1,__:[12]})]),d("div",Ls,[r(G,{"show-input":"",onInput:S,onChange:S,modelValue:i.opacity,"onUpdate:modelValue":w[4]||(w[4]=K=>i.opacity=K),min:0,max:1,step:.01},null,8,["modelValue"])])])],2),w[16]||(w[16]=d("div",{class:"header"},"当前材质自带贴图",-1)),d("div",Es,[r(N,{"max-height":"140px"},{default:u(()=>[r(Q,{justify:"center",align:"middle",style:{minHeight:"120px"}},{default:u(()=>[h.value?(U(),oe(X,{key:0,span:10,offse:4,style:{textAlign:"center"}},{default:u(()=>[d("div",{onClick:w[5]||(w[5]=K=>C(h.value)),class:j([g.value==h.value.mapId?"active":"","mesh-image"])},[r(z,{src:h.value.url,class:"mesh-map",fit:"cover"},null,8,["src"]),g.value==h.value.mapId?(U(),Z("div",Is,[r(V,{color:"#18c174",size:26},{default:u(()=>[r(O)]),_:1})])):xe("",!0)],2)]),_:1})):xe("",!0),h.value?(U(),oe(X,{key:1,span:8,style:{textAlign:"center"}},{default:u(()=>[r(W,{action:"",accept:".jpg,.png,.hdr","show-file-list":!1,"auto-upload":!1,"on-change":m},{default:u(()=>[r(ie,{effect:"dark",content:"该功能仅仅作预览，数据无法保存 ",placement:"top"},{default:u(()=>[r(I,{type:"primary",icon:"UploadFilled"},{default:u(()=>w[13]||(w[13]=[k("加载外部贴图")])),_:1,__:[13]})]),_:1})]),_:1})]),_:1})):xe("",!0)]),_:1})]),_:1})]),w[17]||(w[17]=d("div",{class:"header"},"系统贴图",-1)),d("div",{class:j(["options",v.value])},[r(N,{"max-height":"230px"},{default:u(()=>[r(Q,null,{default:u(()=>[(U(!0),Z(fe,null,_e(ue(s),K=>(U(),oe(X,{span:6,style:{textAlign:"center"},key:K.id},{default:u(()=>[d("div",{onClick:st=>P(K),class:j(["image-box",g.value==K.id?"active":""])},[r(z,{src:K.url,class:"el-map",fit:"cover"},null,8,["src"]),g.value==K.id?(U(),Z("div",ks,[r(V,{color:"#18c174",size:26},{default:u(()=>[r(O)]),_:1})])):xe("",!0)],10,Ps)]),_:2},1024))),128))]),_:1})]),_:1})],2)])),[[ee,l.value]])}}},$s=Le(Rs,[["__scopeId","data-v-3fd368ca"]]),Vs={class:"edit-box"},Us={class:"header"},Ds=["onClick"],Os={class:"icon-name"},Fs={class:"check"},zs={class:"option"},Hs={class:"option"},Ns={class:"option"},js={class:"option"},Bs={class:"option"},Gs={class:"option"},Ys={class:"header"},Xs={class:"options"},Ws={__name:"EditAnimation",setup(t,{expose:e}){const o=be(),{$bus:s}=De().proxy,n=me({visible:!1,animationName:null,loop:"LoopRepeat",timeScale:1,weight:1,rotationVisible:!1,rotationType:"y",rotationSpeed:1}),a=ne(()=>n.visible?"":"disabled"),i=ne(()=>n.rotationVisible?"":"disabled"),l=me({modelAnimation:ne(()=>o.modelApi?o.modelApi.modelAnimation:[])});He(()=>{l.modelAnimation.length&&(n.animationName=l.modelAnimation[0].name),s.on(Ee,()=>{if(l.modelAnimation.length){const f=l.modelAnimation[0].name;n.animationName=f}Object.assign(n,{visible:!1,loop:"LoopRepeat",timeScale:1,weight:1,rotationVisible:!1,rotationType:"y",rotationSpeed:1})})});const c=()=>{const{visible:f}=n;f?g():o.modelApi.onClearAnimation()},h=({name:f})=>{n.animationName=f,o.modelApi.onStartModelAnimation(n)},g=()=>{o.modelApi.onStartModelAnimation(n)},v=()=>{o.modelApi.onSetRotation(n)},y=()=>{o.modelApi.onSetRotationType(n)};return e({config:n}),(f,p)=>{const M=x("el-switch"),S=x("Check"),E=x("el-icon"),C=x("el-space"),P=x("el-scrollbar"),m=x("el-empty"),L=x("Switch"),_=x("el-radio-button"),T=x("el-radio-group"),w=x("VideoPlay"),I=x("el-slider"),Y=x("Sort");return U(),Z("div",Vs,[d("div",Us,[p[7]||(p[7]=d("span",null,"模型动画",-1)),r(M,{modelValue:n.visible,"onUpdate:modelValue":p[0]||(p[0]=R=>n.visible=R),onChange:c},null,8,["modelValue"])]),d("div",{class:j(["options",a.value])},[l.modelAnimation.length?(U(),oe(P,{key:0,"max-height":"250px"},{default:u(()=>[(U(!0),Z(fe,null,_e(l.modelAnimation,R=>(U(),Z("div",{class:j(["option",n.animationName==R.name?"option-active":""]),onClick:b=>h(R),key:R.name},[r(C,null,{default:u(()=>[d("div",Os,ve(R.name),1),ae(d("div",Fs,[r(E,{size:"20px",color:"#2a3ff6"},{default:u(()=>[r(S)]),_:1})],512),[[de,n.animationName==R.name]])]),_:2},1024)],10,Ds))),128))]),_:1})):(U(),oe(m,{key:1,description:"暂无动画","image-size":120}))],2),p[20]||(p[20]=d("div",{class:"header"},[d("span",null,"动画配置")],-1)),d("div",{class:j(["options",a.value])},[d("div",zs,[r(C,null,{default:u(()=>[r(E,null,{default:u(()=>[r(L)]),_:1}),p[8]||(p[8]=d("span",null," 循环方式 ",-1))]),_:1,__:[8]})]),d("div",Hs,[r(T,{modelValue:n.loop,"onUpdate:modelValue":p[1]||(p[1]=R=>n.loop=R),onChange:g},{default:u(()=>[r(_,{value:"LoopOnce"},{default:u(()=>p[9]||(p[9]=[k("只执行一次")])),_:1,__:[9]}),r(_,{value:"LoopRepeat"},{default:u(()=>p[10]||(p[10]=[k("无限循环")])),_:1,__:[10]}),r(_,{value:"LoopPingPong"},{default:u(()=>p[11]||(p[11]=[k("来回循环")])),_:1,__:[11]})]),_:1},8,["modelValue"])]),d("div",Ns,[r(C,null,{default:u(()=>[r(E,null,{default:u(()=>[r(w)]),_:1}),p[12]||(p[12]=d("span",null," 播放速度 ",-1))]),_:1,__:[12]})]),d("div",js,[r(I,{"show-input":"",modelValue:n.timeScale,"onUpdate:modelValue":p[2]||(p[2]=R=>n.timeScale=R),onChange:g,step:.01,min:0,max:1},null,8,["modelValue"])]),d("div",Bs,[r(C,null,{default:u(()=>[r(E,null,{default:u(()=>[r(Y)]),_:1}),p[13]||(p[13]=d("span",null," 动作幅度 ",-1))]),_:1,__:[13]})]),d("div",Gs,[r(I,{"show-input":"",modelValue:n.weight,"onUpdate:modelValue":p[3]||(p[3]=R=>n.weight=R),onChange:g,step:.01,min:0,max:1},null,8,["modelValue"])])],2),d("div",Ys,[p[14]||(p[14]=d("span",null,"轴动画",-1)),r(M,{modelValue:n.rotationVisible,"onUpdate:modelValue":p[4]||(p[4]=R=>n.rotationVisible=R),onChange:v},null,8,["modelValue"])]),d("div",Xs,[d("div",{class:j(["option",i.value])},[r(C,null,{default:u(()=>[p[18]||(p[18]=d("span",null," 轴方向 ",-1)),r(T,{modelValue:n.rotationType,"onUpdate:modelValue":p[5]||(p[5]=R=>n.rotationType=R),onChange:y},{default:u(()=>[r(_,{value:"x"},{default:u(()=>p[15]||(p[15]=[k("X轴")])),_:1,__:[15]}),r(_,{value:"y"},{default:u(()=>p[16]||(p[16]=[k("Y轴")])),_:1,__:[16]}),r(_,{value:"z"},{default:u(()=>p[17]||(p[17]=[k("Z轴")])),_:1,__:[17]})]),_:1},8,["modelValue"])]),_:1,__:[18]})],2),d("div",{class:j(["option",i.value])},[r(C,null,{default:u(()=>[r(E,null,{default:u(()=>[r(w)]),_:1}),p[19]||(p[19]=d("span",null," 播放速度 ",-1))]),_:1,__:[19]})],2),d("div",{class:j(["option",i.value])},[r(I,{onInput:v,"show-input":"",modelValue:n.rotationSpeed,"onUpdate:modelValue":p[6]||(p[6]=R=>n.rotationSpeed=R),step:.01,min:1,max:10},null,8,["modelValue"])],2)])])}}},Zs={class:"edit-box"},qs={class:"header"},Qs={class:"option space-between"},Ks={class:"option"},Js={class:"option"},ei={class:"option"},ti={class:"option space-between"},ni={class:"option"},oi={class:"grid-txt"},si={class:"grid-sidle"},ii={class:"option"},ai={class:"grid-txt"},ri={class:"grid-sidle"},li={class:"option"},di={class:"grid-txt"},ci={class:"grid-sidle"},ui={class:"option space-between"},pi={class:"option"},hi={class:"grid-txt"},fi={class:"grid-sidle"},mi={class:"option"},gi={class:"grid-txt"},_i={class:"grid-sidle"},yi={class:"option"},vi={class:"grid-txt"},wi={class:"grid-sidle"},xi={class:"option"},Mi={class:"option"},bi={class:"option space-between"},Si={class:"grid-txt"},Ci={class:"grid-sidle"},Ai={__name:"EditAttribute",setup(t,{expose:e}){const o=be(),{$bus:s}=De().proxy,n=me({visible:!0,gridHelper:!1,x:0,y:0,z:0,positionX:0,positionY:0,positionZ:0,divisions:18,size:6,color:"rgb(193,193,193)",axesHelper:!1,axesSize:1.8}),a=Ge,i=ne(()=>n.visible?"":"disabled"),l=ne(()=>{const{visible:P,gridHelper:m}=n;return m&&P?"":"disabled"}),c=ne(()=>{const{visible:P,axesHelper:m}=n;return m&&P?"":"disabled"});He(()=>{s.on(Ee,()=>{Object.assign(n,{visible:!0,gridHelper:!1,x:0,y:0,z:0,positionX:0,positionY:0,positionZ:0,divisions:18,size:6,color:"rgb(193,193,193)",axesHelper:!1,axesSize:1.8})})});const h=()=>{},g=(P,m)=>{const L=m=="right";o.modelApi.onSetModelRotateOnAxis(P,L)},v=()=>{o.modelApi.onResultModelRotateOnAxis()},y=()=>{o.modelApi.onSetModelPosition(n)},f=()=>{n.positionX=0,n.positionY=0,n.positionZ=0,o.modelApi.onResultModelPosition(n)},p=P=>{n.color=P,o.modelApi.onSetModelGridHelper(n)},M=()=>{o.modelApi.onSetModelGridHelper(n)},S=()=>{o.modelApi.onSetModelGridHelperSize(n)},E=()=>{o.modelApi.onSetModelAxesHelper(n)};return e({getAttributeConfig:()=>{const{x:P,y:m,z:L}=o.modelApi.model.rotation;return{...n,rotationX:P,rotationY:m,rotationZ:L}}}),(P,m)=>{const L=x("el-switch"),_=x("Setting"),T=x("el-icon"),w=x("el-space"),I=x("el-button"),Y=x("Location"),R=x("el-slider"),b=x("Grid"),A=x("el-input-number"),V=x("el-color-picker"),H=x("Rank");return U(),Z("div",Zs,[d("div",qs,[m[19]||(m[19]=d("span",null,"辅助线/轴配置",-1)),r(L,{modelValue:n.visible,"onUpdate:modelValue":m[0]||(m[0]=D=>n.visible=D),onChange:h},null,8,["modelValue"])]),d("div",{class:j(["options",i.value])},[d("div",Qs,[r(w,null,{default:u(()=>[r(T,null,{default:u(()=>[r(_)]),_:1}),m[20]||(m[20]=d("span",null," 模型轴旋转 ",-1))]),_:1,__:[20]}),r(I,{type:"primary",link:"",icon:"Refresh",onClick:v,plain:""},{default:u(()=>m[21]||(m[21]=[k(" 重置 ")])),_:1,__:[21]})]),d("div",Ks,[r(I,{type:"info",icon:"RefreshRight",onClick:m[1]||(m[1]=D=>g("x","right"))}),r(I,{type:"primary",link:""},{default:u(()=>m[22]||(m[22]=[k("X轴")])),_:1,__:[22]}),r(I,{type:"info",icon:"RefreshLeft",onClick:m[2]||(m[2]=D=>g("x","left"))})]),d("div",Js,[r(I,{type:"info",icon:"RefreshRight",onClick:m[3]||(m[3]=D=>g("y","right"))}),r(I,{type:"primary",link:""},{default:u(()=>m[23]||(m[23]=[k("Y轴")])),_:1,__:[23]}),r(I,{type:"info",icon:"RefreshLeft",onClick:m[4]||(m[4]=D=>g("y","left"))})]),d("div",ei,[r(I,{type:"info",icon:"RefreshRight",onClick:m[5]||(m[5]=D=>g("z","right"))}),r(I,{type:"primary",link:""},{default:u(()=>m[24]||(m[24]=[k("Z轴")])),_:1,__:[24]}),r(I,{type:"info",icon:"RefreshLeft",onClick:m[6]||(m[6]=D=>g("z","left"))})]),d("div",ti,[r(w,null,{default:u(()=>[r(T,null,{default:u(()=>[r(Y)]),_:1}),m[25]||(m[25]=d("span",null," 模型位置 ",-1))]),_:1,__:[25]}),r(I,{type:"primary",link:"",icon:"Refresh",onClick:f,plain:""},{default:u(()=>m[26]||(m[26]=[k(" 重置 ")])),_:1,__:[26]})]),d("div",ni,[d("div",oi,[r(I,{type:"primary",link:""},{default:u(()=>m[27]||(m[27]=[k("X 轴")])),_:1,__:[27]})]),d("div",si,[r(R,{onInput:y,"show-input":"",modelValue:n.positionX,"onUpdate:modelValue":m[7]||(m[7]=D=>n.positionX=D),min:-10,max:10,step:.1},null,8,["modelValue"])])]),d("div",ii,[d("div",ai,[r(I,{type:"primary",link:""},{default:u(()=>m[28]||(m[28]=[k("Y 轴")])),_:1,__:[28]})]),d("div",ri,[r(R,{onInput:y,"show-input":"",modelValue:n.positionY,"onUpdate:modelValue":m[8]||(m[8]=D=>n.positionY=D),min:-10,max:10,step:.1},null,8,["modelValue"])])]),d("div",li,[d("div",di,[r(I,{type:"primary",link:""},{default:u(()=>m[29]||(m[29]=[k("Z 轴")])),_:1,__:[29]})]),d("div",ci,[r(R,{onInput:y,"show-input":"",modelValue:n.positionZ,"onUpdate:modelValue":m[9]||(m[9]=D=>n.positionZ=D),min:-10,max:10,step:.1},null,8,["modelValue"])])])],2),d("div",{class:j(["options",i.value])},[d("div",ui,[r(w,null,{default:u(()=>[r(T,null,{default:u(()=>[r(b)]),_:1}),m[30]||(m[30]=d("span",null," 网格辅助线 ",-1))]),_:1,__:[30]}),r(L,{modelValue:n.gridHelper,"onUpdate:modelValue":m[10]||(m[10]=D=>n.gridHelper=D),onChange:M},null,8,["modelValue"])])],2),d("div",{class:j(["options",l.value])},[d("div",pi,[d("div",hi,[r(I,{type:"primary",link:""},{default:u(()=>m[31]||(m[31]=[k("X 轴")])),_:1,__:[31]})]),d("div",fi,[r(R,{"show-input":"",onInput:M,modelValue:n.x,"onUpdate:modelValue":m[11]||(m[11]=D=>n.x=D),min:-2,max:4,step:.01},null,8,["modelValue"])])]),d("div",mi,[d("div",gi,[r(I,{type:"primary",link:""},{default:u(()=>m[32]||(m[32]=[k("Y 轴")])),_:1,__:[32]})]),d("div",_i,[r(R,{"show-input":"",onInput:M,modelValue:n.y,"onUpdate:modelValue":m[12]||(m[12]=D=>n.y=D),min:-2,max:4,step:.01},null,8,["modelValue"])])]),d("div",yi,[d("div",vi,[r(I,{type:"primary",link:""},{default:u(()=>m[33]||(m[33]=[k("Z 轴")])),_:1,__:[33]})]),d("div",wi,[r(R,{"show-input":"",onInput:M,modelValue:n.z,"onUpdate:modelValue":m[13]||(m[13]=D=>n.z=D),min:-2,max:4,step:.01},null,8,["modelValue"])])]),d("div",xi,[d("div",null,[r(I,{type:"primary",link:""},{default:u(()=>m[34]||(m[34]=[k("大小")])),_:1,__:[34]}),r(A,{controls:!0,onChange:S,modelValue:n.size,"onUpdate:modelValue":m[14]||(m[14]=D=>n.size=D),min:1,max:40},null,8,["modelValue"])]),d("div",null,[r(I,{type:"primary",link:""},{default:u(()=>m[35]||(m[35]=[k("分割数")])),_:1,__:[35]}),r(A,{controls:!0,onChange:S,modelValue:n.divisions,"onUpdate:modelValue":m[15]||(m[15]=D=>n.divisions=D),min:1,max:40},null,8,["modelValue"])])]),d("div",Mi,[r(w,null,{default:u(()=>[r(I,{type:"primary",link:""},{default:u(()=>m[36]||(m[36]=[k("网格颜色")])),_:1,__:[36]}),r(V,{"color-format":"hex",predefine:ue(a),onChange:M,onActiveChange:p,modelValue:n.color,"onUpdate:modelValue":m[16]||(m[16]=D=>n.color=D)},null,8,["predefine","modelValue"])]),_:1})])],2),d("div",{class:j(["options",i.value])},[d("div",bi,[r(w,null,{default:u(()=>[r(T,null,{default:u(()=>[r(H)]),_:1}),m[37]||(m[37]=d("span",null," 坐标轴辅助线 ",-1))]),_:1,__:[37]}),r(L,{modelValue:n.axesHelper,"onUpdate:modelValue":m[17]||(m[17]=D=>n.axesHelper=D),onChange:E},null,8,["modelValue"])]),d("div",{class:j(["option",c.value])},[d("div",Si,[r(I,{type:"primary",link:""},{default:u(()=>m[38]||(m[38]=[k("轴长度")])),_:1,__:[38]})]),d("div",Ci,[r(R,{onInput:E,modelValue:n.axesSize,"onUpdate:modelValue":m[18]||(m[18]=D=>n.axesSize=D),min:1,max:10,step:.2},null,8,["modelValue"])])],2)],2)])}}},Ti={class:"edit-box"},Li={class:"header"},Ei={class:"options"},Ii={class:"option space-between"},Pi={class:"color"},ki={class:"silder"},Ri={class:"options"},$i={class:"option space-between"},Vi={class:"color"},Ui={class:"silder"},Di={class:"grid-txt"},Oi={class:"grid-sidle"},Fi={class:"grid-txt"},zi={class:"grid-sidle"},Hi={class:"grid-txt"},Ni={class:"grid-sidle"},ji={class:"grid-txt"},Bi={class:"grid-sidle"},Gi={class:"grid-txt"},Yi={class:"grid-sidle"},Xi={class:"options"},Wi={class:"option space-between"},Zi={class:"grid-txt"},qi={class:"grid-sidle"},Qi={class:"color"},Ki={class:"silder"},Ji={class:"grid-txt"},ea={class:"grid-sidle"},ta={class:"grid-txt"},na={class:"grid-sidle"},oa={class:"grid-txt"},sa={class:"grid-sidle"},ia={class:"options"},aa={class:"option space-between"},ra={class:"color"},la={class:"silder"},da={class:"grid-txt"},ca={class:"grid-sidle"},ua={class:"grid-txt"},pa={class:"grid-sidle"},ha={class:"grid-txt"},fa={class:"grid-sidle"},ma={class:"grid-txt"},ga={class:"grid-sidle"},_a={class:"grid-txt"},ya={class:"grid-sidle"},va={class:"grid-txt"},wa={class:"grid-sidle"},xa={class:"grid-txt"},Ma={class:"grid-sidle"},ba={class:"grid-txt"},Sa={class:"grid-sidle"},Ca={class:"grid-txt"},Aa={class:"grid-sidle"},Ta={__name:"EditLight",setup(t,{expose:e}){const o=be(),{$bus:s}=De().proxy,n=me({ambientLight:!0,ambientLightColor:"#fff",ambientLightIntensity:1,directionalLight:!1,directionalLightHelper:!0,directionalLightColor:"#fff",directionalLightIntensity:5,directionalHorizontal:-1.26,directionalVertical:-3.85,directionalSistine:2.98,directionShadow:!0,pointLight:!1,pointLightHelper:!0,pointLightColor:"#1E90FF",pointLightIntensity:10,pointHorizontal:-4.21,pointVertical:-4.1,pointDistance:2.53,spotLight:!1,spotLightColor:"#00BABD",spotLightIntensity:900,spotHorizontal:-3.49,spotVertical:-4.37,spotSistine:4.09,spotAngle:.5,spotPenumbra:1,spotFocus:1,spotCastShadow:!0,spotLightHelper:!0,spotDistance:20}),a=Ge,i=ne(()=>{const{ambientLight:L}=n;return L?"":"disabled"}),l=ne(()=>{const{directionalLight:L}=n;return L?"":"disabled"}),c=ne(()=>{const{pointLight:L}=n;return L?"":"disabled"}),h=ne(()=>{const{spotLight:L}=n;return L?"":"disabled"}),g=me({modelApi:ne(()=>o.modelApi)});He(()=>{s.on(Ee,()=>{P()})});const v=L=>{n.ambientLightColor=L,g.modelApi.onSetModelAmbientLight(n)},y=()=>{g.modelApi.onSetModelAmbientLight(n)},f=L=>{n.directionalLightColor=L,g.modelApi.onSetModelDirectionalLight(n)},p=()=>{g.modelApi.onSetModelDirectionalLight(n)},M=L=>{n.pointLightColor=L,g.modelApi.onSetModelPointLight(n)},S=()=>{g.modelApi.onSetModelPointLight(n)},E=L=>{n.spotLightColor=L,g.modelApi.onSetModelSpotLight(n)},C=()=>{g.modelApi.onSetModelSpotLight(n)},P=()=>{Object.assign(n,{ambientLight:!0,ambientLightColor:"#fff",ambientLightIntensity:1,directionalLight:!1,directionalLightHelper:!0,directionalLightColor:"#fff",directionalLightIntensity:5,directionalHorizontal:-1.26,directionalVertical:-3.85,directionalSistine:2.98,directionShadow:!0,pointLight:!1,pointLightHelper:!0,pointLightColor:"#1E90FF",pointLightIntensity:10,pointHorizontal:-4.21,pointVertical:-4.1,pointDistance:2.53,spotLight:!1,spotLightColor:"#00BABD",spotLightIntensity:900,spotHorizontal:-3.49,spotVertical:-4.37,spotSistine:4.09,spotAngle:.5,spotPenumbra:1,spotFocus:1,spotCastShadow:!0,spotLightHelper:!0,spotDistance:20})},m=()=>{P(),g.modelApi.onResettingLight({ambientLight:!0})};return e({config:n}),(L,_)=>{const T=x("el-button"),w=x("Odometer"),I=x("el-icon"),Y=x("el-space"),R=x("el-switch"),b=x("el-color-picker"),A=x("el-slider"),V=x("SetUp"),H=x("Place"),D=x("Orange"),N=x("el-scrollbar");return U(),Z("div",Ti,[d("div",Li,[_[31]||(_[31]=d("span",null,"模型灯光",-1)),r(T,{type:"primary",icon:"Refresh",onClick:m,plain:""},{default:u(()=>_[30]||(_[30]=[k(" 重置 ")])),_:1,__:[30]})]),r(N,{height:"calc(100vh - 130px)"},{default:u(()=>[d("div",Ei,[d("div",Ii,[r(Y,null,{default:u(()=>[r(I,null,{default:u(()=>[r(w)]),_:1}),_[32]||(_[32]=d("span",null,"环境光",-1))]),_:1,__:[32]}),r(R,{modelValue:n.ambientLight,"onUpdate:modelValue":_[0]||(_[0]=$=>n.ambientLight=$),onChange:y},null,8,["modelValue"])]),d("div",{class:j(["option",i.value])},[d("div",Pi,[r(b,{"color-format":"hex",modelValue:n.ambientLightColor,"onUpdate:modelValue":_[1]||(_[1]=$=>n.ambientLightColor=$),predefine:ue(a),onChange:y,onActiveChange:v},null,8,["modelValue","predefine"])]),d("div",ki,[r(A,{"show-input":"",onInput:y,modelValue:n.ambientLightIntensity,"onUpdate:modelValue":_[2]||(_[2]=$=>n.ambientLightIntensity=$),min:-5,max:5,step:.01},null,8,["modelValue"])])],2)]),d("div",Ri,[d("div",$i,[r(Y,null,{default:u(()=>[r(I,null,{default:u(()=>[r(V)]),_:1}),_[33]||(_[33]=d("span",null,"平行光",-1))]),_:1,__:[33]}),r(R,{modelValue:n.directionalLight,"onUpdate:modelValue":_[3]||(_[3]=$=>n.directionalLight=$),onChange:p},null,8,["modelValue"])]),d("div",{class:j(["option",l.value])},[d("div",Vi,[r(b,{"color-format":"hex",modelValue:n.directionalLightColor,"onUpdate:modelValue":_[4]||(_[4]=$=>n.directionalLightColor=$),predefine:ue(a),onChange:p,onActiveChange:f},null,8,["modelValue","predefine"])]),d("div",Ui,[r(A,{"show-input":"",onInput:p,modelValue:n.directionalLightIntensity,"onUpdate:modelValue":_[5]||(_[5]=$=>n.directionalLightIntensity=$),min:-5,max:15,step:.01},null,8,["modelValue"])])],2),d("div",{class:j(["option",l.value])},[d("div",Di,[r(T,{type:"primary",link:""},{default:u(()=>_[34]||(_[34]=[k("是否开启阴影")])),_:1,__:[34]})]),d("div",Oi,[r(R,{modelValue:n.directionShadow,"onUpdate:modelValue":_[6]||(_[6]=$=>n.directionShadow=$),onChange:p},null,8,["modelValue"])]),r(Y,null,{default:u(()=>[d("div",Fi,[r(T,{type:"primary",link:""},{default:u(()=>_[35]||(_[35]=[k("辅助线")])),_:1,__:[35]})]),d("div",zi,[r(R,{modelValue:n.directionalLightHelper,"onUpdate:modelValue":_[7]||(_[7]=$=>n.directionalLightHelper=$),onChange:p},null,8,["modelValue"])])]),_:1})],2),d("div",{class:j(["option",l.value])},[d("div",Hi,[r(T,{type:"primary",link:""},{default:u(()=>_[36]||(_[36]=[k("水平方向")])),_:1,__:[36]})]),d("div",Ni,[r(A,{"show-input":"",onInput:p,modelValue:n.directionalHorizontal,"onUpdate:modelValue":_[8]||(_[8]=$=>n.directionalHorizontal=$),min:-10,max:10,step:.01},null,8,["modelValue"])])],2),d("div",{class:j(["option",l.value])},[d("div",ji,[r(T,{type:"primary",link:""},{default:u(()=>_[37]||(_[37]=[k("垂直方向")])),_:1,__:[37]})]),d("div",Bi,[r(A,{"show-input":"",onInput:p,modelValue:n.directionalVertical,"onUpdate:modelValue":_[9]||(_[9]=$=>n.directionalVertical=$),min:-10,max:10,step:.01},null,8,["modelValue"])])],2),d("div",{class:j(["option",l.value])},[d("div",Gi,[r(T,{type:"primary",link:""},{default:u(()=>_[38]||(_[38]=[k("光源距离")])),_:1,__:[38]})]),d("div",Yi,[r(A,{"show-input":"",onInput:p,modelValue:n.directionalSistine,"onUpdate:modelValue":_[10]||(_[10]=$=>n.directionalSistine=$),min:0,max:10,step:.01},null,8,["modelValue"])])],2)]),d("div",Xi,[d("div",Wi,[r(Y,null,{default:u(()=>[r(I,null,{default:u(()=>[r(H)]),_:1}),_[39]||(_[39]=d("span",null,"点光源",-1))]),_:1,__:[39]}),r(R,{modelValue:n.pointLight,"onUpdate:modelValue":_[11]||(_[11]=$=>n.pointLight=$),onChange:S},null,8,["modelValue"])]),d("div",{class:j(["option",c.value])},[r(Y,null,{default:u(()=>[d("div",Zi,[r(T,{type:"primary",link:""},{default:u(()=>_[40]||(_[40]=[k("辅助线")])),_:1,__:[40]})]),d("div",qi,[r(R,{modelValue:n.pointLightHelper,"onUpdate:modelValue":_[12]||(_[12]=$=>n.pointLightHelper=$),onChange:S},null,8,["modelValue"])])]),_:1})],2),d("div",{class:j(["option",c.value])},[d("div",Qi,[r(b,{"color-format":"hex",modelValue:n.pointLightColor,"onUpdate:modelValue":_[13]||(_[13]=$=>n.pointLightColor=$),predefine:ue(a),onChange:S,onActiveChange:M},null,8,["modelValue","predefine"])]),d("div",Ki,[r(A,{"show-input":"",onInput:S,modelValue:n.pointLightIntensity,"onUpdate:modelValue":_[14]||(_[14]=$=>n.pointLightIntensity=$),min:-20,max:60,step:.1},null,8,["modelValue"])])],2),d("div",{class:j(["option",c.value])},[d("div",Ji,[r(T,{type:"primary",link:""},{default:u(()=>_[41]||(_[41]=[k("水平方向")])),_:1,__:[41]})]),d("div",ea,[r(A,{"show-input":"",onInput:S,modelValue:n.pointHorizontal,"onUpdate:modelValue":_[15]||(_[15]=$=>n.pointHorizontal=$),min:-10,max:10,step:.11},null,8,["modelValue"])])],2),d("div",{class:j(["option",c.value])},[d("div",ta,[r(T,{type:"primary",link:""},{default:u(()=>_[42]||(_[42]=[k("垂直方向")])),_:1,__:[42]})]),d("div",na,[r(A,{"show-input":"",onInput:S,modelValue:n.pointVertical,"onUpdate:modelValue":_[16]||(_[16]=$=>n.pointVertical=$),min:-10,max:10,step:.1},null,8,["modelValue"])])],2),d("div",{class:j(["option",c.value])},[d("div",oa,[r(T,{type:"primary",link:""},{default:u(()=>_[43]||(_[43]=[k("光源距离")])),_:1,__:[43]})]),d("div",sa,[r(A,{"show-input":"",onInput:S,modelValue:n.pointDistance,"onUpdate:modelValue":_[17]||(_[17]=$=>n.pointDistance=$),min:0,max:10,step:.1},null,8,["modelValue"])])],2)]),d("div",ia,[d("div",aa,[r(Y,null,{default:u(()=>[r(I,null,{default:u(()=>[r(D)]),_:1}),_[44]||(_[44]=d("span",null,"聚光灯",-1))]),_:1,__:[44]}),r(R,{modelValue:n.spotLight,"onUpdate:modelValue":_[18]||(_[18]=$=>n.spotLight=$),onChange:C},null,8,["modelValue"])]),d("div",{class:j(["option",h.value])},[d("div",ra,[r(b,{"color-format":"hex",modelValue:n.spotLightColor,"onUpdate:modelValue":_[19]||(_[19]=$=>n.spotLightColor=$),predefine:ue(a),onChange:C,onActiveChange:E},null,8,["modelValue","predefine"])]),d("div",la,[r(A,{"show-input":"",onInput:C,modelValue:n.spotLightIntensity,"onUpdate:modelValue":_[20]||(_[20]=$=>n.spotLightIntensity=$),min:0,max:2e3,step:.1},null,8,["modelValue"])])],2),d("div",{class:j(["option",h.value])},[d("div",da,[r(T,{type:"primary",link:""},{default:u(()=>_[45]||(_[45]=[k("是否开启阴影")])),_:1,__:[45]})]),d("div",ca,[r(R,{modelValue:n.spotCastShadow,"onUpdate:modelValue":_[21]||(_[21]=$=>n.spotCastShadow=$),onChange:C},null,8,["modelValue"])]),r(Y,null,{default:u(()=>[d("div",ua,[r(T,{type:"primary",link:""},{default:u(()=>_[46]||(_[46]=[k("辅助线")])),_:1,__:[46]})]),d("div",pa,[r(R,{modelValue:n.spotLightHelper,"onUpdate:modelValue":_[22]||(_[22]=$=>n.spotLightHelper=$),onChange:C},null,8,["modelValue"])])]),_:1})],2),d("div",{class:j(["option",h.value])},[d("div",ha,[r(T,{type:"primary",link:""},{default:u(()=>_[47]||(_[47]=[k("水平方向")])),_:1,__:[47]})]),d("div",fa,[r(A,{"show-input":"",onInput:C,modelValue:n.spotHorizontal,"onUpdate:modelValue":_[23]||(_[23]=$=>n.spotHorizontal=$),min:-10,max:10,step:.1},null,8,["modelValue"])])],2),d("div",{class:j(["option",h.value])},[d("div",ma,[r(T,{type:"primary",link:""},{default:u(()=>_[48]||(_[48]=[k("垂直方向")])),_:1,__:[48]})]),d("div",ga,[r(A,{"show-input":"",onInput:C,modelValue:n.spotVertical,"onUpdate:modelValue":_[24]||(_[24]=$=>n.spotVertical=$),min:-10,max:10,step:.1},null,8,["modelValue"])])],2),d("div",{class:j(["option",h.value])},[d("div",_a,[r(T,{type:"primary",link:""},{default:u(()=>_[49]||(_[49]=[k("光源距离")])),_:1,__:[49]})]),d("div",ya,[r(A,{"show-input":"",onInput:C,modelValue:n.spotSistine,"onUpdate:modelValue":_[25]||(_[25]=$=>n.spotSistine=$),min:0,max:10,step:.1},null,8,["modelValue"])])],2),d("div",{class:j(["option",h.value])},[d("div",va,[r(T,{type:"primary",link:""},{default:u(()=>_[50]||(_[50]=[k("光线照射范围")])),_:1,__:[50]})]),d("div",wa,[r(A,{"show-input":"",onInput:C,modelValue:n.spotAngle,"onUpdate:modelValue":_[26]||(_[26]=$=>n.spotAngle=$),min:0,max:2,step:.01},null,8,["modelValue"])])],2),d("div",{class:j(["option",h.value])},[d("div",xa,[r(T,{type:"primary",link:""},{default:u(()=>_[51]||(_[51]=[k("边缘聚光度")])),_:1,__:[51]})]),d("div",Ma,[r(A,{"show-input":"",onInput:C,modelValue:n.spotPenumbra,"onUpdate:modelValue":_[27]||(_[27]=$=>n.spotPenumbra=$),min:0,max:1,step:.01},null,8,["modelValue"])])],2),d("div",{class:j(["option",h.value])},[d("div",ba,[r(T,{type:"primary",link:""},{default:u(()=>_[52]||(_[52]=[k("投影聚焦度")])),_:1,__:[52]})]),d("div",Sa,[r(A,{"show-input":"",onInput:C,modelValue:n.spotFocus,"onUpdate:modelValue":_[28]||(_[28]=$=>n.spotFocus=$),min:0,max:3,step:.01},null,8,["modelValue"])])],2),d("div",{class:j(["option",h.value])},[d("div",Ca,[r(T,{type:"primary",link:""},{default:u(()=>_[53]||(_[53]=[k("光源照射距离")])),_:1,__:[53]})]),d("div",Aa,[r(A,{"show-input":"",onInput:C,modelValue:n.spotDistance,"onUpdate:modelValue":_[29]||(_[29]=$=>n.spotDistance=$),min:1,max:500,step:1},null,8,["modelValue"])])],2)])]),_:1})])}}},La=Le(Ta,[["__scopeId","data-v-d2c2b030"]]),Ea={class:"edit-box"},Ia={class:"header"},Pa={class:"options"},ka={class:"option space-between"},Ra={class:"option"},$a={class:"grid-txt"},Va={class:"grid-sidle"},Ua={class:"option"},Da={class:"grid-txt"},Oa={class:"grid-sidle"},Fa={class:"option"},za={class:"grid-txt"},Ha={class:"grid-sidle"},Na={class:"option"},ja={class:"grid-txt"},Ba={class:"grid-sidle"},Ga={class:"options"},Ya={class:"option space-between"},Xa={class:"grid-sidle"},Wa={class:"header"},Za={class:"options"},qa={class:"grid-sidle"},Qa={class:"grid-sidle"},Ka={class:"grid-sidle"},Ja={__name:"EditLaterStage",setup(t,{expose:e}){const o=be(),{$bus:s}=De().proxy,n=ne(()=>{const{glow:E}=c;return E?"":"disabled"}),a=ne(()=>{const E=o.modelApi.modelMaterialList,C=E.filter(P=>P.type=="Mesh");return C.length<=1||C.length!=E.length||c.manageFlag?"disabled":""}),i=ne(()=>{const E=o.modelApi.modelMaterialList,C=E.filter(P=>P.type=="Mesh");return C.length<=1||C.length!=E.length?"disabled":""}),l=ne(()=>c.manageFlag?"":"disabled"),c=me({glow:!1,threshold:.05,strength:.6,radius:1,decompose:0,transformType:"translate",manageFlag:!1,manageFlag:!1,toneMappingExposure:1,color:""});He(()=>{s.on(Ee,()=>{Object.assign(c,{glow:!1,threshold:.05,strength:.6,radius:1,decompose:0,transformType:"translate",manageFlag:!1,toneMappingExposure:1})})});const h=()=>{o.modelApi.onSetFlowColor(c.color)},g=E=>{c.color=E,o.modelApi.onSetFlowColor(c.color)},v=()=>{o.modelApi.onSetUnrealBloomPass(c)},y=()=>{o.modelApi.setModelMeshDecompose(c)},f=()=>{c.decompose=0,o.modelApi.setModelMeshDrag(c)},p=E=>{o.modelApi.setTransformControlsType(E)},M=()=>{Object.assign(c,{glow:!1,threshold:.05,strength:.6,radius:1,decompose:0,transformType:"translate",manageFlag:!1,toneMappingExposure:1}),o.modelApi.initStageFlow()};return e({getStageConfig:()=>({meshPositionList:o.modelApi.getMeshDragPosition(),...c})}),(E,C)=>{const P=x("el-button"),m=x("Sunny"),L=x("el-icon"),_=x("el-space"),T=x("WarnTriangleFilled"),w=x("el-switch"),I=x("el-tooltip"),Y=x("el-color-picker"),R=x("el-slider"),b=x("Umbrella"),A=x("Cpu"),V=x("Rank"),H=x("el-radio-button"),D=x("el-radio-group");return U(),Z("div",Ea,[d("div",Ia,[C[10]||(C[10]=d("span",null,"后期处理",-1)),r(P,{type:"primary",icon:"Refresh",onClick:M,plain:""},{default:u(()=>C[9]||(C[9]=[k(" 重置 ")])),_:1,__:[9]})]),d("div",Pa,[d("div",ka,[r(_,null,{default:u(()=>[r(L,null,{default:u(()=>[r(m)]),_:1}),C[11]||(C[11]=d("span",null," 辉光 ",-1))]),_:1,__:[11]}),r(I,{effect:"dark",content:"注意：辉光效果十分耗费性能，大模型文件开启会有卡顿，请谨慎使用 ",placement:"top"},{default:u(()=>[r(_,null,{default:u(()=>[r(L,null,{default:u(()=>[r(T,{size:20,color:"#ffb940"})]),_:1}),r(w,{modelValue:c.glow,"onUpdate:modelValue":C[0]||(C[0]=N=>c.glow=N),onChange:v},null,8,["modelValue"])]),_:1})]),_:1})])]),d("div",{class:j(["options",n.value])},[d("div",Ra,[d("div",$a,[r(P,{type:"primary",link:""},{default:u(()=>C[12]||(C[12]=[k("颜色")])),_:1,__:[12]})]),d("div",Va,[r(Y,{"color-format":"hex",predefine:ue(Ge),onChange:h,onActiveChange:g,modelValue:c.color,"onUpdate:modelValue":C[1]||(C[1]=N=>c.color=N)},null,8,["predefine","modelValue"])])]),d("div",Ua,[d("div",Da,[r(P,{type:"primary",link:""},{default:u(()=>C[13]||(C[13]=[k("强度")])),_:1,__:[13]})]),d("div",Oa,[r(R,{"show-input":"",modelValue:c.strength,"onUpdate:modelValue":C[2]||(C[2]=N=>c.strength=N),onInput:v,step:.01,min:0,max:8},null,8,["modelValue"])])]),d("div",Fa,[d("div",za,[r(P,{type:"primary",link:""},{default:u(()=>C[14]||(C[14]=[k("半径")])),_:1,__:[14]})]),d("div",Ha,[r(R,{"show-input":"",modelValue:c.radius,"onUpdate:modelValue":C[3]||(C[3]=N=>c.radius=N),onInput:v,step:.01,min:0,max:5},null,8,["modelValue"])])]),d("div",Na,[d("div",ja,[r(P,{type:"primary",link:""},{default:u(()=>C[15]||(C[15]=[k("阈值")])),_:1,__:[15]})]),d("div",Ba,[r(R,{"show-input":"",modelValue:c.threshold,"onUpdate:modelValue":C[4]||(C[4]=N=>c.threshold=N),onInput:v,step:.01,min:0,max:1},null,8,["modelValue"])])])],2),d("div",Ga,[d("div",Ya,[r(_,null,{default:u(()=>[r(L,null,{default:u(()=>[r(b)]),_:1}),C[16]||(C[16]=d("span",null," 色调曝光度 ",-1))]),_:1,__:[16]}),d("div",Xa,[r(R,{"show-input":"",modelValue:c.toneMappingExposure,"onUpdate:modelValue":C[5]||(C[5]=N=>c.toneMappingExposure=N),onInput:v,step:.01,min:.5,max:10},null,8,["modelValue"])])])]),d("div",Wa,[r(_,null,{default:u(()=>[C[17]||(C[17]=d("span",null,"模型操作",-1)),a.value=="disabled"?(U(),oe(I,{key:0,effect:"dark",content:"当前模型不可进行以下操作",placement:"top"},{default:u(()=>[r(L,null,{default:u(()=>[r(T,{size:20,color:"#ffb940"})]),_:1})]),_:1})):xe("",!0)]),_:1,__:[17]})]),d("div",Za,[d("div",{class:j(["option space-between",a.value])},[r(_,null,{default:u(()=>[r(L,null,{default:u(()=>[r(A)]),_:1}),C[18]||(C[18]=d("span",null," 模型分解 ",-1))]),_:1,__:[18]}),d("div",qa,[r(R,{"show-input":"",modelValue:c.decompose,"onUpdate:modelValue":C[6]||(C[6]=N=>c.decompose=N),onInput:y,step:.01,min:0,max:800},null,8,["modelValue"])])],2),d("div",{class:j(["option",i.value])},[r(_,null,{default:u(()=>[r(L,null,{default:u(()=>[r(V,{size:20})]),_:1}),C[19]||(C[19]=d("span",null," 模型材质操作 ",-1))]),_:1,__:[19]}),d("div",Qa,[r(w,{modelValue:c.manageFlag,"onUpdate:modelValue":C[7]||(C[7]=N=>c.manageFlag=N),onChange:f},null,8,["modelValue"])])],2),d("div",{class:j(["option",l.value])},[d("div",Ka,[r(D,{modelValue:c.transformType,"onUpdate:modelValue":C[8]||(C[8]=N=>c.transformType=N),onChange:p},{default:u(()=>[r(H,{value:"translate"},{default:u(()=>C[20]||(C[20]=[k("拖拽")])),_:1,__:[20]}),r(H,{value:"rotate"},{default:u(()=>C[21]||(C[21]=[k("旋转")])),_:1,__:[21]}),r(H,{value:"scale"},{default:u(()=>C[22]||(C[22]=[k("缩放")])),_:1,__:[22]})]),_:1},8,["modelValue"])])],2)])])}}},er={class:"edit-box"},tr={class:"options"},nr=["onClick"],or={class:"icon-name"},sr={class:"check"},ir={class:"icon-delete"},ar={class:"options"},rr={class:"grid-txt"},lr={class:"grid-sidle"},dr={key:1},cr={__name:"EditGeometry",setup(t){const e=be(),o=me({materialName:null,type:null}),s=te(null),n=te([]),a=ne(()=>i.modelMaterialList.filter(y=>y.userData.geometry)!=0),i=me({modelMaterialList:ne(()=>e.modelApi.modelMaterialList),selectMeshUuid:ne(()=>e.selectMeshUuid)});mn(()=>e.selectMeshUuid,v=>{const{geometry:y}=i.modelMaterialList.find(f=>f.uuid==v)||{};if(y){const{type:f}=y;s.value={...y.parameters},o.type=f,n.value=Object.keys(s.value)}else n.value=[]});const l=({name:v,material:y,geometry:f})=>{o.materialName=y.name,e.modelApi.onChangeModelMaterial(v)},c=()=>{e.modelApi.onSetGeometryMesh(s.value,o.type)},h=v=>{e.modelApi.onDeleteGeometryMesh(v),e.selectMeshAction({}),ce.success("删除成功")},g=v=>{let y={min:1,max:80,step:.01};return["width","height","radius","length","thetaLength","radiusTop","innerRadius","radiusBottom","q","outerRadius","arc","tube","p"].includes(v)&&(y={min:.1,max:10,step:.01}),["detail","capSegments","radialSegments","thetaStart","depthSegments","widthSegments","heightSegments"].includes(v)&&(y={min:0,max:10,step:1}),y};return(v,y)=>{const f=x("Check"),p=x("el-icon"),M=x("Delete"),S=x("el-space"),E=x("el-scrollbar"),C=x("el-button"),P=x("el-slider"),m=x("el-switch"),L=x("el-empty");return U(),Z("div",er,[a.value?(U(),Z(fe,{key:0},[y[0]||(y[0]=d("div",{class:"header"},[d("span",null,"几何体模型材质列表")],-1)),d("div",tr,[r(E,{"max-height":"300px"},{default:u(()=>[(U(!0),Z(fe,null,_e(i.modelMaterialList,_=>(U(),Z("div",{class:j(["option",i.selectMeshUuid==_.uuid?"option-active":""]),onClick:T=>l(_),key:_.uuid},[d("div",or,ve(_.name),1),r(S,null,{default:u(()=>[ae(d("div",sr,[r(p,{size:"20px",color:"#2a3ff6"},{default:u(()=>[r(f)]),_:1})],512),[[de,i.selectMeshUuid==_.uuid]]),d("div",ir,[r(p,{size:"18px",color:"#2a3ff6"},{default:u(()=>[r(M,{onClick:Be(T=>h(_.uuid),["stop"])},null,8,["onClick"])]),_:2},1024)])]),_:2},1024)],10,nr))),128))]),_:1})]),y[1]||(y[1]=d("div",{class:"header"},[d("span",null,"几何体模型编辑")],-1)),d("div",ar,[(U(!0),Z(fe,null,_e(n.value,_=>(U(),Z("div",{class:"option",key:_},[d("div",rr,[r(C,{type:"primary",link:""},{default:u(()=>[k(ve(_),1)]),_:2},1024)]),d("div",lr,[typeof s.value[_]=="number"?(U(),oe(P,{key:0,"show-input":"",modelValue:s.value[_],"onUpdate:modelValue":T=>s.value[_]=T,min:g(_).min,max:g(_).max,step:g(_).step,onInput:c},null,8,["modelValue","onUpdate:modelValue","min","max","step"])):typeof s.value[_]=="string"?(U(),Z("div",dr,ve(s.value[_]),1)):typeof s.value[_]=="boolean"?(U(),oe(m,{key:2,onChange:c,modelValue:s.value[_],"onUpdate:modelValue":T=>s.value[_]=T},null,8,["modelValue","onUpdate:modelValue"])):xe("",!0)])]))),128))])],64)):(U(),oe(L,{key:1,description:"当前模型不支持使用该功能","image-size":120}))])}}},ur=Le(cr,[["__scopeId","data-v-a595d645"]]),pr={class:"edit-box"},hr={class:"options"},fr=["onClick"],mr={class:"icon-name"},gr={class:"check"},_r={class:"icon-delete"},yr={class:"options"},vr={class:"option space-between"},wr={class:"option"},xr={class:"option space-between"},Mr={class:"option"},br={class:"grid-txt"},Sr={class:"grid-sidle"},Cr={class:"option"},Ar={class:"grid-txt"},Tr={class:"grid-sidle"},Lr={class:"option"},Er={class:"grid-txt"},Ir={class:"grid-sidle"},Pr={class:"option"},kr={class:"option"},Rr={class:"grid-txt"},$r={class:"grid-sidle"},Vr={__name:"EditMoreModel",setup(t){const e=be(),o=te(null),s=me({position:{x:0,y:0,z:0},scale:0}),n=ne(()=>e.modelApi.manyModelGroup.children.map(p=>({name:p.name,uuid:p.uuid}))),a=y=>{o.value=y.uuid;const{position:f,scale:p}=e.modelApi.chooseManyModel(y.uuid);Object.assign(s,{position:f,scale:p})},i=()=>{e.modelApi.deleteManyModel(o.value),ce.success("删除成功"),o.value=null},l=(y,f)=>{const p=f=="right";e.modelApi.setManyModelRotation(y,p,o.value)},c=()=>{e.modelApi.initManyModelRotation(o.value)},h=()=>{e.modelApi.setManyModelPosition(s.position,o.value)},g=()=>{const y=e.modelApi.initManyModelPosition(o.value);Object.assign(s,{position:y})},v=()=>{e.modelApi.setManyModelScale(o.value,s.scale)};return(y,f)=>{const p=x("Check"),M=x("el-icon"),S=x("Delete"),E=x("el-space"),C=x("el-empty"),P=x("el-scrollbar"),m=x("Setting"),L=x("el-button"),_=x("Location"),T=x("el-slider"),w=x("Odometer");return U(),Z("div",pr,[f[22]||(f[22]=d("div",{class:"header"},[d("span",null," 多模型列表 ")],-1)),d("div",hr,[r(P,{height:"200px"},{default:u(()=>[n.value.length?(U(!0),Z(fe,{key:0},_e(n.value,I=>(U(),Z("div",{class:j(["option",o.value==I.uuid?"option-active":""]),onClick:Y=>a(I),key:I.uuid},[d("div",mr,ve(I.name),1),r(E,null,{default:u(()=>[ae(d("div",gr,[r(M,{size:"20px",color:"#2a3ff6"},{default:u(()=>[r(p)]),_:1})],512),[[de,o.value==I.uuid]]),ae(d("div",_r,[r(M,{size:"18px",color:"#2a3ff6"},{default:u(()=>[r(S,{onClick:Be(Y=>i(I.uuid),["stop"])},null,8,["onClick"])]),_:2},1024)],512),[[de,o.value==I.uuid]])]),_:2},1024)],10,fr))),128)):(U(),oe(C,{key:1,description:"切换多模型“场景”拖拽添加模型","image-size":100}))]),_:1})]),f[23]||(f[23]=d("div",{class:"header"},[d("span",null,"模型编辑")],-1)),ae(d("div",yr,[d("div",vr,[r(E,null,{default:u(()=>[r(M,null,{default:u(()=>[r(m)]),_:1}),f[10]||(f[10]=d("span",null," 模型轴旋转 ",-1))]),_:1,__:[10]}),r(L,{type:"primary",link:"",icon:"Refresh",onClick:c,plain:""},{default:u(()=>f[11]||(f[11]=[k(" 重置 ")])),_:1,__:[11]})]),d("div",wr,[r(E,null,{default:u(()=>[r(L,{type:"info",icon:"RefreshRight",onClick:f[0]||(f[0]=I=>l("x","right"))}),r(L,{type:"primary",link:""},{default:u(()=>f[12]||(f[12]=[k("X轴")])),_:1,__:[12]}),r(L,{type:"info",icon:"RefreshLeft",onClick:f[1]||(f[1]=I=>l("x","left"))})]),_:1}),r(E,null,{default:u(()=>[r(L,{type:"info",icon:"RefreshRight",onClick:f[2]||(f[2]=I=>l("y","right"))}),r(L,{type:"primary",link:""},{default:u(()=>f[13]||(f[13]=[k("Y轴")])),_:1,__:[13]}),r(L,{type:"info",icon:"RefreshLeft",onClick:f[3]||(f[3]=I=>l("y","left"))})]),_:1}),r(E,null,{default:u(()=>[r(L,{type:"info",icon:"RefreshRight",onClick:f[4]||(f[4]=I=>l("z","right"))}),r(L,{type:"primary",link:""},{default:u(()=>f[14]||(f[14]=[k("Z轴")])),_:1,__:[14]}),r(L,{type:"info",icon:"RefreshLeft",onClick:f[5]||(f[5]=I=>l("z","left"))})]),_:1})]),d("div",xr,[r(E,null,{default:u(()=>[r(M,null,{default:u(()=>[r(_)]),_:1}),f[15]||(f[15]=d("span",null," 模型位置 ",-1))]),_:1,__:[15]}),r(L,{type:"primary",link:"",icon:"Refresh",onClick:g,plain:""},{default:u(()=>f[16]||(f[16]=[k(" 重置 ")])),_:1,__:[16]})]),d("div",Mr,[d("div",br,[r(L,{type:"primary",link:""},{default:u(()=>f[17]||(f[17]=[k("X 轴")])),_:1,__:[17]})]),d("div",Sr,[r(T,{onInput:h,"show-input":"",modelValue:s.position.x,"onUpdate:modelValue":f[6]||(f[6]=I=>s.position.x=I),min:-10,max:10,step:.1},null,8,["modelValue"])])]),d("div",Cr,[d("div",Ar,[r(L,{type:"primary",link:""},{default:u(()=>f[18]||(f[18]=[k("Y 轴")])),_:1,__:[18]})]),d("div",Tr,[r(T,{onInput:h,"show-input":"",modelValue:s.position.y,"onUpdate:modelValue":f[7]||(f[7]=I=>s.position.y=I),min:-10,max:10,step:.1},null,8,["modelValue"])])]),d("div",Lr,[d("div",Er,[r(L,{type:"primary",link:""},{default:u(()=>f[19]||(f[19]=[k("Z 轴")])),_:1,__:[19]})]),d("div",Ir,[r(T,{onInput:h,"show-input":"",modelValue:s.position.z,"onUpdate:modelValue":f[8]||(f[8]=I=>s.position.z=I),min:-10,max:10,step:.1},null,8,["modelValue"])])]),d("div",Pr,[r(E,null,{default:u(()=>[r(M,null,{default:u(()=>[r(w)]),_:1}),f[20]||(f[20]=d("span",null," 模型缩放 ",-1))]),_:1,__:[20]})]),d("div",kr,[d("div",Rr,[r(L,{type:"primary",link:""},{default:u(()=>f[21]||(f[21]=[k("缩放值")])),_:1,__:[21]})]),d("div",$r,[r(T,{onInput:v,"show-input":"",modelValue:s.scale,"onUpdate:modelValue":f[9]||(f[9]=I=>s.scale=I),min:.01,max:5,step:.01},null,8,["modelValue"])])])],512),[[de,o.value]])])}}},Ur=Le(Vr,[["__scopeId","data-v-2d625351"]]),Dr={class:"edit-box"},Or={class:"header"},Fr={class:"options"},zr={class:"option"},Hr={class:"tag-box"},Nr={class:"icon"},jr={class:"options"},Br=["onClick"],Gr={class:"icon-name"},Yr={class:"check"},Xr={class:"icon-delete"},Wr={key:0,class:"options"},Zr={class:"option"},qr={class:"grid-txt"},Qr={class:"grid-sidle"},Kr={class:"option"},Jr={class:"grid-txt"},el={class:"grid-sidle"},tl={class:"option"},nl={class:"grid-txt"},ol={class:"grid-sidle"},sl={class:"option"},il={class:"grid-txt"},al={class:"grid-sidle"},rl={class:"option"},ll={class:"grid-txt"},dl={class:"grid-sidle"},cl={class:"option"},ul={class:"grid-txt"},pl={class:"grid-sidle"},hl={class:"option"},fl={class:"grid-txt"},ml={class:"grid-sidle"},gl={class:"grid-txt"},_l={class:"grid-sidle"},yl={class:"grid-txt"},vl={class:"grid-sidle"},wl={class:"option"},xl={class:"grid-txt"},Ml={class:"grid-sidle"},bl={class:"option",style:{height:"auto"}},Sl={class:"grid-txt"},Cl={class:"grid-sidle"},Al={__name:"EditTags",setup(t,{expose:e}){const o=be(),s=Ge,n=me({dragTagList:ne(()=>o.modelApi.dragTagList)}),a=ne(()=>{const f=[];for(const[p]of Object.entries(gn))f.push({name:p});return f}),i=me({}),l=(f,p)=>{o.modelApi.setDragTag(p),o.setActiveEditModelType("tags")},c=f=>{f.preventDefault()},h=()=>{i.uuid=null,o.modelApi.clearSceneTags()},g=f=>{Object.assign(i,{...f})},v=f=>{o.modelApi.deleteTag(f),i.uuid=null},y=()=>{o.modelApi.updateTagElement(i)};return e({config:n}),(f,p)=>{const M=x("el-button"),S=x("PriceTag"),E=x("el-icon"),C=x("el-space"),P=x("el-col"),m=x("el-row"),L=x("el-scrollbar"),_=x("Check"),T=x("Delete"),w=x("el-empty"),I=x("el-slider"),Y=x("el-color-picker"),R=x("el-input");return U(),Z("div",Dr,[d("div",Or,[p[13]||(p[13]=d("span",null," 标签配置 ",-1)),r(M,{type:"primary",icon:"Refresh",onClick:h,plain:""},{default:u(()=>p[12]||(p[12]=[k(" 重置 ")])),_:1,__:[12]})]),d("div",Fr,[d("div",zr,[r(C,null,{default:u(()=>[r(E,null,{default:u(()=>[r(S)]),_:1}),p[14]||(p[14]=d("span",null,"标签类型",-1)),p[15]||(p[15]=d("span",{style:{color:"#18c174 "}},"(可拖拽添加多个)",-1))]),_:1,__:[14,15]})]),r(L,{"max-height":"150px"},{default:u(()=>[r(m,{class:"tag-row"},{default:u(()=>[(U(!0),Z(fe,null,_e(a.value,b=>(U(),oe(P,{draggable:"true",key:b.name,span:4,onDragstart:A=>l(A,b),onDrag:p[0]||(p[0]=A=>c(A))},{default:u(()=>[d("div",Hr,[d("div",Nr,[r(E,{size:"16px"},{default:u(()=>[(U(),oe(_n(b.name)))]),_:2},1024)])])]),_:2},1032,["onDragstart"]))),128))]),_:1})]),_:1})]),p[27]||(p[27]=d("div",{class:"options"},[d("div",{class:"header"},"标签列表")],-1)),d("div",jr,[n.dragTagList.length?(U(),oe(L,{key:0,"max-height":"170px"},{default:u(()=>[(U(!0),Z(fe,null,_e(n.dragTagList,b=>(U(),Z("div",{class:j(["option",i.uuid==b.uuid?"option-active":""]),onClick:A=>g(b),key:b.uuid},[d("div",Gr,ve(b.innerText),1),r(C,null,{default:u(()=>[ae(d("div",Yr,[r(E,{size:"18px",color:"#2a3ff6"},{default:u(()=>[r(_)]),_:1})],512),[[de,i.uuid==b.uuid]]),d("div",Xr,[r(E,{size:"18px",color:"#2a3ff6"},{default:u(()=>[r(T,{onClick:Be(A=>v(b.uuid),["stop"])},null,8,["onClick"])]),_:2},1024)])]),_:2},1024)],10,Br))),128))]),_:1})):(U(),oe(w,{key:1,description:"暂无标签","image-size":100}))]),p[28]||(p[28]=d("div",{class:"header"},[d("span",null," 标签编辑 ")],-1)),i.uuid?(U(),Z("div",Wr,[d("div",Zr,[d("div",qr,[r(M,{type:"primary",link:""},{default:u(()=>p[16]||(p[16]=[k("容器高度")])),_:1,__:[16]})]),d("div",Qr,[r(I,{onInput:y,"show-input":"",modelValue:i.height,"onUpdate:modelValue":p[1]||(p[1]=b=>i.height=b),min:1,max:500,step:1},null,8,["modelValue"])])]),d("div",Kr,[d("div",Jr,[r(M,{type:"primary",link:""},{default:u(()=>p[17]||(p[17]=[k("容器宽度")])),_:1,__:[17]})]),d("div",el,[r(I,{onInput:y,"show-input":"",modelValue:i.width,"onUpdate:modelValue":p[2]||(p[2]=b=>i.width=b),min:1,max:500,step:1},null,8,["modelValue"])])]),d("div",tl,[d("div",nl,[r(M,{type:"primary",link:""},{default:u(()=>p[18]||(p[18]=[k("字体大小")])),_:1,__:[18]})]),d("div",ol,[r(I,{onInput:y,"show-input":"",modelValue:i.fontSize,"onUpdate:modelValue":p[3]||(p[3]=b=>i.fontSize=b),min:1,max:50,step:.1},null,8,["modelValue"])])]),d("div",sl,[d("div",il,[r(M,{type:"primary",link:""},{default:u(()=>p[19]||(p[19]=[k("标签坐标X")])),_:1,__:[19]})]),d("div",al,[r(I,{onInput:y,"show-input":"",modelValue:i.positionX,"onUpdate:modelValue":p[4]||(p[4]=b=>i.positionX=b),min:-50,max:50,step:.01},null,8,["modelValue"])])]),d("div",rl,[d("div",ll,[r(M,{type:"primary",link:""},{default:u(()=>p[20]||(p[20]=[k("标签坐标Y")])),_:1,__:[20]})]),d("div",dl,[r(I,{onInput:y,"show-input":"",modelValue:i.positionY,"onUpdate:modelValue":p[5]||(p[5]=b=>i.positionY=b),min:-50,max:50,step:.1},null,8,["modelValue"])])]),d("div",cl,[d("div",ul,[r(M,{type:"primary",link:""},{default:u(()=>p[21]||(p[21]=[k("标签坐标Z")])),_:1,__:[21]})]),d("div",pl,[r(I,{onInput:y,"show-input":"",modelValue:i.positionZ,"onUpdate:modelValue":p[6]||(p[6]=b=>i.positionZ=b),min:-50,max:50,step:.1},null,8,["modelValue"])])]),d("div",hl,[d("div",fl,[r(M,{type:"primary",link:""},{default:u(()=>p[22]||(p[22]=[k("背景颜色")])),_:1,__:[22]})]),d("div",ml,[r(Y,{"color-format":"hex",predefine:ue(s),onChange:y,modelValue:i.backgroundColor,"onUpdate:modelValue":p[7]||(p[7]=b=>i.backgroundColor=b)},null,8,["predefine","modelValue"])]),d("div",gl,[r(M,{type:"primary",link:""},{default:u(()=>p[23]||(p[23]=[k("图标颜色")])),_:1,__:[23]})]),d("div",_l,[r(Y,{"color-format":"hex",predefine:ue(s),onChange:y,modelValue:i.iconColor,"onUpdate:modelValue":p[8]||(p[8]=b=>i.iconColor=b)},null,8,["predefine","modelValue"])]),d("div",yl,[r(M,{type:"primary",link:""},{default:u(()=>p[24]||(p[24]=[k("字体颜色")])),_:1,__:[24]})]),d("div",vl,[r(Y,{"color-format":"hex",predefine:ue(s),onChange:y,modelValue:i.color,"onUpdate:modelValue":p[9]||(p[9]=b=>i.color=b)},null,8,["predefine","modelValue"])])]),d("div",wl,[d("div",xl,[r(M,{type:"primary",link:""},{default:u(()=>p[25]||(p[25]=[k("图标大小")])),_:1,__:[25]})]),d("div",Ml,[r(I,{onInput:y,"show-input":"",modelValue:i.iconSize,"onUpdate:modelValue":p[10]||(p[10]=b=>i.iconSize=b),min:1,max:50,step:.1},null,8,["modelValue"])])]),d("div",bl,[d("div",Sl,[r(M,{type:"primary",link:""},{default:u(()=>p[26]||(p[26]=[k("标签内容")])),_:1,__:[26]})]),d("div",Cl,[r(R,{type:"textarea",autosize:{minRows:3,maxRows:3},onInput:y,modelValue:i.innerText,"onUpdate:modelValue":p[11]||(p[11]=b=>i.innerText=b),modelModifiers:{trim:!0}},null,8,["modelValue"])])])])):xe("",!0)])}}},Tl=Le(Al,[["__scopeId","data-v-506b59e5"]]),Ll={class:"model-panel"},El={class:"panel-tabs"},Il=["onClick"],Pl={class:"tab"},kl={class:"panel-edit"},Rl={__name:"index",setup(t,{expose:e}){const{$bus:o}=De().proxy,s=[{name:"背景",key:"EditBackground",icon:"Picture"},{name:"材质",key:"EditMaterial",icon:"DataAnalysis"},{name:"后期/操作",key:"EditLaterStage",icon:"MagicStick"},{name:"灯光",key:"EditLight",icon:"Sunrise"},{name:"模型动画",key:"EditAnimation",icon:"VideoCameraFilled"},{name:"辅助线/轴配置",key:"EditAttribute",icon:"Box"},{name:"几何体模型配置",key:"EditGeometry",icon:"Cellphone"},{name:"标签配置",key:"EditTags",icon:"CollectionTag"},{name:"多模型配置",key:"EditMoreModel",icon:"Money"}],n=te("EditMaterial"),a=te(null),i=te(null),l=te(null),c=te(null),h=te(null),g=te(null),v=te(null),y=te(null),f=te(null);return He(()=>{o.on("update-tab",M=>{n.value=M})}),e({getPanelConfig:()=>({background:a.value.config,material:i.value.getMeshConfig(),animation:l.value.config,attribute:c.value.getAttributeConfig(),light:h.value.config,stage:g.value.getStageConfig(),tags:y.value.config})}),(M,S)=>{const E=x("el-icon"),C=x("el-tooltip"),P=x("el-scrollbar");return U(),Z("div",Ll,[d("ul",El,[(U(),Z(fe,null,_e(s,m=>d("li",{key:m.key,class:j(n.value==m.key?"active":""),onClick:L=>n.value=m.key},[r(C,{effect:"light",content:m.name,placement:"top"},{default:u(()=>[d("div",Pl,[r(E,{size:"20px",color:n.value==m.key?"#fff":""},{default:u(()=>[(U(),oe(_n(m.icon)))]),_:2},1032,["color"])])]),_:2},1032,["content"])],10,Il)),64))]),d("div",kl,[r(P,{"max-height":"832px"},{default:u(()=>[ae(d("div",null,[r(gs,{ref_key:"background",ref:a},null,512)],512),[[de,n.value=="EditBackground"]]),ae(d("div",null,[r($s,{ref_key:"material",ref:i},null,512)],512),[[de,n.value=="EditMaterial"]]),ae(d("div",null,[r(Ja,{ref_key:"stage",ref:g},null,512)],512),[[de,n.value=="EditLaterStage"]]),ae(d("div",null,[r(Ws,{ref_key:"animation",ref:l},null,512)],512),[[de,n.value=="EditAnimation"]]),ae(d("div",null,[r(La,{ref_key:"light",ref:h},null,512)],512),[[de,n.value=="EditLight"]]),ae(d("div",null,[r(Ai,{ref_key:"attribute",ref:c},null,512)],512),[[de,n.value=="EditAttribute"]]),ae(d("div",null,[r(ur,{ref_key:"geometry",ref:v},null,512)],512),[[de,n.value=="EditGeometry"]]),ae(d("div",null,[r(Tl,{ref_key:"tags",ref:y},null,512)],512),[[de,n.value=="EditTags"]]),ae(d("div",null,[r(Ur,{ref_key:"more",ref:f},null,512)],512),[[de,n.value=="EditMoreModel"]])]),_:1})])])}}},$l=Le(Rl,[["__scopeId","data-v-730e388f"]]),Vl={class:"model-choose"},Ul={class:"header"},Dl={class:"options"},Ol={class:"option"},Fl={class:"options"},zl={class:"option"},Hl={class:"options"},Nl={class:"option"},jl={class:"file-name"},Bl={class:"upload"},Gl={class:"icon"},Yl={class:"options"},Xl={class:"option"},Wl={key:0,style:{color:"#18c174 "}},Zl=["onDragstart"],ql={class:"geometry-name"},Ql={key:1,class:"geometry-box"},Kl={class:"icon"},Jl={__name:"index",setup(t,{expose:e}){const o={oneModel:{text:"单模型",tooltip:"当前为单模型编辑模式，通过点击加载不同模型",draggable:!1,switchType:"many"},many:{text:"多模型",tooltip:"当前为多模型编辑模式：通过拖拽添加多个模型",draggable:!0,switchType:"oneModel"},geometry:{text:"几何体",tooltip:"当前为几何体模型编辑模式：通过拖拽添加多个几何体模型",draggable:!1,switchType:"oneModel"}},s=be(),{$bus:n}=De().proxy,a=$t(),{modelList:i}=Vt(a),l=ne(()=>{var P;return(P=i.value)==null?void 0:P.filter(m=>!m.animation)}),c=ne(()=>{var P;return(P=i.value)==null?void 0:P.filter(m=>m.animation)}),h=ne(()=>g.modeEditType=="many"?{textAlign:"center",cursor:"all-scroll"}:{textAlign:"center",cursor:"pointer"}),g=me({activeModelId:10,geometryVisible:!1,modeEditType:"oneModel",localModelName:null}),v=te({name:"篮球",key:"glb-10",fileType:"glb",id:10,animation:!1,filePath:"threeFile/glb/glb-10.glb",icon:"threeFile/glb/glb-10.png",decomposeName:"transformers_10",scale:1}),y=async P=>{if(P=="many")yn.confirm("通过拖拽添加多个模型","切换为多模型编辑模式?",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(()=>{Object.assign(g,{modeEditType:P,localModelName:null,geometryVisible:!1}),s.setActiveEditModelType("manyModel"),s.modelApi.clearSceneModel(),ce.success("切换成功：当前为多模型编辑模式")});else if(["geometry","oneModel"].includes(P)){n.emit(Se,!0);try{const{load:m}=await s.modelApi.onSwitchModel(v.value);m&&(Object.assign(g,{modeEditType:"oneModel",activeModelId:v.value.id,localModelName:null,geometryVisible:!1}),n.emit(Ee),n.emit(Se,!1),s.setActiveEditModelType("oneModel"),ce.success("切换成功：当前为单模型编辑模式"))}catch{n.emit(Se,!1)}}},f=async P=>{if(P.id==g.activeModelId||g.modeEditType=="many")return!1;v.value=P,s.setActiveEditModelType("oneModel"),Object.assign(g,{activeModelId:P.id,localModelName:null,modeEditType:"oneModel",geometryVisible:!1}),n.emit(Se,!0);try{const{load:m}=await s.modelApi.onSwitchModel(P);m&&(n.emit(Ee),n.emit(Se,!1))}catch{n.emit(Se,!1)}},p=async()=>{Object.assign(g,{activeModelId:null,localModelName:null,modeEditType:"geometry",geometryVisible:!0}),s.modelApi.clearSceneModel()},M=(P,m)=>{s.modelApi.setDragGeometryModel(m),s.setActiveEditModelType("geometry")},S=P=>{P.preventDefault()},E=P=>{s.setActiveEditModelType("manyModel"),s.modelApi.setDragManyModel(P)},C=async P=>{g.localModelName=P.name;const L={filePath:URL.createObjectURL(P.raw),fileType:Dt(P.name)};n.emit(Se,!0);try{const{load:_,filePath:T}=await s.modelApi.onSwitchModel(L);URL.revokeObjectURL(T),_&&(n.emit(Ee),n.emit(Se,!1),Object.assign(g,{activeModelId:null,geometryVisible:!1}))}catch{g.localModelName=null,n.emit(Se,!1)}};return e({activeModel:v}),(P,m)=>{const L=x("el-button"),_=x("el-tooltip"),T=x("Orange"),w=x("el-icon"),I=x("el-space"),Y=x("el-image"),R=x("el-col"),b=x("el-row"),A=x("el-scrollbar"),V=x("Paperclip"),H=x("UploadFilled"),D=x("Plus"),N=x("el-upload"),$=x("SwitchFilled");return U(),Z("div",Vl,[r(A,{"max-height":"calc(100vh - 72px)"},{default:u(()=>[d("div",Ul,[d("span",null,"当前场景编辑模式:"+ve(o[g.modeEditType].text),1),r(_,{effect:"dark",content:o[g.modeEditType].tooltip,placement:"top"},{default:u(()=>[r(L,{type:"primary",icon:"Switch",plain:"",onClick:m[0]||(m[0]=B=>y(o[g.modeEditType]&&o[g.modeEditType].switchType))},{default:u(()=>m[4]||(m[4]=[k(" 切换场景 ")])),_:1,__:[4]})]),_:1},8,["content"])]),d("div",Dl,[d("div",Ol,[r(I,null,{default:u(()=>[r(w,null,{default:u(()=>[r(T)]),_:1}),m[5]||(m[5]=d("span",null,"普通模型",-1))]),_:1,__:[5]})]),r(A,{"max-height":"210px"},{default:u(()=>[r(b,null,{default:u(()=>[(U(!0),Z(fe,null,_e(l.value,B=>(U(),oe(R,{draggable:o[g.modeEditType]&&o[g.modeEditType].draggable||!1,style:mt(h.value),span:12,onDragstart:ie=>E(B),onDrag:m[1]||(m[1]=ie=>S(ie)),key:B.id},{default:u(()=>[r(Y,{draggable:"false",onClick:Be(ie=>f(B),["prevent"]),class:j(["el-img",g.activeModelId==B.id?"active-model":""]),src:B.icon,fit:"cover"},null,8,["onClick","class","src"])]),_:2},1032,["draggable","style","onDragstart"]))),128))]),_:1})]),_:1})]),d("div",Fl,[d("div",zl,[r(I,null,{default:u(()=>[r(w,null,{default:u(()=>[r(V)]),_:1}),m[6]||(m[6]=d("span",null,"动画模型",-1))]),_:1,__:[6]})]),r(A,{"max-height":"210px"},{default:u(()=>[r(b,null,{default:u(()=>[(U(!0),Z(fe,null,_e(c.value,B=>(U(),oe(R,{draggable:o[g.modeEditType].draggable,style:mt(h.value),span:12,onDragstart:ie=>E(B),onDrag:m[2]||(m[2]=ie=>S(ie)),key:B.id},{default:u(()=>[r(Y,{draggable:"false",onClick:ie=>f(B),class:j(["el-img",g.activeModelId==B.id?"active-model":""]),src:B.icon,fit:"cover"},null,8,["onClick","class","src"])]),_:2},1032,["draggable","style","onDragstart"]))),128))]),_:1})]),_:1})]),d("div",Hl,[d("div",Nl,[r(I,null,{default:u(()=>[r(w,null,{default:u(()=>[r(H)]),_:1}),m[7]||(m[7]=d("span",null,"外部模型",-1))]),_:1,__:[7]})]),d("div",jl,[m[8]||(m[8]=d("span",null,"当前模型:",-1)),r(_,{effect:"dark",content:g.localModelName,placement:"top"},{default:u(()=>[d("b",null,ve(g.localModelName),1)]),_:1},8,["content"])]),r(N,{action:"",accept:".glb,.obj,.gltf,.fbx,.stl",class:"file-box","show-file-list":!1,"auto-upload":!1,"on-change":C},{default:u(()=>[d("div",Bl,[d("div",Gl,[r(w,{size:44},{default:u(()=>[r(D)]),_:1}),m[9]||(m[9]=d("div",null,[d("span",null,"请选择(目前仅支持.glb, .obj, .gltf, .fbx, .stl格式)")],-1))])])]),_:1})]),d("div",Yl,[d("div",Xl,[r(I,null,{default:u(()=>[r(w,null,{default:u(()=>[r($)]),_:1}),m[10]||(m[10]=d("span",null,"几何体模型",-1)),g.geometryVisible?(U(),Z("span",Wl,"(可拖拽添加多个)")):xe("",!0)]),_:1,__:[10]})]),r(A,{"max-height":"120px"},{default:u(()=>[g.geometryVisible?(U(),oe(b,{key:0},{default:u(()=>[(U(!0),Z(fe,null,_e(ue(Un),B=>(U(),oe(R,{style:{textAlign:"center"},span:8,key:B.type},{default:u(()=>[d("div",{class:j(["geometry",g.activeModelId==B.id?"active-model":""]),draggable:"true",onDragstart:ie=>M(ie,B),onDrag:m[3]||(m[3]=ie=>S(ie))},[d("div",ql,[r(_,{effect:"dark",content:`${B.name}:${B.type}`,placement:"top"},{default:u(()=>[d("b",null,ve(B.name),1)]),_:2},1032,["content"])])],42,Zl)]),_:2},1024))),128))]),_:1})):(U(),Z("div",Ql,[d("div",{class:"geometry-add",onClick:p},[d("div",Kl,[r(w,{size:44},{default:u(()=>[r(D)]),_:1}),m[11]||(m[11]=d("div",null,[d("span",null,"添加几何体模型")],-1))])])]))]),_:1})])]),_:1})])}}};var Ln={exports:{}};/*!
* clipboard.js v2.0.11
* https://clipboardjs.com/
*
* Licensed MIT © Zeno Rocha
*/(function(t,e){(function(s,n){t.exports=n()})(Dn,function(){return function(){var o={686:function(a,i,l){l.d(i,{default:function(){return we}});var c=l(279),h=l.n(c),g=l(370),v=l.n(g),y=l(817),f=l.n(y);function p(G){try{return document.execCommand(G)}catch{return!1}}var M=function(z){var O=f()(z);return p("cut"),O},S=M;function E(G){var z=document.documentElement.getAttribute("dir")==="rtl",O=document.createElement("textarea");O.style.fontSize="12pt",O.style.border="0",O.style.padding="0",O.style.margin="0",O.style.position="absolute",O.style[z?"right":"left"]="-9999px";var X=window.pageYOffset||document.documentElement.scrollTop;return O.style.top="".concat(X,"px"),O.setAttribute("readonly",""),O.value=G,O}var C=function(z,O){var X=E(z);O.container.appendChild(X);var W=f()(X);return p("copy"),X.remove(),W},P=function(z){var O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{container:document.body},X="";return typeof z=="string"?X=C(z,O):z instanceof HTMLInputElement&&!["text","search","url","tel","password"].includes(z==null?void 0:z.type)?X=C(z.value,O):(X=f()(z),p("copy")),X},m=P;function L(G){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?L=function(O){return typeof O}:L=function(O){return O&&typeof Symbol=="function"&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O},L(G)}var _=function(){var z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},O=z.action,X=O===void 0?"copy":O,W=z.container,Q=z.target,ee=z.text;if(X!=="copy"&&X!=="cut")throw new Error('Invalid "action" value, use either "copy" or "cut"');if(Q!==void 0)if(Q&&L(Q)==="object"&&Q.nodeType===1){if(X==="copy"&&Q.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if(X==="cut"&&(Q.hasAttribute("readonly")||Q.hasAttribute("disabled")))throw new Error(`Invalid "target" attribute. You can't cut text from elements with "readonly" or "disabled" attributes`)}else throw new Error('Invalid "target" value, use a valid Element');if(ee)return m(ee,{container:W});if(Q)return X==="cut"?S(Q):m(Q,{container:W})},T=_;function w(G){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?w=function(O){return typeof O}:w=function(O){return O&&typeof Symbol=="function"&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O},w(G)}function I(G,z){if(!(G instanceof z))throw new TypeError("Cannot call a class as a function")}function Y(G,z){for(var O=0;O<z.length;O++){var X=z[O];X.enumerable=X.enumerable||!1,X.configurable=!0,"value"in X&&(X.writable=!0),Object.defineProperty(G,X.key,X)}}function R(G,z,O){return z&&Y(G.prototype,z),O&&Y(G,O),G}function b(G,z){if(typeof z!="function"&&z!==null)throw new TypeError("Super expression must either be null or a function");G.prototype=Object.create(z&&z.prototype,{constructor:{value:G,writable:!0,configurable:!0}}),z&&A(G,z)}function A(G,z){return A=Object.setPrototypeOf||function(X,W){return X.__proto__=W,X},A(G,z)}function V(G){var z=N();return function(){var X=$(G),W;if(z){var Q=$(this).constructor;W=Reflect.construct(X,arguments,Q)}else W=X.apply(this,arguments);return H(this,W)}}function H(G,z){return z&&(w(z)==="object"||typeof z=="function")?z:D(G)}function D(G){if(G===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return G}function N(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function $(G){return $=Object.setPrototypeOf?Object.getPrototypeOf:function(O){return O.__proto__||Object.getPrototypeOf(O)},$(G)}function B(G,z){var O="data-clipboard-".concat(G);if(z.hasAttribute(O))return z.getAttribute(O)}var ie=function(G){b(O,G);var z=V(O);function O(X,W){var Q;return I(this,O),Q=z.call(this),Q.resolveOptions(W),Q.listenClick(X),Q}return R(O,[{key:"resolveOptions",value:function(){var W=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.action=typeof W.action=="function"?W.action:this.defaultAction,this.target=typeof W.target=="function"?W.target:this.defaultTarget,this.text=typeof W.text=="function"?W.text:this.defaultText,this.container=w(W.container)==="object"?W.container:document.body}},{key:"listenClick",value:function(W){var Q=this;this.listener=v()(W,"click",function(ee){return Q.onClick(ee)})}},{key:"onClick",value:function(W){var Q=W.delegateTarget||W.currentTarget,ee=this.action(Q)||"copy",K=T({action:ee,container:this.container,target:this.target(Q),text:this.text(Q)});this.emit(K?"success":"error",{action:ee,text:K,trigger:Q,clearSelection:function(){Q&&Q.focus(),window.getSelection().removeAllRanges()}})}},{key:"defaultAction",value:function(W){return B("action",W)}},{key:"defaultTarget",value:function(W){var Q=B("target",W);if(Q)return document.querySelector(Q)}},{key:"defaultText",value:function(W){return B("text",W)}},{key:"destroy",value:function(){this.listener.destroy()}}],[{key:"copy",value:function(W){var Q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{container:document.body};return m(W,Q)}},{key:"cut",value:function(W){return S(W)}},{key:"isSupported",value:function(){var W=arguments.length>0&&arguments[0]!==void 0?arguments[0]:["copy","cut"],Q=typeof W=="string"?[W]:W,ee=!!document.queryCommandSupported;return Q.forEach(function(K){ee=ee&&!!document.queryCommandSupported(K)}),ee}}]),O}(h()),we=ie},828:function(a){var i=9;if(typeof Element<"u"&&!Element.prototype.matches){var l=Element.prototype;l.matches=l.matchesSelector||l.mozMatchesSelector||l.msMatchesSelector||l.oMatchesSelector||l.webkitMatchesSelector}function c(h,g){for(;h&&h.nodeType!==i;){if(typeof h.matches=="function"&&h.matches(g))return h;h=h.parentNode}}a.exports=c},438:function(a,i,l){var c=l(828);function h(y,f,p,M,S){var E=v.apply(this,arguments);return y.addEventListener(p,E,S),{destroy:function(){y.removeEventListener(p,E,S)}}}function g(y,f,p,M,S){return typeof y.addEventListener=="function"?h.apply(null,arguments):typeof p=="function"?h.bind(null,document).apply(null,arguments):(typeof y=="string"&&(y=document.querySelectorAll(y)),Array.prototype.map.call(y,function(E){return h(E,f,p,M,S)}))}function v(y,f,p,M){return function(S){S.delegateTarget=c(S.target,f),S.delegateTarget&&M.call(y,S)}}a.exports=g},879:function(a,i){i.node=function(l){return l!==void 0&&l instanceof HTMLElement&&l.nodeType===1},i.nodeList=function(l){var c=Object.prototype.toString.call(l);return l!==void 0&&(c==="[object NodeList]"||c==="[object HTMLCollection]")&&"length"in l&&(l.length===0||i.node(l[0]))},i.string=function(l){return typeof l=="string"||l instanceof String},i.fn=function(l){var c=Object.prototype.toString.call(l);return c==="[object Function]"}},370:function(a,i,l){var c=l(879),h=l(438);function g(p,M,S){if(!p&&!M&&!S)throw new Error("Missing required arguments");if(!c.string(M))throw new TypeError("Second argument must be a String");if(!c.fn(S))throw new TypeError("Third argument must be a Function");if(c.node(p))return v(p,M,S);if(c.nodeList(p))return y(p,M,S);if(c.string(p))return f(p,M,S);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}function v(p,M,S){return p.addEventListener(M,S),{destroy:function(){p.removeEventListener(M,S)}}}function y(p,M,S){return Array.prototype.forEach.call(p,function(E){E.addEventListener(M,S)}),{destroy:function(){Array.prototype.forEach.call(p,function(E){E.removeEventListener(M,S)})}}}function f(p,M,S){return h(document.body,p,M,S)}a.exports=g},817:function(a){function i(l){var c;if(l.nodeName==="SELECT")l.focus(),c=l.value;else if(l.nodeName==="INPUT"||l.nodeName==="TEXTAREA"){var h=l.hasAttribute("readonly");h||l.setAttribute("readonly",""),l.select(),l.setSelectionRange(0,l.value.length),h||l.removeAttribute("readonly"),c=l.value}else{l.hasAttribute("contenteditable")&&l.focus();var g=window.getSelection(),v=document.createRange();v.selectNodeContents(l),g.removeAllRanges(),g.addRange(v),c=g.toString()}return c}a.exports=i},279:function(a){function i(){}i.prototype={on:function(l,c,h){var g=this.e||(this.e={});return(g[l]||(g[l]=[])).push({fn:c,ctx:h}),this},once:function(l,c,h){var g=this;function v(){g.off(l,v),c.apply(h,arguments)}return v._=c,this.on(l,v,h)},emit:function(l){var c=[].slice.call(arguments,1),h=((this.e||(this.e={}))[l]||[]).slice(),g=0,v=h.length;for(g;g<v;g++)h[g].fn.apply(h[g].ctx,c);return this},off:function(l,c){var h=this.e||(this.e={}),g=h[l],v=[];if(g&&c)for(var y=0,f=g.length;y<f;y++)g[y].fn!==c&&g[y].fn._!==c&&v.push(g[y]);return v.length?h[l]=v:delete h[l],this}},a.exports=i,a.exports.TinyEmitter=i}},s={};function n(a){if(s[a])return s[a].exports;var i=s[a]={exports:{}};return o[a](i,i.exports,n),i.exports}return function(){n.n=function(a){var i=a&&a.__esModule?function(){return a.default}:function(){return a};return n.d(i,{a:i}),i}}(),function(){n.d=function(a,i){for(var l in i)n.o(i,l)&&!n.o(a,l)&&Object.defineProperty(a,l,{enumerable:!0,get:i[l]})}}(),function(){n.o=function(a,i){return Object.prototype.hasOwnProperty.call(a,i)}}(),n(686)}().default})})(Ln);var ed=Ln.exports;const td=On(ed),nd={class:"code"},od={class:"dialog-footer"},sd={__name:"index",setup(t,{expose:e}){const o=te(!1),s=te(null),n=me({width:400,height:300}),a=ne(()=>{const c=s.value.replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,"'$1'"),h=`${Yn}?modelConfig=`+c;return`<iframe  width="${n.width}" height="${n.height}" src="${h}" allowfullscreen></iframe>`}),i=c=>{o.value=!0,s.value=JSON.stringify(c)},l=()=>{const c=new td(".copy-button",{text:()=>a.value});c.on("success",h=>{ce.success("复制成功,将代码粘贴至你的项目中即可"),c.destroy(),o.value=!1}),c.on("error",()=>{console.log("复制失败"),c.destroy()})};return e({showDialog:i}),(c,h)=>{const g=x("el-scrollbar"),v=x("el-text"),y=x("el-input-number"),f=x("el-col"),p=x("el-row"),M=x("el-button"),S=x("el-dialog");return U(),oe(S,{modelValue:o.value,"onUpdate:modelValue":h[2]||(h[2]=E=>o.value=E),title:"将当前编辑效果嵌入你的项目",width:"600px","close-on-click-modal":!1},{footer:u(()=>[d("span",od,[r(M,{type:"primary",class:"copy-button",onClick:l},{default:u(()=>h[5]||(h[5]=[k(" 复制代码 ")])),_:1,__:[5]})])]),default:u(()=>[r(g,{"max-height":"400px"},{default:u(()=>[d("code",nd,ve(a.value),1)]),_:1}),r(p,{style:{marginTop:"10px"}},{default:u(()=>[r(f,{span:12},{default:u(()=>[r(v,{type:"primary"},{default:u(()=>h[3]||(h[3]=[k("容器宽度")])),_:1,__:[3]}),r(y,{class:"number-style",precision:0,modelValue:n.width,"onUpdate:modelValue":h[0]||(h[0]=E=>n.width=E)},null,8,["modelValue"])]),_:1}),r(f,{span:12},{default:u(()=>[r(v,{type:"primary"},{default:u(()=>h[4]||(h[4]=[k("容器高度")])),_:1,__:[4]}),r(y,{class:"number-style",precision:0,modelValue:n.height,"onUpdate:modelValue":h[1]||(h[1]=E=>n.height=E)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},id=Le(sd,[["__scopeId","data-v-e20522dc"]]),Jt={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class yt{constructor(){this.textureUtils=null,this.pluginCallbacks=[],this.register(function(e){return new gd(e)}),this.register(function(e){return new _d(e)}),this.register(function(e){return new xd(e)}),this.register(function(e){return new Md(e)}),this.register(function(e){return new bd(e)}),this.register(function(e){return new Sd(e)}),this.register(function(e){return new yd(e)}),this.register(function(e){return new vd(e)}),this.register(function(e){return new wd(e)}),this.register(function(e){return new Cd(e)}),this.register(function(e){return new Ad(e)}),this.register(function(e){return new Td(e)}),this.register(function(e){return new Ld(e)}),this.register(function(e){return new Ed(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}setTextureUtils(e){return this.textureUtils=e,this}parse(e,o,s,n){const a=new md,i=[];for(let l=0,c=this.pluginCallbacks.length;l<c;l++)i.push(this.pluginCallbacks[l](a));a.setPlugins(i),a.setTextureUtils(this.textureUtils),a.writeAsync(e,o,n).catch(s)}parseAsync(e,o){const s=this;return new Promise(function(n,a){s.parse(e,n,a,o)})}}const J={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Tt="KHR_mesh_quantization",Me={};Me[ao]=J.NEAREST;Me[ro]=J.NEAREST_MIPMAP_NEAREST;Me[lo]=J.NEAREST_MIPMAP_LINEAR;Me[Ve]=J.LINEAR;Me[co]=J.LINEAR_MIPMAP_NEAREST;Me[uo]=J.LINEAR_MIPMAP_LINEAR;Me[po]=J.CLAMP_TO_EDGE;Me[ho]=J.REPEAT;Me[nt]=J.MIRRORED_REPEAT;const en={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},ad=new re,tn=12,rd=1179937895,ld=2,nn=8,dd=1313821514,cd=5130562;function qe(t,e){return t.length===e.length&&t.every(function(o,s){return o===e[s]})}function ud(t){return new TextEncoder().encode(t).buffer}function pd(t){return qe(t.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function hd(t,e,o){const s={min:new Array(t.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(t.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let n=e;n<e+o;n++)for(let a=0;a<t.itemSize;a++){let i;t.itemSize>4?i=t.array[n*t.itemSize+a]:(a===0?i=t.getX(n):a===1?i=t.getY(n):a===2?i=t.getZ(n):a===3&&(i=t.getW(n)),t.normalized===!0&&(i=Pt.normalize(i,t.array))),s.min[a]=Math.min(s.min[a],i),s.max[a]=Math.max(s.max[a],i)}return s}function En(t){return Math.ceil(t/4)*4}function Lt(t,e=0){const o=En(t.byteLength);if(o!==t.byteLength){const s=new Uint8Array(o);if(s.set(new Uint8Array(t)),e!==0)for(let n=t.byteLength;n<o;n++)s[n]=e;return s.buffer}return t}function on(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function fd(t,e){if(t.toBlob!==void 0)return new Promise(s=>t.toBlob(s,e));let o;return e==="image/jpeg"?o=.92:e==="image/webp"&&(o=.8),t.convertToBlob({type:e,quality:o})}class md{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter r"+vn}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map},this.textureUtils=null}setPlugins(e){this.plugins=e}setTextureUtils(e){this.textureUtils=e}async writeAsync(e,o,s={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},s),this.options.animations.length>0&&(this.options.trs=!0),await this.processInputAsync(e),await Promise.all(this.pending);const n=this,a=n.buffers,i=n.json;s=n.options;const l=n.extensionsUsed,c=n.extensionsRequired,h=new Blob(a,{type:"application/octet-stream"}),g=Object.keys(l),v=Object.keys(c);if(g.length>0&&(i.extensionsUsed=g),v.length>0&&(i.extensionsRequired=v),i.buffers&&i.buffers.length>0&&(i.buffers[0].byteLength=h.size),s.binary===!0){const y=new FileReader;y.readAsArrayBuffer(h),y.onloadend=function(){const f=Lt(y.result),p=new DataView(new ArrayBuffer(nn));p.setUint32(0,f.byteLength,!0),p.setUint32(4,cd,!0);const M=Lt(ud(JSON.stringify(i)),32),S=new DataView(new ArrayBuffer(nn));S.setUint32(0,M.byteLength,!0),S.setUint32(4,dd,!0);const E=new ArrayBuffer(tn),C=new DataView(E);C.setUint32(0,rd,!0),C.setUint32(4,ld,!0);const P=tn+S.byteLength+M.byteLength+p.byteLength+f.byteLength;C.setUint32(8,P,!0);const m=new Blob([E,S,M,p,f],{type:"application/octet-stream"}),L=new FileReader;L.readAsArrayBuffer(m),L.onloadend=function(){o(L.result)}}}else if(i.buffers&&i.buffers.length>0){const y=new FileReader;y.readAsDataURL(h),y.onloadend=function(){const f=y.result;i.buffers[0].uri=f,o(i)}}else o(i)}serializeUserData(e,o){if(Object.keys(e.userData).length===0)return;const s=this.options,n=this.extensionsUsed;try{const a=JSON.parse(JSON.stringify(e.userData));if(s.includeCustomExtensions&&a.gltfExtensions){o.extensions===void 0&&(o.extensions={});for(const i in a.gltfExtensions)o.extensions[i]=a.gltfExtensions[i],n[i]=!0;delete a.gltfExtensions}Object.keys(a).length>0&&(o.extras=a)}catch(a){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+a.message)}}getUID(e,o=!1){if(this.uids.has(e)===!1){const n=new Map;n.set(!0,this.uid++),n.set(!1,this.uid++),this.uids.set(e,n)}return this.uids.get(e).get(o)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const s=new q;for(let n=0,a=e.count;n<a;n++)if(Math.abs(s.fromBufferAttribute(e,n).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const o=this.cache;if(o.attributesNormalized.has(e))return o.attributesNormalized.get(e);const s=e.clone(),n=new q;for(let a=0,i=s.count;a<i;a++)n.fromBufferAttribute(s,a),n.x===0&&n.y===0&&n.z===0?n.setX(1):n.normalize(),s.setXYZ(a,n.x,n.y,n.z);return o.attributesNormalized.set(e,s),s}applyTextureTransform(e,o){let s=!1;const n={};(o.offset.x!==0||o.offset.y!==0)&&(n.offset=o.offset.toArray(),s=!0),o.rotation!==0&&(n.rotation=o.rotation,s=!0),(o.repeat.x!==1||o.repeat.y!==1)&&(n.scale=o.repeat.toArray(),s=!0),s&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=n,this.extensionsUsed.KHR_texture_transform=!0)}async buildMetalRoughTextureAsync(e,o){if(e===o)return e;function s(f){return f.colorSpace===ot?function(M){return M<.04045?M*.0773993808:Math.pow(M*.9478672986+.0521327014,2.4)}:function(M){return M}}e instanceof Ct&&(e=await this.decompressTextureAsync(e)),o instanceof Ct&&(o=await this.decompressTextureAsync(o));const n=e?e.image:null,a=o?o.image:null,i=Math.max(n?n.width:0,a?a.width:0),l=Math.max(n?n.height:0,a?a.height:0),c=on();c.width=i,c.height=l;const h=c.getContext("2d",{willReadFrequently:!0});h.fillStyle="#00ffff",h.fillRect(0,0,i,l);const g=h.getImageData(0,0,i,l);if(n){h.drawImage(n,0,0,i,l);const f=s(e),p=h.getImageData(0,0,i,l).data;for(let M=2;M<p.length;M+=4)g.data[M]=f(p[M]/256)*256}if(a){h.drawImage(a,0,0,i,l);const f=s(o),p=h.getImageData(0,0,i,l).data;for(let M=1;M<p.length;M+=4)g.data[M]=f(p[M]/256)*256}h.putImageData(g,0,0);const y=(e||o).clone();return y.source=new oo(c),y.colorSpace=wn,y.channel=(e||o).channel,e&&o&&e.channel!==o.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),y}async decompressTextureAsync(e,o=1/0){if(this.textureUtils===null)throw new Error("THREE.GLTFExporter: setTextureUtils() must be called to process compressed textures.");return await this.textureUtils.decompress(e,o)}processBuffer(e){const o=this.json,s=this.buffers;return o.buffers||(o.buffers=[{byteLength:0}]),s.push(e),0}processBufferView(e,o,s,n,a){const i=this.json;i.bufferViews||(i.bufferViews=[]);let l;switch(o){case J.BYTE:case J.UNSIGNED_BYTE:l=1;break;case J.SHORT:case J.UNSIGNED_SHORT:l=2;break;default:l=4}let c=e.itemSize*l;a===J.ARRAY_BUFFER&&(c=Math.ceil(c/4)*4);const h=En(n*c),g=new DataView(new ArrayBuffer(h));let v=0;for(let p=s;p<s+n;p++){for(let M=0;M<e.itemSize;M++){let S;e.itemSize>4?S=e.array[p*e.itemSize+M]:(M===0?S=e.getX(p):M===1?S=e.getY(p):M===2?S=e.getZ(p):M===3&&(S=e.getW(p)),e.normalized===!0&&(S=Pt.normalize(S,e.array))),o===J.FLOAT?g.setFloat32(v,S,!0):o===J.INT?g.setInt32(v,S,!0):o===J.UNSIGNED_INT?g.setUint32(v,S,!0):o===J.SHORT?g.setInt16(v,S,!0):o===J.UNSIGNED_SHORT?g.setUint16(v,S,!0):o===J.BYTE?g.setInt8(v,S):o===J.UNSIGNED_BYTE&&g.setUint8(v,S),v+=l}v%c!==0&&(v+=c-v%c)}const y={buffer:this.processBuffer(g.buffer),byteOffset:this.byteOffset,byteLength:h};return a!==void 0&&(y.target=a),a===J.ARRAY_BUFFER&&(y.byteStride=c),this.byteOffset+=h,i.bufferViews.push(y),{id:i.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const o=this,s=o.json;return s.bufferViews||(s.bufferViews=[]),new Promise(function(n){const a=new FileReader;a.readAsArrayBuffer(e),a.onloadend=function(){const i=Lt(a.result),l={buffer:o.processBuffer(i),byteOffset:o.byteOffset,byteLength:i.byteLength};o.byteOffset+=i.byteLength,n(s.bufferViews.push(l)-1)}})}processAccessor(e,o,s,n){const a=this.json,i={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let l;if(e.array.constructor===Float32Array)l=J.FLOAT;else if(e.array.constructor===Int32Array)l=J.INT;else if(e.array.constructor===Uint32Array)l=J.UNSIGNED_INT;else if(e.array.constructor===Int16Array)l=J.SHORT;else if(e.array.constructor===Uint16Array)l=J.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)l=J.BYTE;else if(e.array.constructor===Uint8Array)l=J.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);if(s===void 0&&(s=0),(n===void 0||n===1/0)&&(n=e.count),n===0)return null;const c=hd(e,s,n);let h;o!==void 0&&(h=e===o.index?J.ELEMENT_ARRAY_BUFFER:J.ARRAY_BUFFER);const g=this.processBufferView(e,l,s,n,h),v={bufferView:g.id,byteOffset:g.byteOffset,componentType:l,count:n,max:c.max,min:c.min,type:i[e.itemSize]};return e.normalized===!0&&(v.normalized=!0),a.accessors||(a.accessors=[]),a.accessors.push(v)-1}processImage(e,o,s,n="image/png"){if(e!==null){const a=this,i=a.cache,l=a.json,c=a.options,h=a.pending;i.images.has(e)||i.images.set(e,{});const g=i.images.get(e),v=n+":flipY/"+s.toString();if(g[v]!==void 0)return g[v];l.images||(l.images=[]);const y={mimeType:n},f=on();f.width=Math.min(e.width,c.maxTextureSize),f.height=Math.min(e.height,c.maxTextureSize);const p=f.getContext("2d",{willReadFrequently:!0});if(s===!0&&(p.translate(0,f.height),p.scale(1,-1)),e.data!==void 0){o!==xn&&console.error("GLTFExporter: Only RGBAFormat is supported.",o),(e.width>c.maxTextureSize||e.height>c.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const S=new Uint8ClampedArray(e.height*e.width*4);for(let E=0;E<S.length;E+=4)S[E+0]=e.data[E+0],S[E+1]=e.data[E+1],S[E+2]=e.data[E+2],S[E+3]=e.data[E+3];p.putImageData(new ImageData(S,e.width,e.height),0,0)}else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)p.drawImage(e,0,0,f.width,f.height);else throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");c.binary===!0?h.push(fd(f,n).then(S=>a.processBufferViewImage(S)).then(S=>{y.bufferView=S})):y.uri=so.getDataURL(f,n);const M=l.images.push(y)-1;return g[v]=M,M}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const o=this.json;o.samplers||(o.samplers=[]);const s={magFilter:Me[e.magFilter],minFilter:Me[e.minFilter],wrapS:Me[e.wrapS],wrapT:Me[e.wrapT]};return o.samplers.push(s)-1}async processTextureAsync(e){const s=this.options,n=this.cache,a=this.json;if(n.textures.has(e))return n.textures.get(e);a.textures||(a.textures=[]),e instanceof Ct&&(e=await this.decompressTextureAsync(e,s.maxTextureSize));let i=e.userData.mimeType;i==="image/webp"&&(i="image/png");const l={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,i)};e.name&&(l.name=e.name),await this._invokeAllAsync(async function(h){h.writeTexture&&await h.writeTexture(e,l)});const c=a.textures.push(l)-1;return n.textures.set(e,c),c}async processMaterialAsync(e){const o=this.cache,s=this.json;if(o.materials.has(e))return o.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;s.materials||(s.materials=[]);const n={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const a=e.color.toArray().concat([e.opacity]);if(qe(a,[1,1,1,1])||(n.pbrMetallicRoughness.baseColorFactor=a),e.isMeshStandardMaterial?(n.pbrMetallicRoughness.metallicFactor=e.metalness,n.pbrMetallicRoughness.roughnessFactor=e.roughness):(n.pbrMetallicRoughness.metallicFactor=0,n.pbrMetallicRoughness.roughnessFactor=1),e.metalnessMap||e.roughnessMap){const l=await this.buildMetalRoughTextureAsync(e.metalnessMap,e.roughnessMap),c={index:await this.processTextureAsync(l),texCoord:l.channel};this.applyTextureTransform(c,l),n.pbrMetallicRoughness.metallicRoughnessTexture=c}if(e.map){const l={index:await this.processTextureAsync(e.map),texCoord:e.map.channel};this.applyTextureTransform(l,e.map),n.pbrMetallicRoughness.baseColorTexture=l}if(e.emissive){const l=e.emissive;if(Math.max(l.r,l.g,l.b)>0&&(n.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const h={index:await this.processTextureAsync(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(h,e.emissiveMap),n.emissiveTexture=h}}if(e.normalMap){const l={index:await this.processTextureAsync(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(l.scale=e.normalScale.x),this.applyTextureTransform(l,e.normalMap),n.normalTexture=l}if(e.aoMap){const l={index:await this.processTextureAsync(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(l.strength=e.aoMapIntensity),this.applyTextureTransform(l,e.aoMap),n.occlusionTexture=l}e.transparent?n.alphaMode="BLEND":e.alphaTest>0&&(n.alphaMode="MASK",n.alphaCutoff=e.alphaTest),e.side===je&&(n.doubleSided=!0),e.name!==""&&(n.name=e.name),this.serializeUserData(e,n),await this._invokeAllAsync(async function(l){l.writeMaterialAsync&&await l.writeMaterialAsync(e,n)});const i=s.materials.push(n)-1;return o.materials.set(e,i),i}async processMeshAsync(e){const o=this.cache,s=this.json,n=[e.geometry.uuid];if(Array.isArray(e.material))for(let m=0,L=e.material.length;m<L;m++)n.push(e.material[m].uuid);else n.push(e.material.uuid);const a=n.join(":");if(o.meshes.has(a))return o.meshes.get(a);const i=e.geometry;let l;e.isLineSegments?l=J.LINES:e.isLineLoop?l=J.LINE_LOOP:e.isLine?l=J.LINE_STRIP:e.isPoints?l=J.POINTS:l=e.material.wireframe?J.LINES:J.TRIANGLES;const c={},h={},g=[],v=[],y={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},f=i.getAttribute("normal");f!==void 0&&!this.isNormalizedNormalAttribute(f)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),i.setAttribute("normal",this.createNormalizedNormalAttribute(f)));let p=null;for(let m in i.attributes){if(m.slice(0,5)==="morph")continue;const L=i.attributes[m];if(m=y[m]||m.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(m)||(m="_"+m),o.attributes.has(this.getUID(L))){h[m]=o.attributes.get(this.getUID(L));continue}p=null;const T=L.array;m==="JOINTS_0"&&!(T instanceof Uint16Array)&&!(T instanceof Uint8Array)?(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),p=new Re(new Uint16Array(T),L.itemSize,L.normalized)):(T instanceof Uint32Array||T instanceof Int32Array)&&!m.startsWith("_")&&(console.warn(`GLTFExporter: Attribute "${m}" converted to type FLOAT.`),p=yt.Utils.toFloat32BufferAttribute(L));const w=this.processAccessor(p||L,i);w!==null&&(m.startsWith("_")||this.detectMeshQuantization(m,L),h[m]=w,o.attributes.set(this.getUID(L),w))}if(f!==void 0&&i.setAttribute("normal",f),Object.keys(h).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const m=[],L=[],_={};if(e.morphTargetDictionary!==void 0)for(const T in e.morphTargetDictionary)_[e.morphTargetDictionary[T]]=T;for(let T=0;T<e.morphTargetInfluences.length;++T){const w={};let I=!1;for(const Y in i.morphAttributes){if(Y!=="position"&&Y!=="normal"){I||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),I=!0);continue}const R=i.morphAttributes[Y][T],b=Y.toUpperCase(),A=i.attributes[Y];if(o.attributes.has(this.getUID(R,!0))){w[b]=o.attributes.get(this.getUID(R,!0));continue}const V=R.clone();if(!i.morphTargetsRelative)for(let H=0,D=R.count;H<D;H++)for(let N=0;N<R.itemSize;N++)N===0&&V.setX(H,R.getX(H)-A.getX(H)),N===1&&V.setY(H,R.getY(H)-A.getY(H)),N===2&&V.setZ(H,R.getZ(H)-A.getZ(H)),N===3&&V.setW(H,R.getW(H)-A.getW(H));w[b]=this.processAccessor(V,i),o.attributes.set(this.getUID(A,!0),w[b])}v.push(w),m.push(e.morphTargetInfluences[T]),e.morphTargetDictionary!==void 0&&L.push(_[T])}c.weights=m,L.length>0&&(c.extras={},c.extras.targetNames=L)}const M=Array.isArray(e.material);if(M&&i.groups.length===0)return null;let S=!1;if(M&&i.index===null){const m=[];for(let L=0,_=i.attributes.position.count;L<_;L++)m[L]=L;i.setIndex(m),S=!0}const E=M?e.material:[e.material],C=M?i.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let m=0,L=C.length;m<L;m++){const _={mode:l,attributes:h};if(this.serializeUserData(i,_),v.length>0&&(_.targets=v),i.index!==null){let w=this.getUID(i.index);(C[m].start!==void 0||C[m].count!==void 0)&&(w+=":"+C[m].start+":"+C[m].count),o.attributes.has(w)?_.indices=o.attributes.get(w):(_.indices=this.processAccessor(i.index,i,C[m].start,C[m].count),o.attributes.set(w,_.indices)),_.indices===null&&delete _.indices}const T=await this.processMaterialAsync(E[C[m].materialIndex]);T!==null&&(_.material=T),g.push(_)}S===!0&&i.setIndex(null),c.primitives=g,s.meshes||(s.meshes=[]),await this._invokeAllAsync(function(m){m.writeMesh&&m.writeMesh(e,c)});const P=s.meshes.push(c)-1;return o.meshes.set(a,P),P}detectMeshQuantization(e,o){if(this.extensionsUsed[Tt])return;let s;switch(o.array.constructor){case Int8Array:s="byte";break;case Uint8Array:s="unsigned byte";break;case Int16Array:s="short";break;case Uint16Array:s="unsigned short";break;default:return}o.normalized&&(s+=" normalized");const n=e.split("_",1)[0];Jt[n]&&Jt[n].includes(s)&&(this.extensionsUsed[Tt]=!0,this.extensionsRequired[Tt]=!0)}processCamera(e){const o=this.json;o.cameras||(o.cameras=[]);const s=e.isOrthographicCamera,n={type:s?"orthographic":"perspective"};return s?n.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:n.perspective={aspectRatio:e.aspect,yfov:Pt.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(n.name=e.type),o.cameras.push(n)-1}processAnimation(e,o){const s=this.json,n=this.nodeMap;s.animations||(s.animations=[]),e=yt.Utils.mergeMorphTargetTracks(e.clone(),o);const a=e.tracks,i=[],l=[];for(let c=0;c<a.length;++c){const h=a[c],g=gt.parseTrackName(h.name);let v=gt.findNode(o,g.nodeName);const y=en[g.propertyName];if(g.objectName==="bones"&&(v.isSkinnedMesh===!0?v=v.skeleton.getBoneByName(g.objectIndex):v=void 0),!v||!y){console.warn('THREE.GLTFExporter: Could not export animation track "%s".',h.name);continue}const f=1;let p=h.values.length/h.times.length;y===en.morphTargetInfluences&&(p/=v.morphTargetInfluences.length);let M;h.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(M="CUBICSPLINE",p/=3):h.getInterpolation()===io?M="STEP":M="LINEAR",l.push({input:this.processAccessor(new Re(h.times,f)),output:this.processAccessor(new Re(h.values,p)),interpolation:M}),i.push({sampler:l.length-1,target:{node:n.get(v),path:y}})}return s.animations.push({name:e.name||"clip_"+s.animations.length,samplers:l,channels:i}),s.animations.length-1}processSkin(e){const o=this.json,s=this.nodeMap,n=o.nodes[s.get(e)],a=e.skeleton;if(a===void 0)return null;const i=e.skeleton.bones[0];if(i===void 0)return null;const l=[],c=new Float32Array(a.bones.length*16),h=new wt;for(let v=0;v<a.bones.length;++v)l.push(s.get(a.bones[v])),h.copy(a.boneInverses[v]),h.multiply(e.bindMatrix).toArray(c,v*16);return o.skins===void 0&&(o.skins=[]),o.skins.push({inverseBindMatrices:this.processAccessor(new Re(c,16)),joints:l,skeleton:s.get(i)}),n.skin=o.skins.length-1}async processNodeAsync(e){const o=this.json,s=this.options,n=this.nodeMap;o.nodes||(o.nodes=[]);const a={};if(s.trs){const l=e.quaternion.toArray(),c=e.position.toArray(),h=e.scale.toArray();qe(l,[0,0,0,1])||(a.rotation=l),qe(c,[0,0,0])||(a.translation=c),qe(h,[1,1,1])||(a.scale=h)}else e.matrixAutoUpdate&&e.updateMatrix(),pd(e.matrix)===!1&&(a.matrix=e.matrix.elements);if(e.name!==""&&(a.name=String(e.name)),this.serializeUserData(e,a),e.isMesh||e.isLine||e.isPoints){const l=await this.processMeshAsync(e);l!==null&&(a.mesh=l)}else e.isCamera&&(a.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const l=[];for(let c=0,h=e.children.length;c<h;c++){const g=e.children[c];if(g.visible||s.onlyVisible===!1){const v=await this.processNodeAsync(g);v!==null&&l.push(v)}}l.length>0&&(a.children=l)}await this._invokeAllAsync(function(l){l.writeNode&&l.writeNode(e,a)});const i=o.nodes.push(a)-1;return n.set(e,i),i}async processSceneAsync(e){const o=this.json,s=this.options;o.scenes||(o.scenes=[],o.scene=0);const n={};e.name!==""&&(n.name=e.name),o.scenes.push(n);const a=[];for(let i=0,l=e.children.length;i<l;i++){const c=e.children[i];if(c.visible||s.onlyVisible===!1){const h=await this.processNodeAsync(c);h!==null&&a.push(h)}}a.length>0&&(n.nodes=a),this.serializeUserData(e,n)}async processObjectsAsync(e){const o=new et;o.name="AuxScene";for(let s=0;s<e.length;s++)o.children.push(e[s]);await this.processSceneAsync(o)}async processInputAsync(e){const o=this.options;e=e instanceof Array?e:[e],await this._invokeAllAsync(function(n){n.beforeParse&&n.beforeParse(e)});const s=[];for(let n=0;n<e.length;n++)e[n]instanceof et?await this.processSceneAsync(e[n]):s.push(e[n]);s.length>0&&await this.processObjectsAsync(s);for(let n=0;n<this.skins.length;++n)this.processSkin(this.skins[n]);for(let n=0;n<o.animations.length;++n)this.processAnimation(o.animations[n],e[0]);await this._invokeAllAsync(function(n){n.afterParse&&n.afterParse(e)})}async _invokeAllAsync(e){for(let o=0,s=this.plugins.length;o<s;o++)await e(this.plugins[o])}}class gd{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,o){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const s=this.writer,n=s.json,a=s.extensionsUsed,i={};e.name&&(i.name=e.name),i.color=e.color.toArray(),i.intensity=e.intensity,e.isDirectionalLight?i.type="directional":e.isPointLight?(i.type="point",e.distance>0&&(i.range=e.distance)):e.isSpotLight&&(i.type="spot",e.distance>0&&(i.range=e.distance),i.spot={},i.spot.innerConeAngle=(1-e.penumbra)*e.angle,i.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),a[this.name]||(n.extensions=n.extensions||{},n.extensions[this.name]={lights:[]},a[this.name]=!0);const l=n.extensions[this.name].lights;l.push(i),o.extensions=o.extensions||{},o.extensions[this.name]={light:l.length-1}}}class _d{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}async writeMaterialAsync(e,o){if(!e.isMeshBasicMaterial)return;const n=this.writer.extensionsUsed;o.extensions=o.extensions||{},o.extensions[this.name]={},n[this.name]=!0,o.pbrMetallicRoughness.metallicFactor=0,o.pbrMetallicRoughness.roughnessFactor=.9}}class yd{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}async writeMaterialAsync(e,o){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const s=this.writer,n=s.extensionsUsed,a={};if(a.clearcoatFactor=e.clearcoat,e.clearcoatMap){const i={index:await s.processTextureAsync(e.clearcoatMap),texCoord:e.clearcoatMap.channel};s.applyTextureTransform(i,e.clearcoatMap),a.clearcoatTexture=i}if(a.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const i={index:await s.processTextureAsync(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};s.applyTextureTransform(i,e.clearcoatRoughnessMap),a.clearcoatRoughnessTexture=i}if(e.clearcoatNormalMap){const i={index:await s.processTextureAsync(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};e.clearcoatNormalScale.x!==1&&(i.scale=e.clearcoatNormalScale.x),s.applyTextureTransform(i,e.clearcoatNormalMap),a.clearcoatNormalTexture=i}o.extensions=o.extensions||{},o.extensions[this.name]=a,n[this.name]=!0}}class vd{constructor(e){this.writer=e,this.name="KHR_materials_dispersion"}async writeMaterialAsync(e,o){if(!e.isMeshPhysicalMaterial||e.dispersion===0)return;const n=this.writer.extensionsUsed,a={};a.dispersion=e.dispersion,o.extensions=o.extensions||{},o.extensions[this.name]=a,n[this.name]=!0}}class wd{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}async writeMaterialAsync(e,o){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const s=this.writer,n=s.extensionsUsed,a={};if(a.iridescenceFactor=e.iridescence,e.iridescenceMap){const i={index:await s.processTextureAsync(e.iridescenceMap),texCoord:e.iridescenceMap.channel};s.applyTextureTransform(i,e.iridescenceMap),a.iridescenceTexture=i}if(a.iridescenceIor=e.iridescenceIOR,a.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],a.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const i={index:await s.processTextureAsync(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};s.applyTextureTransform(i,e.iridescenceThicknessMap),a.iridescenceThicknessTexture=i}o.extensions=o.extensions||{},o.extensions[this.name]=a,n[this.name]=!0}}class xd{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}async writeMaterialAsync(e,o){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,n=s.extensionsUsed,a={};if(a.transmissionFactor=e.transmission,e.transmissionMap){const i={index:await s.processTextureAsync(e.transmissionMap),texCoord:e.transmissionMap.channel};s.applyTextureTransform(i,e.transmissionMap),a.transmissionTexture=i}o.extensions=o.extensions||{},o.extensions[this.name]=a,n[this.name]=!0}}class Md{constructor(e){this.writer=e,this.name="KHR_materials_volume"}async writeMaterialAsync(e,o){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,n=s.extensionsUsed,a={};if(a.thicknessFactor=e.thickness,e.thicknessMap){const i={index:await s.processTextureAsync(e.thicknessMap),texCoord:e.thicknessMap.channel};s.applyTextureTransform(i,e.thicknessMap),a.thicknessTexture=i}e.attenuationDistance!==1/0&&(a.attenuationDistance=e.attenuationDistance),a.attenuationColor=e.attenuationColor.toArray(),o.extensions=o.extensions||{},o.extensions[this.name]=a,n[this.name]=!0}}class bd{constructor(e){this.writer=e,this.name="KHR_materials_ior"}async writeMaterialAsync(e,o){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const n=this.writer.extensionsUsed,a={};a.ior=e.ior,o.extensions=o.extensions||{},o.extensions[this.name]=a,n[this.name]=!0}}class Sd{constructor(e){this.writer=e,this.name="KHR_materials_specular"}async writeMaterialAsync(e,o){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(ad)&&!e.specularIntensityMap&&!e.specularColorMap)return;const s=this.writer,n=s.extensionsUsed,a={};if(e.specularIntensityMap){const i={index:await s.processTextureAsync(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};s.applyTextureTransform(i,e.specularIntensityMap),a.specularTexture=i}if(e.specularColorMap){const i={index:await s.processTextureAsync(e.specularColorMap),texCoord:e.specularColorMap.channel};s.applyTextureTransform(i,e.specularColorMap),a.specularColorTexture=i}a.specularFactor=e.specularIntensity,a.specularColorFactor=e.specularColor.toArray(),o.extensions=o.extensions||{},o.extensions[this.name]=a,n[this.name]=!0}}class Cd{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}async writeMaterialAsync(e,o){if(!e.isMeshPhysicalMaterial||e.sheen==0)return;const s=this.writer,n=s.extensionsUsed,a={};if(e.sheenRoughnessMap){const i={index:await s.processTextureAsync(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};s.applyTextureTransform(i,e.sheenRoughnessMap),a.sheenRoughnessTexture=i}if(e.sheenColorMap){const i={index:await s.processTextureAsync(e.sheenColorMap),texCoord:e.sheenColorMap.channel};s.applyTextureTransform(i,e.sheenColorMap),a.sheenColorTexture=i}a.sheenRoughnessFactor=e.sheenRoughness,a.sheenColorFactor=e.sheenColor.toArray(),o.extensions=o.extensions||{},o.extensions[this.name]=a,n[this.name]=!0}}class Ad{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}async writeMaterialAsync(e,o){if(!e.isMeshPhysicalMaterial||e.anisotropy==0)return;const s=this.writer,n=s.extensionsUsed,a={};if(e.anisotropyMap){const i={index:await s.processTextureAsync(e.anisotropyMap)};s.applyTextureTransform(i,e.anisotropyMap),a.anisotropyTexture=i}a.anisotropyStrength=e.anisotropy,a.anisotropyRotation=e.anisotropyRotation,o.extensions=o.extensions||{},o.extensions[this.name]=a,n[this.name]=!0}}class Td{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}async writeMaterialAsync(e,o){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const n=this.writer.extensionsUsed,a={};a.emissiveStrength=e.emissiveIntensity,o.extensions=o.extensions||{},o.extensions[this.name]=a,n[this.name]=!0}}class Ld{constructor(e){this.writer=e,this.name="EXT_materials_bump"}async writeMaterialAsync(e,o){if(!e.isMeshStandardMaterial||e.bumpScale===1&&!e.bumpMap)return;const s=this.writer,n=s.extensionsUsed,a={};if(e.bumpMap){const i={index:await s.processTextureAsync(e.bumpMap),texCoord:e.bumpMap.channel};s.applyTextureTransform(i,e.bumpMap),a.bumpTexture=i}a.bumpFactor=e.bumpScale,o.extensions=o.extensions||{},o.extensions[this.name]=a,n[this.name]=!0}}class Ed{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,o){if(!e.isInstancedMesh)return;const s=this.writer,n=e,a=new Float32Array(n.count*3),i=new Float32Array(n.count*4),l=new Float32Array(n.count*3),c=new wt,h=new q,g=new Ce,v=new q;for(let f=0;f<n.count;f++)n.getMatrixAt(f,c),c.decompose(h,g,v),h.toArray(a,f*3),g.toArray(i,f*4),v.toArray(l,f*3);const y={TRANSLATION:s.processAccessor(new Re(a,3)),ROTATION:s.processAccessor(new Re(i,4)),SCALE:s.processAccessor(new Re(l,3))};n.instanceColor&&(y._COLOR_0=s.processAccessor(n.instanceColor)),o.extensions=o.extensions||{},o.extensions[this.name]={attributes:y},s.extensionsUsed[this.name]=!0,s.extensionsRequired[this.name]=!0}}yt.Utils={insertKeyframe:function(t,e){const s=t.getValueSize(),n=new t.TimeBufferType(t.times.length+1),a=new t.ValueBufferType(t.values.length+s),i=t.createInterpolant(new t.ValueBufferType(s));let l;if(t.times.length===0){n[0]=e;for(let c=0;c<s;c++)a[c]=0;l=0}else if(e<t.times[0]){if(Math.abs(t.times[0]-e)<.001)return 0;n[0]=e,n.set(t.times,1),a.set(i.evaluate(e),0),a.set(t.values,s),l=0}else if(e>t.times[t.times.length-1]){if(Math.abs(t.times[t.times.length-1]-e)<.001)return t.times.length-1;n[n.length-1]=e,n.set(t.times,0),a.set(t.values,0),a.set(i.evaluate(e),t.values.length),l=n.length-1}else for(let c=0;c<t.times.length;c++){if(Math.abs(t.times[c]-e)<.001)return c;if(t.times[c]<e&&t.times[c+1]>e){n.set(t.times.slice(0,c+1),0),n[c+1]=e,n.set(t.times.slice(c+1),c+2),a.set(t.values.slice(0,(c+1)*s),0),a.set(i.evaluate(e),(c+1)*s),a.set(t.values.slice((c+1)*s),(c+2)*s),l=c+1;break}}return t.times=n,t.values=a,l},mergeMorphTargetTracks:function(t,e){const o=[],s={},n=t.tracks;for(let a=0;a<n.length;++a){let i=n[a];const l=gt.parseTrackName(i.name),c=gt.findNode(e,l.nodeName);if(l.propertyName!=="morphTargetInfluences"||l.propertyIndex===void 0){o.push(i);continue}if(i.createInterpolant!==i.InterpolantFactoryMethodDiscrete&&i.createInterpolant!==i.InterpolantFactoryMethodLinear){if(i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),i=i.clone(),i.setInterpolation(fo)}const h=c.morphTargetInfluences.length,g=c.morphTargetDictionary[l.propertyIndex];if(g===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+l.propertyIndex);let v;if(s[c.uuid]===void 0){v=i.clone();const f=new v.ValueBufferType(h*v.times.length);for(let p=0;p<v.times.length;p++)f[p*h+g]=v.values[p];v.name=(l.nodeName||"")+".morphTargetInfluences",v.values=f,s[c.uuid]=v,o.push(v);continue}const y=i.createInterpolant(new i.ValueBufferType(1));v=s[c.uuid];for(let f=0;f<v.times.length;f++)v.values[f*h+g]=y.evaluate(v.times[f]);for(let f=0;f<i.times.length;f++){const p=this.insertKeyframe(v,i.times[f]);v.values[p*h+g]=i.values[f]}}return t.tracks=o,t},toFloat32BufferAttribute:function(t){const e=new Re(new Float32Array(t.count*t.itemSize),t.itemSize,!1);if(!t.normalized&&!t.isInterleavedBufferAttribute)return e.array.set(t.array),e;for(let o=0,s=t.count;o<s;o++)for(let n=0;n<t.itemSize;n++)e.setComponent(o,n,t.getComponent(o,n));return e}};class Id{constructor(){this.textureUtils=null}setTextureUtils(e){this.textureUtils=e}parse(e,o,s,n){this.parseAsync(e,n).then(o).catch(s)}async parseAsync(e,o={}){o=Object.assign({ar:{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}},includeAnchoringProperties:!0,quickLookCompatible:!1,maxTextureSize:1024},o);const s={},n="model.usda";s[n]=null;let a=In();a+=kd(o);const i={},l={};e.traverseVisible(h=>{if(h.isMesh){const g=h.geometry,v=h.material;if(v.isMeshStandardMaterial){const y="geometries/Geometry_"+g.id+".usda";if(!(y in s)){const f=Ud(g);s[y]=$d(f)}v.uuid in i||(i[v.uuid]=v),a+=Vd(h,g,i[v.uuid])}else console.warn("THREE.USDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",h)}else h.isCamera&&(a+=Gd(h))}),a+=Rd(),a+=Nd(i,l,o.quickLookCompatible),s[n]=Mn(a),a=null;for(const h in l){let g=l[h];if(g.isCompressedTexture===!0){if(this.textureUtils===null)throw new Error("THREE.USDZExporter: setTextureUtils() must be called to process compressed textures.");g=await this.textureUtils.decompress(g)}const v=Pd(g.image,g.flipY,o.maxTextureSize),y=await new Promise(f=>v.toBlob(f,"image/png",1));s[`textures/Texture_${h}.png`]=new Uint8Array(await y.arrayBuffer())}let c=0;for(const h in s){const g=s[h],v=34+h.length;c+=v;const y=c&63;if(y!==4){const f=64-y,p=new Uint8Array(f);s[h]=[g,{extra:{12345:p}}]}c=g.length}return mo(s,{level:0})}}function Pd(t,e,o){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const s=o/Math.max(t.width,t.height),n=document.createElement("canvas");n.width=t.width*Math.min(1,s),n.height=t.height*Math.min(1,s);const a=n.getContext("2d");return e===!0&&(a.translate(0,n.height),a.scale(1,-1)),a.drawImage(t,0,0,n.width,n.height),n}else throw new Error("THREE.USDZExporter: No valid image data found. Unable to process texture.")}const he=7;function In(){return`#usda 1.0
(
	customLayerData = {
		string creator = "Three.js USDZExporter"
	}
	defaultPrim = "Root"
	metersPerUnit = 1
	upAxis = "Y"
)

`}function kd(t){return`def Xform "Root"
{
	def Scope "Scenes" (
		kind = "sceneLibrary"
	)
	{
		def Xform "Scene" (
			customData = {
				bool preliminary_collidesWithEnvironment = 0
				string sceneName = "Scene"
			}
			sceneName = "Scene"
		)
		{${t.includeAnchoringProperties===!0?`
		token preliminary:anchoring:type = "${t.ar.anchoring.type}"
		token preliminary:planeAnchoring:alignment = "${t.ar.planeAnchoring.alignment}"
	`:""}
`}function Rd(){return`
		}
	}
}

`}function $d(t){let e=In();return e+=t,Mn(e)}function Vd(t,e,o){const s="Object_"+t.id,n=Pn(t.matrixWorld);return t.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",t),`def Xform "${s}" (
	prepend references = @./geometries/Geometry_${e.id}.usda@</Geometry>
	prepend apiSchemas = ["MaterialBindingAPI"]
)
{
	matrix4d xformOp:transform = ${n}
	uniform token[] xformOpOrder = ["xformOp:transform"]

	rel material:binding = </Materials/Material_${o.id}>
}

`}function Pn(t){const e=t.elements;return`( ${lt(e,0)}, ${lt(e,4)}, ${lt(e,8)}, ${lt(e,12)} )`}function lt(t,e){return`(${t[e+0]}, ${t[e+1]}, ${t[e+2]}, ${t[e+3]})`}function Ud(t){return`
def "Geometry"
{
${Dd(t)}
}
`}function Dd(t){const e="Geometry",o=t.attributes,s=o.position.count;return`
	def Mesh "${e}"
	{
		int[] faceVertexCounts = [${Od(t)}]
		int[] faceVertexIndices = [${Fd(t)}]
		normal3f[] normals = [${Rt(o.normal,s)}] (
			interpolation = "vertex"
		)
		point3f[] points = [${Rt(o.position,s)}]
${Hd(o)}
		uniform token subdivisionScheme = "none"
	}
`}function Od(t){const e=t.index!==null?t.index.count:t.attributes.position.count;return Array(e/3).fill(3).join(", ")}function Fd(t){const e=t.index,o=[];if(e!==null)for(let s=0;s<e.count;s++)o.push(e.getX(s));else{const s=t.attributes.position.count;for(let n=0;n<s;n++)o.push(n)}return o.join(", ")}function Rt(t,e){if(t===void 0)return console.warn("USDZExporter: Normals missing."),Array(e).fill("(0, 0, 0)").join(", ");const o=[];for(let s=0;s<t.count;s++){const n=t.getX(s),a=t.getY(s),i=t.getZ(s);o.push(`(${n.toPrecision(he)}, ${a.toPrecision(he)}, ${i.toPrecision(he)})`)}return o.join(", ")}function zd(t){const e=[];for(let o=0;o<t.count;o++){const s=t.getX(o),n=t.getY(o);e.push(`(${s.toPrecision(he)}, ${1-n.toPrecision(he)})`)}return e.join(", ")}function Hd(t){let e="";for(let s=0;s<4;s++){const n=s>0?s:"",a=t["uv"+n];a!==void 0&&(e+=`
		texCoord2f[] primvars:st${n} = [${zd(a)}] (
			interpolation = "vertex"
		)`)}const o=t.color;if(o!==void 0){const s=o.count;e+=`
	color3f[] primvars:displayColor = [${Rt(o,s)}] (
		interpolation = "vertex"
		)`}return e}function Nd(t,e,o=!1){const s=[];for(const n in t){const a=t[n];s.push(jd(a,e,o))}return`def "Materials"
{
${s.join("")}
}

`}function jd(t,e,o=!1){const s="			",n=[],a=[];function i(l,c,h){const g=l.source.id+"_"+l.flipY;e[g]=l;const v=l.channel>0?"st"+l.channel:"st",y={1e3:"repeat",1001:"clamp",1002:"mirror"},f=l.repeat.clone(),p=l.offset.clone(),M=l.rotation,S=Math.sin(M),E=Math.cos(M);return p.y=1-p.y-f.y,o?(p.x=p.x/f.x,p.y=p.y/f.y,p.x+=S/f.x,p.y+=E-1):(p.x+=S*f.x,p.y+=(1-E)*f.y),`
		def Shader "PrimvarReader_${c}"
		{
			uniform token info:id = "UsdPrimvarReader_float2"
			float2 inputs:fallback = (0.0, 0.0)
			token inputs:varname = "${v}"
			float2 outputs:result
		}

		def Shader "Transform2d_${c}"
		{
			uniform token info:id = "UsdTransform2d"
			token inputs:in.connect = </Materials/Material_${t.id}/PrimvarReader_${c}.outputs:result>
			float inputs:rotation = ${(M*(180/Math.PI)).toFixed(he)}
			float2 inputs:scale = ${an(f)}
			float2 inputs:translation = ${an(p)}
			float2 outputs:result
		}

		def Shader "Texture_${l.id}_${c}"
		{
			uniform token info:id = "UsdUVTexture"
			asset inputs:file = @textures/Texture_${g}.png@
			float2 inputs:st.connect = </Materials/Material_${t.id}/Transform2d_${c}.outputs:result>
			${h!==void 0?"float4 inputs:scale = "+Bd(h):""}
			token inputs:sourceColorSpace = "${l.colorSpace===wn?"raw":"sRGB"}"
			token inputs:wrapS = "${y[l.wrapS]}"
			token inputs:wrapT = "${y[l.wrapT]}"
			float outputs:r
			float outputs:g
			float outputs:b
			float3 outputs:rgb
			${t.transparent||t.alphaTest>0?"float outputs:a":""}
		}`}return t.side===je&&console.warn("THREE.USDZExporter: USDZ does not support double sided materials",t),t.map!==null?(n.push(`${s}color3f inputs:diffuseColor.connect = </Materials/Material_${t.id}/Texture_${t.map.id}_diffuse.outputs:rgb>`),t.transparent?n.push(`${s}float inputs:opacity.connect = </Materials/Material_${t.id}/Texture_${t.map.id}_diffuse.outputs:a>`):t.alphaTest>0&&(n.push(`${s}float inputs:opacity.connect = </Materials/Material_${t.id}/Texture_${t.map.id}_diffuse.outputs:a>`),n.push(`${s}float inputs:opacityThreshold = ${t.alphaTest}`)),a.push(i(t.map,"diffuse",t.color))):n.push(`${s}color3f inputs:diffuseColor = ${sn(t.color)}`),t.emissiveMap!==null?(n.push(`${s}color3f inputs:emissiveColor.connect = </Materials/Material_${t.id}/Texture_${t.emissiveMap.id}_emissive.outputs:rgb>`),a.push(i(t.emissiveMap,"emissive",new re(t.emissive.r*t.emissiveIntensity,t.emissive.g*t.emissiveIntensity,t.emissive.b*t.emissiveIntensity)))):t.emissive.getHex()>0&&n.push(`${s}color3f inputs:emissiveColor = ${sn(t.emissive)}`),t.normalMap!==null&&(n.push(`${s}normal3f inputs:normal.connect = </Materials/Material_${t.id}/Texture_${t.normalMap.id}_normal.outputs:rgb>`),a.push(i(t.normalMap,"normal"))),t.aoMap!==null&&(n.push(`${s}float inputs:occlusion.connect = </Materials/Material_${t.id}/Texture_${t.aoMap.id}_occlusion.outputs:r>`),a.push(i(t.aoMap,"occlusion",new re(t.aoMapIntensity,t.aoMapIntensity,t.aoMapIntensity)))),t.roughnessMap!==null?(n.push(`${s}float inputs:roughness.connect = </Materials/Material_${t.id}/Texture_${t.roughnessMap.id}_roughness.outputs:g>`),a.push(i(t.roughnessMap,"roughness",new re(t.roughness,t.roughness,t.roughness)))):n.push(`${s}float inputs:roughness = ${t.roughness}`),t.metalnessMap!==null?(n.push(`${s}float inputs:metallic.connect = </Materials/Material_${t.id}/Texture_${t.metalnessMap.id}_metallic.outputs:b>`),a.push(i(t.metalnessMap,"metallic",new re(t.metalness,t.metalness,t.metalness)))):n.push(`${s}float inputs:metallic = ${t.metalness}`),t.alphaMap!==null?(n.push(`${s}float inputs:opacity.connect = </Materials/Material_${t.id}/Texture_${t.alphaMap.id}_opacity.outputs:r>`),n.push(`${s}float inputs:opacityThreshold = 0.0001`),a.push(i(t.alphaMap,"opacity"))):n.push(`${s}float inputs:opacity = ${t.opacity}`),t.isMeshPhysicalMaterial&&(t.clearcoatMap!==null?(n.push(`${s}float inputs:clearcoat.connect = </Materials/Material_${t.id}/Texture_${t.clearcoatMap.id}_clearcoat.outputs:r>`),a.push(i(t.clearcoatMap,"clearcoat",new re(t.clearcoat,t.clearcoat,t.clearcoat)))):n.push(`${s}float inputs:clearcoat = ${t.clearcoat}`),t.clearcoatRoughnessMap!==null?(n.push(`${s}float inputs:clearcoatRoughness.connect = </Materials/Material_${t.id}/Texture_${t.clearcoatRoughnessMap.id}_clearcoatRoughness.outputs:g>`),a.push(i(t.clearcoatRoughnessMap,"clearcoatRoughness",new re(t.clearcoatRoughness,t.clearcoatRoughness,t.clearcoatRoughness)))):n.push(`${s}float inputs:clearcoatRoughness = ${t.clearcoatRoughness}`),n.push(`${s}float inputs:ior = ${t.ior}`)),`
	def Material "Material_${t.id}"
	{
		def Shader "PreviewSurface"
		{
			uniform token info:id = "UsdPreviewSurface"
${n.join(`
`)}
			int inputs:useSpecularWorkflow = 0
			token outputs:surface
		}

		token outputs:surface.connect = </Materials/Material_${t.id}/PreviewSurface.outputs:surface>

${a.join(`
`)}

	}
`}function sn(t){return`(${t.r}, ${t.g}, ${t.b})`}function Bd(t){return`(${t.r}, ${t.g}, ${t.b}, 1.0)`}function an(t){return`(${t.x}, ${t.y})`}function Gd(t){const e=t.name?t.name:"Camera_"+t.id,o=Pn(t.matrixWorld);return t.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",t),t.isOrthographicCamera?`def Camera "${e}"
		{
			matrix4d xformOp:transform = ${o}
			uniform token[] xformOpOrder = ["xformOp:transform"]

			float2 clippingRange = (${t.near.toPrecision(he)}, ${t.far.toPrecision(he)})
			float horizontalAperture = ${((Math.abs(t.left)+Math.abs(t.right))*10).toPrecision(he)}
			float verticalAperture = ${((Math.abs(t.top)+Math.abs(t.bottom))*10).toPrecision(he)}
			token projection = "orthographic"
		}

	`:`def Camera "${e}"
		{
			matrix4d xformOp:transform = ${o}
			uniform token[] xformOpOrder = ["xformOp:transform"]

			float2 clippingRange = (${t.near.toPrecision(he)}, ${t.far.toPrecision(he)})
			float focalLength = ${t.getFocalLength().toPrecision(he)}
			float focusDistance = ${t.focus.toPrecision(he)}
			float horizontalAperture = ${t.getFilmWidth().toPrecision(he)}
			token projection = "perspective"
			float verticalAperture = ${t.getFilmHeight().toPrecision(he)}
		}

	`}function Mt(){const t=document.getElementById("video");t&&t.pause()}function bt(t,e={}){const{intensity:o=1,blurriness:s=0,isEnvironment:n=!1}=e;t&&(this.scene.background=t,this.scene.backgroundIntensity=o,this.scene.backgroundBlurriness=s,n&&(this.scene.environment=t))}function Yd(t){try{Mt(),this.scene.background=new re(t)}catch(e){throw console.error("设置场景颜色失败:",e),e}}function Xd(t){try{Mt();const e=new $e().load(t);return bt.call(this,e),e}catch(e){throw console.error("设置场景图片失败:",e),e}}async function Wd(t){try{Mt();const{blurriness:e=0,intensity:o=1,viewImg:s}=t;let n;return s.endsWith(".hdr")?n=await new vt().loadAsync(s):n=await new $e().loadAsync(s),n.mapping=Ot,bt.call(this,n,{intensity:o,blurriness:e,isEnvironment:!0}),n}catch(e){throw console.error("设置全景图失败:",e),e}}function Zd(t){const{blurriness:e,intensity:o}=t;this.scene.backgroundIntensity=o,this.scene.backgroundBlurriness=e}async function qd(t,e){try{Mt();const s=await(e==="hdr"?new vt:new $e).loadAsync(t);return s.mapping=Ot,bt.call(this,s),s}catch(o){throw console.error("设置外部贴图失败:",o),o}}async function Qd(t){try{const{container:e}=this,o=document.getElementById("video"),s=await new Promise((a,i)=>{const l=new FileReader;l.onload=c=>a(c.target.result),l.onerror=i,l.readAsDataURL(t.raw)});o.src=s,o.width=e.clientWidth,o.height=e.clientHeight;const n=new go(o);return n.colorSpace=ot,n.minFilter=Ve,n.magFilter=Ve,bt.call(this,n),o.play(),n}catch(e){throw console.error("设置视频失败:",e),e}}const Kd={onSetSceneColor:Yd,onSetSceneImage:Xd,onSetSceneViewImage:Wd,onSetSceneViewConfig:Zd,onSetStorageViewImage:qd,onSetStorageViewVideo:Qd};function Jd({ambientLight:t,ambientLightColor:e,ambientLightIntensity:o}){this.ambientLight.visible=t,this.ambientLight.intensity=o,this.ambientLight.color.set(e)}function ec(t){const{directionShadow:e,directionalHorizontal:o,directionalVertical:s,directionalSistine:n,directionalLight:a,directionalLightColor:i,directionalLightIntensity:l,directionalLightHelper:c}=t;this.directionalLight.visible=a,this.directionalLightHelper.visible=c&&a,this.directionalLight.intensity=l,this.directionalLight.castShadow=e,this.directionalLight.color.set(i);const h=Ft(o,s,n);this.directionalLight.position.set(h.x,h.y,h.z),this.directionalLightHelper.update()}function tc(t){const{pointHorizontal:e,pointVertical:o,pointDistance:s,pointLight:n,pointLightColor:a,pointLightIntensity:i,pointLightHelper:l}=t;this.pointLight.visible=n,this.pointLightHelper.visible=n&&l,this.pointLight.intensity=i,this.pointLight.color.set(a);const c=Ft(e,o,s);this.pointLight.position.set(c.x,c.y,c.z),this.pointLightHelper.update()}function nc(t){const{spotDistance:e,spotCastShadow:o,spotLightHelper:s,spotFocus:n,spotPenumbra:a,spotAngle:i,spotLight:l,spotLightColor:c,spotLightIntensity:h,spotHorizontal:g,spotVertical:v,spotSistine:y}=t;this.spotLight.visible=l,this.spotLightHelper.visible=l&&s,this.spotLight.intensity=h,this.spotLight.angle=i,this.spotLight.penumbra=a,this.spotLight.shadow.focus=n,this.spotLight.castShadow=o,this.spotLight.distance=e,this.spotLight.color.set(c);const f=Ft(g,v,y);this.spotLight.position.set(f.x,f.y,f.z),this.spotLightHelper.update()}function oc({ambientLight:t}){const e={planeColor:"#939393",planeWidth:7,planeHeight:7,ambientLight:t,ambientLightColor:"#fff",ambientLightIntensity:1,directionalLight:!1,directionalLightHelper:!0,directionalLightColor:"#1E90FF",directionalLightIntensity:1,directionalHorizontal:-1.26,directionalVertical:-3.85,directionalSistine:2.98,directionShadow:!0,pointLight:!1,pointLightHelper:!0,pointLightColor:"#1E90FF",pointLightIntensity:1,pointHorizontal:-4.21,pointVertical:-4.1,pointDistance:2.53,spotLight:!1,spotLightColor:"#323636",spotLightIntensity:400,spotHorizontal:-3.49,spotVertical:-4.37,spotSistine:4.09,spotAngle:.5,spotPenumbra:1,spotFocus:1,spotCastShadow:!0,spotLightHelper:!0,spotDistance:20};this.onSetModelAmbientLight(e),this.onSetModelDirectionalLight(e),this.onSetModelPointLight(e),this.onSetModelSpotLight(e)}const sc={onSetModelAmbientLight:Jd,onSetModelDirectionalLight:ec,onSetModelPointLight:tc,onSetModelSpotLight:nc,onResettingLight:oc};var tt={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return .5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return t===0?0:Math.pow(1024,t-1)},Out:function(t){return t===1?1:1-Math.pow(2,-10*t)},InOut:function(t){return t===0?0:t===1?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return t===0?0:t===1?1:-Math.pow(2,10*(t-1))*Math.sin((t-1.1)*5*Math.PI)},Out:function(t){return t===0?0:t===1?1:Math.pow(2,-10*t)*Math.sin((t-.1)*5*Math.PI)+1},InOut:function(t){return t===0?0:t===1?1:(t*=2,t<1?-.5*Math.pow(2,10*(t-1))*Math.sin((t-1.1)*5*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin((t-1.1)*5*Math.PI)+1)}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?.5*(t*t*((e+1)*t-e)):.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-tt.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?tt.Bounce.In(t*2)*.5:tt.Bounce.Out(t*2-1)*.5+.5}}},Qe;typeof self>"u"&&typeof process<"u"&&process.hrtime?Qe=function(){var t=process.hrtime();return t[0]*1e3+t[1]/1e6}:typeof self<"u"&&self.performance!==void 0&&self.performance.now!==void 0?Qe=self.performance.now.bind(self.performance):Date.now!==void 0?Qe=Date.now:Qe=function(){return new Date().getTime()};var ze=Qe,kn=function(){function t(){this._tweens={},this._tweensAddedDuringUpdate={}}return t.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(o){return e._tweens[o]})},t.prototype.removeAll=function(){this._tweens={}},t.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},t.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},t.prototype.update=function(e,o){e===void 0&&(e=ze()),o===void 0&&(o=!1);var s=Object.keys(this._tweens);if(s.length===0)return!1;for(;s.length>0;){this._tweensAddedDuringUpdate={};for(var n=0;n<s.length;n++){var a=this._tweens[s[n]],i=!o;a&&a.update(e,i)===!1&&!o&&delete this._tweens[s[n]]}s=Object.keys(this._tweensAddedDuringUpdate)}return!0},t}(),Ne={Linear:function(t,e){var o=t.length-1,s=o*e,n=Math.floor(s),a=Ne.Utils.Linear;return e<0?a(t[0],t[1],s):e>1?a(t[o],t[o-1],o-s):a(t[n],t[n+1>o?o:n+1],s-n)},Bezier:function(t,e){for(var o=0,s=t.length-1,n=Math.pow,a=Ne.Utils.Bernstein,i=0;i<=s;i++)o+=n(1-e,s-i)*n(e,i)*t[i]*a(s,i);return o},CatmullRom:function(t,e){var o=t.length-1,s=o*e,n=Math.floor(s),a=Ne.Utils.CatmullRom;return t[0]===t[o]?(e<0&&(n=Math.floor(s=o*(1+e))),a(t[(n-1+o)%o],t[n],t[(n+1)%o],t[(n+2)%o],s-n)):e<0?t[0]-(a(t[0],t[0],t[1],t[1],-s)-t[0]):e>1?t[o]-(a(t[o],t[o],t[o-1],t[o-1],s-o)-t[o]):a(t[n?n-1:0],t[n],t[o<n+1?o:n+1],t[o<n+2?o:n+2],s-n)},Utils:{Linear:function(t,e,o){return(e-t)*o+t},Bernstein:function(t,e){var o=Ne.Utils.Factorial;return o(t)/o(e)/o(t-e)},Factorial:function(){var t=[1];return function(e){var o=1;if(t[e])return t[e];for(var s=e;s>1;s--)o*=s;return t[e]=o,o}}(),CatmullRom:function(t,e,o,s,n){var a=(o-t)*.5,i=(s-e)*.5,l=n*n,c=n*l;return(2*e-2*o+a+i)*c+(-3*e+3*o-2*a-i)*l+a*n+e}}},Ht=function(){function t(){}return t.nextId=function(){return t._nextId++},t._nextId=0,t}(),Rn=new kn,ic=function(){function t(e,o){o===void 0&&(o=Rn),this._object=e,this._group=o,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=tt.Linear.None,this._interpolationFunction=Ne.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=Ht.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return t.prototype.getId=function(){return this._id},t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.isPaused=function(){return this._isPaused},t.prototype.to=function(e,o){return this._valuesEnd=Object.create(e),o!==void 0&&(this._duration=o),this},t.prototype.duration=function(e){return this._duration=e,this},t.prototype.start=function(e){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var o in this._valuesStartRepeat)this._swapEndStartRepeatValues(o),this._valuesStart[o]=this._valuesStartRepeat[o]}return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e!==void 0?typeof e=="string"?ze()+parseFloat(e):e:ze(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},t.prototype._setupProperties=function(e,o,s,n){for(var a in s){var i=e[a],l=Array.isArray(i),c=l?"array":typeof i,h=!l&&Array.isArray(s[a]);if(!(c==="undefined"||c==="function")){if(h){var g=s[a];if(g.length===0)continue;g=g.map(this._handleRelativeValue.bind(this,i)),s[a]=[i].concat(g)}if((c==="object"||l)&&i&&!h){o[a]=l?[]:{};for(var v in i)o[a][v]=i[v];n[a]=l?[]:{},this._setupProperties(i,o[a],s[a],n[a])}else typeof o[a]>"u"&&(o[a]=i),l||(o[a]*=1),h?n[a]=s[a].slice().reverse():n[a]=o[a]||0}}},t.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},t.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},t.prototype.pause=function(e){return e===void 0&&(e=ze()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this),this)},t.prototype.resume=function(e){return e===void 0&&(e=ze()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},t.prototype.stopChainedTweens=function(){for(var e=0,o=this._chainedTweens.length;e<o;e++)this._chainedTweens[e].stop();return this},t.prototype.group=function(e){return this._group=e,this},t.prototype.delay=function(e){return this._delayTime=e,this},t.prototype.repeat=function(e){return this._initialRepeat=e,this._repeat=e,this},t.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},t.prototype.yoyo=function(e){return this._yoyo=e,this},t.prototype.easing=function(e){return this._easingFunction=e,this},t.prototype.interpolation=function(e){return this._interpolationFunction=e,this},t.prototype.chain=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];return this._chainedTweens=e,this},t.prototype.onStart=function(e){return this._onStartCallback=e,this},t.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},t.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},t.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},t.prototype.onStop=function(e){return this._onStopCallback=e,this},t.prototype.update=function(e,o){if(e===void 0&&(e=ze()),o===void 0&&(o=!0),this._isPaused)return!0;var s,n,a=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(e>a)return!1;o&&this.start(e)}if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),n=(e-this._startTime)/this._duration,n=this._duration===0||n>1?1:n;var i=this._easingFunction(n);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,i),this._onUpdateCallback&&this._onUpdateCallback(this._object,n),n===1)if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(s in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[s]=="string"&&(this._valuesStartRepeat[s]=this._valuesStartRepeat[s]+parseFloat(this._valuesEnd[s])),this._yoyo&&this._swapEndStartRepeatValues(s),this._valuesStart[s]=this._valuesStartRepeat[s];return this._yoyo&&(this._reversed=!this._reversed),this._repeatDelayTime!==void 0?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var l=0,c=this._chainedTweens.length;l<c;l++)this._chainedTweens[l].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},t.prototype._updateProperties=function(e,o,s,n){for(var a in s)if(o[a]!==void 0){var i=o[a]||0,l=s[a],c=Array.isArray(e[a]),h=Array.isArray(l),g=!c&&h;g?e[a]=this._interpolationFunction(l,n):typeof l=="object"&&l?this._updateProperties(e[a],i,l,n):(l=this._handleRelativeValue(i,l),typeof l=="number"&&(e[a]=i+(l-i)*n))}},t.prototype._handleRelativeValue=function(e,o){return typeof o!="string"?o:o.charAt(0)==="+"||o.charAt(0)==="-"?e+parseFloat(o):parseFloat(o)},t.prototype._swapEndStartRepeatValues=function(e){var o=this._valuesStartRepeat[e],s=this._valuesEnd[e];typeof s=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(s):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=o},t}(),ac="18.6.4",rc=Ht.nextId,Te=Rn,lc=Te.getAll.bind(Te),dc=Te.removeAll.bind(Te),cc=Te.add.bind(Te),uc=Te.remove.bind(Te),pc=Te.update.bind(Te),Ie={Easing:tt,Group:kn,Interpolation:Ne,now:ze,Sequence:Ht,nextId:rc,Tween:ic,VERSION:ac,getAll:lc,removeAll:dc,add:cc,remove:uc,update:pc};function hc(t,e){const o=Math.PI/2,{x:s,y:n,z:a}=this.model.rotation,i={x:s,y:n,z:a};i[t]+=e?o:-o,new Ie.Tween({x:s,y:n,z:a}).to(i,500).onUpdate(l=>{this.model.rotation[t]=l[t]}).start()}function fc(){this.model.rotation.set(0,0,0)}function mc({positionX:t,positionY:e,positionZ:o}){new Ie.Tween(this.model.position).to({x:t,y:e,z:o},500).onUpdate(s=>{this.model.position.set(s.x||0,s.y||0,s.z||0)}).start()}function gc({positionX:t,positionY:e,positionZ:o}){this.model.position.set(t,e,o)}function _c(){this.camera.position.set(0,2,6),this.camera.lookAt(0,0,0)}function yc(){return this.camera.position}function vc({x:t,y:e,z:o,gridHelper:s,color:n}){this.gridHelper.visible=s,this.gridHelper.material.color.set(n),new Ie.Tween(this.gridHelper.position).to({x:t,y:e,z:o},500).onUpdate(a=>{this.gridHelper.position.set(a.x||0,a.y||0,a.z||0)}).start()}function wc({x:t,y:e,z:o,size:s,divisions:n,color:a,gridHelper:i}){this.scene.remove(this.gridHelper),this.gridHelper.geometry.dispose(),this.gridHelper.material.dispose(),this.gridHelper=new ht(s,n,a,a),this.gridHelper.position.set(t,e,o),this.gridHelper.material.linewidth=.1,this.gridHelper.material.color.set(a),this.gridHelper.visible=i,this.scene.add(this.gridHelper)}function xc({axesHelper:t,axesSize:e}){this.scene.remove(this.axesHelper),this.axesHelper.geometry.dispose(),this.axesHelper.material.dispose(),this.axesHelper=new bn(e),this.axesHelper.position.set(0,-.5,0),this.axesHelper.visible=t,this.scene.add(this.axesHelper)}const Mc={onSetModelRotateOnAxis:hc,onResultModelRotateOnAxis:fc,onSetModelPosition:mc,onResultModelPosition:gc,onResetModelCamera:_c,onGetModelCamera:yc,onSetModelGridHelper:vc,onSetModelGridHelperSize:wc,onSetModelAxesHelper:xc},Ue=be();function bc(){this.modelMaterialList=[],this.model.traverse((t,e)=>{!t.isMesh||!t.material||(t.castShadow=!0,t.frustumCulled=!1,Array.isArray(t.material)&&(t.material=t.material[0]),this.setMaterialMeshParams(t,e))})}function Sc(t,e){const o=t.clone();t.userData={...t.userData,rotation:o.rotation,scale:o.scale,position:o.position};const s=t.material.clone();t.mapId=`${t.name}_${e}`,t.material=s;const{mapId:n,uuid:a,userData:i,type:l,name:c,isMesh:h,visible:g}=t,{color:v,wireframe:y,depthWrite:f,opacity:p}=t.material,M={mapId:n,uuid:a,userData:i,type:l,name:c,isMesh:h,visible:g,material:{color:v,wireframe:y,depthWrite:f,opacity:p}};this.modelMaterialList.push(M);const S=t.material.clone();S.userData.mapId=`${t.name}_${e}`,this.originalMaterials.set(t.uuid,S)}function Cc(t){this.model.updateMatrixWorld();const e=new _t().setFromObject(this.model),o=e.getSize(new q),s=e.getCenter(new q),n=Math.max(o.x,o.y,o.z);t=t||2.5;const a=t/(n>1?n:.5);this.model.scale.setScalar(a),this.model.position.sub(s.multiplyScalar(a)),this.controls.maxDistance=o.length()*10,this.camera.position.set(0,2,6),this.camera.updateProjectionMatrix()}function Ac(t){var e;for(const o of t){if(!((e=o.map)!=null&&e.image))continue;const s=document.createElement("canvas");s.width=s.height=75,s.getContext("2d").drawImage(o.map.image,0,0);const a={url:s.toDataURL("image/png",.5)};return s.remove(),a}return{}}function Tc(t){const{color:e,wireframe:o,depthWrite:s,opacity:n}=JSON.parse(JSON.stringify(t)),a=Ue.selectMesh.uuid,i=this.scene.getObjectByProperty("uuid",a);if(i!=null&&i.material){const{name:l,map:c}=i.material;Object.assign(i.material,{map:c,name:l,transparent:!0,color:new re(e),wireframe:o,depthWrite:s,opacity:n});const h=this.modelMaterialList.find(g=>g.uuid===a);h&&Object.assign(h.material,{color:new re(e),wireframe:o,depthWrite:s,opacity:n})}}function Lc({uuid:t,visible:e}){const o=this.scene.getObjectByProperty("uuid",t);o&&(o.visible=e)}function Ec({mapId:t,meshName:e}){const o=Ue.selectMesh.uuid,s=this.scene.getObjectByProperty("uuid",o);if(!s)return;const n=this.originalMaterials.get(o);s.material=n.clone(),s.mapId=t,s.meshFrom=e}function Ic({id:t,url:e}){return new Promise(o=>{const s=Ue.selectMesh.uuid,n=this.scene.getObjectByProperty("uuid",s);if(!n){o();return}const a=new $e().load(e),i=n.material.clone();Object.assign(a,{wrapS:nt,wrapT:nt,flipY:!1,colorSpace:ot,minFilter:Ve,magFilter:Ve}),i.map=a,n.material=i,n.mapId=t,n.meshFrom=t,a.dispose(),o()})}function Pc(t,e){return new Promise(async o=>{const s=Ue.selectMesh.uuid,n=this.scene.getObjectByProperty("uuid",s);if(!n){o();return}const i=await(e==="hdr"?new vt:new $e).loadAsync(t),l=n.material.clone();Object.assign(i,{wrapS:nt,wrapT:nt,flipY:!1,colorSpace:ot,minFilter:Ve,magFilter:Ve}),l.map=i,n.material=l,i.dispose(),o()})}function kc(t){const e=this.model.getObjectByName(t);return e?(this.outlinePass.selectedObjects=[Ut(e)],Ue.selectMeshAction(e),e):null}function Rc(t){const{clientHeight:e,clientWidth:o,offsetLeft:s,offsetTop:n}=this.container;this.mouse.x=(t.clientX-s)/o*2-1,this.mouse.y=-((t.clientY-n)/e)*2+1,this.raycaster.setFromCamera(this.mouse,this.camera);let a=this.model;if(this.geometryGroup.children.length&&(a=this.geometryGroup),!a)return!1;const i=this.raycaster.intersectObjects(Ut(a.children),!0).filter(l=>l.object.isMesh&&l.object.material);if(i.length>0){const l=i[0].object;if(Object.assign(this.outlinePass,{visibleEdgeColor:new re("#FF8C00"),hiddenEdgeColor:new re("#8a90f3"),selectedObjects:[l]}),Ue.selectMeshAction(l),this.transformControls){const c=new _t().setFromObject(l),{dragPosition:h}=l.userData,g=h||c.getCenter(new q);h||(l.userData.dragPosition=g),xt(this.scene,{type:"TransformControlsPlane"}).position.copy(g),this.transformControls.attach(l)}}else this.transformControls||(this.outlinePass.selectedObjects=[],Ue.selectMeshAction({}))}function $c(){const t=[];return this.model.traverse(e=>{if(!e.isMesh||!e.material)return;const{color:o,opacity:s,depthWrite:n,wireframe:a,type:i}=e.material;t.push({meshName:e.name,meshFrom:e.meshFrom,color:o.getStyle(),opacity:s,depthWrite:n,wireframe:a,visible:e.visible,type:i})}),t}function Vc(t){this.model.traverse(e=>{if(!e.isMesh||!e.material)return;const{name:o,color:s,map:n,wireframe:a,depthWrite:i,opacity:l}=e.material;t.type?e.material=new zt[t.type]({map:n,transparent:!0,color:s,name:o}):e.material=this.originalMaterials.get(e.uuid),i&&(e.material.depthWrite=i),l&&(e.material.opacity=l),a&&(e.material.wireframe=a),e.material.side=je})}function Uc(){this.modelMaterialList=[],this.model.traverse(t=>{!t.isMesh||!t.material||(t.castShadow=!0,t.frustumCulled=!1,this.modelMaterialList.push(t),this.originalMaterials.set(t.uuid,t.material),t.mapId=t.name)})}function Dc(){this.model.traverse(t=>{if(!t.isMesh||!t.material)return;const e=this.originalMaterials.get(t.uuid);t.material=e.clone(),t.mapId=e.userData.mapId,t.visible=!0,t.meshFrom=null}),this.modelMaterialList.forEach(t=>{t.visible=!0;const e=this.originalMaterials.get(t.uuid);t.mapId=e.userData.mapId;const{color:o,wireframe:s,depthWrite:n,opacity:a}=e;Object.assign(t.material,{color:o,wireframe:s,depthWrite:n,opacity:a})}),Ue.selectMeshAction({})}const Oc={getModelMaterialList:bc,setModelPositionSize:Cc,getModelMaps:Ac,onSetModelMaterial:Tc,onSetModelMap:Ec,onSetSystemModelMap:Ic,onSetStorageModelMap:Pc,onChangeModelMaterial:kc,onMouseClickModel:Rc,onGetEditMeshList:$c,onChangeModelMeshType:Vc,onSetGeometryMeshList:Uc,onSetMeshVisible:Lc,initModelMaterial:Dc,setMaterialMeshParams:Sc},Fc=be();function zc(t){const e=this.scene.getObjectByProperty("uuid",t);this.modelMaterialList=this.modelMaterialList.filter(o=>o.uuid!==t),this.glowMaterialList=this.modelMaterialList.map(o=>o.name),e.clear(),this.geometryGroup.remove(e)}function Hc(t,e){const o=Fc.selectMesh.uuid,s=this.scene.getObjectByProperty("uuid",o),n=Object.keys(t).map(i=>t[i]),a=new zt[e](...n);s.geometry=a}const Nc={onDeleteGeometryMesh:zc,onSetGeometryMesh:Hc};function jc(t){const e=this.scene.getObjectByProperty("uuid",t);if(this.outlinePass.visibleEdgeColor=new re("#409eff"),this.outlinePass.hiddenEdgeColor=new re("#0099cc"),this.outlinePass.selectedObjects=[Ut(e)],e){const{position:o,rotation:s,userData:n,scale:a}=e.clone();return e.userData={...n,position:o,rotation:s,scale:a},{position:{...o},rotation:{...s},scale:a.x}}return{}}function Bc(t){const e=this.scene.getObjectByProperty("uuid",t);e&&(this.manyModelGroup.remove(e),this.outlinePass.selectedObjects=[])}function Gc(t,e,o){const s=this.scene.getObjectByProperty("uuid",o);if(!s)return;const n=Math.PI/2,{x:a,y:i,z:l}=s.rotation,c={x:a,y:i,z:l};c[t]+=e?n:-n,new Ie.Tween({x:a,y:i,z:l}).to(c,500).onUpdate(h=>{s.rotation[t]=h[t]}).start()}function Yc(t){const e=this.scene.getObjectByProperty("uuid",t);if(!e)return;const{rotation:o}=e.userData;e.rotation.set(o.x,o.y,o.z)}function Xc(t,e){const o=this.scene.getObjectByProperty("uuid",e);o&&new Ie.Tween(o.position).to({x:t.x,y:t.y,z:t.z},500).onUpdate(s=>{o.position.set(s.x||0,s.y||0,s.z||0)}).start()}function Wc(t){const e=this.scene.getObjectByProperty("uuid",t),{position:o}=e.userData;return e.position.set(o.x||0,o.y||0,o.z||0),{...o}}function Zc(t,e){const o=this.scene.getObjectByProperty("uuid",t);o&&new Ie.Tween(o.scale).to({x:e,y:e,z:e},500).onUpdate(s=>{o.scale.set(s.x||0,s.y||0,s.z||0)}).start()}const qc={chooseManyModel:jc,deleteManyModel:Bc,setManyModelRotation:Gc,initManyModelRotation:Yc,setManyModelPosition:Xc,initManyModelPosition:Wc,setManyModelScale:Zc},Oe=new Sn,pe=new q,ke=new q,le=new Ce,rn={X:new q(1,0,0),Y:new q(0,1,0),Z:new q(0,0,1)},Et={type:"change"},ln={type:"mouseDown",mode:null},dn={type:"mouseUp",mode:null},cn={type:"objectChange"};class Qc extends _o{constructor(e,o=null){super(void 0,o);const s=new ou(this);this._root=s;const n=new su;this._gizmo=n,s.add(n);const a=new iu;this._plane=a,s.add(a);const i=this;function l(P,m){let L=m;Object.defineProperty(i,P,{get:function(){return L!==void 0?L:m},set:function(_){L!==_&&(L=_,a[P]=_,n[P]=_,i.dispatchEvent({type:P+"-changed",value:_}),i.dispatchEvent(Et))}}),i[P]=m,a[P]=m,n[P]=m}l("camera",e),l("object",void 0),l("enabled",!0),l("axis",null),l("mode","translate"),l("translationSnap",null),l("rotationSnap",null),l("scaleSnap",null),l("space","world"),l("size",1),l("dragging",!1),l("showX",!0),l("showY",!0),l("showZ",!0),l("minX",-1/0),l("maxX",1/0),l("minY",-1/0),l("maxY",1/0),l("minZ",-1/0),l("maxZ",1/0);const c=new q,h=new q,g=new Ce,v=new Ce,y=new q,f=new Ce,p=new q,M=new q,S=new q,E=0,C=new q;l("worldPosition",c),l("worldPositionStart",h),l("worldQuaternion",g),l("worldQuaternionStart",v),l("cameraPosition",y),l("cameraQuaternion",f),l("pointStart",p),l("pointEnd",M),l("rotationAxis",S),l("rotationAngle",E),l("eye",C),this._offset=new q,this._startNorm=new q,this._endNorm=new q,this._cameraScale=new q,this._parentPosition=new q,this._parentQuaternion=new Ce,this._parentQuaternionInv=new Ce,this._parentScale=new q,this._worldScaleStart=new q,this._worldQuaternionInv=new Ce,this._worldScale=new q,this._positionStart=new q,this._quaternionStart=new Ce,this._scaleStart=new q,this._getPointer=Kc.bind(this),this._onPointerDown=eu.bind(this),this._onPointerHover=Jc.bind(this),this._onPointerMove=tu.bind(this),this._onPointerUp=nu.bind(this),o!==null&&this.connect(o)}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;e!==null&&Oe.setFromCamera(e,this.camera);const o=It(this._gizmo.picker[this.mode],Oe);o?this.axis=o.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e!=null&&e.button!==0)&&this.axis!==null){e!==null&&Oe.setFromCamera(e,this.camera);const o=It(this._plane,Oe,!0);o&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(o.point).sub(this.worldPositionStart)),this.dragging=!0,ln.mode=this.mode,this.dispatchEvent(ln)}}pointerMove(e){const o=this.axis,s=this.mode,n=this.object;let a=this.space;if(s==="scale"?a="local":(o==="E"||o==="XYZE"||o==="XYZ")&&(a="world"),n===void 0||o===null||this.dragging===!1||e!==null&&e.button!==-1)return;e!==null&&Oe.setFromCamera(e,this.camera);const i=It(this._plane,Oe,!0);if(i){if(this.pointEnd.copy(i.point).sub(this.worldPositionStart),s==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),a==="local"&&o!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),o.indexOf("X")===-1&&(this._offset.x=0),o.indexOf("Y")===-1&&(this._offset.y=0),o.indexOf("Z")===-1&&(this._offset.z=0),a==="local"&&o!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),n.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(a==="local"&&(n.position.applyQuaternion(le.copy(this._quaternionStart).invert()),o.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),o.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),o.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this._quaternionStart)),a==="world"&&(n.parent&&n.position.add(pe.setFromMatrixPosition(n.parent.matrixWorld)),o.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),o.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),o.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(pe.setFromMatrixPosition(n.parent.matrixWorld)))),n.position.x=Math.max(this.minX,Math.min(this.maxX,n.position.x)),n.position.y=Math.max(this.minY,Math.min(this.maxY,n.position.y)),n.position.z=Math.max(this.minZ,Math.min(this.maxZ,n.position.z));else if(s==="scale"){if(o.search("XYZ")!==-1){let l=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(l*=-1),ke.set(l,l,l)}else pe.copy(this.pointStart),ke.copy(this.pointEnd),pe.applyQuaternion(this._worldQuaternionInv),ke.applyQuaternion(this._worldQuaternionInv),ke.divide(pe),o.search("X")===-1&&(ke.x=1),o.search("Y")===-1&&(ke.y=1),o.search("Z")===-1&&(ke.z=1);n.scale.copy(this._scaleStart).multiply(ke),this.scaleSnap&&(o.search("X")!==-1&&(n.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),o.search("Y")!==-1&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),o.search("Z")!==-1&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(s==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const l=20/this.worldPosition.distanceTo(pe.setFromMatrixPosition(this.camera.matrixWorld));let c=!1;o==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(pe.copy(this.rotationAxis).cross(this.eye))*l):(o==="X"||o==="Y"||o==="Z")&&(this.rotationAxis.copy(rn[o]),pe.copy(rn[o]),a==="local"&&pe.applyQuaternion(this.worldQuaternion),pe.cross(this.eye),pe.length()===0?c=!0:this.rotationAngle=this._offset.dot(pe.normalize())*l),(o==="E"||c)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),a==="local"&&o!=="E"&&o!=="XYZE"?(n.quaternion.copy(this._quaternionStart),n.quaternion.multiply(le.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),n.quaternion.copy(le.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Et),this.dispatchEvent(cn)}}pointerUp(e){e!==null&&e.button!==0||(this.dragging&&this.axis!==null&&(dn.mode=this.mode,this.dispatchEvent(dn)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this._root.dispose()}attach(e){return this.object=e,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Et),this.dispatchEvent(cn),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Oe}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function Kc(t){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:t.button};{const e=this.domElement.getBoundingClientRect();return{x:(t.clientX-e.left)/e.width*2-1,y:-(t.clientY-e.top)/e.height*2+1,button:t.button}}}function Jc(t){if(this.enabled)switch(t.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(t));break}}function eu(t){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(t.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(t)),this.pointerDown(this._getPointer(t)))}function tu(t){this.enabled&&this.pointerMove(this._getPointer(t))}function nu(t){this.enabled&&(this.domElement.releasePointerCapture(t.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(t)))}function It(t,e,o){const s=e.intersectObject(t,!0);for(let n=0;n<s.length;n++)if(s[n].object.visible||o)return s[n];return!1}const dt=new wo,se=new q(0,1,0),un=new q(0,0,0),pn=new wt,ct=new Ce,ft=new Ce,Ae=new q,hn=new wt,Ke=new q(1,0,0),Fe=new q(0,1,0),Je=new q(0,0,1),ut=new q,We=new q,Ze=new q;class ou extends kt{constructor(e){super(),this.isTransformControlsRoot=!0,this.controls=e,this.visible=!1}updateMatrixWorld(e){const o=this.controls;o.object!==void 0&&(o.object.updateMatrixWorld(),o.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):o.object.parent.matrixWorld.decompose(o._parentPosition,o._parentQuaternion,o._parentScale),o.object.matrixWorld.decompose(o.worldPosition,o.worldQuaternion,o._worldScale),o._parentQuaternionInv.copy(o._parentQuaternion).invert(),o._worldQuaternionInv.copy(o.worldQuaternion).invert()),o.camera.updateMatrixWorld(),o.camera.matrixWorld.decompose(o.cameraPosition,o.cameraQuaternion,o._cameraScale),o.camera.isOrthographicCamera?o.camera.getWorldDirection(o.eye).negate():o.eye.copy(o.cameraPosition).sub(o.worldPosition).normalize(),super.updateMatrixWorld(e)}dispose(){this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}}class su extends kt{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new Cn({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),o=new yo({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=e.clone();s.opacity=.15;const n=o.clone();n.opacity=.5;const a=e.clone();a.color.setHex(16711680);const i=e.clone();i.color.setHex(65280);const l=e.clone();l.color.setHex(255);const c=e.clone();c.color.setHex(16711680),c.opacity=.5;const h=e.clone();h.color.setHex(65280),h.opacity=.5;const g=e.clone();g.color.setHex(255),g.opacity=.5;const v=e.clone();v.opacity=.25;const y=e.clone();y.color.setHex(16776960),y.opacity=.25,e.clone().color.setHex(16776960);const p=e.clone();p.color.setHex(7895160);const M=new ye(0,.04,.1,12);M.translate(0,.05,0);const S=new ge(.08,.08,.08);S.translate(0,.04,0);const E=new Xt;E.setAttribute("position",new Wt([0,0,0,1,0,0],3));const C=new ye(.0075,.0075,.5,3);C.translate(0,.25,0);function P(H,D){const N=new Ye(H,.0075,3,64,D*Math.PI*2);return N.rotateY(Math.PI/2),N.rotateX(Math.PI/2),N}function m(){const H=new Xt;return H.setAttribute("position",new Wt([0,0,0,1,1,1],3)),H}const L={X:[[new F(M,a),[.5,0,0],[0,0,-Math.PI/2]],[new F(M,a),[-.5,0,0],[0,0,Math.PI/2]],[new F(C,a),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new F(M,i),[0,.5,0]],[new F(M,i),[0,-.5,0],[Math.PI,0,0]],[new F(C,i)]],Z:[[new F(M,l),[0,0,.5],[Math.PI/2,0,0]],[new F(M,l),[0,0,-.5],[-Math.PI/2,0,0]],[new F(C,l),null,[Math.PI/2,0,0]]],XYZ:[[new F(new at(.1,0),v.clone()),[0,0,0]]],XY:[[new F(new ge(.15,.15,.01),g.clone()),[.15,.15,0]]],YZ:[[new F(new ge(.15,.15,.01),c.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new F(new ge(.15,.15,.01),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},_={X:[[new F(new ye(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new F(new ye(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new F(new ye(.2,0,.6,4),s),[0,.3,0]],[new F(new ye(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new F(new ye(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new F(new ye(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new F(new at(.2,0),s)]],XY:[[new F(new ge(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new F(new ge(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new F(new ge(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},T={START:[[new F(new at(.01,2),n),null,null,null,"helper"]],END:[[new F(new at(.01,2),n),null,null,null,"helper"]],DELTA:[[new Pe(m(),n),null,null,null,"helper"]],X:[[new Pe(E,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Pe(E,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Pe(E,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},w={XYZE:[[new F(P(.5,1),p),null,[0,Math.PI/2,0]]],X:[[new F(P(.5,.5),a)]],Y:[[new F(P(.5,.5),i),null,[0,0,-Math.PI/2]]],Z:[[new F(P(.5,.5),l),null,[0,Math.PI/2,0]]],E:[[new F(P(.75,1),y),null,[0,Math.PI/2,0]]]},I={AXIS:[[new Pe(E,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},Y={XYZE:[[new F(new vo(.25,10,8),s)]],X:[[new F(new Ye(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new F(new Ye(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new F(new Ye(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new F(new Ye(.75,.1,2,24),s)]]},R={X:[[new F(S,a),[.5,0,0],[0,0,-Math.PI/2]],[new F(C,a),[0,0,0],[0,0,-Math.PI/2]],[new F(S,a),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new F(S,i),[0,.5,0]],[new F(C,i)],[new F(S,i),[0,-.5,0],[0,0,Math.PI]]],Z:[[new F(S,l),[0,0,.5],[Math.PI/2,0,0]],[new F(C,l),[0,0,0],[Math.PI/2,0,0]],[new F(S,l),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new F(new ge(.15,.15,.01),g),[.15,.15,0]]],YZ:[[new F(new ge(.15,.15,.01),c),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new F(new ge(.15,.15,.01),h),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new F(new ge(.1,.1,.1),v.clone())]]},b={X:[[new F(new ye(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new F(new ye(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new F(new ye(.2,0,.6,4),s),[0,.3,0]],[new F(new ye(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new F(new ye(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new F(new ye(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new F(new ge(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new F(new ge(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new F(new ge(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new F(new ge(.2,.2,.2),s),[0,0,0]]]},A={X:[[new Pe(E,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Pe(E,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Pe(E,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function V(H){const D=new kt;for(const N in H)for(let $=H[N].length;$--;){const B=H[N][$][0].clone(),ie=H[N][$][1],we=H[N][$][2],G=H[N][$][3],z=H[N][$][4];B.name=N,B.tag=z,ie&&B.position.set(ie[0],ie[1],ie[2]),we&&B.rotation.set(we[0],we[1],we[2]),G&&B.scale.set(G[0],G[1],G[2]),B.updateMatrix();const O=B.geometry.clone();O.applyMatrix4(B.matrix),B.geometry=O,B.renderOrder=1/0,B.position.set(0,0,0),B.rotation.set(0,0,0),B.scale.set(1,1,1),D.add(B)}return D}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=V(L)),this.add(this.gizmo.rotate=V(w)),this.add(this.gizmo.scale=V(R)),this.add(this.picker.translate=V(_)),this.add(this.picker.rotate=V(Y)),this.add(this.picker.scale=V(b)),this.add(this.helper.translate=V(T)),this.add(this.helper.rotate=V(I)),this.add(this.helper.scale=V(A)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const s=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:ft;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let a=0;a<n.length;a++){const i=n[a];i.visible=!0,i.rotation.set(0,0,0),i.position.copy(this.worldPosition);let l;if(this.camera.isOrthographicCamera?l=(this.camera.top-this.camera.bottom)/this.camera.zoom:l=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),i.scale.set(1,1,1).multiplyScalar(l*this.size/4),i.tag==="helper"){i.visible=!1,i.name==="AXIS"?(i.visible=!!this.axis,this.axis==="X"&&(le.setFromEuler(dt.set(0,0,0)),i.quaternion.copy(s).multiply(le),Math.abs(se.copy(Ke).applyQuaternion(s).dot(this.eye))>.9&&(i.visible=!1)),this.axis==="Y"&&(le.setFromEuler(dt.set(0,0,Math.PI/2)),i.quaternion.copy(s).multiply(le),Math.abs(se.copy(Fe).applyQuaternion(s).dot(this.eye))>.9&&(i.visible=!1)),this.axis==="Z"&&(le.setFromEuler(dt.set(0,Math.PI/2,0)),i.quaternion.copy(s).multiply(le),Math.abs(se.copy(Je).applyQuaternion(s).dot(this.eye))>.9&&(i.visible=!1)),this.axis==="XYZE"&&(le.setFromEuler(dt.set(0,Math.PI/2,0)),se.copy(this.rotationAxis),i.quaternion.setFromRotationMatrix(pn.lookAt(un,se,Fe)),i.quaternion.multiply(le),i.visible=this.dragging),this.axis==="E"&&(i.visible=!1)):i.name==="START"?(i.position.copy(this.worldPositionStart),i.visible=this.dragging):i.name==="END"?(i.position.copy(this.worldPosition),i.visible=this.dragging):i.name==="DELTA"?(i.position.copy(this.worldPositionStart),i.quaternion.copy(this.worldQuaternionStart),pe.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),pe.applyQuaternion(this.worldQuaternionStart.clone().invert()),i.scale.copy(pe),i.visible=this.dragging):(i.quaternion.copy(s),this.dragging?i.position.copy(this.worldPositionStart):i.position.copy(this.worldPosition),this.axis&&(i.visible=this.axis.search(i.name)!==-1));continue}i.quaternion.copy(s),this.mode==="translate"||this.mode==="scale"?(i.name==="X"&&Math.abs(se.copy(Ke).applyQuaternion(s).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),i.name==="Y"&&Math.abs(se.copy(Fe).applyQuaternion(s).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),i.name==="Z"&&Math.abs(se.copy(Je).applyQuaternion(s).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),i.name==="XY"&&Math.abs(se.copy(Je).applyQuaternion(s).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),i.name==="YZ"&&Math.abs(se.copy(Ke).applyQuaternion(s).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),i.name==="XZ"&&Math.abs(se.copy(Fe).applyQuaternion(s).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1)):this.mode==="rotate"&&(ct.copy(s),se.copy(this.eye).applyQuaternion(le.copy(s).invert()),i.name.search("E")!==-1&&i.quaternion.setFromRotationMatrix(pn.lookAt(this.eye,un,Fe)),i.name==="X"&&(le.setFromAxisAngle(Ke,Math.atan2(-se.y,se.z)),le.multiplyQuaternions(ct,le),i.quaternion.copy(le)),i.name==="Y"&&(le.setFromAxisAngle(Fe,Math.atan2(se.x,se.z)),le.multiplyQuaternions(ct,le),i.quaternion.copy(le)),i.name==="Z"&&(le.setFromAxisAngle(Je,Math.atan2(se.y,se.x)),le.multiplyQuaternions(ct,le),i.quaternion.copy(le))),i.visible=i.visible&&(i.name.indexOf("X")===-1||this.showX),i.visible=i.visible&&(i.name.indexOf("Y")===-1||this.showY),i.visible=i.visible&&(i.name.indexOf("Z")===-1||this.showZ),i.visible=i.visible&&(i.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),i.material._color=i.material._color||i.material.color.clone(),i.material._opacity=i.material._opacity||i.material.opacity,i.material.color.copy(i.material._color),i.material.opacity=i.material._opacity,this.enabled&&this.axis&&(i.name===this.axis||this.axis.split("").some(function(c){return i.name===c}))&&(i.material.color.setHex(16776960),i.material.opacity=1)}super.updateMatrixWorld(e)}}class iu extends F{constructor(){super(new An(1e5,1e5,2,2),new Cn({visible:!1,wireframe:!0,side:je,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let o=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(o="local"),ut.copy(Ke).applyQuaternion(o==="local"?this.worldQuaternion:ft),We.copy(Fe).applyQuaternion(o==="local"?this.worldQuaternion:ft),Ze.copy(Je).applyQuaternion(o==="local"?this.worldQuaternion:ft),se.copy(We),this.mode){case"translate":case"scale":switch(this.axis){case"X":se.copy(this.eye).cross(ut),Ae.copy(ut).cross(se);break;case"Y":se.copy(this.eye).cross(We),Ae.copy(We).cross(se);break;case"Z":se.copy(this.eye).cross(Ze),Ae.copy(Ze).cross(se);break;case"XY":Ae.copy(Ze);break;case"YZ":Ae.copy(ut);break;case"XZ":se.copy(Ze),Ae.copy(We);break;case"XYZ":case"E":Ae.set(0,0,0);break}break;case"rotate":default:Ae.set(0,0,0)}Ae.length()===0?this.quaternion.copy(this.cameraQuaternion):(hn.lookAt(pe.set(0,0,0),Ae,se),this.quaternion.setFromRotationMatrix(hn)),super.updateMatrixWorld(e)}}function au(t){const{glow:e,threshold:o,strength:s,radius:n,toneMappingExposure:a,color:i}=t;this.glowUnrealBloomPass=e,e?(this.unrealBloomPass.threshold=o,this.unrealBloomPass.strength=s,this.unrealBloomPass.radius=n,this.renderer.toneMappingExposure=a,this.shaderPass.material.uniforms.glowColor.value=new re(i),(this.effectComposer.passes||[]).find(h=>h.name==="ShaderColor")||this.effectComposer.addPass(this.shaderPass)):(this.unrealBloomPass.threshold=0,this.unrealBloomPass.strength=0,this.unrealBloomPass.radius=0,this.renderer.toneMappingExposure=a,this.shaderPass.material.uniforms.glowColor.value=new re,this.effectComposer.removePass(this.shaderPass))}function ru({decompose:t}){if(this.glowMaterialList.length<=1)return!1;const e=(n,a)=>{new Ie.Tween(n.position).to(a,500).onUpdate(i=>n.position.set(i.x||0,i.y||0,i.z||0)).start()},o=this.glowMaterialList.length,s=2*Math.PI/o;this.glowMaterialList.forEach((n,a)=>{var c;const i=this.model.getObjectByName(n),{decomposeName:l}=this.model;if(i.type==="Mesh")if((c=jt[l])!=null&&c[n]){const h={x:0,y:0,z:0},{x:g,y:v,z:y}=jt[l][n];["x","y","z"].forEach(f=>{const p={modelX:g,modelY:v,modelZ:y}[`model${f.toUpperCase()}`];p==="straight"?h[f]+=t:p==="burden"&&(h[f]-=t)}),e(i,h)}else{const h=a*s;e(i,{x:t*Math.cos(h),y:t*Math.sin(h),z:0})}})}function lu({manageFlag:t}){var e;if(t&&!this.transformControls){this.transformControls=new Qc(this.camera,this.renderer.domElement),this.transformControls.setMode("translate"),this.transformControls.addEventListener("dragging-changed",s=>{this.controls.enabled=!s.value}),this.transformControls.size=1,this.transformControls.attach();const o=this.transformControls.getHelper();this.scene.add(o)}else{(e=this.transformControls)==null||e.detach();const o=xt(this.scene,{type:"TransformControlsPlane"});o&&this.scene.remove(o)}}function du(t){this.transformControls.setMode(t)}function cu(){return this.modelMaterialList.map(t=>{const e=this.model.getObjectByProperty("name",t.name),{rotation:o,scale:s,position:n}=e;return{name:t.name,rotation:{x:o.x,y:o.y,z:o.z},scale:{x:s.x,y:s.y,z:s.z},position:{x:n.x,y:n.y,z:n.z}}})}function uu(t){this.shaderPass.material.uniforms.glowColor.value=new re(t)}function pu(){if(this.renderer.toneMappingExposure=1,Object.assign(this.unrealBloomPass,{threshold:0,strength:0,radius:0}),this.glowComposer.renderer.clear(),this.shaderPass.material.uniforms.glowColor.value=new re,this.glowUnrealBloomPass=!1,this.transformControls){this.transformControls.detach();const t=xt(this.scene,{type:"TransformControlsPlane"});t&&this.scene.remove(t),this.scene.remove(this.transformControls),this.transformControls=null}this.effectComposer.removePass(this.shaderPass),this.model.traverse(t=>{if(t.isMesh&&t.material){const{rotation:e,scale:o,position:s}=t.userData;t.rotation.set(e.x,e.y,e.z),t.scale.set(o.x,o.y,o.z),t.position.set(s.x,s.y,s.z)}})}const hu={onSetUnrealBloomPass:au,setModelMeshDecompose:ru,setModelMeshDrag:lu,getMeshDragPosition:cu,onSetFlowColor:uu,initStageFlow:pu,setTransformControlsType:du};function fu(t){this.onSetModelAnimation(t),cancelAnimationFrame(this.animationFrame),this.animationFrameFun()}function mu({animationName:t,loop:e,timeScale:o,weight:s}){this.animationMixer=new xo(this.model);const n=Mo.findByName(this.modelAnimation,t);n&&(this.animateClipAction=this.animationMixer.clipAction(n),this.animateClipAction.setEffectiveTimeScale(o),this.animateClipAction.setEffectiveWeight(s),this.animateClipAction.setLoop(this.loopMap[e]),this.animateClipAction.play())}function gu(){this.animationFrame=requestAnimationFrame(()=>this.animationFrameFun()),this.animationMixer&&this.animationMixer.update(this.animationClock.getDelta())}function _u(){this.animateClipAction&&(this.animationMixer.stopAllAction(),this.animationMixer.update(0),cancelAnimationFrame(this.animationFrame))}function yu(t){const{rotationVisible:e,rotationType:o,rotationSpeed:s}=t;e?(cancelAnimationFrame(this.rotationAnimationFrame),this.rotationAnimationFun(o,s)):(cancelAnimationFrame(this.rotationAnimationFrame),this.model.rotation.set(0,0,0))}function vu(t){const{rotationType:e,rotationSpeed:o}=t;this.model.rotation.set(0,0,0),cancelAnimationFrame(this.rotationAnimationFrame),this.rotationAnimationFun(e,o)}function wu(t,e){this.rotationAnimationFrame=requestAnimationFrame(()=>this.rotationAnimationFun(t,e)),this.model.rotation[t]+=e/50}function xu(t){this.modelAnimation=t.animations||[]}function Mu(t){Array.isArray(t)&&(this.modelAnimation=this.modelAnimation.concat(t))}const bu={onStartModelAnimation:fu,onSetModelAnimation:mu,animationFrameFun:gu,onClearAnimation:_u,onSetRotation:yu,onSetRotationType:vu,rotationAnimationFun:wu,getModelAnimationList:xu,getManyModelAnimationList:Mu};function Su(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!Nn(t)}function Cu(t){this.dragTag=t,this.dragTag.id=Tn(4,7)}function Au(){const{clientHeight:t,clientWidth:e,offsetLeft:o,offsetTop:s}=this.container,{clientX:n,clientY:a,name:i}=this.dragTag;this.mouse.x=(n-o)/e*2-1,this.mouse.y=-((a-s)/t)*2+1,this.raycaster.setFromCamera(this.mouse,this.camera);const l=this.raycaster.intersectObjects(this.scene.children,!0);if(l.length>0){const c=document.createElement("div"),h=`rgba(0,127,127,${Math.random()*.5+.25})`,g=this.dragTagList.length+1,y=Fn({render(){let L;return r("div",null,[r("div",{className:"element-tag",style:{width:"60px",height:"40px",fontSize:"6px",color:"#ffffffbf",backgroundColor:h}},[r("span",{className:"tag-txt"},[`标签-${g}`])]),r("div",{className:"tag-icon"},[r(zn,null,Su(L=Hn(gn[i]))?L:{default:()=>[L]})])])}}).mount(document.createElement("div"));c.appendChild(y.$el);const f=new Xn(c),{x:p,y:M,z:S}=l[0].point;f.position.set(p,M,S),f.scale.set(.01,.01,.01);const{uuid:E,position:C,element:{innerText:P}}=f,m={uuid:E,positionX:C.x,positionY:C.y,positionZ:C.z,innerText:P,width:60,height:40,fontSize:6,backgroundColor:h,color:"#ffffffbf",iconColor:"#fff",iconSize:12,iconName:i,hover:!1};this.dragTagList.length===0&&this.container.appendChild(this.css3DRenderer.domElement),this.dragTagList.push(m),this.scene.add(f)}else ce.warning("当前视角无法获取标注位置,请调整相机角度后重试")}function Tu(){if(this.dragTagList.length===0)return!1;this.dragTagList.forEach(t=>{var o;const e=this.scene.getObjectByProperty("uuid",t.uuid);this.scene.remove(e),(o=e.element)!=null&&o.parentNode&&e.element.parentNode.removeChild(e.element)}),this.dragTagList=[],this.container.removeChild(this.css3DRenderer.domElement)}function Lu(t){var o;const e=this.scene.getObjectByProperty("uuid",t);if(this.scene.remove(e),(o=e.element)!=null&&o.parentNode&&e.element.parentNode.removeChild(e.element),this.dragTagList=this.dragTagList.filter(s=>s.uuid!==t),this.dragTagList.length===0)return this.container.removeChild(this.css3DRenderer.domElement),!1}function Eu(t){const e=this.scene.getObjectByProperty("uuid",t.uuid);if(!e)return;const o=e.element.querySelector(".element-tag"),s=e.element.querySelector(".tag-icon"),n=e.element.querySelector(".tag-txt"),{height:a,backgroundColor:i,width:l,fontSize:c,color:h,innerText:g,iconColor:v,iconSize:y,positionX:f,positionY:p,positionZ:M}=t;Object.assign(o.style,{height:`${a}px`,backgroundColor:i,boxShadow:`0px 0px 4px ${i}`,width:`${l}px`,fontSize:`${c}px`,color:h}),n.innerText=g,Object.assign(s.style,{fontSize:`${y}px`,color:v}),new Ie.Tween(e.position).to({x:f,y:p,z:M},500).onUpdate(E=>{e.position.set(E.x||0,E.y||0,E.z||0)}).start();const S=this.dragTagList.find(E=>E.uuid===t.uuid);Object.assign(S,t)}const Iu={create3dTags:Au,setDragTag:Cu,clearSceneTags:Tu,deleteTag:Lu,updateTagElement:Eu},Pu={...Kd,...sc,...Mc,...Oc,...Nc,...qc,...hu,...bu,...Iu},ku=["#FF4500","#90EE90","#00CED1","#1E90FF","#C71585","#FF4500","#FAD400","#1F93FF","#90F090","#C71585"];class $n{constructor(e){this.container=document.querySelector(e),this.camera,this.scene=null,this.renderer,this.controls,this.model,this.geometryGroup=new Zt,this.manyModelGroup=new Zt,this.loadingManager=new bo,this.fileLoaderMap={glb:new rt,fbx:new Ao(this.loadingManager),gltf:new rt,obj:new Co(this.loadingManager),stl:new So},this.modelAnimation,this.animationMixer,this.animationClock=new To,this.animationFrame=null,this.rotationAnimationFrame=null,this.animateClipAction=null,this.loopMap={LoopOnce:Io,LoopRepeat:Eo,LoopPingPong:Lo},this.gridHelper,this.axesHelper,this.ambientLight,this.directionalLight,this.directionalLightHelper,this.pointLight,this.pointLightHelper,this.spotLight,this.spotLightHelper,this.planeGeometry,this.modelMaterialList=[],this.originalMaterials=new Map,this.effectComposer,this.outlinePass,this.renderAnimation=null,this.raycaster=new Sn,this.mouse=new At,this.glowComposer,this.glowRenderPass,this.unrealBloomPass,this.shaderPass,this.glowMaterialList,this.materials={},this.transformControls,this.glowUnrealBloomPass=!1,this.onWindowResizesListener,this.onMouseClickListener,this.modelProgressCallback=o=>o,this.dragGeometryModel={},this.loadingStatus=!0,this.css3DRenderer=null,this.css3dControls=null,this.dragTag={},this.dragTagList=[],this.activeDragManyModel={}}init(){return new Promise(async(e,o)=>{this.initRender(),this.initCamera(),this.initScene(),this.initControls(),this.createHelper(),this.createLight(),this.addEvenListMouseListener();const s=await this.loadModel({filePath:pt[0].filePath,fileType:pt[0].fileType,scale:pt[0].scale});this.createEffectComposer(),this.sceneAnimation(),e(s)})}async initScene(){this.scene=new et;let e;St[0].url.endsWith(".hdr")?e=await new vt().loadAsync(St[0].url):e=await new $e().loadAsync(St[0].url),e.mapping=Ot,this.scene.background=e,this.scene.environment=e,this.scene.backgroundIntensity=1,this.scene.backgroundBlurriness=0,e.dispose()}initCamera(){const{clientHeight:e,clientWidth:o}=this.container;this.camera=new Po(50,o/e,.05,1e4)}initRender(){this.renderer=new ko({antialias:!0,alpha:!0,preserveDrawingBuffer:!0,logarithmicDepthBuffer:!0}),this.renderer.setPixelRatio(window.devicePixelRatio);const{clientHeight:e,clientWidth:o}=this.container;this.renderer.setSize(o,e),this.renderer.outputEncoding=void 0,this.renderer.toneMapping=Ro,this.renderer.autoClear=!0,this.renderer.outputColorSpace=ot,this.renderer.toneMappingExposure=1,this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=$o,this.container.appendChild(this.renderer.domElement),this.css3DRenderer=new Wn,this.css3DRenderer.setSize(o,e),this.css3DRenderer.domElement.style.position="absolute",this.css3DRenderer.domElement.style.pointerEvents="none",this.css3DRenderer.domElement.style.top=0}sceneAnimation(){this.renderAnimation=requestAnimationFrame(()=>this.sceneAnimation()),this.loadingStatus&&(this.glowUnrealBloomPass?this.setMeshFlow():(this.effectComposer.render(),this.controls.update()),Ie.update(),this.dragTagList.length&&(this.css3DRenderer.render(this.scene,this.camera),this.css3dControls.update()))}addEvenListMouseListener(){this.onWindowResizesListener=this.onWindowResizes.bind(this),window.addEventListener("resize",this.onWindowResizesListener),this.onMouseClickListener=this.onMouseClickModel.bind(this),this.container.addEventListener("click",this.onMouseClickListener)}initControls(){this.controls=new qt(this.camera,this.renderer.domElement),this.controls.enablePan=!1,this.controls.enableDamping=!0,this.controls.target.set(0,0,0),this.controls.update(),this.css3dControls=new qt(this.camera,this.css3DRenderer.domElement),this.css3dControls.enablePan=!1,this.css3dControls.enableDamping=!0,this.css3dControls.target.set(0,0,0),this.css3dControls.update()}loadModel({filePath:e,fileType:o,scale:s,decomposeName:n}){return new Promise(a=>{this.loadingStatus=!1;let i;if(["glb","gltf"].includes(o)){const l=new Qt;l.setDecoderPath("draco/"),l.setDecoderConfig({type:"js"}),l.preload(),i=new rt().setDRACOLoader(l)}else i=this.fileLoaderMap[o];i.load(e,l=>{switch(o){case"glb":this.model=l.scene;break;case"fbx":this.model=l;break;case"gltf":this.model=l.scene;break;case"obj":this.model=l;break;case"stl":const c=new Xe,h=new F(l,c);this.model=h;break}this.model.decomposeName=n,this.getModelMaterialList(),this.setModelPositionSize(s),this.glowMaterialList=this.modelMaterialList.map(c=>c.name),this.scene.add(this.model),this.loadingStatus=!0,a(!0),this.getModelAnimationList(l)},l=>{this.modelProgressCallback(l.loaded,l.total)},l=>{ce.error("文件错误"),console.log(l),a(!0)})})}setMeshFlow(){this.scene.traverse(e=>{e instanceof ht&&(this.materials.gridHelper=e.material,e.material=new Xe({color:"#000"})),e instanceof et&&(this.materials.scene=e.background,this.materials.environment=e.environment,e.background=null,e.environment=null),!this.glowMaterialList.includes(e.name)&&e.isMesh&&(this.materials[e.uuid]=e.material,e.material=new Xe({color:"#000"}))}),this.glowComposer.render(),this.scene.traverse(e=>{this.materials[e.uuid]&&(e.material=this.materials[e.uuid],delete this.materials[e.uuid]),e instanceof ht&&(e.material=this.materials.gridHelper,delete this.materials.gridHelper),e instanceof et&&(e.background=this.materials.scene,e.environment=this.materials.environment,delete this.materials.scene,delete this.materials.environment)}),this.effectComposer.render(),this.controls.update()}setGeometryModel(e){return new Promise((o,s)=>{const{clientHeight:n,clientWidth:a,offsetLeft:i,offsetTop:l}=this.container;this.mouse.x=(e.clientX-i)/a*2-1,this.mouse.y=-((e.clientY-l)/n)*2+1,this.raycaster.setFromCamera(this.mouse,this.camera);const c=this.raycaster.intersectObjects(this.scene.children,!0);if(c.length>0){const{type:h}=e,g=["id","name","modelType","type"],v=Object.keys(e).filter(_=>!g.includes(_)).map(_=>e[_]),y=new zt[h](...v),f=ku[Math.ceil(Math.random()*10)],p=new Xe({color:new re(f),side:je}),M=new F(y,p),{x:S,y:E,z:C}=c[0].point;M.position.set(S,E,C);const P=M.clone();Object.assign(M.userData,{rotation:P.rotation,scale:P.scale,position:P.position}),M.name=h+"_"+Tn(4,5),M.userData.geometry=!0,this.geometryGroup.add(M),this.model=this.geometryGroup,this.onSetGeometryMeshList(M),this.glowMaterialList=this.modelMaterialList.map(_=>_.name),this.setModelMeshDrag({transformType:!0}),this.scene.add(this.model);const L=new _t().setFromObject(this.model).getSize(new q);this.controls.maxDistance=L.length()*10,this.loadingStatus=!0,o(!0)}else ce.warning("当前角度无法获取鼠标位置请调整“相机角度”在添加")})}onProgress(e){typeof e=="function"&&(this.modelProgressCallback=e)}createHelper(){this.gridHelper=new ht(6,18,"#fff","rgb(193,193,193)"),this.gridHelper.position.set(0,-.59,-.1),this.gridHelper.visible=!1,this.scene.add(this.gridHelper),this.axesHelper=new bn(2),this.axesHelper.visible=!1,this.scene.add(this.axesHelper),this.renderer.shadowMap.enabled=!0}createLight(){this.ambientLight=new Vo(16777215,1),this.ambientLight.visible=!0,this.scene.add(this.ambientLight),this.directionalLight=new Uo(16777215,1.5),this.directionalLight.position.set(-1.44,2.2,1),this.directionalLight.castShadow=!0,this.directionalLight.visible=!1,this.scene.add(this.directionalLight),this.directionalLightHelper=new Do(this.directionalLight,.3),this.directionalLightHelper.visible=!1,this.scene.add(this.directionalLightHelper),this.pointLight=new Oo(16711680,5,100),this.pointLight.visible=!1,this.scene.add(this.pointLight),this.pointLightHelper=new Fo(this.pointLight,.5),this.pointLightHelper.visible=!1,this.scene.add(this.pointLightHelper),this.spotLight=new zo("#00BABD",900),this.spotLight.visible=!1,this.spotLight.map=new $e().load("model-bg/model-bg-1.jpg"),this.spotLight.map=new $e().load("model-bg/model-bg-1.jpg"),this.spotLight.decay=2,this.spotLight.shadow.mapSize.width=1920,this.spotLight.shadow.mapSize.height=1080,this.spotLight.shadow.camera.near=1,this.spotLight.shadow.camera.far=10,this.scene.add(this.spotLight),this.spotLightHelper=new Ho(this.spotLight),this.spotLightHelper.visible=!1,this.scene.add(this.spotLightHelper);const e=new An(2e3,2e3),o=new No({color:0,opacity:.5});this.planeGeometry=new F(e,o),this.planeGeometry.rotation.x=-Math.PI/2,this.planeGeometry.position.set(0,-1.2,0),this.planeGeometry.receiveShadow=!0,this.planeGeometry.material.side=je,this.planeGeometry.material.color.set("#23191F"),this.planeGeometry.geometry.verticesNeedUpdate=!0,this.scene.add(this.planeGeometry)}createEffectComposer(){if(!this.container)return!1;const{clientHeight:e,clientWidth:o}=this.container;this.effectComposer=new Bt(this.renderer,new Kt(o,e,{samples:4}));const s=new Gt(this.scene,this.camera);this.effectComposer.addPass(s),this.outlinePass=new Zn(new At(o,e),this.model,this.camera),this.outlinePass.visibleEdgeColor=new re("#FF8C00"),this.outlinePass.hiddenEdgeColor=new re("#8a90f3"),this.outlinePass.edgeGlow=2,this.outlinePass.usePatternTexture=!1,this.outlinePass.edgeThickness=2,this.outlinePass.edgeStrength=4,this.outlinePass.pulsePeriod=200,this.effectComposer.addPass(this.outlinePass);let n=new qn;this.effectComposer.addPass(n);let a=new Yt(Qn);const i=this.renderer.getPixelRatio();a.uniforms.resolution.value.set(1/(o*i),1/(e*i)),a.renderToScreen=!0,a.needsSwap=!0,a.material.uniforms.tDiffuse.value=1,a.enabled=!0,this.effectComposer.addPass(a),this.unrealBloomPass=new Kn(new At(o,e),1.5,.4,.85);const l={minFilter:Ve,format:xn,stencilBuffer:!1,samples:4},c=new Kt(o*2,e*2,l);this.glowComposer=new Bt(this.renderer,c),this.glowComposer.renderToScreen=!1,this.glowRenderPass=new Gt(this.scene,this.camera),this.glowComposer.addPass(this.glowRenderPass),this.glowComposer.addPass(this.unrealBloomPass),this.shaderPass=new Yt(new jo({uniforms:{baseTexture:{value:null},bloomTexture:{value:this.glowComposer.renderTarget2.texture},tDiffuse:{value:null},glowColor:{value:null}},vertexShader:eo,fragmentShader:Jn,defines:{}}),"baseTexture"),this.shaderPass.material.uniforms.glowColor.value=new re,this.shaderPass.renderToScreen=!0,this.shaderPass.needsSwap=!0,this.shaderPass.name="ShaderColor"}onSwitchModel(e){return new Promise(async(o,s)=>{try{if(e.modelType&&e.modelType=="geometry")this.modelAnimation=[],this.camera.fov=80,this.camera.updateProjectionMatrix(),await this.setGeometryModel(e),this.outlinePass.renderScene=this.geometryGroup,o();else{this.clearSceneModel();const n=await this.loadModel(e);this.outlinePass.renderScene=this.model,o({load:n,filePath:e.filePath})}}catch(n){console.log(n,"=================="),s()}})}onWindowResizes(){if(!this.container)return!1;const{clientHeight:e,clientWidth:o}=this.container;if(this.camera.aspect=o/e,this.camera.updateProjectionMatrix(),this.renderer.setSize(o,e),this.css3DRenderer.setSize(o,e),this.effectComposer){let s=this.effectComposer.passes[3];const n=this.renderer.getPixelRatio();s.uniforms.resolution.value.set(1/(o*n),1/(e*n)),this.effectComposer.setSize(o,e)}this.glowComposer&&this.glowComposer.setSize(o,e)}onDownloadSceneCover(){let e=document.createElement("a"),o=this.renderer.domElement;e.href=o.toDataURL("image/png"),e.download=`${new Date().toLocaleString()}.png`,e.click(),ce.success("下载成功")}onExporterModel(e){if(e=="usdz")new Id().parse(this.scene,s=>{const n=new Blob([s],{type:"model/vnd.usdz+zip"}),a=URL.createObjectURL(n),i=document.createElement("a");i.href=a,i.download=`${new Date().toLocaleString()}.usdz`,i.click(),URL.revokeObjectURL(a),ce.success("导出成功")});else{const o=new yt,s={trs:!0,animations:this.modelAnimation,binary:e=="glb",embedImages:!0,onlyVisible:!0,includeCustomExtensions:!0};o.parse(this.model,n=>{n instanceof ArrayBuffer?a(n,`${new Date().toLocaleString()}.glb`):i(JSON.stringify(n),`${new Date().toLocaleString()}.gltf`);function a(l,c){const h=new Blob([l],{type:"application/octet-stream"}),g=URL.createObjectURL(h),v=document.createElement("a");v.href=g,v.download=c,v.click(),URL.revokeObjectURL(g),ce.success("导出成功")}function i(l,c){const h=new Blob([l],{type:"application/json"}),g=URL.createObjectURL(h),v=document.createElement("a");v.href=g,v.download=c,v.click(),URL.revokeObjectURL(g),ce.success("导出成功")}},n=>{ce.error(n)},s)}}onClearModelData(){cancelAnimationFrame(this.rotationAnimationFrame),cancelAnimationFrame(this.renderAnimation),cancelAnimationFrame(this.animationFrame),this.container.removeEventListener("click",this.onMouseClickListener),window.removeEventListener("resize",this.onWindowResizesListener),this.scene.traverse(e=>{e.type==="Mesh"&&(e.geometry.dispose(),e.material.dispose()),e.isMesh&&(e.geometry.dispose(),e.material.dispose())}),this.scene.clear(),this.renderer.dispose(),this.renderer.clear(),this.container=null,this.camera=null,this.scene=null,this.renderer=null,this.controls=null,this.model=null,this.fileLoaderMap=null,this.modelAnimation=null,this.animationMixer=null,this.animationClock=null,this.animationFrame=null,this.rotationAnimationFrame=null,this.animateClipAction=null,this.loopMap=null,this.gridHelper=null,this.axesHelper=null,this.ambientLight=null,this.directionalLight=null,this.directionalLightHelper=null,this.pointLight=null,this.pointLightHelper=null,this.spotLight=null,this.spotLightHelper=null,this.planeGeometry=null,this.modelMaterialList=[],this.originalMaterials.clear(),this.effectComposer=null,this.outlinePass=null,this.renderAnimation=null,this.raycaster=null,this.mouse=null,this.glowComposer&&this.glowComposer.renderer.clear(),this.glowComposer=null,this.unrealBloomPass=null,this.shaderPass=null,this.glowMaterialList=null,this.materials=null,this.transformControls=null,this.dragGeometryModel=null,this.glowUnrealBloomPass=!1,this.css3DRenderer=null,this.css3dControls=null,this.dragTag={},this.dragTagList=[],this.activeDragManyModel={}}clearSceneModel(){if(this.camera.fov=50,this.scene.traverse(s=>{["Mesh"].includes(s.type)&&(s.geometry.dispose(),s.material.dispose())}),this.dragGeometryModel={},this.activeDragManyModel={},this.geometryGroup.clear(),this.scene.remove(this.geometryGroup),this.scene.remove(this.manyModelGroup),this.manyModelGroup.clear(),this.scene.children.filter(s=>s.userData.type=="manyModel").forEach(s=>{this.scene.remove(s)}),this.scene.remove(this.model),this.model=null,cancelAnimationFrame(this.animationFrame),cancelAnimationFrame(this.rotationAnimationFrame),this.glowUnrealBloomPass=!1,this.glowMaterialList=[],this.modelMaterialList=[],this.originalMaterials.clear(),this.materials={},this.transformControls){this.transformControls.detach();const s=xt(this.scene,{type:"TransformControlsPlane"});s&&this.scene.remove(s),this.scene.remove(this.transformControls),this.transformControls=null}this.effectComposer&&this.effectComposer.removePass(this.shaderPass),this.renderer.toneMappingExposure=1,this.outlinePass.selectedObjects=[],Object.assign(this.unrealBloomPass,{threshold:0,strength:0,radius:0}),this.shaderPass.material.uniforms.glowColor.value=new re;const o={gridHelper:!1,x:0,y:0,z:0,positionX:0,positionY:0,positionZ:0,divisions:18,size:6,color:"rgb(193,193,193)",axesHelper:!1,axesSize:1.8};this.onResettingLight({ambientLight:!0}),this.onSetModelGridHelper(o),this.onSetModelGridHelperSize(o),this.onSetModelAxesHelper(o),this.clearSceneTags()}setDragGeometryModel(e){this.dragGeometryModel=e}setDragManyModel(e){this.activeDragManyModel=e}onLoadManyModel(e){return new Promise((o,s)=>{const{clientHeight:n,clientWidth:a,offsetLeft:i,offsetTop:l}=this.container,{filePath:c,fileType:h,name:g}=e;if(this.mouse.x=(e.clientX-i)/a*2-1,this.mouse.y=-((e.clientY-l)/n)*2+1,this.raycaster.setFromCamera(this.mouse,this.camera),this.raycaster.intersectObjects(this.scene.children,!0).length>0){this.loadingStatus=!1;let y;if(["glb","gltf"].includes(h)){const p=new Qt;p.setDecoderPath("draco/gltf/"),p.setDecoderConfig({type:"js"}),p.preload(),y=new rt().setDRACOLoader(p)}else y=this.fileLoaderMap[h];let f;y.load(c,p=>{switch(h){case"glb":f=p.scene;break;case"fbx":f=p;break;case"gltf":f=p.scene;break;case"obj":f=p;break;case"stl":const m=new Xe;f=new F(p,m);break}this.getManyModelAnimationList(p.animations);const S=new _t().setFromObject(f).getSize(new q),E=Math.max(S.x,S.y,S.z),P=2.5/(E>1?E:.5);f.scale.set(P,P,P),this.controls.maxDistance=S.length()*50,f.name=g,f.userData={type:"manyModel",...f.userData},this.manyModelGroup.add(f),this.model=this.manyModelGroup,this.outlinePass.renderScene=this.model,this.getModelMaterialList(),this.glowMaterialList=this.modelMaterialList.map(m=>m.name),this.scene.add(this.model),this.loadingStatus=!0,o({load:!0})},p=>{this.modelProgressCallback(p.loaded,p.total)},p=>{ce.error(p),s()})}else s(),ce.warning("当前角度无法获取鼠标位置请调整“相机角度”在添加")})}chooseManyModel(e){const o=this.scene.children.find(s=>s.uuid==e);this.model=o,this.outlinePass.renderScene=this.model,this.getModelMaterialList()}}Object.assign($n.prototype,{...Pu});const Ru={key:0,id:"loading-mark"},$u={class:"loading-box"},Vu={class:"loading"},Uu={class:"progress-txt"},Du={__name:"PageLoading",props:{percentage:{type:[Number,String],default:0},loading:{type:Boolean,default:!1}},setup(t){const e=t;return(o,s)=>{const n=x("el-progress");return e.loading?(U(),Z("div",Ru,[d("div",$u,[d("div",Vu,[s[1]||(s[1]=d("img",{src:jn},null,-1)),d("div",Uu,[s[0]||(s[0]=k(" 当前模型已加载 ")),d("b",null,ve(e.percentage)+"%",1),r(n,{"text-inside":!0,"show-text":!1,"stroke-width":20,status:"exception",percentage:e.percentage},null,8,["percentage"])]),s[2]||(s[2]=d("div",{class:"loading-txt"},"模型文件首次加载时间较长请耐心等待.....",-1))])])])):xe("",!0)}}},Ou=Le(Du,[["__scopeId","data-v-29f5d973"]]),Fu={class:"model-page"},zu={class:"model-header"},Hu={class:"header-lf"},Nu={class:"header-lr"},ju={class:"model-container"},Bu={class:"camera-icon"},Gu={__name:"index",setup(t){const e=be(),o=Gn(),{$bus:s,$local:n}=De().proxy,a=te(!1),i=te(0),l=te(null),c=te(null),h=te(null),g=te(!1),v=te(null),y=ne(()=>{var b;if(l.value){const A=(b=c.value)==null?void 0:b.activeModel;return!!(A!=null&&A.filePath&&["oneModel","tags"].includes(e.modelType))}return!1}),f=te(!1),p=te(!1),M=()=>{f.value=!f.value},S=()=>{p.value=!p.value},E=()=>{e.modelApi.onResetModelCamera()},C=()=>{const b=n.get(it);if(!Array.isArray(b)){let A=[];pt.forEach(V=>{A.push({...to,fileInfo:{...V}})}),n.set(it,A)}},P=async b=>{const{dragGeometryModel:A,dragTag:V,activeDragManyModel:H}=e.modelApi,{clientX:D,clientY:N}=b,$=B=>{B.clientX=D,B.clientY=N};if(A.id&&e.modelType==="geometry"&&($(A),e.modelApi.onSwitchModel(A),s.emit("update-tab","EditGeometry")),V.id&&e.modelType==="tags"&&($(V),e.modelApi.create3dTags(V)),e.modelType==="manyModel"){console.log("activeDragManyModel",H),$(H);try{s.emit(Se,!0);const{load:B}=await e.modelApi.onLoadManyModel(H);B&&(s.emit(Ee),s.emit("update-tab","EditMoreModel"))}catch(B){console.error("加载多模型失败:",B)}finally{s.emit(Se,!1)}}},m=()=>{var A;const b=l.value.getPanelConfig();if(b.camera=e.modelApi.onGetModelCamera(),b.fileInfo=(A=c.value)==null?void 0:A.activeModel,b.fileInfo.filePath){n.set(no,b);const{href:V}=o.resolve({path:"/preview"});window.open(V,"_blank")}else ce.warning("当前模型暂不支持“效果预览”")};function L(b){const A={};return b.ambientLight&&Object.keys(b).forEach(V=>{V.startsWith("ambient")&&(A[V]=b[V])}),b.directionalLight&&Object.keys(b).forEach(V=>{V.startsWith("directional")&&(A[V]=b[V])}),b.pointLight&&Object.keys(b).forEach(V=>{V.startsWith("point")&&(A[V]=b[V])}),b.spotLight&&Object.keys(b).forEach(V=>{V.startsWith("spot")&&(A[V]=b[V])}),A}const _=()=>{var A;const b=l.value.getPanelConfig();b.animation.visible||(b.animation={}),b.light=L(b.light),console.log("onImportantCode",b),b.camera=e.modelApi.onGetModelCamera(),b.fileInfo=(A=c.value)==null?void 0:A.activeModel,h.value.showDialog(b)},T=()=>{const b=document.documentElement;g.value?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():b.requestFullscreen?b.requestFullscreen():b.webkitRequestFullscreen&&b.webkitRequestFullscreen()},w=()=>{yn.confirm(" 确认要更新当前模型数据至“模板库”?","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"success"}).then(()=>{var A;const b=l.value.getPanelConfig();if(b.camera=e.modelApi.onGetModelCamera(),b.fileInfo=(A=c.value)==null?void 0:A.activeModel,b.fileInfo.filePath){const V=n.get(it)||[],{id:H}=b.fileInfo;Object.assign(V.filter(D=>H===D.fileInfo.id)[0],b),n.set(it,V),ce.success("更新成功")}else ce.warning("当前模型暂不支持“数据保存”")}).catch(()=>{})},I=()=>{e.modelApi.onDownloadSceneCover()},Y=b=>{e.modelApi.onExporterModel(b)},R=b=>{const A=document.fullscreenElement||document.webkitFullscreenElement;g.value=!!A};return He(async()=>{a.value=!0;const b=new $n("#model");e.setModelApi(b),s.on(Se,V=>{clearTimeout(v.value),V?a.value=V:v.value=setTimeout(()=>{a.value=V,i.value=0},500)}),e.modelApi.onProgress((V,H)=>{i.value=Number((V/H*100).toFixed(0))}),await b.init()&&(a.value=!1,i.value=0),C(),document.addEventListener("fullscreenchange",R)}),Bn(()=>{e.modelApi.onClearModelData(),document.removeEventListener("fullscreenchange",R),clearTimeout(v.value)}),(b,A)=>{const V=x("el-space"),H=x("el-button"),D=x("el-dropdown-item"),N=x("el-dropdown-menu"),$=x("el-dropdown"),B=x("Aim"),ie=x("el-icon"),we=x("el-tooltip");return U(),Z("div",Fu,[d("header",zu,[d("div",Hu,[r(V,null,{default:u(()=>[A[5]||(A[5]=d("img",{src:Bo,alt:"logo",width:"30px"},null,-1)),d("span",null,"Microi吾码-3D模型渲染器·V"+ve(vn),1)]),_:1,__:[5]})]),d("div",Nu,[r(V,null,{default:u(()=>[r(H,{type:"primary",plain:"",icon:"Film",onClick:A[0]||(A[0]=G=>b.$router.push({path:"/modelBase"}))},{default:u(()=>A[6]||(A[6]=[k(" 模型库 ")])),_:1,__:[6]}),y.value?(U(),oe(H,{key:0,type:"primary",plain:"",icon:"Document",onClick:w},{default:u(()=>A[7]||(A[7]=[k("保存数据")])),_:1,__:[7]})):xe("",!0),y.value?(U(),oe(H,{key:1,type:"primary",plain:"",icon:"View",onClick:m},{default:u(()=>A[8]||(A[8]=[k("效果预览")])),_:1,__:[8]})):xe("",!0),r($,{trigger:"click"},{dropdown:u(()=>[r(N,null,{default:u(()=>[r(D,{onClick:I},{default:u(()=>A[10]||(A[10]=[k("下载封面")])),_:1,__:[10]}),r(D,{onClick:A[1]||(A[1]=G=>Y("glb"))},{default:u(()=>A[11]||(A[11]=[k("导出模型(.glb)格式")])),_:1,__:[11]}),r(D,{onClick:A[2]||(A[2]=G=>Y("gltf"))},{default:u(()=>A[12]||(A[12]=[k("导出模型(.gltf)格式")])),_:1,__:[12]}),r(D,{onClick:A[3]||(A[3]=G=>Y("usdz"))},{default:u(()=>A[13]||(A[13]=[k("导出模型(.usdz)格式")])),_:1,__:[13]})]),_:1})]),default:u(()=>[r(H,{type:"primary",plain:"",icon:"Download"},{default:u(()=>A[9]||(A[9]=[k(" 下载/导出 ")])),_:1,__:[9]})]),_:1}),y.value?(U(),oe(H,{key:2,type:"primary",plain:"",icon:"HelpFilled",onClick:_},{default:u(()=>A[14]||(A[14]=[k(" 嵌入代码 ")])),_:1,__:[14]})):xe("",!0),r(H,{type:"primary",plain:"",icon:"FullScreen",onClick:T},{default:u(()=>[k(ve(g.value?"取消全屏":"全屏"),1)]),_:1})]),_:1})])]),d("div",ju,[d("div",{class:j(["model-panel",{collapsed:f.value}])},[ae(r(ue(Jl),{ref_key:"choosePanel",ref:c},null,512),[[de,!f.value]])],2),d("div",{class:"toggle-trigger left-trigger",style:mt({left:f.value?"0":"305px"}),onClick:M},null,4),d("div",{id:"model",onDrop:P,ref:"model",onDragover:A[4]||(A[4]=Be(()=>{},["prevent"]))},[d("div",Bu,[r(we,{effect:"dark",content:"居中",placement:"top"},{default:u(()=>[r(ie,{size:22,color:"#409eff",onClick:E},{default:u(()=>[r(B)]),_:1})]),_:1})]),A[15]||(A[15]=d("div",{id:"mesh-txt"},null,-1))],544),d("div",{class:j(["edit-panel",{collapsed:p.value}])},[ue(e).modelApi.model?(U(),oe(ue($l),{key:0,ref_key:"editPanel",ref:l},null,512)):xe("",!0)],2),d("div",{class:"toggle-trigger right-trigger",style:mt({right:p.value||!ue(e).modelApi.model?"0":"380px"}),onClick:S},null,4)]),A[16]||(A[16]=d("video",{id:"video",loop:"loop",playsinline:"",autoplay:"",style:{display:"none"}},null,-1)),r(Ou,{loading:a.value,percentage:i.value},null,8,["loading","percentage"]),r(ue(id),{ref_key:"implantDialog",ref:h},null,512)])}}},Zu=Le(Gu,[["__scopeId","data-v-47f3455d"]]);export{Zu as default};
