import{K as L,L as O,_ as P,r as y,w as k,a as _,o as x,b as j,d as J,e as C,E as h}from"./index-BGFu5ZxE.js";import{u as E}from"./useWidget-n3HUFkKV.js";import"./axiosInstance-D4MJEpoG.js";var I={exports:{}};(function(M,m){(function(g,p){M.exports=p()})(L,function(){function g(e){var o=[];return e.AMapUI&&o.push(p(e.AMapUI)),e.Loca&&o.push(b(e.Loca)),Promise.all(o)}function p(e){return new Promise(function(o,a){var u=[];if(e.plugins)for(var s=0;s<e.plugins.length;s+=1)t.AMapUI.plugins.indexOf(e.plugins[s])==-1&&u.push(e.plugins[s]);if(n.AMapUI===i.failed)a("前次请求 AMapUI 失败");else if(n.AMapUI===i.notload){n.AMapUI=i.loading,t.AMapUI.version=e.version||t.AMapUI.version,s=t.AMapUI.version;var l=document.body||document.head,c=document.createElement("script");c.type="text/javascript",c.src="https://webapi.amap.com/ui/"+s+"/main.js",c.onerror=function(r){n.AMapUI=i.failed,a("请求 AMapUI 失败")},c.onload=function(){if(n.AMapUI=i.loaded,u.length)window.AMapUI.loadUI(u,function(){for(var r=0,w=u.length;r<w;r++){var A=u[r].split("/").slice(-1)[0];window.AMapUI[A]=arguments[r]}for(o();f.AMapUI.length;)f.AMapUI.splice(0,1)[0]()});else for(o();f.AMapUI.length;)f.AMapUI.splice(0,1)[0]()},l.appendChild(c)}else n.AMapUI===i.loaded?e.version&&e.version!==t.AMapUI.version?a("不允许多个版本 AMapUI 混用"):u.length?window.AMapUI.loadUI(u,function(){for(var r=0,w=u.length;r<w;r++){var A=u[r].split("/").slice(-1)[0];window.AMapUI[A]=arguments[r]}o()}):o():e.version&&e.version!==t.AMapUI.version?a("不允许多个版本 AMapUI 混用"):f.AMapUI.push(function(r){r?a(r):u.length?window.AMapUI.loadUI(u,function(){for(var w=0,A=u.length;w<A;w++){var U=u[w].split("/").slice(-1)[0];window.AMapUI[U]=arguments[w]}o()}):o()})})}function b(e){return new Promise(function(o,a){if(n.Loca===i.failed)a("前次请求 Loca 失败");else if(n.Loca===i.notload){n.Loca=i.loading,t.Loca.version=e.version||t.Loca.version;var u=t.Loca.version,s=t.AMap.version.startsWith("2"),l=u.startsWith("2");if(s&&!l||!s&&l)a("JSAPI 与 Loca 版本不对应！！");else{s=t.key,l=document.body||document.head;var c=document.createElement("script");c.type="text/javascript",c.src="https://webapi.amap.com/loca?v="+u+"&key="+s,c.onerror=function(r){n.Loca=i.failed,a("请求 AMapUI 失败")},c.onload=function(){for(n.Loca=i.loaded,o();f.Loca.length;)f.Loca.splice(0,1)[0]()},l.appendChild(c)}}else n.Loca===i.loaded?e.version&&e.version!==t.Loca.version?a("不允许多个版本 Loca 混用"):o():e.version&&e.version!==t.Loca.version?a("不允许多个版本 Loca 混用"):f.Loca.push(function(r){r?a(r):a()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var i;(function(e){e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed"})(i||(i={}));var t={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},n={AMap:i.notload,AMapUI:i.notload,Loca:i.notload},f={AMap:[],AMapUI:[],Loca:[]},d=[],v=function(e){typeof e=="function"&&(n.AMap===i.loaded?e(window.AMap):d.push(e))};return{load:function(e){return new Promise(function(o,a){if(n.AMap==i.failed)a("");else if(n.AMap==i.notload){var u=e.key,s=e.version,l=e.plugins;u?(window.AMap&&location.host!=="lbs.amap.com"&&a("禁止多种API加载方式混用"),t.key=u,t.AMap.version=s||t.AMap.version,t.AMap.plugins=l||t.AMap.plugins,n.AMap=i.loading,s=document.body||document.head,window.___onAPILoaded=function(r){if(delete window.___onAPILoaded,r)n.AMap=i.failed,a(r);else for(n.AMap=i.loaded,g(e).then(function(){o(window.AMap)}).catch(a);d.length;)d.splice(0,1)[0]()},l=document.createElement("script"),l.type="text/javascript",l.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+t.AMap.version+"&key="+u+"&plugin="+t.AMap.plugins.join(","),l.onerror=function(r){n.AMap=i.failed,a(r)},s.appendChild(l)):a("请填写key")}else if(n.AMap==i.loaded)if(e.key&&e.key!==t.key)a("多个不一致的 key");else if(e.version&&e.version!==t.AMap.version)a("不允许多个版本 JSAPI 混用");else{if(u=[],e.plugins)for(s=0;s<e.plugins.length;s+=1)t.AMap.plugins.indexOf(e.plugins[s])==-1&&u.push(e.plugins[s]);u.length?window.AMap.plugin(u,function(){g(e).then(function(){o(window.AMap)}).catch(a)}):g(e).then(function(){o(window.AMap)}).catch(a)}else if(e.key&&e.key!==t.key)a("多个不一致的 key");else if(e.version&&e.version!==t.AMap.version)a("不允许多个版本 JSAPI 混用");else{var c=[];if(e.plugins)for(s=0;s<e.plugins.length;s+=1)t.AMap.plugins.indexOf(e.plugins[s])==-1&&c.push(e.plugins[s]);v(function(){c.length?window.AMap.plugin(c,function(){g(e).then(function(){o(window.AMap)}).catch(a)}):g(e).then(function(){o(window.AMap)}).catch(a)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,t={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},n={AMap:i.notload,AMapUI:i.notload,Loca:i.notload},f={AMap:[],AMapUI:[],Loca:[]}}}})})(I);var S=I.exports;const B=O(S),N={id:"container",style:{width:"100%",height:"100%"}},T={__name:"map-widget",props:{widgetObj:{type:Object,required:!0}},async setup(M){let m,g;const p=M,b=y(),i=y(!1),{loadRemoteData:t}=E(p.widgetObj,p.widgetObj.widgetParams[0].typeOptions.dataJson,b,i);[m,g]=k(()=>t()),await m,g();let n;const f=()=>{B.load({key:"44a64ccfb659299ca8be07d7d0839830",version:"2.0",plugins:[]}).then(d=>{var e;let v=p.widgetObj.widgetParams[1].value.split(",");p.widgetObj.widgetParams[0].typeOptions.dataJson&&(v=(e=p.widgetObj.widgetParams[0].typeOptions.dataJson[0])==null?void 0:e.position.split(",")),n=new d.Map("container",{zoom:p.widgetObj.widgetParams[2].value,center:v}),p.widgetObj.widgetParams[3].value&&d.plugin("AMap.ToolBar",function(){var o=new d.ToolBar;n.addControl(o)}),p.widgetObj.widgetParams[4].value&&d.plugin("AMap.Scale",function(){var o=new d.Scale;n.addControl(o)}),p.widgetObj.widgetParams[5].value&&d.plugin("AMap.HawkEye",function(){var o=new d.HawkEye;n.addControl(o)}),p.widgetObj.widgetParams[6].value&&d.plugin("AMap.MapType",function(){var o=new d.MapType;n.addControl(o)}),p.widgetObj.widgetParams[7].value&&d.plugin("AMap.Geolocation",function(){var o=new d.Geolocation({enableHighAccuracy:!0,timeout:1e4,offset:[20,100],zoomToAccuracy:!0,position:"RB"});n.addControl(o)}),p.widgetObj.widgetParams[0].typeOptions.dataJson&&p.widgetObj.widgetParams[0].typeOptions.dataJson.forEach(o=>{console.log("item",o);let a=new d.Marker({offset:new d.Pixel(-10,-10),position:o.position.split(","),icon:o.icon,title:o.title,content:o.content});if(a.on("click",function(s){var l;console.log("点击了地图maker：",JSON.stringify(o)),h.emit("mapMarkerClick",JSON.stringify(o)),(l=window.parent)==null||l.postMessage({key:"mapWidget",value:JSON.stringify(o)},"*")}),n.add(a),p.widgetObj.widgetParams[8].value){var u=new d.Text({text:o.title,anchor:"center",draggable:!1,cursor:"pointer",angle:0,style:{padding:"4px 8px","margin-bottom":"3.2rem","margin-left":"3.5rem","border-radius":".25rem","background-color":"white","border-width":0,"box-shadow":"0 2px 6px 0 rgba(114, 124, 245, .5)","text-align":"center","font-size":"12px",color:"#409eff",cursor:"pointer"},position:o.position.split(",")});u.on("click",function(s){var l;console.log("点击了地图maker：",JSON.stringify(o)),h.emit("mapMarkerClick",JSON.stringify(o)),(l=window.parent)==null||l.postMessage({key:"mapWidget",value:JSON.stringify(o)},"*")}),u.setMap(n)}})}).catch(d=>{console.error(d)})};return _(()=>{f()}),x(()=>{n&&n.destroy()}),j([()=>p.widgetObj.widgetParams],()=>{n&&n.destroy(),f()},{deep:!0}),(d,v)=>(J(),C("div",N))}},H=P(T,[["__scopeId","data-v-10d0aafa"]]);export{H as default};
