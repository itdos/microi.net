import{_ as R,r as u,w as T,o as A,a as L,b as U,c as W,d as F,e as I,f,g as q,h as H,i as G,F as K,j as Q,k as X,E as Y}from"./index-B5wzY7fk.js";import{u as Z}from"./useWidget-BqQaiJ-A.js";const V={style:{display:"flex","justify-content":"space-between"}},ee={__name:"areamap-widget",props:{widgetObj:{type:Object,required:!0}},async setup(b){var y,h,M,_,x,$,D;let O,j;const i=b,k=u(),C=u(!1),{loadRemoteData:E}=Z(i.widgetObj,i.widgetObj.widgetParams[0].typeOptions.dataJson,k,C);[O,j]=T(()=>E()),await O,j();const P=u("330000");P.value=(y=i.widgetObj.widgetParams[1])==null?void 0:y.value;const m=u(null);let n=null,p=[];const v=u(null),o=u({tooltip:{trigger:"item",formatter:e=>{var a;return e.seriesType==="lines"?`${e.data.fromName} -> ${e.data.toName}`:`${e.name}<br>${(a=i.widgetObj.widgetParams[3])==null?void 0:a.value}：${Array.isArray(e.value)?e.value[2]:e.value}`}},visualMap:{show:!0,min:(h=i.widgetObj.widgetParams[4])==null?void 0:h.value,max:(M=i.widgetObj.widgetParams[5])==null?void 0:M.value,inRange:{color:(x=(_=i.widgetObj.widgetParams[6])==null?void 0:_.value)==null?void 0:x.split(",")},calculable:!0,right:10,bottom:30},geo:{label:{normal:{show:!0,formatter:e=>{const a=o.value.series[0].data.find(r=>r.name===e.name);return`${e.name}：${a?a.value:0}`},position:"right",textStyle:{color:($=i.widgetObj.widgetParams[7])==null?void 0:$.value,fontSize:(D=i.widgetObj.widgetParams[8])==null?void 0:D.value}}},roam:!0},series:[{type:"map",geoIndex:0}]});async function z(e){var a,r;try{let t=`${(a=i.widgetObj.widgetParams[10])==null?void 0:a.value}/${(r=i.widgetObj.widgetParams[1])==null?void 0:r.value}/${e}.json`;console.log("newJsonUrl",t);const s=await fetch(t);if(!s.ok)throw new Error(`HTTP error! Status: ${s.status}`);const l=await s.json();return console.log("data.default",l),v.value=l,v.value}catch(t){return console.error(`加载${e}地图数据失败:`,t),null}}async function d(e){const a=await z(e);if(!a)return;p=[],a.features.forEach(s=>{p.push({name:s.properties.name,adcode:s.properties.adcode})}),P.value=e,Q(e,a),o.value.geo.map=e,o.value.series[0].map=e;const{features:r}=v.value,t=N(r);o.value.series[0].data=t.areaData,console.log("模拟数据",t.areaData),n&&n.setOption(o.value,!0)}function N(e){var t;let a=[],r=[];return(t=i.widgetObj.widgetParams[9])!=null&&t.value?e.forEach((s,l)=>{const c=s.properties,g=Math.round(Math.random()*100);a.push({name:c.name,value:g})}):a=i.widgetObj.widgetParams[0].typeOptions.dataJson,{areaData:a,scatterData:r}}function S(e){var r,t;const a=p.find(s=>s.name===e.name);a&&(console.log("点击了",a),Y.emit("areaMapClick",a),(r=window.parent)==null||r.postMessage({key:"areaMapWidget",value:JSON.stringify(a)},"*"),(t=i.widgetObj.widgetParams[2])!=null&&t.value&&d(a.adcode))}function B(){var e;m.value&&(n=X(m.value),d((e=i.widgetObj.widgetParams[1])==null?void 0:e.value),n.on("click",S),window.addEventListener("resize",w))}A(()=>{n&&(n.dispose(),n=null),window.removeEventListener("resize",w)}),L(()=>{B()});function w(){n&&(n==null||n.resize())}function J(e){var a,r,t,s,l,c,g;o.value.visualMap.min=(a=e.widgetParams[4])==null?void 0:a.value,o.value.visualMap.max=(r=e.widgetParams[5])==null?void 0:r.value,o.value.visualMap.inRange.color=(s=(t=e.widgetParams[6])==null?void 0:t.value)==null?void 0:s.split(","),o.value.geo.label.normal.textStyle={color:(l=e.widgetParams[7])==null?void 0:l.value,fontSize:(c=e.widgetParams[8])==null?void 0:c.value},d((g=e.widgetParams[1])==null?void 0:g.value),n&&n.setOption(o.value,!0),w()}return U(()=>i.widgetObj,(e,a)=>{J(e)},{deep:!0}),(e,a)=>{const r=W("el-button");return F(),I(K,null,[f("div",V,[f("div",null,[q(r,{onClick:a[0]||(a[0]=t=>{var s;return d((s=b.widgetObj.widgetParams[1])==null?void 0:s.value)})},{default:H(()=>a[1]||(a[1]=[G("初始化地图")])),_:1})])]),f("div",{class:"overview_main_mapBox",id:"mapChart",ref_key:"mapChart",ref:m},null,512)],64)}}},ie=R(ee,[["__scopeId","data-v-8bf6ab0f"]]);export{ie as default};
