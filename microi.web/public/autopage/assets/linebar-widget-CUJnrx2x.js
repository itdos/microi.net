import{_ as ge,u as ve,s as we,r as v,c as pe,o as me,a as be,n as Q,i as he,w as ye,b as w,d as n,e as L,f as fe,v as xe,g as X,h as Z,j as $,F as k,k as ee,l as S,m as ae,p as te,q as Oe,t as je,x as Pe}from"./index-e3nHg57k.js";import{u as _e,g as Le}from"./useWidget-R-djxtlI.js";const ke={class:"date-range"},Se={__name:"linebar-widget",props:{widgetObj:{type:Object,required:!0}},setup(y){var E,D,M,B,I,J,W;const le=ve(),{curWrapper:oe,dark:o}=we(le),e=y,f=v(!1);v([]);const se=async(r,s,d)=>{if(r&&s.optionUrl){f.value=!0;let u={};try{const i=await Le(s.optionUrl+r,u);i&&i.length>0&&(e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[d].options=i),f.value=!1}catch(i){console.error("Error fetching data:",i)}finally{f.value=!1}}},V=v(),R=v(!1),{loadRemoteData:U}=_e(e.widgetObj,(E=e.widgetObj.widgetParams[0])==null?void 0:E.typeOptions.dataJson,V,R),A=async()=>{console.log("重新加载了数据"),await U(),C()},x=v(null);let p=null;const ie=pe(()=>{var s;let r=(s=e.widgetObj.widgetParams[1])!=null&&s.value?40:0;return e.widgetObj.widgetOption.height-r+"px"}),a=v({});a.value={title:{show:!0,text:"",subtext:"",textStyle:{color:o.value?"#999":"#333",fontStyle:"normal",fontWeight:"bolder",fontFamily:"sans-serif",fontSize:18}},tooltip:{trigger:"axis",show:!0,axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{show:!0,type:"scroll",textStyle:{color:o.value?"#999":"#333"},data:[],orient:(D=e.widgetObj.widgetParams[8])==null?void 0:D.value,left:(M=e.widgetObj.widgetParams[9])==null?void 0:M.value},grid:{show:!1,left:"10%",right:"8%",bottom:"30px",containLabel:!1},toolbox:{show:!0,feature:{dataView:{readOnly:!1},restore:{},saveAsImage:{}}},xAxis:[{type:"category",boundaryGap:!0,axisTick:{alignWithLabel:!0},axisLabel:{color:o.value?"#999":"#333"},data:[]}],yAxis:[{type:"value",splitLine:{show:(B=e.widgetObj.widgetParams[16])==null?void 0:B.value,lineStyle:{color:["#ccc"],width:1,type:"solid"}},axisLabel:{formatter:"{value} "+((I=e.widgetObj.widgetParams[3])==null?void 0:I.value),color:o.value?"#999":"#333"}},{type:"value",splitLine:{show:(J=e.widgetObj.widgetParams[17])==null?void 0:J.value,lineStyle:{color:["#ccc"],width:1,type:"dashed"}},axisLabel:{formatter:"{value} "+((W=e.widgetObj.widgetParams[4])==null?void 0:W.value),color:o.value?"#999":"#333"}}],series:[]},me(()=>{re(),de()}),be(()=>{ue()});const re=async()=>{await U(),Y()},Y=()=>{Q(()=>{p&&p.dispose(),x.value&&(p=he(x.value),C())})},ne=()=>{p.setOption(a.value)},C=()=>{var r,s,d,u,i,O,j,P,m,b,h,t,c,l,_,F,K,N,T;a.value.title.textStyle.color=o.value?"#999":"#333",a.value.legend.textStyle.color=o.value?"#999":"#333",a.value.legend.orient=(r=e.widgetObj.widgetParams[8])==null?void 0:r.value,a.value.legend.left=(s=e.widgetObj.widgetParams[9])==null?void 0:s.value,a.value.title.text=(d=e.widgetObj.widgetParams[5])==null?void 0:d.value,a.value.title.subtext=(u=e.widgetObj.widgetParams[6])==null?void 0:u.value,a.value.legend.show=(i=e.widgetObj.widgetParams[7])==null?void 0:i.value,a.value.tooltip.show=(O=e.widgetObj.widgetParams[10])==null?void 0:O.value,a.value.tooltip.trigger=(j=e.widgetObj.widgetParams[11])==null?void 0:j.value,a.value.toolbox.show=(P=e.widgetObj.widgetParams[13])==null?void 0:P.value,a.value.xAxis[0].data=(m=e.widgetObj.widgetParams[0])==null?void 0:m.typeOptions.dataJson.xAxis,a.value.xAxis[0].boundaryGap=(b=e.widgetObj.widgetParams[2])==null?void 0:b.value,a.value.xAxis[0].axisLabel.color=o.value?"#999":"#333",a.value.yAxis[0].axisLabel.color=o.value?"#999":"#333",a.value.yAxis[1].axisLabel.color=o.value?"#999":"#333",a.value.yAxis[0].axisLabel.formatter="{value} "+((h=e.widgetObj.widgetParams[3])==null?void 0:h.value),a.value.yAxis[1].axisLabel.formatter="{value} "+((t=e.widgetObj.widgetParams[4])==null?void 0:t.value),a.value.yAxis[0].splitLine.show=(l=(c=e.widgetObj)==null?void 0:c.widgetParams[16])==null?void 0:l.value,a.value.yAxis[1].splitLine.show=(F=(_=e.widgetObj)==null?void 0:_.widgetParams[17])==null?void 0:F.value,a.value.series=[],a.value.legend.data=[],(T=(N=(K=e.widgetObj.widgetParams[0])==null?void 0:K.typeOptions.dataJson)==null?void 0:N.series)==null||T.forEach((g,Ve)=>{var H,q;const G={type:g.type,name:g.name,data:g.data,tooltip:{valueFormatter:function(ce){return ce+" "+g.unit}},label:{show:(H=e.widgetObj.widgetParams[14])==null?void 0:H.value,position:(q=e.widgetObj.widgetParams[15])==null?void 0:q.value}};g.type=="line"&&(G.yAxisIndex=1),a.value.series.push(G),a.value.legend.data.push(g.name)}),ne()},de=()=>{window.addEventListener("resize",z)},ue=()=>{window.removeEventListener("resize",z)},z=()=>{Q(()=>{x.value&&p.resize()})};return ye([()=>e.widgetObj,()=>oe.value,()=>o.value],()=>{Y(),z()},{deep:!0}),(r,s)=>{var m;const d=w("el-input"),u=w("el-option"),i=w("el-select"),O=w("el-date-picker"),j=w("el-button"),P=w("el-space");return n(),L(k,null,[fe(X("div",ke,[Z(P,{wrap:""},{default:$(()=>{var b,h;return[(n(!0),L(k,null,ee((b=y.widgetObj.widgetParams[0].typeOptions.dataJson)==null?void 0:b.searchData,(t,c)=>(n(),L(k,null,[t.type=="input"?(n(),S(d,{key:c,modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,size:"small",placeholder:"请输入"+t.label,clearable:"",onKeyup:ae(A,["enter"])},null,8,["modelValue","onUpdate:modelValue","placeholder"])):t.type=="select"?(n(),S(i,{class:"pagesearch",style:{"min-width":"120px"},key:c+"select",modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,size:"small",placeholder:"请选择"+t.label,clearable:"",filterable:"",remote:"","remote-method":l=>se(l,t,c),loading:f.value,onKeyup:ae(A,["enter"])},{default:$(()=>[(n(!0),L(k,null,ee(t.options,(l,_)=>(n(),S(u,{value:l.value,label:l.label,key:_+l.value},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","remote-method","loading"])):te("",!0)],64))),256)),(h=y.widgetObj.widgetParams[18])!=null&&h.value?(n(),S(O,{key:0,modelValue:V.value,"onUpdate:modelValue":s[0]||(s[0]=t=>V.value=t),size:"small","unlink-panels":"",type:"monthrange","range-separator":"至","start-placeholder":"起始年月","end-placeholder":"结束年月",format:"YYYY-MM","value-format":"YYYY-MM"},null,8,["modelValue"])):te("",!0),Z(j,{icon:Oe(je),size:"small",loading:R.value,circle:"",onClick:A},null,8,["icon","loading"])]}),_:1})],512),[[xe,(m=y.widgetObj.widgetParams[1])==null?void 0:m.value]]),X("div",{ref_key:"chartRef",ref:x,style:Pe([{width:"100%"},{height:ie.value}])},null,4)],64)}}},Re=ge(Se,[["__scopeId","data-v-9b9c0145"]]);export{Re as default};
