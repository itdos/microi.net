import{_ as te,u as ae,s as le,r as i,c as B,o as oe,a as se,n as J,i as ne,w as re,b as c,d as r,e as _,f as ie,v as de,g as W,h as F,j as I,F as j,k as K,l as P,m as N,p as H,q as ue,t as ce,x as ge}from"./index-CfICaLg9.js";import{u as pe,g as we}from"./useWidget-zuxP2hw3.js";const me={class:"date-range"},ve={__name:"funnel-widget",props:{widgetObj:{type:Object,required:!0}},setup(x){var D,E,M;const T=ae(),{curWrapper:q,dark:g}=le(T),e=x,V=i((D=e.widgetObj.widgetParams[0].typeOptions.dataJson)==null?void 0:D.searchData),h=i(!1);i([]);const A=async(l,o,d)=>{if(l&&o.optionUrl){h.value=!0;let u={};try{const s=await we(o.optionUrl+l,u);s&&s.length>0&&(V.value[d].options=s),h.value=!1}catch(s){console.error("Error fetching data:",s)}finally{h.value=!1}}},S=i(),C=i(!1),{loadRemoteData:L}=pe(e.widgetObj,e.widgetObj.widgetParams[0].typeOptions.dataJson,S,C),k=async()=>{console.log("重新加载了数据"),await L(),U()},b=i(null);let p=null;const G=B(()=>{var o;let l=(o=e.widgetObj.widgetParams[1])!=null&&o.value?40:0;return e.widgetObj.widgetOption.height-l+"px"}),t=i({});t.value={title:{show:!0,text:"",subtext:"",textStyle:{color:g.value?"#999":"#333",fontStyle:"normal",fontWeight:"bolder",fontFamily:"sans-serif",fontSize:18}},tooltip:{trigger:"item",show:!0,axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{show:!0,type:"scroll",textStyle:{color:g.value?"#999":"#333"},orient:(E=e.widgetObj.widgetParams[6])==null?void 0:E.value,left:(M=e.widgetObj.widgetParams[7])==null?void 0:M.value,data:[]},grid:{show:!1,left:"10%",right:"4%",bottom:"30px",containLabel:!1},toolbox:{show:!0,feature:{dataView:{readOnly:!1},restore:{},saveAsImage:{}}},series:[]},oe(()=>{Q(),Z()}),se(()=>{$()});const Q=async()=>{await L(),R()},R=()=>{J(()=>{p&&p.dispose(),b.value&&(p=ne(b.value),U())})},X=()=>{p.setOption(t.value)},U=()=>{var l,o,d,u,s,f,y,O,w,m,a;t.value.legend.orient=(l=e.widgetObj.widgetParams[6])==null?void 0:l.value,t.value.legend.left=(o=e.widgetObj.widgetParams[7])==null?void 0:o.value,t.value.title.textStyle.color=g.value?"#999":"#333",t.value.legend.textStyle.color=g.value?"#999":"#333",t.value.title.text=(d=e.widgetObj.widgetParams[3])==null?void 0:d.value,t.value.title.subtext=(u=e.widgetObj.widgetParams[4])==null?void 0:u.value,t.value.legend.show=(s=e.widgetObj.widgetParams[5])==null?void 0:s.value,t.value.tooltip.show=(f=e.widgetObj.widgetParams[8])==null?void 0:f.value,t.value.tooltip.trigger=(y=e.widgetObj.widgetParams[9])==null?void 0:y.value,t.value.toolbox.show=(O=e.widgetObj.widgetParams[10])==null?void 0:O.value,t.value.series=[{type:"funnel",left:"10%",top:40,bottom:10,width:"80%",min:0,max:100,minSize:"0%",maxSize:"100%",sort:"descending",gap:2,label:{show:(w=e.widgetObj.widgetParams[11])==null?void 0:w.value,position:(m=e.widgetObj.widgetParams[12])==null?void 0:m.value},labelLine:{length:10,lineStyle:{width:1,type:"solid"}},itemStyle:{borderColor:"#fff",borderWidth:1},emphasis:{label:{fontSize:20}},data:Y.value}],t.value.legend.data=[],(a=Y.value)==null||a.forEach((v,n)=>{t.value.legend.data.push(v.name)}),X()},Z=()=>{window.addEventListener("resize",z)},$=()=>{window.removeEventListener("resize",z)},z=()=>{J(()=>{b.value&&p.resize()})};re([()=>e.widgetObj,()=>q.value,()=>g.value],()=>{R(),z()},{deep:!0});const Y=B(()=>{var l;return(l=e.widgetObj.widgetParams[0].typeOptions.dataJson)!=null&&l.data?e.widgetObj.widgetParams[0].typeOptions.dataJson.data:e.widgetObj.widgetParams[0].typeOptions.dataJson});return(l,o)=>{var w;const d=c("el-input"),u=c("el-option"),s=c("el-select"),f=c("el-date-picker"),y=c("el-button"),O=c("el-space");return r(),_(j,null,[ie(W("div",me,[F(O,{wrap:""},{default:I(()=>{var m;return[(r(!0),_(j,null,K(V.value,(a,v)=>(r(),_(j,null,[a.type=="input"?(r(),P(d,{key:v,modelValue:a.value,"onUpdate:modelValue":n=>a.value=n,size:"small",placeholder:"请输入"+a.label,clearable:"",onKeyup:N(k,["enter"])},null,8,["modelValue","onUpdate:modelValue","placeholder"])):a.type=="select"?(r(),P(s,{class:"pagesearch",style:{"min-width":"120px"},key:v+"select",modelValue:a.value,"onUpdate:modelValue":n=>a.value=n,size:"small",placeholder:"请选择"+a.label,clearable:"",filterable:"",remote:"","remote-method":n=>A(n,a,v),loading:h.value,onKeyup:N(k,["enter"])},{default:I(()=>[(r(!0),_(j,null,K(a.options,(n,ee)=>(r(),P(u,{value:n.value,label:n.label,key:ee+n.value},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","remote-method","loading"])):H("",!0)],64))),256)),(m=x.widgetObj.widgetParams[13])!=null&&m.value?(r(),P(f,{key:0,modelValue:S.value,"onUpdate:modelValue":o[0]||(o[0]=a=>S.value=a),size:"small","unlink-panels":"",type:"monthrange","range-separator":"至","start-placeholder":"起始年月","end-placeholder":"结束年月",format:"YYYY-MM","value-format":"YYYY-MM"},null,8,["modelValue"])):H("",!0),F(y,{icon:ue(ce),size:"small",loading:C.value,circle:"",onClick:k},null,8,["icon","loading"])]}),_:1})],512),[[de,(w=x.widgetObj.widgetParams[1])==null?void 0:w.value]]),W("div",{ref_key:"chartRef",ref:b,style:ge([{width:"100%"},{height:G.value}])},null,4)],64)}}},fe=te(ve,[["__scopeId","data-v-8dcd24bd"]]);export{fe as default};
