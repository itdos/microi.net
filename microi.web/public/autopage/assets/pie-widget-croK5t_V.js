import{_ as le,u as se,s as oe,r as c,c as W,o as re,a as ie,n as I,i as ne,w as de,b as w,d as u,e as x,f as ue,v as ce,g as F,h as K,j as N,F as S,k as T,l as z,m as A,p as H,q as ge,t as we,x as pe}from"./index-BVh9aAA9.js";import{u as me,g as ve}from"./useWidget-DHPg7DNb.js";const be={class:"date-range"},he={__name:"pie-widget",props:{widgetObj:{type:Object,required:!0}},setup(f){var Y,E;const q=se(),{curWrapper:G,dark:p}=oe(q),e=f,O=c(!1);c([]);const Q=async(t,a,o)=>{if(t&&a.optionUrl){O.value=!0;let d={};try{const i=await ve(a.optionUrl+t,d);i&&i.length>0&&(e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[o].options=i),O.value=!1}catch(i){console.error("Error fetching data:",i)}finally{O.value=!1}}},D=c(),R=c(!1),{loadRemoteData:C}=me(e.widgetObj,e.widgetObj.widgetParams[0].typeOptions.dataJson,D,R),g=c({}),y=async t=>{const a={...g.value};for(const[o,d]of Object.entries(a))e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[o]&&(e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[o].value=d);await C(),U()},j=c(null);let m=null;const X=W(()=>{var a;let t=(a=e.widgetObj.widgetParams[1])!=null&&a.value?40:0;return e.widgetObj.widgetOption.height-t+"px"}),l=c({});l.value={title:{show:!0,text:"",subtext:"",textStyle:{color:p.value?"#999":"#333",fontStyle:"normal",fontWeight:"bolder",fontFamily:"sans-serif",fontSize:18}},tooltip:{trigger:"item",show:!0},legend:{show:!0,type:"scroll",textStyle:{color:p.value?"#fff":"#333"},orient:(Y=e.widgetObj.widgetParams[8])==null?void 0:Y.value,left:(E=e.widgetObj.widgetParams[9])==null?void 0:E.value},grid:{show:!1,left:"6%",right:"4%",bottom:"30px",containLabel:!1},toolbox:{show:!0,feature:{dataView:{readOnly:!1},restore:{},saveAsImage:{}}},series:[]},re(()=>{var t;(t=e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData)==null||t.forEach((a,o)=>{g.value[o]=a.value}),Z(),ee()}),ie(()=>{te()});const Z=async()=>{await C(),L()},L=()=>{I(()=>{m&&m.dispose(),j.value&&(m=ne(j.value),U())})},$=()=>{m.setOption(l.value)},U=()=>{var a,o,d,i,P,_,V,v,b,h,r,n,s,k,M,B;l.value.title.textStyle.color=p.value?"#999":"#333",l.value.legend.textStyle.color=p.value?"#999":"#333",l.value.legend.orient=(a=e.widgetObj.widgetParams[8])==null?void 0:a.value,l.value.legend.left=(o=e.widgetObj.widgetParams[9])==null?void 0:o.value,l.value.title.text=(d=e.widgetObj.widgetParams[5])==null?void 0:d.value,l.value.title.subtext=(i=e.widgetObj.widgetParams[6])==null?void 0:i.value,l.value.legend.show=(P=e.widgetObj.widgetParams[7])==null?void 0:P.value,l.value.tooltip.show=(_=e.widgetObj.widgetParams[10])==null?void 0:_.value,l.value.tooltip.trigger=(V=e.widgetObj.widgetParams[11])==null?void 0:V.value,l.value.toolbox.show=(v=e.widgetObj.widgetParams[12])==null?void 0:v.value,l.value.series=[];const t={type:"pie",radius:[((b=e.widgetObj.widgetParams[2])==null?void 0:b.value)+"%",((h=e.widgetObj.widgetParams[3])==null?void 0:h.value)+"%"],top:50,bottom:30,labelLine:{show:!0},padAngle:(r=e.widgetObj.widgetParams[17])==null?void 0:r.value,itemStyle:{borderRadius:(n=e.widgetObj.widgetParams[15])==null?void 0:n.value,borderColor:"#fff",borderWidth:(s=e.widgetObj.widgetParams[16])==null?void 0:s.value},data:ae.value,label:{show:(k=e.widgetObj.widgetParams[13])==null?void 0:k.value,position:(M=e.widgetObj.widgetParams[14])==null?void 0:M.value}};(B=e.widgetObj.widgetParams[18])!=null&&B.value&&(t.roseType="radius"),l.value.series.push(t),$()},ee=()=>{window.addEventListener("resize",J)},te=()=>{window.removeEventListener("resize",J)},J=()=>{I(()=>{j.value&&m.resize()})};de([()=>e.widgetObj,()=>G.value,()=>p.value],()=>{L(),J()},{deep:!0});const ae=W(()=>{var t;return(t=e.widgetObj.widgetParams[0].typeOptions.dataJson)!=null&&t.data?e.widgetObj.widgetParams[0].typeOptions.dataJson.data:e.widgetObj.widgetParams[0].typeOptions.dataJson});return(t,a)=>{var v;const o=w("el-input"),d=w("el-option"),i=w("el-select"),P=w("el-date-picker"),_=w("el-button"),V=w("el-space");return u(),x(S,null,[ue(F("div",be,[K(V,{wrap:""},{default:N(()=>{var b,h;return[(u(!0),x(S,null,T((b=f.widgetObj.widgetParams[0].typeOptions.dataJson)==null?void 0:b.searchData,(r,n)=>(u(),x(S,null,[r.type=="input"?(u(),z(o,{key:n,modelValue:g.value[n],"onUpdate:modelValue":s=>g.value[n]=s,size:"small",placeholder:"请输入"+r.label,clearable:"",onKeyup:A(y,["enter"])},null,8,["modelValue","onUpdate:modelValue","placeholder"])):r.type=="select"?(u(),z(i,{class:"pagesearch",style:{"min-width":"120px"},key:n+"select",modelValue:g.value[n],"onUpdate:modelValue":s=>g.value[n]=s,onChange:y,size:"small",placeholder:"请选择"+r.label,clearable:"",filterable:"",remote:"","remote-method":s=>Q(s,r,n),loading:O.value,onKeyup:A(y,["enter"])},{default:N(()=>[(u(!0),x(S,null,T(r.options,(s,k)=>(u(),z(d,{value:s.value,label:s.label,key:k+s.value},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","remote-method","loading"])):H("",!0)],64))),256)),(h=f.widgetObj.widgetParams[19])!=null&&h.value?(u(),z(P,{key:0,modelValue:D.value,"onUpdate:modelValue":a[0]||(a[0]=r=>D.value=r),size:"small","unlink-panels":"",type:"monthrange","range-separator":"至","start-placeholder":"起始年月","end-placeholder":"结束年月",format:"YYYY-MM","value-format":"YYYY-MM"},null,8,["modelValue"])):H("",!0),K(_,{icon:ge(we),size:"small",loading:R.value,circle:"",onClick:y},null,8,["icon","loading"])]}),_:1})],512),[[ce,(v=f.widgetObj.widgetParams[1])==null?void 0:v.value]]),F("div",{ref_key:"chartRef",ref:j,style:pe([{width:"100%"},{height:X.value}])},null,4)],64)}}},ye=le(he,[["__scopeId","data-v-10269803"]]);export{ye as default};
