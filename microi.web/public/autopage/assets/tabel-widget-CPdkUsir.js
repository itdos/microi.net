import{_ as ae,b as s,d as l,l as d,N as re,j as y,g as x,M as se,z as Z,A as B,e as p,F as k,k as S,p as U,r as P,c as de,o as ie,y as ue,f as ce,v as me,h as K,m as ee,q as ge,t as we,x as be}from"./index-CXgNbF0w.js";import{u as pe,g as ye}from"./useWidget-mapG2dm_.js";const ve={key:3,style:{"margin-left":"5px"}},he={__name:"RecursiveTableColumn",props:{column:{type:Object,required:!0},widgetObj:{type:Object,required:!0}},setup(e){return(M,Y)=>{const r=s("el-tag"),v=s("el-progress"),_=s("el-rate"),C=s("recursive-table-column",!0),w=s("el-table-column");return l(),d(w,{prop:e.column.prop,label:e.column.label,width:e.column.width,align:e.column.align},re({default:y(()=>[e.column.children?(l(!0),p(k,{key:0},S(e.column.children,(t,c)=>(l(),d(C,{key:c,column:t,"widget-obj":e.widgetObj},null,8,["column","widget-obj"]))),128)):U("",!0)]),_:2},[e.column.children?void 0:{name:"header",fn:y(t=>[x("div",null,[(l(),d(se(e.column.icon),{class:"icons"})),Z(" "+B(t.column.label),1)])]),key:"0"},e.column.children?void 0:{name:"default",fn:y(t=>{var c;return[x("div",null,[e.column.status_ui&&t.row.status_ui?(l(),d(r,{key:0,type:t.row.status_ui},{default:y(()=>[Z(B(t.row[e.column.prop]),1)]),_:2},1032,["type"])):e.column.progress_ui&&t.row.progress_ui?(l(),d(v,{key:1,"text-inside":!0,"stroke-width":(c=e.widgetObj.widgetParams[5])==null?void 0:c.value,status:t.row.progress_ui,percentage:t.row[e.column.prop]},null,8,["stroke-width","status","percentage"])):e.column.rate_ui?(l(),d(_,{key:2,"allow-half":"",disabled:"","show-score":"",modelValue:t.row[e.column.prop],"onUpdate:modelValue":h=>t.row[e.column.prop]=h},null,8,["modelValue","onUpdate:modelValue"])):(l(),p("span",ve,B(t.row[e.column.prop]),1))])]}),key:"1"}]),1032,["prop","label","width","align"])}}},fe=ae(he,[["__scopeId","data-v-ea4e1344"]]),Oe={class:"date-range"},je={style:{"margin-top":"12px",display:"flex","justify-content":"flex-end"}},Pe={__name:"tabel-widget",props:{widgetObj:{type:Object,required:!0}},async setup(e){let M,Y;const r=e,v=P(!1);P([]);const _=async(n,a,i)=>{if(n&&a.optionUrl){v.value=!0;let V={};try{const o=await ye(a.optionUrl+n,V);o&&o.length>0&&(r.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[i].options=o),v.value=!1}catch(o){console.error("Error fetching data:",o)}finally{v.value=!1}}},C=de(()=>{var a;let n=10;return r.widgetObj.widgetParams[7]&&(n=(a=r.widgetObj.widgetParams[7])==null?void 0:a.value),n}),w=P(1),t=P({});ie(()=>{r.widgetObj.widgetParams[0].typeOptions.dataJson.searchData.forEach((n,a)=>{t.value[a]=n.value})});const c=async()=>{const n={...t.value};for(const[a,i]of Object.entries(n))r.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[a]&&(r.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[a].value=i);await T()},h=async n=>{w.value=1,await c()},te=async n=>{w.value=1,await c()},le=async n=>{await c()},q=[];q.value=r.widgetObj.widgetParams[0].typeOptions.dataJson.bodyData;const R=P(),E=P(!1),{loadRemoteData:T}=pe(r.widgetObj,q.value,R,E,w);[M,Y]=ue(()=>T()),await M,Y();const A=n=>n.map(a=>a.children?{...a,children:A(a.children)}:a),ne=({row:n,column:a,rowIndex:i,columnIndex:V})=>{var z;let o=(z=r.widgetObj.widgetParams[6])==null?void 0:z.value;if(!o)return{rowspan:1,colspan:1};let f=r.widgetObj.widgetParams[0].typeOptions.dataJson.bodyData,N=r.widgetObj.widgetParams[0].typeOptions.dataJson.headerData.findIndex(O=>O.prop==o);if(V===N){const O=f[i-1];if(f[i+1],O&&O[o]===n[o])return{rowspan:0,colspan:0};let D=1;for(let j=i+1;j<f.length&&f[j][o]===n[o];j++)D++;return{rowspan:D,colspan:1}}};return(n,a)=>{var D,j,I,L,W,$,G,H,Q,X;const i=s("el-input"),V=s("el-option"),o=s("el-select"),f=s("el-date-picker"),F=s("el-button"),N=s("el-space"),z=s("el-table"),O=s("el-pagination");return l(),p(k,null,[ce(x("div",Oe,[K(N,{wrap:""},{default:y(()=>{var m,J;return[(l(!0),p(k,null,S((m=e.widgetObj.widgetParams[0].typeOptions.dataJson)==null?void 0:m.searchData,(g,b)=>(l(),p(k,null,[g.type=="input"?(l(),d(i,{key:b,modelValue:t.value[b],"onUpdate:modelValue":u=>t.value[b]=u,size:"small",placeholder:"请输入"+g.label,clearable:"",onKeyup:ee(h,["enter"])},null,8,["modelValue","onUpdate:modelValue","placeholder"])):g.type=="select"?(l(),d(o,{class:"pagesearch",style:{"min-width":"120px"},key:b+"select",modelValue:t.value[b],"onUpdate:modelValue":u=>t.value[b]=u,onChange:h,size:"small",placeholder:"请选择"+g.label,clearable:"",filterable:"",remote:"","remote-method":u=>_(u,g,b),loading:v.value,onKeyup:ee(h,["enter"])},{default:y(()=>[(l(!0),p(k,null,S(g.options,(u,oe)=>(l(),d(V,{value:u.value,label:u.label,key:oe+u.value},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","remote-method","loading"])):U("",!0)],64))),256)),(J=e.widgetObj.widgetParams[13])!=null&&J.value?(l(),d(f,{key:0,modelValue:R.value,"onUpdate:modelValue":a[0]||(a[0]=g=>R.value=g),size:"small","unlink-panels":"",type:"monthrange","range-separator":"至","start-placeholder":"起始年月","end-placeholder":"结束年月",format:"YYYY-MM","value-format":"YYYY-MM"},null,8,["modelValue"])):U("",!0),K(F,{icon:ge(we),size:"small",loading:E.value,circle:"",onClick:h},null,8,["icon","loading"])]}),_:1})],512),[[me,(D=e.widgetObj.widgetParams[1])==null?void 0:D.value]]),K(z,{data:e.widgetObj.widgetParams[0].typeOptions.dataJson.bodyData,stripe:(j=e.widgetObj.widgetParams[2])==null?void 0:j.value,border:(I=e.widgetObj.widgetParams[3])==null?void 0:I.value,size:(L=e.widgetObj.widgetParams[4])==null?void 0:L.value,"span-method":ne,"show-summary":(W=e.widgetObj.widgetParams[8])==null?void 0:W.value,style:be({"--el-table-border-color":($=e.widgetObj.widgetParams[9])==null?void 0:$.value}),"header-cell-style":{background:(G=e.widgetObj.widgetParams[10])==null?void 0:G.value,color:(H=e.widgetObj.widgetParams[11])==null?void 0:H.value},"cell-style":{color:(Q=e.widgetObj.widgetParams[12])==null?void 0:Q.value}},{default:y(()=>[(l(!0),p(k,null,S(A(e.widgetObj.widgetParams[0].typeOptions.dataJson.headerData),(m,J)=>(l(),d(fe,{key:J,column:m,"widget-obj":e.widgetObj},null,8,["column","widget-obj"]))),128))]),_:1},8,["data","stripe","border","size","show-summary","style","header-cell-style","cell-style"]),x("div",je,[e.widgetObj.widgetParams[7]&&((X=e.widgetObj.widgetParams[7])==null?void 0:X.value)!=-1?(l(),d(O,{key:0,layout:"prev, pager, next",background:"",size:"small","hide-on-single-page":!1,total:e.widgetObj.widgetParams[0].typeOptions.dataJson.total,"current-page":w.value,"onUpdate:currentPage":a[1]||(a[1]=m=>w.value=m),"page-size":C.value,"onUpdate:pageSize":a[2]||(a[2]=m=>C.value=m),onSizeChange:te,onCurrentChange:le},null,8,["total","current-page","page-size"])):U("",!0)])],64)}}},De=ae(Pe,[["__scopeId","data-v-83de9041"]]);export{De as default};
