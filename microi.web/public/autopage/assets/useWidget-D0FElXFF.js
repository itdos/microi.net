import{g as y}from"./axiosInstance-Bx4QMvBM.js";import{u as h,s as x,b as J,r as c,J as L}from"./index-BkXWi8RI.js";const I=h(),{formData:u}=x(I);function S(e,n,f=c(),m=c(!1),l=c(-1)){const d=a=>{let t=e.widgetOption.wrapperNumber,i=e.widgetOption.number,o=u.value.JsonObj.wrapperList.findIndex(r=>r.wrapperOption.number===t);if(o!==-1){let r=u.value.JsonObj.wrapperList[o].widgetList.findIndex(p=>p.widgetOption.number===i);r!==-1&&(u.value.JsonObj.wrapperList[o].widgetList[r].widgetParams[0].typeOptions.dataJson=a)}},w=async()=>{var t,i,o,r,p,g;let a={};if(f.value&&(a.start=f.value[0],a.end=f.value[1]),l.value!==-1&&((t=e.widgetParams[7])==null?void 0:t.value)!==-1&&(a.currentPage=l.value,a.pageSize=(i=e.widgetParams[7])==null?void 0:i.value),e.widgetParams[0].typeOptions.dataJson.searchData&&((o=e.widgetParams[0].typeOptions.dataJson.searchData)==null||o.forEach(s=>{a[s.prop]=s.value})),e.widgetParams[0].value){console.log("请求地址",e.widgetParams[0].value),console.log("请求参数",a),m.value=!0;const s=await y(e.widgetParams[0].value,a);try{(s instanceof Object||s instanceof Array)&&d(s),m.value=!1}catch(v){m.value=!1,console.log(v)}}else if(n&&l.value!==-1&&e.widgetParams[7]&&((r=e.widgetParams[7])==null?void 0:r.value)!==-1){let s=(l.value-1)*((p=e.widgetParams[7])==null?void 0:p.value),v=s+((g=e.widgetParams[7])==null?void 0:g.value);e.widgetParams[0].typeOptions.dataJson.bodyData&&(e.widgetParams[0].typeOptions.dataJson.bodyData=n==null?void 0:n.slice(s,v))}},P=L(async()=>{await w()},1e3);return J(()=>e.widgetParams[0].value,async(a,t)=>{a!==t&&P()},{deep:!0}),J(()=>u.value.JsonObj.formConfig.lastRefreshTime,async(a,t)=>{a!==t&&P()},{deep:!1}),{loadRemoteData:w,setResponse:d}}export{S as u};
