import{_ as le,u as oe,s as se,r as g,c as re,o as ie,a as ne,n as F,i as de,w as ue,b as v,d as n,e as j,f as ce,v as ge,g as I,h as K,j as N,F as P,k as T,l as _,m as G,p as H,q as ve,t as we,x as pe}from"./index-e3nHg57k.js";import{u as me,g as be}from"./useWidget-R-djxtlI.js";const he={class:"date-range"},fe={__name:"bar-widget",props:{widgetObj:{type:Object,required:!0}},setup(b){var Y,C,E,D,M;const q=oe(),{curWrapper:Q,dark:r}=se(q),e=b,h=g(!1);g([]);const X=async(i,o,d)=>{if(i&&o.optionUrl){h.value=!0;let u={};try{const s=await be(o.optionUrl+i,u);s&&s.length>0&&(e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[d].options=s),h.value=!1}catch(s){console.error("Error fetching data:",s)}finally{h.value=!1}}},k=g(),L=g(!1),{loadRemoteData:z}=me(e.widgetObj,e.widgetObj.widgetParams[0].typeOptions.dataJson,k,L),V=async()=>{console.log("重新加载了数据"),await z(),U()},f=g(null);let w=null;const Z=re(()=>{var o;let i=(o=e.widgetObj.widgetParams[1])!=null&&o.value?40:0;return e.widgetObj.widgetOption.height-i+"px"}),a=g({});a.value={title:{show:!0,text:"",subtext:"",textStyle:{color:r.value?"#999":"#333",fontStyle:"normal",fontWeight:"bolder",fontFamily:"sans-serif",fontSize:18}},tooltip:{trigger:"axis",show:!0,axisPointer:{type:(Y=e.widgetObj.widgetParams[3])==null?void 0:Y.value,label:{backgroundColor:"#6a7985"}}},legend:{show:!0,type:"scroll",textStyle:{color:r.value?"#999":"#333"},data:[],orient:(C=e.widgetObj.widgetParams[8])==null?void 0:C.value,left:(E=e.widgetObj.widgetParams[9])==null?void 0:E.value},grid:{show:!1,left:"10%",right:"4%",bottom:"30px",containLabel:!1},toolbox:{show:!0,feature:{dataView:{readOnly:!1},restore:{},saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!0,axisTick:{alignWithLabel:!0},axisLabel:{color:r.value?"#999":"#333"},data:[]},yAxis:{type:"value",splitLine:{show:(D=e.widgetObj.widgetParams[15])==null?void 0:D.value},axisLabel:{formatter:"{value} "+((M=e.widgetObj.widgetParams[4])==null?void 0:M.value),color:r.value?"#999":"#333"}},series:[]},ie(()=>{$(),window.addEventListener("resize",S)}),ne(()=>{window.removeEventListener("resize",S)});const $=async()=>{await z(),A()},A=()=>{F(()=>{w&&w.dispose(),f.value&&(w=de(f.value),U())})},ee=()=>{w.setOption(a.value)},U=()=>{var i,o,d,u,s,y,O,x,p,m,t,c;a.value.title.textStyle.color=r.value?"#999":"#333",a.value.legend.textStyle.color=r.value?"#999":"#333",a.value.xAxis.axisLabel.color=r.value?"#999":"#333",a.value.yAxis.axisLabel.color=r.value?"#999":"#333",a.value.tooltip.axisPointer.type=(i=e.widgetObj.widgetParams[3])==null?void 0:i.value,a.value.legend.orient=(o=e.widgetObj.widgetParams[8])==null?void 0:o.value,a.value.legend.left=(d=e.widgetObj.widgetParams[9])==null?void 0:d.value,a.value.title.text=(u=e.widgetObj.widgetParams[5])==null?void 0:u.value,a.value.title.subtext=(s=e.widgetObj.widgetParams[6])==null?void 0:s.value,a.value.legend.show=(y=e.widgetObj.widgetParams[7])==null?void 0:y.value,a.value.tooltip.show=(O=e.widgetObj.widgetParams[10])==null?void 0:O.value,a.value.tooltip.trigger=(x=e.widgetObj.widgetParams[11])==null?void 0:x.value,a.value.toolbox.show=(p=e.widgetObj.widgetParams[12])==null?void 0:p.value,a.value.xAxis.data=e.widgetObj.widgetParams[0].typeOptions.dataJson.xAxis,a.value.xAxis.boundaryGap=(m=e.widgetObj.widgetParams[2])==null?void 0:m.value,a.value.yAxis.splitLine.show=(t=e.widgetObj.widgetParams[15])==null?void 0:t.value,a.value.series=[],a.value.legend.data=[],(c=e.widgetObj.widgetParams[0].typeOptions.dataJson.series)==null||c.forEach((l,R)=>{var B,J;const ae={type:"bar",name:l.name,data:l.data,tooltip:{valueFormatter:function(te){var W;return te+" "+((W=e.widgetObj.widgetParams[4])==null?void 0:W.value)}},label:{show:(B=e.widgetObj.widgetParams[13])==null?void 0:B.value,position:(J=e.widgetObj.widgetParams[14])==null?void 0:J.value}};a.value.series.push(ae),a.value.legend.data.push(l.name)}),ee()},S=()=>{F(()=>{f.value&&w.resize()})};return ue([()=>e.widgetObj,()=>Q.value,()=>r.value],()=>{A(),S()},{deep:!0}),(i,o)=>{var p;const d=v("el-input"),u=v("el-option"),s=v("el-select"),y=v("el-date-picker"),O=v("el-button"),x=v("el-space");return n(),j(P,null,[ce(I("div",he,[K(x,{wrap:""},{default:N(()=>{var m;return[(n(!0),j(P,null,T(b.widgetObj.widgetParams[0].typeOptions.dataJson.searchData,(t,c)=>(n(),j(P,null,[t.type=="input"?(n(),_(d,{key:c,modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,size:"small",placeholder:"请输入"+t.label,clearable:"",onKeyup:G(V,["enter"])},null,8,["modelValue","onUpdate:modelValue","placeholder"])):t.type=="select"?(n(),_(s,{class:"pagesearch",style:{"min-width":"120px"},key:c+"select",modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,size:"small",placeholder:"请选择"+t.label,clearable:"",filterable:"",remote:"","remote-method":l=>X(l,t,c),loading:h.value,onKeyup:G(V,["enter"])},{default:N(()=>[(n(!0),j(P,null,T(t.options,(l,R)=>(n(),_(u,{value:l.value,label:l.label,key:R+l.value},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","remote-method","loading"])):H("",!0)],64))),256)),(m=b.widgetObj.widgetParams[16])!=null&&m.value?(n(),_(y,{key:0,modelValue:k.value,"onUpdate:modelValue":o[0]||(o[0]=t=>k.value=t),size:"small","unlink-panels":"",type:"monthrange","range-separator":"至","start-placeholder":"起始年月","end-placeholder":"结束年月",format:"YYYY-MM","value-format":"YYYY-MM"},null,8,["modelValue"])):H("",!0),K(O,{icon:ve(we),size:"small",loading:L.value,circle:"",onClick:V},null,8,["icon","loading"])]}),_:1})],512),[[ge,(p=b.widgetObj.widgetParams[1])==null?void 0:p.value]]),I("div",{ref_key:"chartRef",ref:f,style:pe([{width:"100%"},{height:Z.value}])},null,4)],64)}}},xe=le(fe,[["__scopeId","data-v-e37746f6"]]);export{xe as default};
