import{_ as le,u as se,s as oe,r as c,c as W,o as re,a as ie,n as I,i as ne,w as de,b as w,d as u,e as x,f as ue,v as ce,g as F,h as K,j as N,F as S,k as T,l as z,m as A,p as H,q as ge,t as we,x as pe}from"./index-CXgNbF0w.js";import{u as me,g as ve}from"./useWidget-mapG2dm_.js";const be={class:"date-range"},he={__name:"pie-widget",props:{widgetObj:{type:Object,required:!0}},setup(f){var Y,E;const q=se(),{curWrapper:G,dark:p}=oe(q),e=f,O=c(!1);c([]);const Q=async(l,t,n)=>{if(l&&t.optionUrl){O.value=!0;let d={};try{const r=await ve(t.optionUrl+l,d);r&&r.length>0&&(e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[n].options=r),O.value=!1}catch(r){console.error("Error fetching data:",r)}finally{O.value=!1}}},D=c(),R=c(!1),{loadRemoteData:C}=me(e.widgetObj,e.widgetObj.widgetParams[0].typeOptions.dataJson,D,R),g=c({}),y=async l=>{const t={...g.value};for(const[n,d]of Object.entries(t))e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[n]&&(e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[n].value=d);await C(),U()},j=c(null);let m=null;const X=W(()=>{var t;let l=(t=e.widgetObj.widgetParams[1])!=null&&t.value?40:0;return e.widgetObj.widgetOption.height-l+"px"}),a=c({});a.value={title:{show:!0,text:"",subtext:"",textStyle:{color:p.value?"#999":"#333",fontStyle:"normal",fontWeight:"bolder",fontFamily:"sans-serif",fontSize:18}},tooltip:{trigger:"item",show:!0},legend:{show:!0,type:"scroll",textStyle:{color:p.value?"#fff":"#333"},orient:(Y=e.widgetObj.widgetParams[8])==null?void 0:Y.value,left:(E=e.widgetObj.widgetParams[9])==null?void 0:E.value},grid:{show:!1,left:"6%",right:"4%",bottom:"30px",containLabel:!1},toolbox:{show:!0,feature:{dataView:{readOnly:!1},restore:{},saveAsImage:{}}},series:[]},re(()=>{e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData.forEach((l,t)=>{g.value[t]=l.value}),Z(),ee()}),ie(()=>{te()});const Z=async()=>{await C(),L()},L=()=>{I(()=>{m&&m.dispose(),j.value&&(m=ne(j.value),U())})},$=()=>{m.setOption(a.value)},U=()=>{var t,n,d,r,P,_,V,v,b,h,o,i,s,k,M,B;a.value.title.textStyle.color=p.value?"#999":"#333",a.value.legend.textStyle.color=p.value?"#999":"#333",a.value.legend.orient=(t=e.widgetObj.widgetParams[8])==null?void 0:t.value,a.value.legend.left=(n=e.widgetObj.widgetParams[9])==null?void 0:n.value,a.value.title.text=(d=e.widgetObj.widgetParams[5])==null?void 0:d.value,a.value.title.subtext=(r=e.widgetObj.widgetParams[6])==null?void 0:r.value,a.value.legend.show=(P=e.widgetObj.widgetParams[7])==null?void 0:P.value,a.value.tooltip.show=(_=e.widgetObj.widgetParams[10])==null?void 0:_.value,a.value.tooltip.trigger=(V=e.widgetObj.widgetParams[11])==null?void 0:V.value,a.value.toolbox.show=(v=e.widgetObj.widgetParams[12])==null?void 0:v.value,a.value.series=[];const l={type:"pie",radius:[((b=e.widgetObj.widgetParams[2])==null?void 0:b.value)+"%",((h=e.widgetObj.widgetParams[3])==null?void 0:h.value)+"%"],top:50,bottom:30,labelLine:{show:!0},padAngle:(o=e.widgetObj.widgetParams[17])==null?void 0:o.value,itemStyle:{borderRadius:(i=e.widgetObj.widgetParams[15])==null?void 0:i.value,borderColor:"#fff",borderWidth:(s=e.widgetObj.widgetParams[16])==null?void 0:s.value},data:ae.value,label:{show:(k=e.widgetObj.widgetParams[13])==null?void 0:k.value,position:(M=e.widgetObj.widgetParams[14])==null?void 0:M.value}};(B=e.widgetObj.widgetParams[18])!=null&&B.value&&(l.roseType="radius"),a.value.series.push(l),$()},ee=()=>{window.addEventListener("resize",J)},te=()=>{window.removeEventListener("resize",J)},J=()=>{I(()=>{j.value&&m.resize()})};de([()=>e.widgetObj,()=>G.value,()=>p.value],()=>{L(),J()},{deep:!0});const ae=W(()=>{var l;return(l=e.widgetObj.widgetParams[0].typeOptions.dataJson)!=null&&l.data?e.widgetObj.widgetParams[0].typeOptions.dataJson.data:e.widgetObj.widgetParams[0].typeOptions.dataJson});return(l,t)=>{var v;const n=w("el-input"),d=w("el-option"),r=w("el-select"),P=w("el-date-picker"),_=w("el-button"),V=w("el-space");return u(),x(S,null,[ue(F("div",be,[K(V,{wrap:""},{default:N(()=>{var b,h;return[(u(!0),x(S,null,T((b=f.widgetObj.widgetParams[0].typeOptions.dataJson)==null?void 0:b.searchData,(o,i)=>(u(),x(S,null,[o.type=="input"?(u(),z(n,{key:i,modelValue:g.value[i],"onUpdate:modelValue":s=>g.value[i]=s,size:"small",placeholder:"请输入"+o.label,clearable:"",onKeyup:A(y,["enter"])},null,8,["modelValue","onUpdate:modelValue","placeholder"])):o.type=="select"?(u(),z(r,{class:"pagesearch",style:{"min-width":"120px"},key:i+"select",modelValue:g.value[i],"onUpdate:modelValue":s=>g.value[i]=s,onChange:y,size:"small",placeholder:"请选择"+o.label,clearable:"",filterable:"",remote:"","remote-method":s=>Q(s,o,i),loading:O.value,onKeyup:A(y,["enter"])},{default:N(()=>[(u(!0),x(S,null,T(o.options,(s,k)=>(u(),z(d,{value:s.value,label:s.label,key:k+s.value},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","remote-method","loading"])):H("",!0)],64))),256)),(h=f.widgetObj.widgetParams[19])!=null&&h.value?(u(),z(P,{key:0,modelValue:D.value,"onUpdate:modelValue":t[0]||(t[0]=o=>D.value=o),size:"small","unlink-panels":"",type:"monthrange","range-separator":"至","start-placeholder":"起始年月","end-placeholder":"结束年月",format:"YYYY-MM","value-format":"YYYY-MM"},null,8,["modelValue"])):H("",!0),K(_,{icon:ge(we),size:"small",loading:R.value,circle:"",onClick:y},null,8,["icon","loading"])]}),_:1})],512),[[ce,(v=f.widgetObj.widgetParams[1])==null?void 0:v.value]]),F("div",{ref_key:"chartRef",ref:j,style:pe([{width:"100%"},{height:X.value}])},null,4)],64)}}},ye=le(he,[["__scopeId","data-v-93043e87"]]);export{ye as default};
