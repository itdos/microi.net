import{_ as ve,u as we,s as pe,r as g,c as me,o as be,a as he,n as X,i as ye,w as fe,b as p,d as c,e as V,f as Oe,v as xe,g as Z,h as $,j as ee,F as S,k as ae,l as A,m as te,p as le,q as je,t as Pe,x as _e}from"./index-CXgNbF0w.js";import{u as Le,g as ke}from"./useWidget-mapG2dm_.js";const Ve={class:"date-range"},Se={__name:"linebar-widget",props:{widgetObj:{type:Object,required:!0}},setup(f){var U,Y,M,B,I,W,F;const se=we(),{curWrapper:oe,dark:s}=pe(se),e=f,O=g(!1);g([]);const ie=async(o,t,d)=>{if(o&&t.optionUrl){O.value=!0;let u={};try{const r=await ke(t.optionUrl+o,u);r&&r.length>0&&(e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[d].options=r),O.value=!1}catch(r){console.error("Error fetching data:",r)}finally{O.value=!1}}},z=g(),C=g(!1),{loadRemoteData:E}=Le(e.widgetObj,(U=e.widgetObj.widgetParams[0])==null?void 0:U.typeOptions.dataJson,z,C),v=g({}),x=async o=>{const t={...v.value};for(const[d,u]of Object.entries(t))e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[d]&&(e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[d].value=u);await E(),R()},j=g(null);let m=null;const re=me(()=>{var t;let o=(t=e.widgetObj.widgetParams[1])!=null&&t.value?40:0;return e.widgetObj.widgetOption.height-o+"px"}),a=g({});a.value={title:{show:!0,text:"",subtext:"",textStyle:{color:s.value?"#999":"#333",fontStyle:"normal",fontWeight:"bolder",fontFamily:"sans-serif",fontSize:18}},tooltip:{trigger:"axis",show:!0,axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{show:!0,type:"scroll",textStyle:{color:s.value?"#999":"#333"},data:[],orient:(Y=e.widgetObj.widgetParams[8])==null?void 0:Y.value,left:(M=e.widgetObj.widgetParams[9])==null?void 0:M.value},grid:{show:!1,left:"10%",right:"8%",bottom:"30px",containLabel:!1},toolbox:{show:!0,feature:{dataView:{readOnly:!1},restore:{},saveAsImage:{}}},xAxis:[{type:"category",boundaryGap:!0,axisTick:{alignWithLabel:!0},axisLabel:{color:s.value?"#999":"#333"},data:[]}],yAxis:[{type:"value",splitLine:{show:(B=e.widgetObj.widgetParams[16])==null?void 0:B.value,lineStyle:{color:["#ccc"],width:1,type:"solid"}},axisLabel:{formatter:"{value} "+((I=e.widgetObj.widgetParams[3])==null?void 0:I.value),color:s.value?"#999":"#333"}},{type:"value",splitLine:{show:(W=e.widgetObj.widgetParams[17])==null?void 0:W.value,lineStyle:{color:["#ccc"],width:1,type:"dashed"}},axisLabel:{formatter:"{value} "+((F=e.widgetObj.widgetParams[4])==null?void 0:F.value),color:s.value?"#999":"#333"}}],series:[]},be(()=>{e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData.forEach((o,t)=>{v.value[t]=o.value}),ne(),ue()}),he(()=>{ce()});const ne=async()=>{await E(),J()},J=()=>{X(()=>{m&&m.dispose(),j.value&&(m=ye(j.value),R())})},de=()=>{m.setOption(a.value)},R=()=>{var o,t,d,u,r,P,_,L,b,h,y,i,n,l,k,K,N,T,G;a.value.title.textStyle.color=s.value?"#999":"#333",a.value.legend.textStyle.color=s.value?"#999":"#333",a.value.legend.orient=(o=e.widgetObj.widgetParams[8])==null?void 0:o.value,a.value.legend.left=(t=e.widgetObj.widgetParams[9])==null?void 0:t.value,a.value.title.text=(d=e.widgetObj.widgetParams[5])==null?void 0:d.value,a.value.title.subtext=(u=e.widgetObj.widgetParams[6])==null?void 0:u.value,a.value.legend.show=(r=e.widgetObj.widgetParams[7])==null?void 0:r.value,a.value.tooltip.show=(P=e.widgetObj.widgetParams[10])==null?void 0:P.value,a.value.tooltip.trigger=(_=e.widgetObj.widgetParams[11])==null?void 0:_.value,a.value.toolbox.show=(L=e.widgetObj.widgetParams[13])==null?void 0:L.value,a.value.xAxis[0].data=(b=e.widgetObj.widgetParams[0])==null?void 0:b.typeOptions.dataJson.xAxis,a.value.xAxis[0].boundaryGap=(h=e.widgetObj.widgetParams[2])==null?void 0:h.value,a.value.xAxis[0].axisLabel.color=s.value?"#999":"#333",a.value.yAxis[0].axisLabel.color=s.value?"#999":"#333",a.value.yAxis[1].axisLabel.color=s.value?"#999":"#333",a.value.yAxis[0].axisLabel.formatter="{value} "+((y=e.widgetObj.widgetParams[3])==null?void 0:y.value),a.value.yAxis[1].axisLabel.formatter="{value} "+((i=e.widgetObj.widgetParams[4])==null?void 0:i.value),a.value.yAxis[0].splitLine.show=(l=(n=e.widgetObj)==null?void 0:n.widgetParams[16])==null?void 0:l.value,a.value.yAxis[1].splitLine.show=(K=(k=e.widgetObj)==null?void 0:k.widgetParams[17])==null?void 0:K.value,a.value.series=[],a.value.legend.data=[],(G=(T=(N=e.widgetObj.widgetParams[0])==null?void 0:N.typeOptions.dataJson)==null?void 0:T.series)==null||G.forEach((w,Ae)=>{var q,Q;const H={type:w.type,name:w.name,data:w.data,tooltip:{valueFormatter:function(ge){return ge+" "+w.unit}},label:{show:(q=e.widgetObj.widgetParams[14])==null?void 0:q.value,position:(Q=e.widgetObj.widgetParams[15])==null?void 0:Q.value}};w.type=="line"&&(H.yAxisIndex=1),a.value.series.push(H),a.value.legend.data.push(w.name)}),de()},ue=()=>{window.addEventListener("resize",D)},ce=()=>{window.removeEventListener("resize",D)},D=()=>{X(()=>{j.value&&m.resize()})};return fe([()=>e.widgetObj,()=>oe.value,()=>s.value],()=>{J(),D()},{deep:!0}),(o,t)=>{var b;const d=p("el-input"),u=p("el-option"),r=p("el-select"),P=p("el-date-picker"),_=p("el-button"),L=p("el-space");return c(),V(S,null,[Oe(Z("div",Ve,[$(L,{wrap:""},{default:ee(()=>{var h,y;return[(c(!0),V(S,null,ae((h=f.widgetObj.widgetParams[0].typeOptions.dataJson)==null?void 0:h.searchData,(i,n)=>(c(),V(S,null,[i.type=="input"?(c(),A(d,{key:n,modelValue:v.value[n],"onUpdate:modelValue":l=>v.value[n]=l,size:"small",placeholder:"请输入"+i.label,clearable:"",onKeyup:te(x,["enter"])},null,8,["modelValue","onUpdate:modelValue","placeholder"])):i.type=="select"?(c(),A(r,{class:"pagesearch",style:{"min-width":"120px"},key:n+"select",modelValue:v.value[n],"onUpdate:modelValue":l=>v.value[n]=l,onChange:x,size:"small",placeholder:"请选择"+i.label,clearable:"",filterable:"",remote:"","remote-method":l=>ie(l,i,n),loading:O.value,onKeyup:te(x,["enter"])},{default:ee(()=>[(c(!0),V(S,null,ae(i.options,(l,k)=>(c(),A(u,{value:l.value,label:l.label,key:k+l.value},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","remote-method","loading"])):le("",!0)],64))),256)),(y=f.widgetObj.widgetParams[18])!=null&&y.value?(c(),A(P,{key:0,modelValue:z.value,"onUpdate:modelValue":t[0]||(t[0]=i=>z.value=i),size:"small","unlink-panels":"",type:"monthrange","range-separator":"至","start-placeholder":"起始年月","end-placeholder":"结束年月",format:"YYYY-MM","value-format":"YYYY-MM"},null,8,["modelValue"])):le("",!0),$(_,{icon:je(Pe),size:"small",loading:C.value,circle:"",onClick:x},null,8,["icon","loading"])]}),_:1})],512),[[xe,(b=f.widgetObj.widgetParams[1])==null?void 0:b.value]]),Z("div",{ref_key:"chartRef",ref:j,style:_e([{width:"100%"},{height:re.value}])},null,4)],64)}}},Ce=ve(Se,[["__scopeId","data-v-0e559f5a"]]);export{Ce as default};
