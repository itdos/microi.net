import{_ as le,c as r,d as t,p as d,L as re,h as b,f as x,J as se,i as ae,y as q,e as p,F as h,z,A as U,r as k,l as de,a as ie,w as ue,t as ce,v as me,g as E,M as te,x as ge,N as we,q as be}from"./index-Cd0LJEJn.js";import{u as pe,g as ye}from"./useWidget-gUdKlkzY.js";const ve={key:3,style:{"margin-left":"5px"}},he={__name:"RecursiveTableColumn",props:{column:{type:Object,required:!0},widgetObj:{type:Object,required:!0}},setup(e){return(M,Y)=>{const s=r("el-tag"),f=r("el-space"),R=r("el-progress"),J=r("el-rate"),y=r("recursive-table-column",!0),g=r("el-table-column");return t(),d(g,{prop:e.column.prop,label:e.column.label,width:e.column.width,align:e.column.align},re({default:b(()=>[e.column.children?(t(!0),p(h,{key:0},z(e.column.children,(n,u)=>(t(),d(y,{key:u,column:n,"widget-obj":e.widgetObj},null,8,["column","widget-obj"]))),128)):U("",!0)]),_:2},[e.column.children?void 0:{name:"header",fn:b(n=>[x("div",null,[(t(),d(se(e.column.icon),{class:"icons"})),ae(" "+q(n.column.label),1)])]),key:"0"},e.column.children?void 0:{name:"default",fn:b(n=>{var u;return[x("div",null,[e.column.status_ui&&n.row.status_ui?(t(),d(f,{key:0},{default:b(()=>[(t(!0),p(h,null,z(n.row[e.column.prop].split(","),(V,N)=>(t(),d(s,{key:N,type:n.row.status_ui},{default:b(()=>[ae(q(V),1)]),_:2},1032,["type"]))),128))]),_:2},1024)):e.column.progress_ui&&n.row.progress_ui?(t(),d(R,{key:1,"text-inside":!0,"stroke-width":(u=e.widgetObj.widgetParams[5])==null?void 0:u.value,status:n.row.progress_ui,percentage:n.row[e.column.prop]},null,8,["stroke-width","status","percentage"])):e.column.rate_ui?(t(),d(J,{key:2,"allow-half":"",disabled:"","show-score":"",modelValue:n.row[e.column.prop],"onUpdate:modelValue":V=>n.row[e.column.prop]=V},null,8,["modelValue","onUpdate:modelValue"])):(t(),p("span",ve,q(n.row[e.column.prop]),1))])]}),key:"1"}]),1032,["prop","label","width","align"])}}},fe=le(he,[["__scopeId","data-v-07b2bb73"]]),Oe={class:"date-range"},je={style:{"margin-top":"12px",display:"flex","justify-content":"flex-end"}},Pe={__name:"tabel-widget",props:{widgetObj:{type:Object,required:!0}},async setup(e){let M,Y;const s=e,f=k(!1);k([]);const R=async(l,a,i)=>{if(l&&a.remote&&a.optionUrl){f.value=!0;let D={};try{const o=await ye(a.optionUrl+l,D);o&&o.length>0&&(s.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[i].options=o),f.value=!1}catch(o){console.error("Error fetching data:",o)}finally{f.value=!1}}},J=de(()=>{var a;let l=10;return s.widgetObj.widgetParams[7]&&(l=(a=s.widgetObj.widgetParams[7])==null?void 0:a.value),l}),y=k(1),g=k({});ie(()=>{var l;(l=s.widgetObj.widgetParams[0].typeOptions.dataJson.searchData)==null||l.forEach((a,i)=>{g.value[i]=a.value})});const n=async()=>{const l={...g.value};for(const[a,i]of Object.entries(l))s.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[a]&&(s.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[a].value=i);await A()},u=async l=>{y.value=1,await n()},V=async l=>{y.value=1,await n()},N=async l=>{await n()},L=[];L.value=s.widgetObj.widgetParams[0].typeOptions.dataJson.bodyData;const B=k(),T=k(!1),{loadRemoteData:A}=pe(s.widgetObj,L.value,B,T,y);[M,Y]=ue(()=>A()),await M,Y();const F=l=>l.map(a=>a.children?{...a,children:F(a.children)}:a),ne=({row:l,column:a,rowIndex:i,columnIndex:D})=>{var _;let o=(_=s.widgetObj.widgetParams[6])==null?void 0:_.value;if(!o)return{rowspan:1,colspan:1};let O=s.widgetObj.widgetParams[0].typeOptions.dataJson.bodyData,K=s.widgetObj.widgetParams[0].typeOptions.dataJson.headerData.findIndex(j=>j.prop==o);if(D===K){const j=O[i-1];if(O[i+1],j&&j[o]===l[o])return{rowspan:0,colspan:0};let C=1;for(let P=i+1;P<O.length&&O[P][o]===l[o];P++)C++;return{rowspan:C,colspan:1}}};return(l,a)=>{var C,P,W,$,G,H,Q,X,Z,ee;const i=r("el-input"),D=r("el-option"),o=r("el-select"),O=r("el-date-picker"),I=r("el-button"),K=r("el-space"),_=r("el-table"),j=r("el-pagination");return t(),p(h,null,[ce(x("div",Oe,[E(K,{wrap:""},{default:b(()=>{var w,S;return[(t(!0),p(h,null,z((w=e.widgetObj.widgetParams[0].typeOptions.dataJson)==null?void 0:w.searchData,(c,v)=>(t(),p(h,null,[c.type=="input"?(t(),d(i,{key:v,modelValue:g.value[v],"onUpdate:modelValue":m=>g.value[v]=m,size:"small",placeholder:"请输入"+c.label,clearable:"",onKeyup:te(u,["enter"])},null,8,["modelValue","onUpdate:modelValue","placeholder"])):c.type=="select"?(t(),d(o,{class:"pagesearch",style:{"min-width":"120px"},key:v+"select",modelValue:g.value[v],"onUpdate:modelValue":m=>g.value[v]=m,onChange:u,size:"small",placeholder:"请选择"+c.label,clearable:"",filterable:"",remote:c.remote,"remote-method":m=>R(m,c,v),loading:f.value,onKeyup:te(u,["enter"])},{default:b(()=>[(t(!0),p(h,null,z(c.options,(m,oe)=>(t(),d(D,{value:m.value,label:m.label,key:oe+m.value},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","remote","remote-method","loading"])):U("",!0)],64))),256)),(S=e.widgetObj.widgetParams[13])!=null&&S.value?(t(),d(O,{key:0,modelValue:B.value,"onUpdate:modelValue":a[0]||(a[0]=c=>B.value=c),size:"small","unlink-panels":"",type:"monthrange","range-separator":"至","start-placeholder":"起始年月","end-placeholder":"结束年月",format:"YYYY-MM","value-format":"YYYY-MM"},null,8,["modelValue"])):U("",!0),E(I,{icon:ge(we),size:"small",loading:T.value,circle:"",onClick:u},null,8,["icon","loading"])]}),_:1})],512),[[me,(C=e.widgetObj.widgetParams[1])==null?void 0:C.value]]),E(_,{data:e.widgetObj.widgetParams[0].typeOptions.dataJson.bodyData,stripe:(P=e.widgetObj.widgetParams[2])==null?void 0:P.value,border:(W=e.widgetObj.widgetParams[3])==null?void 0:W.value,size:($=e.widgetObj.widgetParams[4])==null?void 0:$.value,"span-method":ne,"show-summary":(G=e.widgetObj.widgetParams[8])==null?void 0:G.value,style:be({"--el-table-border-color":(H=e.widgetObj.widgetParams[9])==null?void 0:H.value}),"header-cell-style":{background:(Q=e.widgetObj.widgetParams[10])==null?void 0:Q.value,color:(X=e.widgetObj.widgetParams[11])==null?void 0:X.value},"cell-style":{color:(Z=e.widgetObj.widgetParams[12])==null?void 0:Z.value}},{default:b(()=>[(t(!0),p(h,null,z(F(e.widgetObj.widgetParams[0].typeOptions.dataJson.headerData),(w,S)=>(t(),d(fe,{key:S,column:w,"widget-obj":e.widgetObj},null,8,["column","widget-obj"]))),128))]),_:1},8,["data","stripe","border","size","show-summary","style","header-cell-style","cell-style"]),x("div",je,[e.widgetObj.widgetParams[7]&&((ee=e.widgetObj.widgetParams[7])==null?void 0:ee.value)!=-1?(t(),d(j,{key:0,layout:"prev, pager, next",background:"",size:"small","hide-on-single-page":!1,total:e.widgetObj.widgetParams[0].typeOptions.dataJson.total,"current-page":y.value,"onUpdate:currentPage":a[1]||(a[1]=w=>y.value=w),"page-size":J.value,"onUpdate:pageSize":a[2]||(a[2]=w=>J.value=w),onSizeChange:V,onCurrentChange:N},null,8,["total","current-page","page-size"])):U("",!0)])],64)}}},De=le(Pe,[["__scopeId","data-v-2702e969"]]);export{De as default};
