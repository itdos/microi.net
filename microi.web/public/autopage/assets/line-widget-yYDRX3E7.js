import{_ as se,u as oe,s as ie,r as g,o as ne,c as re,a as de,n as F,i as ue,w as ce,b as w,d as c,e as V,f as ge,v as ve,g as K,h as N,j as T,F as L,k as G,l as S,m as H,p as q,q as we,t as pe,x as me}from"./index-BVh9aAA9.js";import{u as be,g as he}from"./useWidget-DHPg7DNb.js";const fe={class:"date-range"},ye={__name:"line-widget",props:{widgetObj:{type:Object,required:!0}},setup(f){var R,U,Y;const Q=oe(),{curWrapper:X,dark:d}=ie(Q),e=f,y=g(!1);g([]);const Z=async(l,t,s)=>{if(l&&t.optionUrl){y.value=!0;let u={};try{const n=await he(t.optionUrl+l,u);n&&n.length>0&&(e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[s].options=n),y.value=!1}catch(n){console.error("Error fetching data:",n)}finally{y.value=!1}}},z=g(),D=g(!1),{loadRemoteData:C}=be(e.widgetObj,e.widgetObj.widgetParams[0].typeOptions.dataJson,z,D),v=g({});ne(()=>{var l;(l=e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData)==null||l.forEach((t,s)=>{v.value[s]=t.value}),ee(),te()});const O=async l=>{const t={...v.value};for(const[s,u]of Object.entries(t))e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[s]&&(e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[s].value=u);await C(),J()},j=g(null);let p=null;const $=re(()=>{var t;let l=(t=e.widgetObj.widgetParams[1])!=null&&t.value?40:0;return e.widgetObj.widgetOption.height-l+"px"}),a=g({});a.value={title:{show:!0,text:"",subtext:"",textStyle:{color:d.value?"#fff":"#333",fontStyle:"normal",fontWeight:"bolder",fontFamily:"sans-serif",fontSize:18}},tooltip:{trigger:"axis",show:!0,axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{show:!0,type:"scroll",textStyle:{color:d.value?"#999":"#333"},data:[],orient:(R=e.widgetObj.widgetParams[8])==null?void 0:R.value,left:(U=e.widgetObj.widgetParams[9])==null?void 0:U.value},grid:{show:!1,left:"10%",right:"4%",bottom:"30px",containLabel:!1},toolbox:{show:!0,feature:{dataView:{readOnly:!1},restore:{},saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!0,axisTick:{alignWithLabel:!0},axisLabel:{color:d.value?"#999":"#333"},data:[]},yAxis:{type:"value",splitLine:{show:(Y=e.widgetObj.widgetParams[15])==null?void 0:Y.value},axisLabel:{formatter:"{value}",color:d.value?"#999":"#333"}},series:[]},de(()=>{le()});const ee=async()=>{await C(),E()},E=()=>{F(()=>{p&&p.dispose(),j.value&&(p=ue(j.value),J())})},ae=()=>{p.setOption(a.value)},J=()=>{var l,t,s,u,n,x,P,_,m,b,h,o;a.value.title.textStyle.color=d.value?"#999":"#333",a.value.legend.textStyle.color=d.value?"#999":"#333",a.value.xAxis.axisLabel.color=d.value?"#999":"#333",a.value.yAxis.axisLabel.color=d.value?"#999":"#333",a.value.legend.orient=(l=e.widgetObj.widgetParams[8])==null?void 0:l.value,a.value.legend.left=(t=e.widgetObj.widgetParams[9])==null?void 0:t.value,a.value.title.text=(s=e.widgetObj.widgetParams[5])==null?void 0:s.value,a.value.title.subtext=(u=e.widgetObj.widgetParams[6])==null?void 0:u.value,a.value.legend.show=(n=e.widgetObj.widgetParams[7])==null?void 0:n.value,a.value.tooltip.show=(x=e.widgetObj.widgetParams[10])==null?void 0:x.value,a.value.tooltip.trigger=(P=e.widgetObj.widgetParams[11])==null?void 0:P.value,a.value.toolbox.show=(_=e.widgetObj.widgetParams[12])==null?void 0:_.value,a.value.xAxis.data=e.widgetObj.widgetParams[0].typeOptions.dataJson.xAxis,a.value.xAxis.boundaryGap=(m=e.widgetObj.widgetParams[2])==null?void 0:m.value,a.value.yAxis.splitLine.show=(b=e.widgetObj.widgetParams[15])==null?void 0:b.value,a.value.series=[],a.value.legend.data=[],(o=(h=e.widgetObj.widgetParams[0].typeOptions.dataJson)==null?void 0:h.series)==null||o.forEach((i,r)=>{var M,B,W,I;const k={type:"line",name:i.name,data:i.data,smooth:(M=e.widgetObj.widgetParams[3])==null?void 0:M.value,label:{show:(B=e.widgetObj.widgetParams[13])==null?void 0:B.value,position:(W=e.widgetObj.widgetParams[14])==null?void 0:W.value}};(I=e.widgetObj.widgetParams[4])!=null&&I.value&&(k.areaStyle={}),a.value.series.push(k),a.value.legend.data.push(i.name)}),ae()},te=()=>{window.addEventListener("resize",A)},le=()=>{window.removeEventListener("resize",A)},A=()=>{F(()=>{j.value&&p.resize()})};return ce([()=>e.widgetObj,()=>X.value,()=>d.value],()=>{E(),A()},{deep:!0}),(l,t)=>{var m;const s=w("el-input"),u=w("el-option"),n=w("el-select"),x=w("el-date-picker"),P=w("el-button"),_=w("el-space");return c(),V(L,null,[ge(K("div",fe,[N(_,{wrap:""},{default:T(()=>{var b,h;return[(c(!0),V(L,null,G((b=f.widgetObj.widgetParams[0].typeOptions.dataJson)==null?void 0:b.searchData,(o,i)=>(c(),V(L,null,[o.type=="input"?(c(),S(s,{key:i,modelValue:v.value[i],"onUpdate:modelValue":r=>v.value[i]=r,size:"small",placeholder:"请输入"+o.label,clearable:"",onKeyup:H(O,["enter"])},null,8,["modelValue","onUpdate:modelValue","placeholder"])):o.type=="select"?(c(),S(n,{class:"pagesearch",style:{"min-width":"120px"},key:i+"select",modelValue:v.value[i],"onUpdate:modelValue":r=>v.value[i]=r,onChange:O,size:"small",placeholder:"请选择"+o.label,clearable:"",filterable:"",remote:"","remote-method":r=>Z(r,o,i),loading:y.value,onKeyup:H(O,["enter"])},{default:T(()=>[(c(!0),V(L,null,G(o.options,(r,k)=>(c(),S(u,{value:r.value,label:r.label,key:k+r.value},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","remote-method","loading"])):q("",!0)],64))),256)),(h=f.widgetObj.widgetParams[16])!=null&&h.value?(c(),S(x,{key:0,modelValue:z.value,"onUpdate:modelValue":t[0]||(t[0]=o=>z.value=o),size:"small","unlink-panels":"",type:"monthrange","range-separator":"至","start-placeholder":"起始年月","end-placeholder":"结束年月",format:"YYYY-MM","value-format":"YYYY-MM"},null,8,["modelValue"])):q("",!0),N(P,{icon:we(pe),size:"small",loading:D.value,circle:"",onClick:O},null,8,["icon","loading"])]}),_:1})],512),[[ve,(m=f.widgetObj.widgetParams[1])==null?void 0:m.value]]),K("div",{ref_key:"chartRef",ref:j,style:me([{width:"100%"},{height:$.value}])},null,4)],64)}}},xe=se(ye,[["__scopeId","data-v-ab375bd3"]]);export{xe as default};
