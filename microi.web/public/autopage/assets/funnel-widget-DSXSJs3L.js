import{_ as te,u as ae,s as le,r as c,o as oe,c as M,a as se,n as B,i as ne,w as re,b as p,d as u,e as x,f as ie,v as de,g as W,h as F,j as I,F as V,k as K,l as k,m as N,p as H,q as ue,t as ce,x as ge}from"./index-BVh9aAA9.js";import{u as pe,g as we}from"./useWidget-DHPg7DNb.js";const me={class:"date-range"},ve={__name:"funnel-widget",props:{widgetObj:{type:Object,required:!0}},setup(f){var U,Y;const T=ae(),{curWrapper:q,dark:w}=le(T),e=f,O=c(!1);c([]);const A=async(a,l,o)=>{if(a&&l.optionUrl){O.value=!0;let i={};try{const s=await we(l.optionUrl+a,i);s&&s.length>0&&(e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[o].options=s),O.value=!1}catch(s){console.error("Error fetching data:",s)}finally{O.value=!1}}},z=c(),C=c(!1),{loadRemoteData:J}=pe(e.widgetObj,e.widgetObj.widgetParams[0].typeOptions.dataJson,z,C),g=c({});oe(()=>{var a;(a=e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData)==null||a.forEach((l,o)=>{g.value[o]=l.value}),Q(),Z()});const y=async a=>{const l={...g.value};for(const[o,i]of Object.entries(l))e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[o]&&(e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[o].value=i);await J(),L()},j=c(null);let m=null;const G=M(()=>{var l;let a=(l=e.widgetObj.widgetParams[1])!=null&&l.value?40:0;return e.widgetObj.widgetOption.height-a+"px"}),t=c({});t.value={title:{show:!0,text:"",subtext:"",textStyle:{color:w.value?"#999":"#333",fontStyle:"normal",fontWeight:"bolder",fontFamily:"sans-serif",fontSize:18}},tooltip:{trigger:"item",show:!0,axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{show:!0,type:"scroll",textStyle:{color:w.value?"#999":"#333"},orient:(U=e.widgetObj.widgetParams[6])==null?void 0:U.value,left:(Y=e.widgetObj.widgetParams[7])==null?void 0:Y.value,data:[]},grid:{show:!1,left:"10%",right:"4%",bottom:"30px",containLabel:!1},toolbox:{show:!0,feature:{dataView:{readOnly:!1},restore:{},saveAsImage:{}}},series:[]},se(()=>{$()});const Q=async()=>{await J(),E()},E=()=>{B(()=>{m&&m.dispose(),j.value&&(m=ne(j.value),L())})},X=()=>{m.setOption(t.value)},L=()=>{var a,l,o,i,s,_,P,S,v,h,b;t.value.legend.orient=(a=e.widgetObj.widgetParams[6])==null?void 0:a.value,t.value.legend.left=(l=e.widgetObj.widgetParams[7])==null?void 0:l.value,t.value.title.textStyle.color=w.value?"#999":"#333",t.value.legend.textStyle.color=w.value?"#999":"#333",t.value.title.text=(o=e.widgetObj.widgetParams[3])==null?void 0:o.value,t.value.title.subtext=(i=e.widgetObj.widgetParams[4])==null?void 0:i.value,t.value.legend.show=(s=e.widgetObj.widgetParams[5])==null?void 0:s.value,t.value.tooltip.show=(_=e.widgetObj.widgetParams[8])==null?void 0:_.value,t.value.tooltip.trigger=(P=e.widgetObj.widgetParams[9])==null?void 0:P.value,t.value.toolbox.show=(S=e.widgetObj.widgetParams[10])==null?void 0:S.value,t.value.series=[{type:"funnel",left:"10%",top:40,bottom:10,width:"80%",min:0,max:100,minSize:"0%",maxSize:"100%",sort:"descending",gap:2,label:{show:(v=e.widgetObj.widgetParams[11])==null?void 0:v.value,position:(h=e.widgetObj.widgetParams[12])==null?void 0:h.value},labelLine:{length:10,lineStyle:{width:1,type:"solid"}},itemStyle:{borderColor:"#fff",borderWidth:1},emphasis:{label:{fontSize:20}},data:R.value}],t.value.legend.data=[],(b=R.value)==null||b.forEach((n,d)=>{t.value.legend.data.push(n.name)}),X()},Z=()=>{window.addEventListener("resize",D)},$=()=>{window.removeEventListener("resize",D)},D=()=>{B(()=>{j.value&&m.resize()})};re([()=>e.widgetObj,()=>q.value,()=>w.value],()=>{E(),D()},{deep:!0});const R=M(()=>{var a;return(a=e.widgetObj.widgetParams[0].typeOptions.dataJson)!=null&&a.data?e.widgetObj.widgetParams[0].typeOptions.dataJson.data:e.widgetObj.widgetParams[0].typeOptions.dataJson});return(a,l)=>{var v;const o=p("el-input"),i=p("el-option"),s=p("el-select"),_=p("el-date-picker"),P=p("el-button"),S=p("el-space");return u(),x(V,null,[ie(W("div",me,[F(S,{wrap:""},{default:I(()=>{var h,b;return[(u(!0),x(V,null,K((h=f.widgetObj.widgetParams[0].typeOptions.dataJson)==null?void 0:h.searchData,(n,d)=>(u(),x(V,null,[n.type=="input"?(u(),k(o,{key:d,modelValue:g.value[d],"onUpdate:modelValue":r=>g.value[d]=r,size:"small",placeholder:"请输入"+n.label,clearable:"",onKeyup:N(y,["enter"])},null,8,["modelValue","onUpdate:modelValue","placeholder"])):n.type=="select"?(u(),k(s,{class:"pagesearch",style:{"min-width":"120px"},key:d+"select",modelValue:g.value[d],"onUpdate:modelValue":r=>g.value[d]=r,onChange:y,size:"small",placeholder:"请选择"+n.label,clearable:"",filterable:"",remote:"","remote-method":r=>A(r,n,d),loading:O.value,onKeyup:N(y,["enter"])},{default:I(()=>[(u(!0),x(V,null,K(n.options,(r,ee)=>(u(),k(i,{value:r.value,label:r.label,key:ee+r.value},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","remote-method","loading"])):H("",!0)],64))),256)),(b=f.widgetObj.widgetParams[13])!=null&&b.value?(u(),k(_,{key:0,modelValue:z.value,"onUpdate:modelValue":l[0]||(l[0]=n=>z.value=n),size:"small","unlink-panels":"",type:"monthrange","range-separator":"至","start-placeholder":"起始年月","end-placeholder":"结束年月",format:"YYYY-MM","value-format":"YYYY-MM"},null,8,["modelValue"])):H("",!0),F(P,{icon:ue(ce),size:"small",loading:C.value,circle:"",onClick:y},null,8,["icon","loading"])]}),_:1})],512),[[de,(v=f.widgetObj.widgetParams[1])==null?void 0:v.value]]),W("div",{ref_key:"chartRef",ref:j,style:ge([{width:"100%"},{height:G.value}])},null,4)],64)}}},fe=te(ve,[["__scopeId","data-v-a0ddb7be"]]);export{fe as default};
