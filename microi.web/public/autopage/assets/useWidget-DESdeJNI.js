import{g as y}from"./axiosInstance-DBGEDyk1.js";import{u as h,s as L,b as J,r as c,J as x}from"./index-BtYVu8ky.js";const I=h(),{formData:n}=L(I);function S(a,i,f=c(),m=c(!1),l=c(-1)){const d=e=>{let s=a.widgetOption.wrapperNumber,p=a.widgetOption.number,r=n.value.JsonObj.wrapperList.findIndex(t=>t.wrapperOption.number===s);if(r!==-1){let t=n.value.JsonObj.wrapperList[r].widgetList.findIndex(u=>u.widgetOption.number===p);t!==-1&&(e instanceof Object||e instanceof Array?n.value.JsonObj.wrapperList[r].widgetList[t].widgetParams[0].typeOptions.dataJson=e:n.value.JsonObj.wrapperList[r].widgetList[t].widgetParams[0].typeOptions.dataJson={})}},w=async()=>{var s,p,r,t,u,g;let e={};if(f.value&&(e.start=f.value[0],e.end=f.value[1]),l.value!==-1&&((s=a.widgetParams[7])==null?void 0:s.value)!==-1&&(e.currentPage=l.value,e.pageSize=(p=a.widgetParams[7])==null?void 0:p.value),a.widgetParams[0].typeOptions.dataJson.searchData&&((r=a.widgetParams[0].typeOptions.dataJson.searchData)==null||r.forEach(o=>{e[o.prop]=o.value})),a.widgetParams[0].value){console.log("请求地址",a.widgetParams[0].value),console.log("请求参数",e),m.value=!0;const o=await y(a.widgetParams[0].value,e);try{d(o),m.value=!1}catch(v){m.value=!1,console.log(v)}}else if(i&&l.value!==-1&&a.widgetParams[7]&&((t=a.widgetParams[7])==null?void 0:t.value)!==-1){let o=(l.value-1)*((u=a.widgetParams[7])==null?void 0:u.value),v=o+((g=a.widgetParams[7])==null?void 0:g.value);a.widgetParams[0].typeOptions.dataJson.bodyData&&(a.widgetParams[0].typeOptions.dataJson.bodyData=i==null?void 0:i.slice(o,v))}},P=x(async()=>{await w()},1e3);return J(()=>a.widgetParams[0].value,async(e,s)=>{e!==s&&P()},{deep:!0}),J(()=>n.value.JsonObj.formConfig.lastRefreshTime,async(e,s)=>{e!==s&&P()},{deep:!1}),{loadRemoteData:w,setResponse:d}}export{S as u};
