import{_ as X,u as Z,s as $,r,c as ee,o as te,a as ae,n as E,i as le,w as oe,b as c,d as i,e as _,f as se,v as ne,g as M,h as z,j as B,F as j,k as J,l as V,m as W,p as re,q as ie,t as de,x as ue}from"./index-Cdknt3Ns.js";import{u as ce,g as ge}from"./useWidget-Didqp_4P.js";const pe={class:"date-range"},me={__name:"funnel-widget",props:{widgetObj:{type:Object,required:!0}},setup(P){var Y,D;const F=Z(),{curWrapper:I,dark:g}=$(F),e=P,K=r(e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData),h=r(!1);r([]);const N=async(n,l,d)=>{if(n&&l.optionUrl){h.value=!0;let u={};try{const o=await ge(l.optionUrl+n,u);o&&o.length>0&&(K.value[d].options=o),h.value=!1}catch(o){console.error("Error fetching data:",o)}finally{h.value=!1}}},x=r(),C=r(!1),{loadRemoteData:L}=ce(e.widgetObj,e.widgetObj.widgetParams[0].typeOptions.dataJson,x,C),S=async()=>{console.log("重新加载了数据"),await L(),U()},f=r(null);let p=null;const H=ee(()=>{var l;let n=(l=e.widgetObj.widgetParams[1])!=null&&l.value?40:0;return e.widgetObj.widgetOption.height-n+"px"}),t=r({});t.value={title:{show:!0,text:"",subtext:"",textStyle:{color:g.value?"#999":"#333",fontStyle:"normal",fontWeight:"bolder",fontFamily:"sans-serif",fontSize:18}},tooltip:{trigger:"item",show:!0,axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{show:!0,type:"scroll",textStyle:{color:g.value?"#999":"#333"},orient:(Y=e.widgetObj.widgetParams[6])==null?void 0:Y.value,left:(D=e.widgetObj.widgetParams[7])==null?void 0:D.value,data:[]},grid:{show:!1,left:"10%",right:"4%",bottom:"30px",containLabel:!1},toolbox:{show:!0,feature:{dataView:{readOnly:!1},restore:{},saveAsImage:{}}},series:[]},te(()=>{T(),A()}),ae(()=>{G()});const T=async()=>{await L(),R()},R=()=>{E(()=>{p&&p.dispose(),f.value&&(p=le(f.value),U())})},q=()=>{p.setOption(t.value)},U=()=>{var n,l,d,u,o,b,y,O,m,w,a;t.value.legend.orient=(n=e.widgetObj.widgetParams[6])==null?void 0:n.value,t.value.legend.left=(l=e.widgetObj.widgetParams[7])==null?void 0:l.value,t.value.title.textStyle.color=g.value?"#999":"#333",t.value.legend.textStyle.color=g.value?"#999":"#333",t.value.title.text=(d=e.widgetObj.widgetParams[3])==null?void 0:d.value,t.value.title.subtext=(u=e.widgetObj.widgetParams[4])==null?void 0:u.value,t.value.legend.show=(o=e.widgetObj.widgetParams[5])==null?void 0:o.value,t.value.tooltip.show=(b=e.widgetObj.widgetParams[8])==null?void 0:b.value,t.value.tooltip.trigger=(y=e.widgetObj.widgetParams[9])==null?void 0:y.value,t.value.toolbox.show=(O=e.widgetObj.widgetParams[10])==null?void 0:O.value,t.value.series=[{type:"funnel",left:"10%",top:40,bottom:10,width:"80%",min:0,max:100,minSize:"0%",maxSize:"100%",sort:"descending",gap:2,label:{show:(m=e.widgetObj.widgetParams[11])==null?void 0:m.value,position:(w=e.widgetObj.widgetParams[12])==null?void 0:w.value},labelLine:{length:10,lineStyle:{width:1,type:"solid"}},itemStyle:{borderColor:"#fff",borderWidth:1},emphasis:{label:{fontSize:20}},data:e.widgetObj.widgetParams[0].typeOptions.dataJson}],t.value.legend.data=[],(a=e.widgetObj.widgetParams[0].typeOptions.dataJson)==null||a.forEach((v,s)=>{t.value.legend.data.push(v.name)}),q()},A=()=>{window.addEventListener("resize",k)},G=()=>{window.removeEventListener("resize",k)},k=()=>{E(()=>{f.value&&p.resize()})};return oe([()=>e.widgetObj,()=>I.value,()=>g.value],()=>{R(),k()},{deep:!0}),(n,l)=>{var m;const d=c("el-input"),u=c("el-option"),o=c("el-select"),b=c("el-date-picker"),y=c("el-button"),O=c("el-space");return i(),_(j,null,[se(M("div",pe,[z(O,{wrap:""},{default:B(()=>{var w;return[(i(!0),_(j,null,J((w=P.widgetObj.widgetParams[0].typeOptions.dataJson)==null?void 0:w.searchData,(a,v)=>(i(),_(j,null,[a.type=="input"?(i(),V(d,{key:v,modelValue:a.value,"onUpdate:modelValue":s=>a.value=s,size:"small",placeholder:"请输入"+a.label,clearable:"",onKeyup:W(S,["enter"])},null,8,["modelValue","onUpdate:modelValue","placeholder"])):a.type=="select"?(i(),V(o,{class:"pagesearch",style:{"min-width":"120px"},key:v+"select",modelValue:a.value,"onUpdate:modelValue":s=>a.value=s,size:"small",placeholder:"请选择"+a.label,clearable:"",filterable:"",remote:"","remote-method":s=>N(s,a,v),loading:h.value,onKeyup:W(S,["enter"])},{default:B(()=>[(i(!0),_(j,null,J(a.options,(s,Q)=>(i(),V(u,{value:s.value,label:s.label,key:Q+s.value},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","remote-method","loading"])):re("",!0)],64))),256)),z(b,{size:"small",modelValue:x.value,"onUpdate:modelValue":l[0]||(l[0]=a=>x.value=a),"unlink-panels":"",type:"monthrange","range-separator":"至","start-placeholder":"起始年月","end-placeholder":"结束年月",format:"YYYY-MM","value-format":"YYYY-MM"},null,8,["modelValue"]),z(y,{size:"small",icon:ie(de),loading:C.value,circle:"",onClick:S},null,8,["icon","loading"])]}),_:1})],512),[[ne,(m=P.widgetObj.widgetParams[1])==null?void 0:m.value]]),M("div",{ref_key:"chartRef",ref:f,style:ue([{width:"100%"},{height:H.value}])},null,4)],64)}}},he=X(me,[["__scopeId","data-v-cfdcbe80"]]);export{he as default};
