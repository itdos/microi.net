import{_ as ee,u as te,s as ae,r as u,c as J,o as le,a as oe,n as M,i as se,w as ne,b as c,d as r,e as P,f as re,v as ie,g as B,h as W,j as F,F as x,k as I,l as S,m as K,p as N,q as de,t as ue,x as ce}from"./index-e3nHg57k.js";import{u as ge,g as pe}from"./useWidget-R-djxtlI.js";const we={class:"date-range"},me={__name:"funnel-widget",props:{widgetObj:{type:Object,required:!0}},setup(h){var D,E;const H=te(),{curWrapper:T,dark:g}=ae(H),e=h,b=u(!1);u([]);const q=async(l,o,i)=>{if(l&&o.optionUrl){b.value=!0;let d={};try{const s=await pe(o.optionUrl+l,d);s&&s.length>0&&(e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[i].options=s),b.value=!1}catch(s){console.error("Error fetching data:",s)}finally{b.value=!1}}},k=u(),C=u(!1),{loadRemoteData:L}=ge(e.widgetObj,e.widgetObj.widgetParams[0].typeOptions.dataJson,k,C),z=async()=>{console.log("重新加载了数据"),await L(),U()},f=u(null);let p=null;const A=J(()=>{var o;let l=(o=e.widgetObj.widgetParams[1])!=null&&o.value?40:0;return e.widgetObj.widgetOption.height-l+"px"}),t=u({});t.value={title:{show:!0,text:"",subtext:"",textStyle:{color:g.value?"#999":"#333",fontStyle:"normal",fontWeight:"bolder",fontFamily:"sans-serif",fontSize:18}},tooltip:{trigger:"item",show:!0,axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{show:!0,type:"scroll",textStyle:{color:g.value?"#999":"#333"},orient:(D=e.widgetObj.widgetParams[6])==null?void 0:D.value,left:(E=e.widgetObj.widgetParams[7])==null?void 0:E.value,data:[]},grid:{show:!1,left:"10%",right:"4%",bottom:"30px",containLabel:!1},toolbox:{show:!0,feature:{dataView:{readOnly:!1},restore:{},saveAsImage:{}}},series:[]},le(()=>{G(),X()}),oe(()=>{Z()});const G=async()=>{await L(),R()},R=()=>{M(()=>{p&&p.dispose(),f.value&&(p=se(f.value),U())})},Q=()=>{p.setOption(t.value)},U=()=>{var l,o,i,d,s,y,O,_,w,m,v;t.value.legend.orient=(l=e.widgetObj.widgetParams[6])==null?void 0:l.value,t.value.legend.left=(o=e.widgetObj.widgetParams[7])==null?void 0:o.value,t.value.title.textStyle.color=g.value?"#999":"#333",t.value.legend.textStyle.color=g.value?"#999":"#333",t.value.title.text=(i=e.widgetObj.widgetParams[3])==null?void 0:i.value,t.value.title.subtext=(d=e.widgetObj.widgetParams[4])==null?void 0:d.value,t.value.legend.show=(s=e.widgetObj.widgetParams[5])==null?void 0:s.value,t.value.tooltip.show=(y=e.widgetObj.widgetParams[8])==null?void 0:y.value,t.value.tooltip.trigger=(O=e.widgetObj.widgetParams[9])==null?void 0:O.value,t.value.toolbox.show=(_=e.widgetObj.widgetParams[10])==null?void 0:_.value,t.value.series=[{type:"funnel",left:"10%",top:40,bottom:10,width:"80%",min:0,max:100,minSize:"0%",maxSize:"100%",sort:"descending",gap:2,label:{show:(w=e.widgetObj.widgetParams[11])==null?void 0:w.value,position:(m=e.widgetObj.widgetParams[12])==null?void 0:m.value},labelLine:{length:10,lineStyle:{width:1,type:"solid"}},itemStyle:{borderColor:"#fff",borderWidth:1},emphasis:{label:{fontSize:20}},data:Y.value}],t.value.legend.data=[],(v=Y.value)==null||v.forEach((a,j)=>{t.value.legend.data.push(a.name)}),Q()},X=()=>{window.addEventListener("resize",V)},Z=()=>{window.removeEventListener("resize",V)},V=()=>{M(()=>{f.value&&p.resize()})};ne([()=>e.widgetObj,()=>T.value,()=>g.value],()=>{R(),V()},{deep:!0});const Y=J(()=>{var l;return(l=e.widgetObj.widgetParams[0].typeOptions.dataJson)!=null&&l.data?e.widgetObj.widgetParams[0].typeOptions.dataJson.data:e.widgetObj.widgetParams[0].typeOptions.dataJson});return(l,o)=>{var w;const i=c("el-input"),d=c("el-option"),s=c("el-select"),y=c("el-date-picker"),O=c("el-button"),_=c("el-space");return r(),P(x,null,[re(B("div",we,[W(_,{wrap:""},{default:F(()=>{var m,v;return[(r(!0),P(x,null,I((m=h.widgetObj.widgetParams[0].typeOptions.dataJson)==null?void 0:m.searchData,(a,j)=>(r(),P(x,null,[a.type=="input"?(r(),S(i,{key:j,modelValue:a.value,"onUpdate:modelValue":n=>a.value=n,size:"small",placeholder:"请输入"+a.label,clearable:"",onKeyup:K(z,["enter"])},null,8,["modelValue","onUpdate:modelValue","placeholder"])):a.type=="select"?(r(),S(s,{class:"pagesearch",style:{"min-width":"120px"},key:j+"select",modelValue:a.value,"onUpdate:modelValue":n=>a.value=n,size:"small",placeholder:"请选择"+a.label,clearable:"",filterable:"",remote:"","remote-method":n=>q(n,a,j),loading:b.value,onKeyup:K(z,["enter"])},{default:F(()=>[(r(!0),P(x,null,I(a.options,(n,$)=>(r(),S(d,{value:n.value,label:n.label,key:$+n.value},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","remote-method","loading"])):N("",!0)],64))),256)),(v=h.widgetObj.widgetParams[13])!=null&&v.value?(r(),S(y,{key:0,modelValue:k.value,"onUpdate:modelValue":o[0]||(o[0]=a=>k.value=a),size:"small","unlink-panels":"",type:"monthrange","range-separator":"至","start-placeholder":"起始年月","end-placeholder":"结束年月",format:"YYYY-MM","value-format":"YYYY-MM"},null,8,["modelValue"])):N("",!0),W(O,{icon:de(ue),size:"small",loading:C.value,circle:"",onClick:z},null,8,["icon","loading"])]}),_:1})],512),[[ie,(w=h.widgetObj.widgetParams[1])==null?void 0:w.value]]),B("div",{ref_key:"chartRef",ref:f,style:ce([{width:"100%"},{height:A.value}])},null,4)],64)}}},be=ee(me,[["__scopeId","data-v-c75e365d"]]);export{be as default};
