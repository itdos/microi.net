import{_ as se,u as ie,s as re,r as g,o as I,c as ne,a as de,n as K,i as ue,w as ce,b as w,d as c,e as _,f as ge,v as ve,g as N,h as T,j as G,F as k,k as H,l as V,m as q,p as Q,q as we,t as pe,x as me}from"./index-CXgNbF0w.js";import{u as be,g as he}from"./useWidget-mapG2dm_.js";const fe={class:"date-range"},Oe={__name:"bar-widget",props:{widgetObj:{type:Object,required:!0}},setup(h){var E,J,U,Y,M;const X=ie(),{curWrapper:Z,dark:n}=re(X),e=h,f=g(!1);g([]);const $=async(o,t,d)=>{if(o&&t.optionUrl){f.value=!0;let u={};try{const i=await he(t.optionUrl+o,u);i&&i.length>0&&(e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[d].options=i),f.value=!1}catch(i){console.error("Error fetching data:",i)}finally{f.value=!1}}},S=g(),z=g(!1),{loadRemoteData:A}=be(e.widgetObj,e.widgetObj.widgetParams[0].typeOptions.dataJson,S,z),v=g({});I(()=>{e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData.forEach((o,t)=>{v.value[t]=o.value})});const O=async o=>{const t={...v.value};for(const[d,u]of Object.entries(t))e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[d]&&(e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[d].value=u);await A(),C()},y=g(null);let p=null;const ee=ne(()=>{var t;let o=(t=e.widgetObj.widgetParams[1])!=null&&t.value?40:0;return e.widgetObj.widgetOption.height-o+"px"}),a=g({});a.value={title:{show:!0,text:"",subtext:"",textStyle:{color:n.value?"#999":"#333",fontStyle:"normal",fontWeight:"bolder",fontFamily:"sans-serif",fontSize:18}},tooltip:{trigger:"axis",show:!0,axisPointer:{type:(E=e.widgetObj.widgetParams[3])==null?void 0:E.value,label:{backgroundColor:"#6a7985"}}},legend:{show:!0,type:"scroll",textStyle:{color:n.value?"#999":"#333"},data:[],orient:(J=e.widgetObj.widgetParams[8])==null?void 0:J.value,left:(U=e.widgetObj.widgetParams[9])==null?void 0:U.value},grid:{show:!1,left:"10%",right:"4%",bottom:"30px",containLabel:!1},toolbox:{show:!0,feature:{dataView:{readOnly:!1},restore:{},saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!0,axisTick:{alignWithLabel:!0},axisLabel:{color:n.value?"#999":"#333"},data:[]},yAxis:{type:"value",splitLine:{show:(Y=e.widgetObj.widgetParams[15])==null?void 0:Y.value},axisLabel:{formatter:"{value} "+((M=e.widgetObj.widgetParams[4])==null?void 0:M.value),color:n.value?"#999":"#333"}},series:[]},I(()=>{ae(),window.addEventListener("resize",L)}),de(()=>{window.removeEventListener("resize",L)});const ae=async()=>{await A(),D()},D=()=>{K(()=>{p&&p.dispose(),y.value&&(p=ue(y.value),C())})},te=()=>{p.setOption(a.value)},C=()=>{var o,t,d,u,i,j,x,P,m,b,s,r;a.value.title.textStyle.color=n.value?"#999":"#333",a.value.legend.textStyle.color=n.value?"#999":"#333",a.value.xAxis.axisLabel.color=n.value?"#999":"#333",a.value.yAxis.axisLabel.color=n.value?"#999":"#333",a.value.tooltip.axisPointer.type=(o=e.widgetObj.widgetParams[3])==null?void 0:o.value,a.value.legend.orient=(t=e.widgetObj.widgetParams[8])==null?void 0:t.value,a.value.legend.left=(d=e.widgetObj.widgetParams[9])==null?void 0:d.value,a.value.title.text=(u=e.widgetObj.widgetParams[5])==null?void 0:u.value,a.value.title.subtext=(i=e.widgetObj.widgetParams[6])==null?void 0:i.value,a.value.legend.show=(j=e.widgetObj.widgetParams[7])==null?void 0:j.value,a.value.tooltip.show=(x=e.widgetObj.widgetParams[10])==null?void 0:x.value,a.value.tooltip.trigger=(P=e.widgetObj.widgetParams[11])==null?void 0:P.value,a.value.toolbox.show=(m=e.widgetObj.widgetParams[12])==null?void 0:m.value,a.value.xAxis.data=e.widgetObj.widgetParams[0].typeOptions.dataJson.xAxis,a.value.xAxis.boundaryGap=(b=e.widgetObj.widgetParams[2])==null?void 0:b.value,a.value.yAxis.splitLine.show=(s=e.widgetObj.widgetParams[15])==null?void 0:s.value,a.value.series=[],a.value.legend.data=[],(r=e.widgetObj.widgetParams[0].typeOptions.dataJson.series)==null||r.forEach((l,R)=>{var B,W;const le={type:"bar",name:l.name,data:l.data,tooltip:{valueFormatter:function(oe){var F;return oe+" "+((F=e.widgetObj.widgetParams[4])==null?void 0:F.value)}},label:{show:(B=e.widgetObj.widgetParams[13])==null?void 0:B.value,position:(W=e.widgetObj.widgetParams[14])==null?void 0:W.value}};a.value.series.push(le),a.value.legend.data.push(l.name)}),te()},L=()=>{K(()=>{y.value&&p.resize()})};return ce([()=>e.widgetObj,()=>Z.value,()=>n.value],()=>{D(),L()},{deep:!0}),(o,t)=>{var m;const d=w("el-input"),u=w("el-option"),i=w("el-select"),j=w("el-date-picker"),x=w("el-button"),P=w("el-space");return c(),_(k,null,[ge(N("div",fe,[T(P,{wrap:""},{default:G(()=>{var b;return[(c(!0),_(k,null,H(h.widgetObj.widgetParams[0].typeOptions.dataJson.searchData,(s,r)=>(c(),_(k,null,[s.type=="input"?(c(),V(d,{key:r,modelValue:v.value[r],"onUpdate:modelValue":l=>v.value[r]=l,size:"small",placeholder:"请输入"+s.label,clearable:"",onKeyup:q(O,["enter"])},null,8,["modelValue","onUpdate:modelValue","placeholder"])):s.type=="select"?(c(),V(i,{class:"pagesearch",style:{"min-width":"120px"},key:r+"select",modelValue:v.value[r],"onUpdate:modelValue":l=>v.value[r]=l,onChange:O,size:"small",placeholder:"请选择"+s.label,clearable:"",filterable:"",remote:"","remote-method":l=>$(l,s,r),loading:f.value,onKeyup:q(O,["enter"])},{default:G(()=>[(c(!0),_(k,null,H(s.options,(l,R)=>(c(),V(u,{value:l.value,label:l.label,key:R+l.value},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","remote-method","loading"])):Q("",!0)],64))),256)),(b=h.widgetObj.widgetParams[16])!=null&&b.value?(c(),V(j,{key:0,modelValue:S.value,"onUpdate:modelValue":t[0]||(t[0]=s=>S.value=s),size:"small","unlink-panels":"",type:"monthrange","range-separator":"至","start-placeholder":"起始年月","end-placeholder":"结束年月",format:"YYYY-MM","value-format":"YYYY-MM"},null,8,["modelValue"])):Q("",!0),T(x,{icon:we(pe),size:"small",loading:z.value,circle:"",onClick:O},null,8,["icon","loading"])]}),_:1})],512),[[ve,(m=h.widgetObj.widgetParams[1])==null?void 0:m.value]]),N("div",{ref_key:"chartRef",ref:y,style:me([{width:"100%"},{height:ee.value}])},null,4)],64)}}},xe=se(Oe,[["__scopeId","data-v-0231b451"]]);export{xe as default};
