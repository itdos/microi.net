import{_ as we,u as pe,s as me,r as u,c as be,o as he,a as ye,n as Z,i as fe,w as xe,b as w,d as n,e as P,f as Oe,v as je,g as $,h as ee,j as ae,F as _,k as te,l as L,m as le,p as oe,q as Pe,t as _e,x as Le}from"./index-CfICaLg9.js";import{u as ke,g as Se}from"./useWidget-zuxP2hw3.js";const Ve={class:"date-range"},Ae={__name:"linebar-widget",props:{widgetObj:{type:Object,required:!0}},setup(k){var E,D,M,B,I,W,F,J;const se=pe(),{curWrapper:ie,dark:o}=me(se),e=k,z=u((E=e.widgetObj.widgetParams[0].typeOptions.dataJson)==null?void 0:E.searchData),h=u(!1);u([]);const re=async(r,s,d)=>{if(r&&s.optionUrl){h.value=!0;let c={};try{const i=await Se(s.optionUrl+r,c);i&&i.length>0&&(z.value[d].options=i),h.value=!1}catch(i){console.error("Error fetching data:",i)}finally{h.value=!1}}},S=u(),R=u(!1),{loadRemoteData:U}=ke(e.widgetObj,(D=e.widgetObj.widgetParams[0])==null?void 0:D.typeOptions.dataJson,S,R),V=async()=>{console.log("重新加载了数据"),await U(),C()},y=u(null);let p=null;const ne=be(()=>{var s;let r=(s=e.widgetObj.widgetParams[1])!=null&&s.value?40:0;return e.widgetObj.widgetOption.height-r+"px"}),a=u({});a.value={title:{show:!0,text:"",subtext:"",textStyle:{color:o.value?"#999":"#333",fontStyle:"normal",fontWeight:"bolder",fontFamily:"sans-serif",fontSize:18}},tooltip:{trigger:"axis",show:!0,axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{show:!0,type:"scroll",textStyle:{color:o.value?"#999":"#333"},data:[],orient:(M=e.widgetObj.widgetParams[8])==null?void 0:M.value,left:(B=e.widgetObj.widgetParams[9])==null?void 0:B.value},grid:{show:!1,left:"10%",right:"8%",bottom:"30px",containLabel:!1},toolbox:{show:!0,feature:{dataView:{readOnly:!1},restore:{},saveAsImage:{}}},xAxis:[{type:"category",boundaryGap:!0,axisTick:{alignWithLabel:!0},axisLabel:{color:o.value?"#999":"#333"},data:[]}],yAxis:[{type:"value",splitLine:{show:(I=e.widgetObj.widgetParams[16])==null?void 0:I.value,lineStyle:{color:["#ccc"],width:1,type:"solid"}},axisLabel:{formatter:"{value} "+((W=e.widgetObj.widgetParams[3])==null?void 0:W.value),color:o.value?"#999":"#333"}},{type:"value",splitLine:{show:(F=e.widgetObj.widgetParams[17])==null?void 0:F.value,lineStyle:{color:["#ccc"],width:1,type:"dashed"}},axisLabel:{formatter:"{value} "+((J=e.widgetObj.widgetParams[4])==null?void 0:J.value),color:o.value?"#999":"#333"}}],series:[]},he(()=>{ue(),ce()}),ye(()=>{ge()});const ue=async()=>{await U(),Y()},Y=()=>{Z(()=>{p&&p.dispose(),y.value&&(p=fe(y.value),C())})},de=()=>{p.setOption(a.value)},C=()=>{var r,s,d,c,i,f,x,O,m,b,t,g,l,j,K,N,T,G,H;a.value.title.textStyle.color=o.value?"#999":"#333",a.value.legend.textStyle.color=o.value?"#999":"#333",a.value.legend.orient=(r=e.widgetObj.widgetParams[8])==null?void 0:r.value,a.value.legend.left=(s=e.widgetObj.widgetParams[9])==null?void 0:s.value,a.value.title.text=(d=e.widgetObj.widgetParams[5])==null?void 0:d.value,a.value.title.subtext=(c=e.widgetObj.widgetParams[6])==null?void 0:c.value,a.value.legend.show=(i=e.widgetObj.widgetParams[7])==null?void 0:i.value,a.value.tooltip.show=(f=e.widgetObj.widgetParams[10])==null?void 0:f.value,a.value.tooltip.trigger=(x=e.widgetObj.widgetParams[11])==null?void 0:x.value,a.value.toolbox.show=(O=e.widgetObj.widgetParams[13])==null?void 0:O.value,a.value.xAxis[0].data=(m=e.widgetObj.widgetParams[0])==null?void 0:m.typeOptions.dataJson.xAxis,a.value.xAxis[0].boundaryGap=(b=e.widgetObj.widgetParams[2])==null?void 0:b.value,a.value.xAxis[0].axisLabel.color=o.value?"#999":"#333",a.value.yAxis[0].axisLabel.color=o.value?"#999":"#333",a.value.yAxis[1].axisLabel.color=o.value?"#999":"#333",a.value.yAxis[0].axisLabel.formatter="{value} "+((t=e.widgetObj.widgetParams[3])==null?void 0:t.value),a.value.yAxis[1].axisLabel.formatter="{value} "+((g=e.widgetObj.widgetParams[4])==null?void 0:g.value),a.value.yAxis[0].splitLine.show=(j=(l=e.widgetObj)==null?void 0:l.widgetParams[16])==null?void 0:j.value,a.value.yAxis[1].splitLine.show=(N=(K=e.widgetObj)==null?void 0:K.widgetParams[17])==null?void 0:N.value,a.value.series=[],a.value.legend.data=[],(H=(G=(T=e.widgetObj.widgetParams[0])==null?void 0:T.typeOptions.dataJson)==null?void 0:G.series)==null||H.forEach((v,ze)=>{var Q,X;const q={type:v.type,name:v.name,data:v.data,tooltip:{valueFormatter:function(ve){return ve+" "+v.unit}},label:{show:(Q=e.widgetObj.widgetParams[14])==null?void 0:Q.value,position:(X=e.widgetObj.widgetParams[15])==null?void 0:X.value}};v.type=="line"&&(q.yAxisIndex=1),a.value.series.push(q),a.value.legend.data.push(v.name)}),de()},ce=()=>{window.addEventListener("resize",A)},ge=()=>{window.removeEventListener("resize",A)},A=()=>{Z(()=>{y.value&&p.resize()})};return xe([()=>e.widgetObj,()=>ie.value,()=>o.value],()=>{Y(),A()},{deep:!0}),(r,s)=>{var m;const d=w("el-input"),c=w("el-option"),i=w("el-select"),f=w("el-date-picker"),x=w("el-button"),O=w("el-space");return n(),P(_,null,[Oe($("div",Ve,[ee(O,{wrap:""},{default:ae(()=>{var b;return[(n(!0),P(_,null,te(z.value,(t,g)=>(n(),P(_,null,[t.type=="input"?(n(),L(d,{key:g,modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,size:"small",placeholder:"请输入"+t.label,clearable:"",onKeyup:le(V,["enter"])},null,8,["modelValue","onUpdate:modelValue","placeholder"])):t.type=="select"?(n(),L(i,{class:"pagesearch",style:{"min-width":"120px"},key:g+"select",modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,size:"small",placeholder:"请选择"+t.label,clearable:"",filterable:"",remote:"","remote-method":l=>re(l,t,g),loading:h.value,onKeyup:le(V,["enter"])},{default:ae(()=>[(n(!0),P(_,null,te(t.options,(l,j)=>(n(),L(c,{value:l.value,label:l.label,key:j+l.value},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","remote-method","loading"])):oe("",!0)],64))),256)),(b=k.widgetObj.widgetParams[18])!=null&&b.value?(n(),L(f,{key:0,modelValue:S.value,"onUpdate:modelValue":s[0]||(s[0]=t=>S.value=t),size:"small","unlink-panels":"",type:"monthrange","range-separator":"至","start-placeholder":"起始年月","end-placeholder":"结束年月",format:"YYYY-MM","value-format":"YYYY-MM"},null,8,["modelValue"])):oe("",!0),ee(x,{icon:Pe(_e),size:"small",loading:R.value,circle:"",onClick:V},null,8,["icon","loading"])]}),_:1})],512),[[je,(m=k.widgetObj.widgetParams[1])==null?void 0:m.value]]),$("div",{ref_key:"chartRef",ref:y,style:Le([{width:"100%"},{height:ne.value}])},null,4)],64)}}},Ye=we(Ae,[["__scopeId","data-v-ec71d422"]]);export{Ye as default};
