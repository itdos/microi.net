import{_ as ae,u as le,s as oe,r as c,c as B,o as se,a as re,n as W,i as ne,w as ie,b as g,d as n,e as x,f as de,v as ue,g as I,h as F,j as K,F as k,k as N,l as V,m as T,p as A,q as ce,t as ge,x as we}from"./index-e3nHg57k.js";import{u as pe,g as me}from"./useWidget-R-djxtlI.js";const ve={class:"date-range"},be={__name:"pie-widget",props:{widgetObj:{type:Object,required:!0}},setup(h){var D,E;const H=le(),{curWrapper:q,dark:w}=oe(H),e=h,f=c(!1);c([]);const G=async(o,s,i)=>{if(o&&s.optionUrl){f.value=!0;let d={};try{const r=await me(s.optionUrl+o,d);r&&r.length>0&&(e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[i].options=r),f.value=!1}catch(r){console.error("Error fetching data:",r)}finally{f.value=!1}}},S=c(),L=c(!1),{loadRemoteData:U}=pe(e.widgetObj,e.widgetObj.widgetParams[0].typeOptions.dataJson,S,L),z=async()=>{console.log("重新加载了数据"),await U(),C()},O=c(null);let p=null;const Q=B(()=>{var s;let o=(s=e.widgetObj.widgetParams[1])!=null&&s.value?40:0;return e.widgetObj.widgetOption.height-o+"px"}),a=c({});a.value={title:{show:!0,text:"",subtext:"",textStyle:{color:w.value?"#999":"#333",fontStyle:"normal",fontWeight:"bolder",fontFamily:"sans-serif",fontSize:18}},tooltip:{trigger:"item",show:!0},legend:{show:!0,type:"scroll",textStyle:{color:w.value?"#fff":"#333"},orient:(D=e.widgetObj.widgetParams[8])==null?void 0:D.value,left:(E=e.widgetObj.widgetParams[9])==null?void 0:E.value},grid:{show:!1,left:"6%",right:"4%",bottom:"30px",containLabel:!1},toolbox:{show:!0,feature:{dataView:{readOnly:!1},restore:{},saveAsImage:{}}},series:[]},se(()=>{X(),$()}),re(()=>{ee()});const X=async()=>{await U(),Y()},Y=()=>{W(()=>{p&&p.dispose(),O.value&&(p=ne(O.value),C())})},Z=()=>{p.setOption(a.value)},C=()=>{var s,i,d,r,y,j,P,m,v,b,t,u,l,_,J,M;a.value.title.textStyle.color=w.value?"#999":"#333",a.value.legend.textStyle.color=w.value?"#999":"#333",a.value.legend.orient=(s=e.widgetObj.widgetParams[8])==null?void 0:s.value,a.value.legend.left=(i=e.widgetObj.widgetParams[9])==null?void 0:i.value,a.value.title.text=(d=e.widgetObj.widgetParams[5])==null?void 0:d.value,a.value.title.subtext=(r=e.widgetObj.widgetParams[6])==null?void 0:r.value,a.value.legend.show=(y=e.widgetObj.widgetParams[7])==null?void 0:y.value,a.value.tooltip.show=(j=e.widgetObj.widgetParams[10])==null?void 0:j.value,a.value.tooltip.trigger=(P=e.widgetObj.widgetParams[11])==null?void 0:P.value,a.value.toolbox.show=(m=e.widgetObj.widgetParams[12])==null?void 0:m.value,a.value.series=[];const o={type:"pie",radius:[((v=e.widgetObj.widgetParams[2])==null?void 0:v.value)+"%",((b=e.widgetObj.widgetParams[3])==null?void 0:b.value)+"%"],top:50,bottom:30,labelLine:{show:!0},padAngle:(t=e.widgetObj.widgetParams[17])==null?void 0:t.value,itemStyle:{borderRadius:(u=e.widgetObj.widgetParams[15])==null?void 0:u.value,borderColor:"#fff",borderWidth:(l=e.widgetObj.widgetParams[16])==null?void 0:l.value},data:te.value,label:{show:(_=e.widgetObj.widgetParams[13])==null?void 0:_.value,position:(J=e.widgetObj.widgetParams[14])==null?void 0:J.value}};(M=e.widgetObj.widgetParams[18])!=null&&M.value&&(o.roseType="radius"),a.value.series.push(o),Z()},$=()=>{window.addEventListener("resize",R)},ee=()=>{window.removeEventListener("resize",R)},R=()=>{W(()=>{O.value&&p.resize()})};ie([()=>e.widgetObj,()=>q.value,()=>w.value],()=>{Y(),R()},{deep:!0});const te=B(()=>{var o;return(o=e.widgetObj.widgetParams[0].typeOptions.dataJson)!=null&&o.data?e.widgetObj.widgetParams[0].typeOptions.dataJson.data:e.widgetObj.widgetParams[0].typeOptions.dataJson});return(o,s)=>{var m;const i=g("el-input"),d=g("el-option"),r=g("el-select"),y=g("el-date-picker"),j=g("el-button"),P=g("el-space");return n(),x(k,null,[de(I("div",ve,[F(P,{wrap:""},{default:K(()=>{var v,b;return[(n(!0),x(k,null,N((v=h.widgetObj.widgetParams[0].typeOptions.dataJson)==null?void 0:v.searchData,(t,u)=>(n(),x(k,null,[t.type=="input"?(n(),V(i,{key:u,modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,size:"small",placeholder:"请输入"+t.label,clearable:"",onKeyup:T(z,["enter"])},null,8,["modelValue","onUpdate:modelValue","placeholder"])):t.type=="select"?(n(),V(r,{class:"pagesearch",style:{"min-width":"120px"},key:u+"select",modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,size:"small",placeholder:"请选择"+t.label,clearable:"",filterable:"",remote:"","remote-method":l=>G(l,t,u),loading:f.value,onKeyup:T(z,["enter"])},{default:K(()=>[(n(!0),x(k,null,N(t.options,(l,_)=>(n(),V(d,{value:l.value,label:l.label,key:_+l.value},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","remote-method","loading"])):A("",!0)],64))),256)),(b=h.widgetObj.widgetParams[19])!=null&&b.value?(n(),V(y,{key:0,modelValue:S.value,"onUpdate:modelValue":s[0]||(s[0]=t=>S.value=t),size:"small","unlink-panels":"",type:"monthrange","range-separator":"至","start-placeholder":"起始年月","end-placeholder":"结束年月",format:"YYYY-MM","value-format":"YYYY-MM"},null,8,["modelValue"])):A("",!0),F(j,{icon:ce(ge),size:"small",loading:L.value,circle:"",onClick:z},null,8,["icon","loading"])]}),_:1})],512),[[ue,(m=h.widgetObj.widgetParams[1])==null?void 0:m.value]]),I("div",{ref_key:"chartRef",ref:O,style:we([{width:"100%"},{height:Q.value}])},null,4)],64)}}},Oe=ae(be,[["__scopeId","data-v-02463703"]]);export{Oe as default};
