import{_ as le,u as se,s as oe,r as c,c as W,o as re,a as ie,n as I,i as ne,w as de,b as g,d as u,e as k,f as ue,v as ce,g as F,h as K,j as N,F as x,k as T,l as S,m as A,p as H,q as ge,t as we,x as pe}from"./index-DlsyjTHd.js";import{u as me,g as ve}from"./useWidget-DNrzTSHA.js";const be={class:"date-range"},he={__name:"pie-widget",props:{widgetObj:{type:Object,required:!0}},setup(f){var C,E;const q=se(),{curWrapper:G,dark:w}=oe(q),e=f,O=c(!1);c([]);const Q=async(l,a,n)=>{if(l&&a.optionUrl){O.value=!0;let d={};try{const r=await ve(a.optionUrl+l,d);r&&r.length>0&&(e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[n].options=r),O.value=!1}catch(r){console.error("Error fetching data:",r)}finally{O.value=!1}}},z=c(),J=c(!1),{loadRemoteData:L}=me(e.widgetObj,e.widgetObj.widgetParams[0].typeOptions.dataJson,z,J),p=c({}),D=async l=>{const a={...p.value};for(const[n,d]of Object.entries(a))e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[n]&&(e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData[n].value=d);await L(),Y()},y=c(null);let m=null;const X=W(()=>{var a;let l=(a=e.widgetObj.widgetParams[1])!=null&&a.value?40:0;return e.widgetObj.widgetOption.height-l+"px"}),t=c({});t.value={title:{show:!0,text:"",subtext:"",textStyle:{color:w.value?"#999":"#333",fontStyle:"normal",fontWeight:"bolder",fontFamily:"sans-serif",fontSize:18}},tooltip:{trigger:"item",show:!0},legend:{show:!0,type:"scroll",textStyle:{color:w.value?"#fff":"#333"},orient:(C=e.widgetObj.widgetParams[8])==null?void 0:C.value,left:(E=e.widgetObj.widgetParams[9])==null?void 0:E.value},grid:{show:!1,left:"6%",right:"4%",bottom:"30px",containLabel:!1},toolbox:{show:!0,feature:{dataView:{readOnly:!1},restore:{},saveAsImage:{}}},series:[]},re(()=>{Z(),ee()}),ie(()=>{te()});const Z=async()=>{await L(),U()},U=()=>{I(()=>{m&&m.dispose(),y.value&&(m=ne(y.value),Y())})},$=()=>{m.setOption(t.value)},Y=()=>{var a,n,d,r,j,P,_,v,b,h,o,i,s,V,M,B;t.value.title.textStyle.color=w.value?"#999":"#333",t.value.legend.textStyle.color=w.value?"#999":"#333",t.value.legend.orient=(a=e.widgetObj.widgetParams[8])==null?void 0:a.value,t.value.legend.left=(n=e.widgetObj.widgetParams[9])==null?void 0:n.value,t.value.title.text=(d=e.widgetObj.widgetParams[5])==null?void 0:d.value,t.value.title.subtext=(r=e.widgetObj.widgetParams[6])==null?void 0:r.value,t.value.legend.show=(j=e.widgetObj.widgetParams[7])==null?void 0:j.value,t.value.tooltip.show=(P=e.widgetObj.widgetParams[10])==null?void 0:P.value,t.value.tooltip.trigger=(_=e.widgetObj.widgetParams[11])==null?void 0:_.value,t.value.toolbox.show=(v=e.widgetObj.widgetParams[12])==null?void 0:v.value,t.value.series=[];const l={type:"pie",radius:[((b=e.widgetObj.widgetParams[2])==null?void 0:b.value)+"%",((h=e.widgetObj.widgetParams[3])==null?void 0:h.value)+"%"],top:50,bottom:30,labelLine:{show:!0},padAngle:(o=e.widgetObj.widgetParams[17])==null?void 0:o.value,itemStyle:{borderRadius:(i=e.widgetObj.widgetParams[15])==null?void 0:i.value,borderColor:"#fff",borderWidth:(s=e.widgetObj.widgetParams[16])==null?void 0:s.value},data:ae.value,label:{show:(V=e.widgetObj.widgetParams[13])==null?void 0:V.value,position:(M=e.widgetObj.widgetParams[14])==null?void 0:M.value}};(B=e.widgetObj.widgetParams[18])!=null&&B.value&&(l.roseType="radius"),t.value.series.push(l),$()},ee=()=>{window.addEventListener("resize",R)},te=()=>{window.removeEventListener("resize",R)},R=()=>{I(()=>{y.value&&m.resize()})};de([()=>e.widgetObj,()=>G.value,()=>w.value],()=>{U(),R()},{deep:!0});const ae=W(()=>{var l;return(l=e.widgetObj.widgetParams[0].typeOptions.dataJson)!=null&&l.data?e.widgetObj.widgetParams[0].typeOptions.dataJson.data:e.widgetObj.widgetParams[0].typeOptions.dataJson});return(l,a)=>{var v;const n=g("el-input"),d=g("el-option"),r=g("el-select"),j=g("el-date-picker"),P=g("el-button"),_=g("el-space");return u(),k(x,null,[ue(F("div",be,[K(_,{wrap:""},{default:N(()=>{var b,h;return[(u(!0),k(x,null,T((b=f.widgetObj.widgetParams[0].typeOptions.dataJson)==null?void 0:b.searchData,(o,i)=>(u(),k(x,null,[o.type=="input"?(u(),S(n,{key:i,modelValue:p.value[i],"onUpdate:modelValue":s=>p.value[i]=s,size:"small",placeholder:"请输入"+o.label,clearable:"",onKeyup:A(D,["enter"])},null,8,["modelValue","onUpdate:modelValue","placeholder"])):o.type=="select"?(u(),S(r,{class:"pagesearch",style:{"min-width":"120px"},key:i+"select",modelValue:p.value[i],"onUpdate:modelValue":s=>p.value[i]=s,size:"small",placeholder:"请选择"+o.label,clearable:"",filterable:"",remote:"","remote-method":s=>Q(s,o,i),loading:O.value,onKeyup:A(D,["enter"])},{default:N(()=>[(u(!0),k(x,null,T(o.options,(s,V)=>(u(),S(d,{value:s.value,label:s.label,key:V+s.value},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","remote-method","loading"])):H("",!0)],64))),256)),(h=f.widgetObj.widgetParams[19])!=null&&h.value?(u(),S(j,{key:0,modelValue:z.value,"onUpdate:modelValue":a[0]||(a[0]=o=>z.value=o),size:"small","unlink-panels":"",type:"monthrange","range-separator":"至","start-placeholder":"起始年月","end-placeholder":"结束年月",format:"YYYY-MM","value-format":"YYYY-MM"},null,8,["modelValue"])):H("",!0),K(P,{icon:ge(we),size:"small",loading:J.value,circle:"",onClick:D},null,8,["icon","loading"])]}),_:1})],512),[[ce,(v=f.widgetObj.widgetParams[1])==null?void 0:v.value]]),F("div",{ref_key:"chartRef",ref:y,style:pe([{width:"100%"},{height:X.value}])},null,4)],64)}}},ye=le(he,[["__scopeId","data-v-e784b3a2"]]);export{ye as default};
