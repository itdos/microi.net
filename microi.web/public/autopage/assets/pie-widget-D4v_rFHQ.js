import{_ as ee,u as te,s as ae,r as n,c as le,o as oe,a as se,n as I,i as re,w as ne,b as g,d as i,e as _,f as ie,v as de,g as J,h as z,j as F,F as P,k as K,l as R,m as N,p as ue,q as ce,t as ge,x as pe}from"./index-CzCDAM-x.js";import{u as we,g as ve}from"./useWidget-CYUdCzEA.js";const me={class:"date-range"},he={__name:"pie-widget",props:{widgetObj:{type:Object,required:!0}},setup(x){var D,E;const T=te(),{curWrapper:A,dark:p}=ae(T),e=x,H=n(e.widgetObj.widgetParams[0].typeOptions.dataJson.searchData),h=n(!1);n([]);const q=async(r,o,d)=>{if(r&&o.optionUrl){h.value=!0;let u={};try{const s=await ve(o.optionUrl+r,u);s&&s.length>0&&(H.value[d].options=s),h.value=!1}catch(s){console.error("Error fetching data:",s)}finally{h.value=!1}}},V=n(),L=n(!1),{loadRemoteData:U}=we(e.widgetObj,e.widgetObj.widgetParams[0].typeOptions.dataJson,V,L),k=async()=>{console.log("重新加载了数据"),await U(),C()},b=n(null);let w=null;const G=le(()=>{var o;let r=(o=e.widgetObj.widgetParams[1])!=null&&o.value?40:0;return e.widgetObj.widgetOption.height-r+"px"}),a=n({});a.value={title:{show:!0,text:"",subtext:"",textStyle:{color:p.value?"#999":"#333",fontStyle:"normal",fontWeight:"bolder",fontFamily:"sans-serif",fontSize:18}},tooltip:{trigger:"item",show:!0},legend:{show:!0,type:"scroll",textStyle:{color:p.value?"#fff":"#333"},orient:(D=e.widgetObj.widgetParams[8])==null?void 0:D.value,left:(E=e.widgetObj.widgetParams[9])==null?void 0:E.value},grid:{show:!1,left:"6%",right:"4%",bottom:"30px",containLabel:!1},toolbox:{show:!0,feature:{dataView:{readOnly:!1},restore:{},saveAsImage:{}}},series:[]},oe(()=>{Q(),Z()}),se(()=>{$()});const Q=async()=>{await U(),Y()},Y=()=>{I(()=>{w&&w.dispose(),b.value&&(w=re(b.value),C())})},X=()=>{w.setOption(a.value)},C=()=>{var o,d,u,s,f,O,y,v,m,t,c,l,j,M,B,W;a.value.title.textStyle.color=p.value?"#999":"#333",a.value.legend.textStyle.color=p.value?"#999":"#333",a.value.legend.orient=(o=e.widgetObj.widgetParams[8])==null?void 0:o.value,a.value.legend.left=(d=e.widgetObj.widgetParams[9])==null?void 0:d.value,a.value.title.text=(u=e.widgetObj.widgetParams[5])==null?void 0:u.value,a.value.title.subtext=(s=e.widgetObj.widgetParams[6])==null?void 0:s.value,a.value.legend.show=(f=e.widgetObj.widgetParams[7])==null?void 0:f.value,a.value.tooltip.show=(O=e.widgetObj.widgetParams[10])==null?void 0:O.value,a.value.tooltip.trigger=(y=e.widgetObj.widgetParams[11])==null?void 0:y.value,a.value.toolbox.show=(v=e.widgetObj.widgetParams[12])==null?void 0:v.value,a.value.series=[];const r={type:"pie",radius:[((m=e.widgetObj.widgetParams[2])==null?void 0:m.value)+"%",((t=e.widgetObj.widgetParams[3])==null?void 0:t.value)+"%"],top:50,bottom:30,labelLine:{show:!0},padAngle:(c=e.widgetObj.widgetParams[17])==null?void 0:c.value,itemStyle:{borderRadius:(l=e.widgetObj.widgetParams[15])==null?void 0:l.value,borderColor:"#fff",borderWidth:(j=e.widgetObj.widgetParams[16])==null?void 0:j.value},data:e.widgetObj.widgetParams[0].typeOptions.dataJson,label:{show:(M=e.widgetObj.widgetParams[13])==null?void 0:M.value,position:(B=e.widgetObj.widgetParams[14])==null?void 0:B.value}};(W=e.widgetObj.widgetParams[18])!=null&&W.value&&(r.roseType="radius"),a.value.series.push(r),X()},Z=()=>{window.addEventListener("resize",S)},$=()=>{window.removeEventListener("resize",S)},S=()=>{I(()=>{b.value&&w.resize()})};return ne([()=>e.widgetObj,()=>A.value,()=>p.value],()=>{Y(),S()},{deep:!0}),(r,o)=>{var v;const d=g("el-input"),u=g("el-option"),s=g("el-select"),f=g("el-date-picker"),O=g("el-button"),y=g("el-space");return i(),_(P,null,[ie(J("div",me,[z(y,{wrap:""},{default:F(()=>{var m;return[(i(!0),_(P,null,K((m=x.widgetObj.widgetParams[0].typeOptions.dataJson)==null?void 0:m.searchData,(t,c)=>(i(),_(P,null,[t.type=="input"?(i(),R(d,{key:c,modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,size:"small",placeholder:"请输入"+t.label,clearable:"",onKeyup:N(k,["enter"])},null,8,["modelValue","onUpdate:modelValue","placeholder"])):t.type=="select"?(i(),R(s,{class:"pagesearch",style:{"min-width":"120px"},key:c+"select",modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,size:"small",placeholder:"请选择"+t.label,clearable:"",filterable:"",remote:"","remote-method":l=>q(l,t,c),loading:h.value,onKeyup:N(k,["enter"])},{default:F(()=>[(i(!0),_(P,null,K(t.options,(l,j)=>(i(),R(u,{value:l.value,label:l.label,key:j+l.value},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","remote-method","loading"])):ue("",!0)],64))),256)),z(f,{size:"small",modelValue:V.value,"onUpdate:modelValue":o[0]||(o[0]=t=>V.value=t),"unlink-panels":"",type:"monthrange","range-separator":"至","start-placeholder":"起始年月","end-placeholder":"结束年月",format:"YYYY-MM","value-format":"YYYY-MM"},null,8,["modelValue"]),z(O,{size:"small",icon:ce(ge),loading:L.value,circle:"",onClick:k},null,8,["icon","loading"])]}),_:1})],512),[[de,(v=x.widgetObj.widgetParams[1])==null?void 0:v.value]]),J("div",{ref_key:"chartRef",ref:b,style:pe([{width:"100%"},{height:G.value}])},null,4)],64)}}},Oe=ee(he,[["__scopeId","data-v-78857cf5"]]);export{Oe as default};
