import{_ as oe,u as se,s as re,r as i,c as I,o as ne,a as ie,n as F,i as de,w as ue,b as g,d as n,e as _,f as ce,v as ge,g as K,h as N,j as T,F as P,k as A,l as x,m as H,p as q,q as we,t as pe,x as ve}from"./index-CfICaLg9.js";import{u as me,g as be}from"./useWidget-zuxP2hw3.js";const he={class:"date-range"},fe={__name:"pie-widget",props:{widgetObj:{type:Object,required:!0}},setup(k){var D,E,M;const G=se(),{curWrapper:Q,dark:w}=re(G),e=k,R=i((D=e.widgetObj.widgetParams[0].typeOptions.dataJson)==null?void 0:D.searchData),b=i(!1);i([]);const X=async(o,s,d)=>{if(o&&s.optionUrl){b.value=!0;let u={};try{const r=await be(s.optionUrl+o,u);r&&r.length>0&&(R.value[d].options=r),b.value=!1}catch(r){console.error("Error fetching data:",r)}finally{b.value=!1}}},V=i(),L=i(!1),{loadRemoteData:U}=me(e.widgetObj,e.widgetObj.widgetParams[0].typeOptions.dataJson,V,L),S=async()=>{console.log("重新加载了数据"),await U(),C()},h=i(null);let p=null;const Z=I(()=>{var s;let o=(s=e.widgetObj.widgetParams[1])!=null&&s.value?40:0;return e.widgetObj.widgetOption.height-o+"px"}),a=i({});a.value={title:{show:!0,text:"",subtext:"",textStyle:{color:w.value?"#999":"#333",fontStyle:"normal",fontWeight:"bolder",fontFamily:"sans-serif",fontSize:18}},tooltip:{trigger:"item",show:!0},legend:{show:!0,type:"scroll",textStyle:{color:w.value?"#fff":"#333"},orient:(E=e.widgetObj.widgetParams[8])==null?void 0:E.value,left:(M=e.widgetObj.widgetParams[9])==null?void 0:M.value},grid:{show:!1,left:"6%",right:"4%",bottom:"30px",containLabel:!1},toolbox:{show:!0,feature:{dataView:{readOnly:!1},restore:{},saveAsImage:{}}},series:[]},ne(()=>{$(),te()}),ie(()=>{ae()});const $=async()=>{await U(),Y()},Y=()=>{F(()=>{p&&p.dispose(),h.value&&(p=de(h.value),C())})},ee=()=>{p.setOption(a.value)},C=()=>{var s,d,u,r,f,O,y,v,m,t,c,l,j,B,J,W;a.value.title.textStyle.color=w.value?"#999":"#333",a.value.legend.textStyle.color=w.value?"#999":"#333",a.value.legend.orient=(s=e.widgetObj.widgetParams[8])==null?void 0:s.value,a.value.legend.left=(d=e.widgetObj.widgetParams[9])==null?void 0:d.value,a.value.title.text=(u=e.widgetObj.widgetParams[5])==null?void 0:u.value,a.value.title.subtext=(r=e.widgetObj.widgetParams[6])==null?void 0:r.value,a.value.legend.show=(f=e.widgetObj.widgetParams[7])==null?void 0:f.value,a.value.tooltip.show=(O=e.widgetObj.widgetParams[10])==null?void 0:O.value,a.value.tooltip.trigger=(y=e.widgetObj.widgetParams[11])==null?void 0:y.value,a.value.toolbox.show=(v=e.widgetObj.widgetParams[12])==null?void 0:v.value,a.value.series=[];const o={type:"pie",radius:[((m=e.widgetObj.widgetParams[2])==null?void 0:m.value)+"%",((t=e.widgetObj.widgetParams[3])==null?void 0:t.value)+"%"],top:50,bottom:30,labelLine:{show:!0},padAngle:(c=e.widgetObj.widgetParams[17])==null?void 0:c.value,itemStyle:{borderRadius:(l=e.widgetObj.widgetParams[15])==null?void 0:l.value,borderColor:"#fff",borderWidth:(j=e.widgetObj.widgetParams[16])==null?void 0:j.value},data:le.value,label:{show:(B=e.widgetObj.widgetParams[13])==null?void 0:B.value,position:(J=e.widgetObj.widgetParams[14])==null?void 0:J.value}};(W=e.widgetObj.widgetParams[18])!=null&&W.value&&(o.roseType="radius"),a.value.series.push(o),ee()},te=()=>{window.addEventListener("resize",z)},ae=()=>{window.removeEventListener("resize",z)},z=()=>{F(()=>{h.value&&p.resize()})};ue([()=>e.widgetObj,()=>Q.value,()=>w.value],()=>{Y(),z()},{deep:!0});const le=I(()=>{var o;return(o=e.widgetObj.widgetParams[0].typeOptions.dataJson)!=null&&o.data?e.widgetObj.widgetParams[0].typeOptions.dataJson.data:e.widgetObj.widgetParams[0].typeOptions.dataJson});return(o,s)=>{var v;const d=g("el-input"),u=g("el-option"),r=g("el-select"),f=g("el-date-picker"),O=g("el-button"),y=g("el-space");return n(),_(P,null,[ce(K("div",he,[N(y,{wrap:""},{default:T(()=>{var m;return[(n(!0),_(P,null,A(R.value,(t,c)=>(n(),_(P,null,[t.type=="input"?(n(),x(d,{key:c,modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,size:"small",placeholder:"请输入"+t.label,clearable:"",onKeyup:H(S,["enter"])},null,8,["modelValue","onUpdate:modelValue","placeholder"])):t.type=="select"?(n(),x(r,{class:"pagesearch",style:{"min-width":"120px"},key:c+"select",modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,size:"small",placeholder:"请选择"+t.label,clearable:"",filterable:"",remote:"","remote-method":l=>X(l,t,c),loading:b.value,onKeyup:H(S,["enter"])},{default:T(()=>[(n(!0),_(P,null,A(t.options,(l,j)=>(n(),x(u,{value:l.value,label:l.label,key:j+l.value},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","remote-method","loading"])):q("",!0)],64))),256)),(m=k.widgetObj.widgetParams[19])!=null&&m.value?(n(),x(f,{key:0,modelValue:V.value,"onUpdate:modelValue":s[0]||(s[0]=t=>V.value=t),size:"small","unlink-panels":"",type:"monthrange","range-separator":"至","start-placeholder":"起始年月","end-placeholder":"结束年月",format:"YYYY-MM","value-format":"YYYY-MM"},null,8,["modelValue"])):q("",!0),N(O,{icon:we(pe),size:"small",loading:L.value,circle:"",onClick:S},null,8,["icon","loading"])]}),_:1})],512),[[ge,(v=k.widgetObj.widgetParams[1])==null?void 0:v.value]]),K("div",{ref_key:"chartRef",ref:h,style:ve([{width:"100%"},{height:Z.value}])},null,4)],64)}}},je=oe(fe,[["__scopeId","data-v-69b36886"]]);export{je as default};
