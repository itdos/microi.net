import{E as h,_ as f,x as M,j as L,k as m,o as S}from"./main-DrxgF003.js";import{a6 as x,a7 as v,a8 as c,a9 as P,ag as y,aJ as C,f as g,ai as z,af as R,e as _,q as k,L as p,aS as A,ak as j,al as B,W as u,u as D,V as w,aj as E,am as W,an as F,r as O,a0 as G,at as V,D as H}from"./DRACOLoader-DSa8Sn_h.js";class I{constructor(i){this.container=document.querySelector(i),this.camera,this.scene=null,this.renderer,this.controls,this.model,this.loadingStatus=!0,this.fileLoaderMap={glb:new c,fbx:new P(this.loadingManager),gltf:new c,obj:new v(this.loadingManager),stl:new x},this.modelProgressCallback=t=>t,this.ambientLight,this.directionalLight}init(){return new Promise(async(i,t)=>{this.initRender(),this.initCamera(),this.initScene(),this.addEvenListMouseListener(),this.initControls(),this.createLight(),await this.setModel({filePath:"threeFile/glb/glb-10.glb",fileType:"glb",decomposeName:"transformers_10"}),i(!0),this.sceneAnimation()})}initRender(){this.renderer=new y({antialias:!0,alpha:!0,preserveDrawingBuffer:!0}),this.renderer.setPixelRatio(window.devicePixelRatio);const{clientHeight:i,clientWidth:t}=this.container;this.renderer.setSize(t,i),this.renderer.toneMapping=C,this.renderer.autoClear=!0,this.renderer.outputColorSpace=g,this.renderer.toneMappingExposure=1,this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=z,this.container.appendChild(this.renderer.domElement)}initCamera(){const{clientHeight:i,clientWidth:t}=this.container;this.camera=new R(50,t/i,1,2e3)}async initScene(){this.scene=new _;const t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?"environment":"user",s=document.getElementById("video"),{clientWidth:n,clientHeight:a}=this.container,e={video:{width:a,height:n,facingMode:t}},r={video:{width:n,height:a,facingMode:t}},d=t=="environment"?e:r;try{const l=await navigator.mediaDevices.getUserMedia(d);s.srcObject=l,s.play();const o=new k(s);o.minFilter=p,o.magFilter=p,o.colorSpace=g,o.mapping=A,this.scene.background=o,o.update()}catch{h.error("当前设备摄像头无法使用,请检查")}}setModel({filePath:i,fileType:t}){return new Promise((s,n)=>{this.loadingStatus=!1;let a;if(["glb","gltf"].includes(t)){const e=new j;e.setDecoderPath("draco/gltf/"),e.setDecoderConfig({type:"js"}),e.preload(),a=new c().setDRACOLoader(e)}else a=this.fileLoaderMap[t];a.load(i,e=>{switch(t){case"glb":this.model=e.scene;break;case"fbx":this.model=e;break;case"gltf":this.model=e.scene;break;case"obj":this.model=e;break;case"stl":const r=new B,d=new u(e,r);this.model=d;break}this.setModelPositionSize(),this.scene.add(this.model),s(!0)},e=>{this.modelProgressCallback(e.loaded)},e=>{h.error("文件错误"),console.log(e),s(!0)})})}onProgress(i){typeof i=="function"&&(this.modelProgressCallback=i)}setModelPositionSize(){this.model.traverse(r=>{r.isMesh&&r.material&&(r.castShadow=!0,r.frustumCulled=!1)}),this.model.updateMatrixWorld();const i=new D().setFromObject(this.model),t=i.getSize(new w),s=i.getCenter(new w),n=Math.max(t.x,t.y,t.z),e=2/(n>1?n:.5);this.model.scale.set(e,e,e),this.model.position.sub(s.multiplyScalar(e)),this.controls.maxDistance=t.length()*10,this.camera.position.set(0,2,6),this.camera.updateProjectionMatrix()}sceneAnimation(){this.renderAnimation=requestAnimationFrame(()=>this.sceneAnimation()),this.controls.update(),this.renderer.render(this.scene,this.camera)}addEvenListMouseListener(){this.onWindowResizesListener=this.onWindowResizes.bind(this),window.addEventListener("resize",this.onWindowResizesListener)}onWindowResizes(){if(!this.container)return!1;const{clientHeight:i,clientWidth:t}=this.container;this.camera.aspect=t/i,this.camera.updateProjectionMatrix(),this.renderer.setSize(t,i)}initControls(){this.controls=new E(this.camera,this.renderer.domElement),this.controls.enablePan=!0,this.controls.enableDamping=!0,this.controls.target.set(0,0,0),this.controls.update()}createLight(){this.ambientLight=new W("#fff",3),this.scene.add(this.ambientLight),this.directionalLight=new F("#fff",5);const{x:i,y:t,z:s}=O(-6.48,-4.58,3);this.directionalLight.position.set(i,t,s),this.directionalLight.castShadow=!0,this.scene.add(this.directionalLight);const n=new G(2e3,2e3),a=new V({color:0,opacity:.5}),e=new u(n,a);e.rotation.x=-Math.PI/2,e.position.set(0,-1.2,0),e.receiveShadow=!0,e.material.side=H,e.material.color.set("#23191F"),e.geometry.verticesNeedUpdate=!0,this.scene.add(e)}}const q={id:"vr-page"},N={__name:"index",setup(b){return M(async()=>{await new I("#vr-model").init()}),(i,t)=>(S(),L("div",q,t[0]||(t[0]=[m("div",{id:"vr-model"},null,-1),m("video",{id:"video",playsinline:"",muted:"",autoplay:""},null,-1)])))}},J=f(N,[["__scopeId","data-v-b1f764cb"]]);export{J as default};
