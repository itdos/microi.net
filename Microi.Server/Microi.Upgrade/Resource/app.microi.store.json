{"PackageInfo":{"Name":"未命名应用包","Version":"1.0.0","CreateTime":"2026-02-05T11:13:59.391Z","CreateUser":"管理员","OsClient":"iTdos","MenuCount":1,"TableCount":1,"FieldCount":19,"FlowCount":0,"NodeCount":0,"LineCount":0,"DDLCount":1,"ApiEngineCount":2},"DDLStatements":[{"TableName":"Sys_MicroiStore","TableId":"6cf254f1-edd0-4f04-96bc-c9ad08b5a2c1","DDL":"CREATE TABLE IF NOT EXISTS `Sys_MicroiStore` (\n  `Id` varchar(36) NOT NULL PRIMARY KEY,\n  `CreateTime` datetime NULL COMMENT '创建时间',\n  `UpdateTime` datetime NULL COMMENT '修改时间',\n  `UserId` varchar(36) NULL COMMENT '创建人Id',\n  `UserName` varchar(255) NULL COMMENT '创建人',\n  `IsDeleted` int NULL COMMENT '是否已删除',\n  `BtnMakeApp` varchar(255) NULL COMMENT '开始制作',\n  `SelectApiEngine` varchar(255) NULL COMMENT '选择接口引擎',\n  `SelectWF` varchar(255) NULL COMMENT '选择流程',\n  `SelectMenu` varchar(255) NULL COMMENT '选择模块',\n  `ClientMinVersion` varchar(50) NULL COMMENT '前端最低版本',\n  `ServerMinVersion` varchar(50) NULL COMMENT '后端最低版本',\n  `AppId` varchar(50) NULL COMMENT '应用Id',\n  `AppAuthorAvatar` varchar(255) NULL COMMENT '作者头像',\n  `AppPrice` int NULL COMMENT '价格',\n  `AppDetail` varchar(255) NULL COMMENT '应用介绍',\n  `AppRate` decimal(18,1) NULL COMMENT '评分',\n  `AppPakcet` varchar(255) NULL COMMENT '数据包',\n  `IsApprove` varchar(255) NULL COMMENT '审核通过',\n  `AppOriPrice` int NULL COMMENT '原价',\n  `AppAuthor` varchar(50) NULL COMMENT '作者',\n  `AppUpdateTime` varchar(25) NULL COMMENT '更新时间',\n  `AppPublishTime` varchar(25) NULL COMMENT '发布时间',\n  `AppVersion` varchar(50) NULL COMMENT '版本号',\n  `AppName` varchar(50) NULL COMMENT '应用名称'\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;"}],"SysMenus":[{"DiyTableName":"Sys_MicroiStore","HiddenIndex":0,"GeneralSeaarch":0,"SelectApi":"https://api.itdos.com/apiengine/get-microi-store-list?OsClient=iTdos","FixedFields":"[]","MobileListFields":"[]","IsChildSystem":0,"ModuleEngineKey":"sys_microistore","TableCardImgField":"AppPreview","TableCardCol":8,"SecondMenuRow":0,"SecondMenuColumn":0,"DefaultPageSize":0,"SecondMenuLineCount":0,"MacScreenIndex":0,"HasChild":0,"SizeHeightMac":"1","SizeWidthMac":"1","DisplayMac":1,"AppDisplay":1,"Display":1,"InTableEditFields":"[]","PageTabs":"[]","ComponentName":"搜索+卡片","MoreBtns":"[{\"Id\":\"\",\"Name\":\"安装\",\"Icon\":\"Cloudy\",\"BtnStyle\":\"primary\",\"V8Code\":\"debugger;\\nV8.ConfirmTips('确认以覆盖的形式安装此应用？应用商城为刚上线新功能，安装前请备份好数据库！', function () {\\n  //获取数据包\\n  V8.Post(\\\"https://api.itdos.com/apiengine/get-microi-store-model?OsClient=iTdos\\\", {\\n    Id: V8.Form.Id\\n  }, function(result) {\\n    if(result.Code != 1) {\\n      V8.Tips(\\\"获取数据包失败：\\\" + result.Msg, false);\\n      return;\\n    }\\n    if (!result.Data.AppPakcet || !result.Data.AppPakcet.trim()) { \\n      V8.Tips(\\\"数据包中不存在数据，无法安装！\\\", false);\\n      return;\\n    }\\n    //开始安装\\n    V8.ApiEngine.Run(\\\"import-microi-store-package\\\", {\\n      Package: JSON.parse(result.Data.AppPakcet)\\n    }, function (result2) {\\n      if (result2.Code != 1) {\\n        V8.Tips(\\\"安装失败：\\\" + result2.Msg, false)\\n        return;\\n      }\\n      V8.Tips(\\\"安装成功，请刷新系统，新模块可能需要在[角色权限]模块配置权限！\\\")\\n    })\\n  })\\n});\",\"V8CodeShow\":\"\",\"ShowRow\":1}]","Name":"应用商城","BatchSelectMoreBtns":"[]","SortFieldIds":"[]","DiyConfig":"{\"HiddenIndex\":0,\"GeneralSeaarch\":0}","Url":"/microi-store","IconClass":"fab fa-app-store","ExportMoreBtns":"[]","ComponentPath":"/diy/diy-table-rowlist","SearchFieldIds":"[]","InTableEdit":0,"Sort":0,"TableHeaders":"[]","MultRun":0,"IsMicroiService":0,"StatisticsFields":"[]","NotShowFields":"[]","DiyTableId":"6cf254f1-edd0-4f04-96bc-c9ad08b5a2c1","PageBtns":"[]","TableDiyFieldIds":"[]","Icon":"/itdos/img/20241021/appstore.png","OpenType":"Diy","SelectFields":"[]","FormBtns":"[]","JoinTables":"[]","DisplayWin":1,"ParentId":"cdc0844b-7249-4d64-a9c3-563a15c9cd20","Id":"61b7faee-35b2-4571-add2-5231a355f368","CreateTime":"2022-08-08 21:50:12"}],"DiyTables":[{"DataLogRole":"[]","FormOpenType":"Drawer","IsAnonymousAdd":0,"EnableCache":0,"TreeLazy":0,"DataEncryptTransfer":0,"IsTree":0,"Name":"Sys_MicroiStore","BindRole":"[]","Tabs":"[{\"Name\":\"应用信息\",\"EnName\":\"none\",\"Display\":true,\"Sort\":1,\"Id\":\"01KGEJJY56ESY1Q8M6B6JBY6V3\",\"Icon\":\"Cloudy\"},{\"Sort\":2,\"Name\":\"数据包\",\"Id\":\"01KGFEDBPR9WZ800PYC63P8RRG\",\"Icon\":\"Coin\",\"Display\":true},{\"Sort\":3,\"Name\":\"制作应用\",\"Id\":\"01KGFEETNK3KVYXEF3BNH6WXFX\",\"Icon\":\"Management\",\"Display\":true}]","Description":"应用商城","IsAnonymousRead":0,"ApiReplace":"{\"Insert\":\"\",\"Update\":\"\",\"Delete\":\"\",\"Select\":\"https://api.itdos.com/apiengine/get-microi-store-model?OsClient=iTdos\"}","TableTabs":"[]","DataEncryptSave":0,"Column":3,"RowAction":"[]","Id":"6cf254f1-edd0-4f04-96bc-c9ad08b5a2c1","CreateTime":"2022-04-08 15:36:27"}],"DiyFields":[{"TableName":"Sys_MicroiStore","AppVisible":1,"Label":"开始制作","NotEmpty":0,"Sort":1900,"Data":"[]","IsLockField":0,"Visible":1,"Component":"Button","BindRole":"[]","Encrypt":0,"Readonly":0,"TableId":"6cf254f1-edd0-4f04-96bc-c9ad08b5a2c1","Config":"{\"ParamData\":{},\"KeysAddVisible\":false,\"KeysAddVModel\":\"\",\"V8Code\":\"//获取相关数据\\ndebugger;\\nvar MenuIds = [];\\nvar FlowIds = [];\\nvar ApiEngineKeys = [];\\nif (V8.Form.SelectMenu && V8.Form.SelectMenu.length > 0) {\\n  MenuIds = V8.Form.SelectMenu.map(item => { return item.Id });\\n}\\nif (V8.Form.SelectWF && V8.Form.SelectWF.length > 0) {\\n  FlowIds = V8.Form.SelectWF.map(item => { return item.Id });\\n}\\nif (V8.Form.SelectApiEngine && V8.Form.SelectApiEngine.length > 0) {\\n  ApiEngineKeys = V8.Form.SelectApiEngine.map(item => { return item.ApiEngineKey });\\n}\\nif (MenuIds.length == 0 && FlowIds.length == 0 && ApiEngineKeys.length == 0) {\\n  V8.Tips('菜单、流程、接口模块至少选择1个！', false);\\n  return;\\n}\\n//执行导出数据包\\nvar packageResult = await V8.ApiEngine.Run(\\\"export-microi-store-package\\\", {\\n  MenuIds, FlowIds, ApiEngineKeys\\n});\\nif (packageResult.Code != 1) {\\n  V8.Tips('制作失败：' + packageResult.Msg, false);\\n  return;\\n}\\nV8.FormSet('AppPakcet', JSON.stringify(packageResult.Data));\\nV8.Tips('制作成功！，请查看数据包！');\\n\\n\\n\\n\",\"V8CodeBlur\":\"\",\"Button\":{\"Type\":\"primary\",\"Loading\":false,\"Icon\":\"\",\"Size\":\"small\",\"PreviewCanClick\":true},\"Sql\":\"\",\"EnableSearch\":true,\"NumberTextStep\":1,\"NumberTextPrecision\":0,\"NumberText\":0,\"NumberTextMath\":\"\",\"NumberTextBtn\":true,\"NumberTextBtnPosition\":\"right\",\"DividerPosition\":\"left\",\"DataSource\":\"\",\"DataSourceSqlRemote\":false,\"DataSourceSqlRemoteLoading\":false,\"DataSourceId\":\"\",\"DataSourceApiEngineKey\":\"\",\"TextShowPassword\":false,\"TextIcon\":\"\",\"TextIconPosition\":\"\",\"TextApend\":\"\",\"TextApendPosition\":\"\",\"SelectLabel\":\"\",\"SelectSaveField\":\"\",\"SelectSaveFormat\":\"Text\",\"DateTimeType\":\"date\",\"TextAutocomplete\":false,\"AutoNumberFixed\":\"\",\"AutoNumberLength\":1,\"AutoNumberFields\":[],\"DevComponentName\":\"\",\"DevComponentPath\":\"\",\"TableChildTableId\":\"\",\"TableChildSysMenuId\":\"\",\"TableChildSysMenuName\":\"\",\"TableChildFkFieldName\":\"\",\"TableChildCallbackField\":\"\",\"TableChildRowClickV8\":\"\",\"MapCompany\":\"Baidu\"}","TableWidth":120,"NameConfirm":1,"Unique":0,"InTableEdit":0,"Name":"BtnMakeApp","Tab":"01KGFEETNK3KVYXEF3BNH6WXFX","Id":"01KGFEPBXFNNCAN2WAAHRHW553","CreateTime":"2026-02-02 23:14:15"},{"TableName":"Sys_MicroiStore","AppVisible":1,"Label":"选择接口引擎","NotEmpty":0,"Sort":1800,"Data":"[]","IsLockField":0,"Visible":1,"Component":"MultipleSelect","BindRole":"[]","Encrypt":0,"Readonly":0,"TableId":"6cf254f1-edd0-4f04-96bc-c9ad08b5a2c1","Config":"{\"ParamData\":{},\"KeysAddVisible\":false,\"KeysAddVModel\":\"\",\"Sql\":\"select Id,CONCAT(ApiName,' - ', ApiEngineKey) ApiName,ApiEngineKey from sys_apiengine where IsDeleted<>1\",\"EnableSearch\":true,\"V8Code\":\"\",\"V8CodeBlur\":\"\",\"DataSource\":\"Sql\",\"DataSourceSqlRemote\":false,\"DataSourceId\":\"\",\"DataSourceApiEngineKey\":\"\",\"SelectLabel\":\"ApiName\",\"SelectSaveField\":\"\",\"SelectSaveFormat\":\"Text\",\"NumberTextStep\":1,\"NumberTextPrecision\":0,\"NumberText\":0,\"NumberTextMath\":\"\",\"NumberTextBtn\":true,\"NumberTextBtnPosition\":\"right\",\"DividerPosition\":\"left\",\"DataSourceSqlRemoteLoading\":false,\"TextShowPassword\":false,\"TextIcon\":\"\",\"TextIconPosition\":\"\",\"TextApend\":\"\",\"TextApendPosition\":\"\",\"DateTimeType\":\"date\",\"TextAutocomplete\":false,\"AutoNumberFixed\":\"\",\"AutoNumberLength\":1,\"AutoNumberFields\":[],\"DevComponentName\":\"\",\"DevComponentPath\":\"\",\"TableChildTableId\":\"\",\"TableChildSysMenuId\":\"\",\"TableChildSysMenuName\":\"\",\"TableChildFkFieldName\":\"\",\"TableChildCallbackField\":\"\",\"TableChildRowClickV8\":\"\",\"MapCompany\":\"Baidu\"}","TableWidth":120,"NameConfirm":1,"Unique":0,"InTableEdit":0,"Name":"SelectApiEngine","Type":"mediumtext","Tab":"01KGFEETNK3KVYXEF3BNH6WXFX","FormWidth":12,"Id":"01KGFEN9RA5VBGWNNAF9PYXW2V","CreateTime":"2026-02-02 23:13:40"},{"TableName":"Sys_MicroiStore","AppVisible":1,"Label":"选择流程","NotEmpty":0,"Sort":1700,"Data":"[]","IsLockField":0,"Visible":1,"Component":"MultipleSelect","BindRole":"[]","Encrypt":0,"Readonly":0,"TableId":"6cf254f1-edd0-4f04-96bc-c9ad08b5a2c1","Config":"{\"ParamData\":{},\"KeysAddVisible\":false,\"KeysAddVModel\":\"\",\"Sql\":\"select Id,FlowName from wf_flowdesign where IsDeleted<>1\",\"EnableSearch\":true,\"V8Code\":\"\",\"V8CodeBlur\":\"\",\"DataSource\":\"Sql\",\"DataSourceSqlRemote\":false,\"DataSourceId\":\"\",\"DataSourceApiEngineKey\":\"\",\"SelectLabel\":\"FlowName\",\"SelectSaveField\":\"\",\"SelectSaveFormat\":\"Text\",\"NumberTextStep\":1,\"NumberTextPrecision\":0,\"NumberText\":0,\"NumberTextMath\":\"\",\"NumberTextBtn\":true,\"NumberTextBtnPosition\":\"right\",\"DividerPosition\":\"left\",\"DataSourceSqlRemoteLoading\":false,\"TextShowPassword\":false,\"TextIcon\":\"\",\"TextIconPosition\":\"\",\"TextApend\":\"\",\"TextApendPosition\":\"\",\"DateTimeType\":\"date\",\"TextAutocomplete\":false,\"AutoNumberFixed\":\"\",\"AutoNumberLength\":1,\"AutoNumberFields\":[],\"DevComponentName\":\"\",\"DevComponentPath\":\"\",\"TableChildTableId\":\"\",\"TableChildSysMenuId\":\"\",\"TableChildSysMenuName\":\"\",\"TableChildFkFieldName\":\"\",\"TableChildCallbackField\":\"\",\"TableChildRowClickV8\":\"\",\"MapCompany\":\"Baidu\"}","TableWidth":120,"NameConfirm":1,"Unique":0,"InTableEdit":0,"Name":"SelectWF","Type":"mediumtext","Tab":"01KGFEETNK3KVYXEF3BNH6WXFX","FormWidth":12,"Id":"01KGFEKSVGJQKG75ARGPHM7P70","CreateTime":"2026-02-02 23:12:51"},{"TableName":"Sys_MicroiStore","AppVisible":1,"Label":"选择模块","NotEmpty":0,"Sort":1600,"Data":"[]","IsLockField":0,"Visible":1,"Component":"SelectTree","BindRole":"[]","Encrypt":0,"Readonly":0,"TableId":"6cf254f1-edd0-4f04-96bc-c9ad08b5a2c1","Config":"{\"ParamData\":{},\"KeysAddVisible\":false,\"KeysAddVModel\":\"\",\"Sql\":\"select Id,Name,ParentId from sys_menu where IsDeleted<>1\",\"EnableSearch\":true,\"V8Code\":\"\",\"V8CodeBlur\":\"\",\"DataSource\":\"Sql\",\"DataSourceSqlRemote\":false,\"DataSourceId\":\"\",\"DataSourceApiEngineKey\":\"\",\"SelectLabel\":\"Name\",\"SelectSaveField\":\"\",\"SelectSaveFormat\":\"Text\",\"SelectTree\":{\"Lazy\":false,\"Filterable\":true,\"Value\":\"\",\"Label\":\"\",\"Children\":\"\",\"ParentField\":\"ParentId\",\"ParentFields\":\"ParentIds\",\"Multiple\":true,\"Disabled\":\"\",\"Leaf\":\"\",\"ParentChildLinkage\":false},\"NumberTextStep\":1,\"NumberTextPrecision\":0,\"NumberText\":0,\"NumberTextMath\":\"\",\"NumberTextBtn\":true,\"NumberTextBtnPosition\":\"right\",\"DividerPosition\":\"left\",\"DataSourceSqlRemoteLoading\":false,\"TextShowPassword\":false,\"TextIcon\":\"\",\"TextIconPosition\":\"\",\"TextApend\":\"\",\"TextApendPosition\":\"\",\"DateTimeType\":\"date\",\"TextAutocomplete\":false,\"AutoNumberFixed\":\"\",\"AutoNumberLength\":1,\"AutoNumberFields\":[],\"DevComponentName\":\"\",\"DevComponentPath\":\"\",\"TableChildTableId\":\"\",\"TableChildSysMenuId\":\"\",\"TableChildSysMenuName\":\"\",\"TableChildFkFieldName\":\"\",\"TableChildCallbackField\":\"\",\"TableChildRowClickV8\":\"\",\"MapCompany\":\"Baidu\"}","TableWidth":120,"NameConfirm":1,"Unique":0,"InTableEdit":0,"Name":"SelectMenu","Type":"mediumtext","Tab":"01KGFEETNK3KVYXEF3BNH6WXFX","FormWidth":12,"Id":"01KGFEK0FMF5J5AZPCSEXQW2XA","CreateTime":"2026-02-02 23:12:25"},{"TableName":"Sys_MicroiStore","AppVisible":1,"Label":"前端最低版本","NotEmpty":0,"Sort":1300,"Data":"[]","IsLockField":0,"Visible":0,"Component":"Text","BindRole":"[]","Encrypt":0,"Readonly":0,"TableId":"6cf254f1-edd0-4f04-96bc-c9ad08b5a2c1","Config":"{\"ParamData\":{},\"KeysAddVisible\":false,\"KeysAddVModel\":\"\",\"V8Code\":\"\",\"V8CodeBlur\":\"\",\"TextShowPassword\":false,\"TextIcon\":\"\",\"TextIconPosition\":\"\",\"TextApend\":\"\",\"TextApendPosition\":\"\",\"TextAutocomplete\":false,\"Sql\":\"\",\"EnableSearch\":true,\"NumberTextStep\":1,\"NumberTextPrecision\":0,\"NumberText\":0,\"NumberTextMath\":\"\",\"NumberTextBtn\":true,\"NumberTextBtnPosition\":\"right\",\"DividerPosition\":\"left\",\"DataSource\":\"\",\"DataSourceSqlRemote\":false,\"DataSourceSqlRemoteLoading\":false,\"DataSourceId\":\"\",\"DataSourceApiEngineKey\":\"\",\"SelectLabel\":\"\",\"SelectSaveField\":\"\",\"SelectSaveFormat\":\"Text\",\"DateTimeType\":\"date\",\"AutoNumberFixed\":\"\",\"AutoNumberLength\":1,\"AutoNumberFields\":[],\"DevComponentName\":\"\",\"DevComponentPath\":\"\",\"TableChildTableId\":\"\",\"TableChildSysMenuId\":\"\",\"TableChildSysMenuName\":\"\",\"TableChildFkFieldName\":\"\",\"TableChildCallbackField\":\"\",\"TableChildRowClickV8\":\"\",\"MapCompany\":\"Baidu\"}","TableWidth":120,"NameConfirm":1,"Unique":0,"InTableEdit":0,"Name":"ClientMinVersion","Type":"varchar(50)","Id":"9430a809-e67f-4be4-9080-2b10783fa2f2","CreateTime":"2023-02-28 12:19:14"},{"TableName":"Sys_MicroiStore","AppVisible":1,"Label":"后端最低版本","NotEmpty":0,"Sort":1100,"Data":"[]","IsLockField":0,"Visible":0,"Component":"Text","BindRole":"[]","Encrypt":0,"Readonly":0,"TableId":"6cf254f1-edd0-4f04-96bc-c9ad08b5a2c1","Config":"{\"ParamData\":{},\"KeysAddVisible\":false,\"KeysAddVModel\":\"\",\"V8Code\":\"\",\"V8CodeBlur\":\"\",\"TextShowPassword\":false,\"TextIcon\":\"\",\"TextIconPosition\":\"\",\"TextApend\":\"\",\"TextApendPosition\":\"\",\"TextAutocomplete\":false,\"Sql\":\"\",\"EnableSearch\":true,\"NumberTextStep\":1,\"NumberTextPrecision\":0,\"NumberText\":0,\"NumberTextMath\":\"\",\"NumberTextBtn\":true,\"NumberTextBtnPosition\":\"right\",\"DividerPosition\":\"left\",\"DataSource\":\"\",\"DataSourceSqlRemote\":false,\"DataSourceSqlRemoteLoading\":false,\"DataSourceId\":\"\",\"DataSourceApiEngineKey\":\"\",\"SelectLabel\":\"\",\"SelectSaveField\":\"\",\"SelectSaveFormat\":\"Text\",\"DateTimeType\":\"date\",\"AutoNumberFixed\":\"\",\"AutoNumberLength\":1,\"AutoNumberFields\":[],\"DevComponentName\":\"\",\"DevComponentPath\":\"\",\"TableChildTableId\":\"\",\"TableChildSysMenuId\":\"\",\"TableChildSysMenuName\":\"\",\"TableChildFkFieldName\":\"\",\"TableChildCallbackField\":\"\",\"TableChildRowClickV8\":\"\",\"MapCompany\":\"Baidu\"}","TableWidth":120,"NameConfirm":1,"Unique":0,"InTableEdit":0,"Name":"ServerMinVersion","Type":"varchar(50)","Id":"b6c850d2-4569-417a-ac47-b0ecfc17a8c9","CreateTime":"2023-02-28 12:19:12"},{"TableName":"Sys_MicroiStore","AppVisible":1,"Label":"应用Id","NotEmpty":1,"Sort":200,"Data":"[]","IsLockField":0,"Visible":1,"Component":"Text","BindRole":"[]","Encrypt":0,"Readonly":0,"TableId":"6cf254f1-edd0-4f04-96bc-c9ad08b5a2c1","Config":"{\"ParamData\":{},\"KeysAddVisible\":false,\"KeysAddVModel\":\"\",\"V8Code\":\"\",\"V8CodeBlur\":\"\",\"TextShowPassword\":false,\"TextIcon\":\"\",\"TextIconPosition\":\"\",\"TextApend\":\"\",\"TextApendPosition\":\"\",\"TextAutocomplete\":false,\"Sql\":\"\",\"EnableSearch\":true,\"NumberTextStep\":1,\"NumberTextPrecision\":0,\"NumberText\":0,\"NumberTextMath\":\"\",\"NumberTextBtn\":true,\"NumberTextBtnPosition\":\"right\",\"DividerPosition\":\"left\",\"DataSource\":\"\",\"DataSourceSqlRemote\":false,\"DataSourceSqlRemoteLoading\":false,\"DataSourceId\":\"\",\"DataSourceApiEngineKey\":\"\",\"SelectLabel\":\"\",\"SelectSaveField\":\"\",\"SelectSaveFormat\":\"Text\",\"DateTimeType\":\"date\",\"AutoNumberFixed\":\"\",\"AutoNumberLength\":1,\"AutoNumberFields\":[],\"DevComponentName\":\"\",\"DevComponentPath\":\"\",\"TableChildTableId\":\"\",\"TableChildSysMenuId\":\"\",\"TableChildSysMenuName\":\"\",\"TableChildFkFieldName\":\"\",\"TableChildCallbackField\":\"\",\"TableChildRowClickV8\":\"\",\"MapCompany\":\"Baidu\"}","TableWidth":120,"NameConfirm":1,"Unique":1,"InTableEdit":0,"Name":"AppId","Type":"varchar(50)","Id":"9a4cb262-d623-4221-a5af-8a1afba790c1","CreateTime":"2022-08-08 23:08:53"},{"TableName":"Sys_MicroiStore","AppVisible":1,"Label":"作者头像","NotEmpty":0,"Sort":800,"Data":"[]","IsLockField":0,"Visible":1,"Component":"ImgUpload","BindRole":"[]","Encrypt":0,"Readonly":0,"TableId":"6cf254f1-edd0-4f04-96bc-c9ad08b5a2c1","Config":"{\"ParamData\":{},\"KeysAddVisible\":false,\"KeysAddVModel\":\"\",\"V8Code\":\"\",\"V8CodeBlur\":\"\",\"ImgUpload\":{\"Limit\":false,\"Multiple\":false,\"Tips\":\"\",\"MaxCount\":10,\"ShowFileList\":false,\"Preview\":true,\"MaxSize\":10},\"Sql\":\"\",\"EnableSearch\":true,\"NumberTextStep\":1,\"NumberTextPrecision\":0,\"NumberText\":0,\"NumberTextMath\":\"\",\"NumberTextBtn\":true,\"NumberTextBtnPosition\":\"right\",\"DividerPosition\":\"left\",\"DataSource\":\"\",\"DataSourceSqlRemote\":false,\"DataSourceSqlRemoteLoading\":false,\"DataSourceId\":\"\",\"DataSourceApiEngineKey\":\"\",\"TextShowPassword\":false,\"TextIcon\":\"\",\"TextIconPosition\":\"\",\"TextApend\":\"\",\"TextApendPosition\":\"\",\"SelectLabel\":\"\",\"SelectSaveField\":\"\",\"SelectSaveFormat\":\"Text\",\"DateTimeType\":\"date\",\"TextAutocomplete\":false,\"AutoNumberFixed\":\"\",\"AutoNumberLength\":1,\"AutoNumberFields\":[],\"DevComponentName\":\"\",\"DevComponentPath\":\"\",\"TableChildTableId\":\"\",\"TableChildSysMenuId\":\"\",\"TableChildSysMenuName\":\"\",\"TableChildFkFieldName\":\"\",\"TableChildCallbackField\":\"\",\"TableChildRowClickV8\":\"\",\"MapCompany\":\"Baidu\"}","TableWidth":120,"NameConfirm":1,"Unique":0,"InTableEdit":0,"Name":"AppAuthorAvatar","Type":"mediumtext","Id":"78cc651b-1a1e-49b5-9d80-b816afc60f88","CreateTime":"2022-08-08 22:50:11"},{"TableName":"Sys_MicroiStore","AppVisible":1,"Label":"价格","NotEmpty":0,"Sort":1200,"Data":"[]","IsLockField":0,"Visible":0,"Component":"NumberText","BindRole":"[]","Encrypt":0,"Readonly":0,"TableId":"6cf254f1-edd0-4f04-96bc-c9ad08b5a2c1","Config":"{\"ParamData\":{},\"KeysAddVisible\":false,\"KeysAddVModel\":\"\",\"NumberTextStep\":1,\"NumberTextPrecision\":0,\"NumberText\":0,\"NumberTextMath\":\"\",\"NumberTextBtn\":true,\"NumberTextBtnPosition\":\"right\",\"V8Code\":\"\",\"V8CodeBlur\":\"\",\"Sql\":\"\",\"EnableSearch\":true,\"DividerPosition\":\"left\",\"DataSource\":\"\",\"DataSourceSqlRemote\":false,\"DataSourceSqlRemoteLoading\":false,\"DataSourceId\":\"\",\"DataSourceApiEngineKey\":\"\",\"TextShowPassword\":false,\"TextIcon\":\"\",\"TextIconPosition\":\"\",\"TextApend\":\"\",\"TextApendPosition\":\"\",\"SelectLabel\":\"\",\"SelectSaveField\":\"\",\"SelectSaveFormat\":\"Text\",\"DateTimeType\":\"date\",\"TextAutocomplete\":false,\"AutoNumberFixed\":\"\",\"AutoNumberLength\":1,\"AutoNumberFields\":[],\"DevComponentName\":\"\",\"DevComponentPath\":\"\",\"TableChildTableId\":\"\",\"TableChildSysMenuId\":\"\",\"TableChildSysMenuName\":\"\",\"TableChildFkFieldName\":\"\",\"TableChildCallbackField\":\"\",\"TableChildRowClickV8\":\"\",\"MapCompany\":\"Baidu\"}","TableWidth":120,"NameConfirm":1,"Unique":0,"InTableEdit":0,"Name":"AppPrice","Type":"int","Id":"47eebac2-a97f-4c49-ac4c-9756b9768a4f","CreateTime":"2022-08-08 16:38:44"},{"TableName":"Sys_MicroiStore","AppVisible":1,"Label":"应用介绍","NotEmpty":0,"Sort":1400,"Data":"[]","IsLockField":0,"Visible":1,"Component":"RichText","BindRole":"[]","Encrypt":0,"Readonly":0,"TableId":"6cf254f1-edd0-4f04-96bc-c9ad08b5a2c1","Config":"{\"ParamData\":{},\"KeysAddVisible\":false,\"KeysAddVModel\":\"\",\"V8Code\":\"\",\"V8CodeBlur\":\"\",\"RichText\":{\"EditorProduct\":\"\"},\"Sql\":\"\",\"EnableSearch\":true,\"NumberTextStep\":1,\"NumberTextPrecision\":0,\"NumberText\":0,\"NumberTextMath\":\"\",\"NumberTextBtn\":true,\"NumberTextBtnPosition\":\"right\",\"DividerPosition\":\"left\",\"DataSource\":\"\",\"DataSourceSqlRemote\":false,\"DataSourceSqlRemoteLoading\":false,\"DataSourceId\":\"\",\"DataSourceApiEngineKey\":\"\",\"TextShowPassword\":false,\"TextIcon\":\"\",\"TextIconPosition\":\"\",\"TextApend\":\"\",\"TextApendPosition\":\"\",\"SelectLabel\":\"\",\"SelectSaveField\":\"\",\"SelectSaveFormat\":\"Text\",\"DateTimeType\":\"date\",\"TextAutocomplete\":false,\"AutoNumberFixed\":\"\",\"AutoNumberLength\":1,\"AutoNumberFields\":[],\"DevComponentName\":\"\",\"DevComponentPath\":\"\",\"TableChildTableId\":\"\",\"TableChildSysMenuId\":\"\",\"TableChildSysMenuName\":\"\",\"TableChildFkFieldName\":\"\",\"TableChildCallbackField\":\"\",\"TableChildRowClickV8\":\"\",\"MapCompany\":\"Baidu\"}","TableWidth":100,"NameConfirm":1,"Unique":0,"InTableEdit":0,"Name":"AppDetail","Type":"mediumtext","FormWidth":24,"Id":"14e41854-796a-4a0f-9eb1-bcfb37820197","CreateTime":"2022-04-08 15:48:59"},{"TableName":"Sys_MicroiStore","AppVisible":1,"Label":"评分","NotEmpty":0,"Sort":700,"Data":"[]","IsLockField":0,"Visible":1,"Component":"Rate","BindRole":"[]","Encrypt":0,"Readonly":0,"TableId":"6cf254f1-edd0-4f04-96bc-c9ad08b5a2c1","Config":"{\"ParamData\":{},\"KeysAddVisible\":false,\"KeysAddVModel\":\"\",\"V8Code\":\"\",\"V8CodeBlur\":\"\",\"Sql\":\"\",\"EnableSearch\":true,\"NumberTextStep\":1,\"NumberTextPrecision\":0,\"NumberText\":0,\"NumberTextMath\":\"\",\"NumberTextBtn\":true,\"NumberTextBtnPosition\":\"right\",\"DividerPosition\":\"left\",\"DataSource\":\"\",\"DataSourceSqlRemote\":false,\"DataSourceSqlRemoteLoading\":false,\"DataSourceId\":\"\",\"DataSourceApiEngineKey\":\"\",\"TextShowPassword\":false,\"TextIcon\":\"\",\"TextIconPosition\":\"\",\"TextApend\":\"\",\"TextApendPosition\":\"\",\"SelectLabel\":\"\",\"SelectSaveField\":\"\",\"SelectSaveFormat\":\"Text\",\"DateTimeType\":\"date\",\"TextAutocomplete\":false,\"AutoNumberFixed\":\"\",\"AutoNumberLength\":1,\"AutoNumberFields\":[],\"DevComponentName\":\"\",\"DevComponentPath\":\"\",\"TableChildTableId\":\"\",\"TableChildSysMenuId\":\"\",\"TableChildSysMenuName\":\"\",\"TableChildFkFieldName\":\"\",\"TableChildCallbackField\":\"\",\"TableChildRowClickV8\":\"\",\"MapCompany\":\"Baidu\"}","TableWidth":100,"NameConfirm":1,"Unique":0,"InTableEdit":0,"Name":"AppRate","Type":"decimal(18,1)","Id":"d8944437-0ea5-47d3-93ae-84587b62d2b5","CreateTime":"2022-04-08 15:48:03"},{"TableName":"Sys_MicroiStore","AppVisible":1,"Label":"数据包","NotEmpty":0,"Sort":1500,"Data":"[]","IsLockField":0,"Visible":1,"Component":"Textarea","BindRole":"[]","Encrypt":0,"Readonly":0,"TableId":"6cf254f1-edd0-4f04-96bc-c9ad08b5a2c1","Config":"{\"ParamData\":{},\"KeysAddVisible\":false,\"KeysAddVModel\":\"\",\"V8Code\":\"\",\"V8CodeBlur\":\"\",\"Sql\":\"\",\"EnableSearch\":true,\"NumberTextStep\":1,\"NumberTextPrecision\":0,\"NumberText\":0,\"NumberTextMath\":\"\",\"NumberTextBtn\":true,\"NumberTextBtnPosition\":\"right\",\"Textarea\":{\"DefaultRows\":20},\"DividerPosition\":\"left\",\"DataSource\":\"\",\"DataSourceSqlRemote\":false,\"DataSourceSqlRemoteLoading\":false,\"DataSourceId\":\"\",\"DataSourceApiEngineKey\":\"\",\"TextShowPassword\":false,\"TextIcon\":\"\",\"TextIconPosition\":\"\",\"TextApend\":\"\",\"TextApendPosition\":\"\",\"SelectLabel\":\"\",\"SelectSaveField\":\"\",\"SelectSaveFormat\":\"Text\",\"DateTimeType\":\"date\",\"TextAutocomplete\":false,\"AutoNumberFixed\":\"\",\"AutoNumberLength\":1,\"AutoNumberFields\":[],\"DevComponentName\":\"\",\"DevComponentPath\":\"\",\"TableChildTableId\":\"\",\"TableChildSysMenuId\":\"\",\"TableChildSysMenuName\":\"\",\"TableChildFkFieldName\":\"\",\"TableChildCallbackField\":\"\",\"TableChildRowClickV8\":\"\",\"MapCompany\":\"Baidu\"}","TableWidth":100,"NameConfirm":1,"Unique":0,"InTableEdit":0,"Name":"AppPakcet","Type":"mediumtext","Tab":"01KGFEDBPR9WZ800PYC63P8RRG","FormWidth":24,"Id":"8dbe4967-7651-44f6-b76c-49de730c520c","CreateTime":"2022-04-08 15:43:53"},{"TableName":"Sys_MicroiStore","AppVisible":1,"Label":"审核通过","NotEmpty":0,"Sort":900,"Data":"[]","IsLockField":0,"Visible":1,"Component":"Switch","BindRole":"[]","Encrypt":0,"Readonly":0,"TableId":"6cf254f1-edd0-4f04-96bc-c9ad08b5a2c1","Config":"{\"ParamData\":{},\"KeysAddVisible\":false,\"KeysAddVModel\":\"\",\"V8Code\":\"\",\"V8CodeBlur\":\"\",\"Sql\":\"\",\"EnableSearch\":true,\"NumberTextStep\":1,\"NumberTextPrecision\":0,\"NumberText\":0,\"NumberTextMath\":\"\",\"NumberTextBtn\":true,\"NumberTextBtnPosition\":\"right\",\"DividerPosition\":\"left\",\"DataSource\":\"\",\"DataSourceSqlRemote\":false,\"DataSourceSqlRemoteLoading\":false,\"DataSourceId\":\"\",\"DataSourceApiEngineKey\":\"\",\"TextShowPassword\":false,\"TextIcon\":\"\",\"TextIconPosition\":\"\",\"TextApend\":\"\",\"TextApendPosition\":\"\",\"SelectLabel\":\"\",\"SelectSaveField\":\"\",\"SelectSaveFormat\":\"Text\",\"DateTimeType\":\"date\",\"TextAutocomplete\":false,\"AutoNumberFixed\":\"\",\"AutoNumberLength\":1,\"AutoNumberFields\":[],\"DevComponentName\":\"\",\"DevComponentPath\":\"\",\"TableChildTableId\":\"\",\"TableChildSysMenuId\":\"\",\"TableChildSysMenuName\":\"\",\"TableChildFkFieldName\":\"\",\"TableChildCallbackField\":\"\",\"TableChildRowClickV8\":\"\",\"MapCompany\":\"Baidu\"}","TableWidth":100,"NameConfirm":1,"Unique":0,"InTableEdit":0,"Name":"IsApprove","Type":"bit","Id":"8640ee9a-5b2a-4a28-a777-05789f4aa76c","CreateTime":"2022-04-08 15:41:06"},{"TableName":"Sys_MicroiStore","AppVisible":1,"Label":"原价","NotEmpty":0,"Sort":1000,"Data":"[]","IsLockField":0,"Visible":0,"Component":"NumberText","BindRole":"[]","Encrypt":0,"Readonly":0,"TableId":"6cf254f1-edd0-4f04-96bc-c9ad08b5a2c1","Config":"{\"ParamData\":{},\"KeysAddVisible\":false,\"KeysAddVModel\":\"\",\"NumberTextStep\":1,\"NumberTextPrecision\":0,\"NumberText\":0,\"NumberTextMath\":\"\",\"NumberTextBtn\":true,\"NumberTextBtnPosition\":\"right\",\"V8Code\":\"\",\"V8CodeBlur\":\"\",\"Sql\":\"\",\"EnableSearch\":true,\"DividerPosition\":\"left\",\"DataSource\":\"\",\"DataSourceSqlRemote\":false,\"DataSourceSqlRemoteLoading\":false,\"DataSourceId\":\"\",\"DataSourceApiEngineKey\":\"\",\"TextShowPassword\":false,\"TextIcon\":\"\",\"TextIconPosition\":\"\",\"TextApend\":\"\",\"TextApendPosition\":\"\",\"SelectLabel\":\"\",\"SelectSaveField\":\"\",\"SelectSaveFormat\":\"Text\",\"DateTimeType\":\"date\",\"TextAutocomplete\":false,\"AutoNumberFixed\":\"\",\"AutoNumberLength\":1,\"AutoNumberFields\":[],\"DevComponentName\":\"\",\"DevComponentPath\":\"\",\"TableChildTableId\":\"\",\"TableChildSysMenuId\":\"\",\"TableChildSysMenuName\":\"\",\"TableChildFkFieldName\":\"\",\"TableChildCallbackField\":\"\",\"TableChildRowClickV8\":\"\",\"MapCompany\":\"Baidu\"}","TableWidth":100,"NameConfirm":1,"Unique":0,"InTableEdit":0,"Name":"AppOriPrice","Type":"int","Id":"8039b97f-d127-4ae0-b626-d9b1533505d5","CreateTime":"2022-04-08 15:40:43"},{"TableName":"Sys_MicroiStore","AppVisible":1,"Label":"作者","NotEmpty":0,"Sort":600,"Data":"[]","IsLockField":0,"Visible":1,"Component":"Text","BindRole":"[]","Encrypt":0,"Readonly":0,"TableId":"6cf254f1-edd0-4f04-96bc-c9ad08b5a2c1","Config":"{\"ParamData\":{},\"KeysAddVisible\":false,\"KeysAddVModel\":\"\",\"V8Code\":\"\",\"V8CodeBlur\":\"\",\"TextShowPassword\":false,\"TextIcon\":\"\",\"TextIconPosition\":\"\",\"TextApend\":\"\",\"TextApendPosition\":\"\",\"TextAutocomplete\":false,\"Sql\":\"\",\"EnableSearch\":true,\"NumberTextStep\":1,\"NumberTextPrecision\":0,\"NumberText\":0,\"NumberTextMath\":\"\",\"NumberTextBtn\":true,\"NumberTextBtnPosition\":\"right\",\"DividerPosition\":\"left\",\"DataSource\":\"\",\"DataSourceSqlRemote\":false,\"DataSourceSqlRemoteLoading\":false,\"DataSourceId\":\"\",\"DataSourceApiEngineKey\":\"\",\"SelectLabel\":\"\",\"SelectSaveField\":\"\",\"SelectSaveFormat\":\"Text\",\"DateTimeType\":\"date\",\"AutoNumberFixed\":\"\",\"AutoNumberLength\":1,\"AutoNumberFields\":[],\"DevComponentName\":\"\",\"DevComponentPath\":\"\",\"TableChildTableId\":\"\",\"TableChildSysMenuId\":\"\",\"TableChildSysMenuName\":\"\",\"TableChildFkFieldName\":\"\",\"TableChildCallbackField\":\"\",\"TableChildRowClickV8\":\"\",\"MapCompany\":\"Baidu\"}","TableWidth":100,"NameConfirm":1,"Unique":0,"InTableEdit":0,"Name":"AppAuthor","Type":"varchar(50)","Id":"82467784-cd21-45b9-b7f7-c2f38412e8a8","CreateTime":"2022-04-08 15:39:05"},{"TableName":"Sys_MicroiStore","AppVisible":1,"Label":"更新时间","NotEmpty":0,"Sort":500,"Data":"[]","IsLockField":0,"Visible":1,"Component":"DateTime","BindRole":"[]","Encrypt":0,"Readonly":0,"TableId":"6cf254f1-edd0-4f04-96bc-c9ad08b5a2c1","Config":"{\"ParamData\":{},\"KeysAddVisible\":false,\"KeysAddVModel\":\"\",\"V8Code\":\"\",\"V8CodeBlur\":\"\",\"DateTimeType\":\"datetime\",\"Sql\":\"\",\"EnableSearch\":true,\"NumberTextStep\":1,\"NumberTextPrecision\":0,\"NumberText\":0,\"NumberTextMath\":\"\",\"NumberTextBtn\":true,\"NumberTextBtnPosition\":\"right\",\"DividerPosition\":\"left\",\"DataSource\":\"\",\"DataSourceSqlRemote\":false,\"DataSourceSqlRemoteLoading\":false,\"DataSourceId\":\"\",\"DataSourceApiEngineKey\":\"\",\"TextShowPassword\":false,\"TextIcon\":\"\",\"TextIconPosition\":\"\",\"TextApend\":\"\",\"TextApendPosition\":\"\",\"SelectLabel\":\"\",\"SelectSaveField\":\"\",\"SelectSaveFormat\":\"Text\",\"TextAutocomplete\":false,\"AutoNumberFixed\":\"\",\"AutoNumberLength\":1,\"AutoNumberFields\":[],\"DevComponentName\":\"\",\"DevComponentPath\":\"\",\"TableChildTableId\":\"\",\"TableChildSysMenuId\":\"\",\"TableChildSysMenuName\":\"\",\"TableChildFkFieldName\":\"\",\"TableChildCallbackField\":\"\",\"TableChildRowClickV8\":\"\",\"MapCompany\":\"Baidu\"}","TableWidth":100,"NameConfirm":1,"Unique":0,"InTableEdit":0,"Name":"AppUpdateTime","Type":"varchar(25)","Id":"c7e844ce-1ace-405c-bf1f-e8318ad6c935","CreateTime":"2022-04-08 15:38:41"},{"TableName":"Sys_MicroiStore","AppVisible":1,"Label":"发布时间","NotEmpty":0,"Sort":400,"Data":"[]","IsLockField":0,"Visible":1,"Component":"DateTime","BindRole":"[]","Encrypt":0,"Readonly":0,"TableId":"6cf254f1-edd0-4f04-96bc-c9ad08b5a2c1","Config":"{\"ParamData\":{},\"KeysAddVisible\":false,\"KeysAddVModel\":\"\",\"V8Code\":\"\",\"V8CodeBlur\":\"\",\"DateTimeType\":\"datetime\",\"Sql\":\"\",\"EnableSearch\":true,\"NumberTextStep\":1,\"NumberTextPrecision\":0,\"NumberText\":0,\"NumberTextMath\":\"\",\"NumberTextBtn\":true,\"NumberTextBtnPosition\":\"right\",\"DividerPosition\":\"left\",\"DataSource\":\"\",\"DataSourceSqlRemote\":false,\"DataSourceSqlRemoteLoading\":false,\"DataSourceId\":\"\",\"DataSourceApiEngineKey\":\"\",\"TextShowPassword\":false,\"TextIcon\":\"\",\"TextIconPosition\":\"\",\"TextApend\":\"\",\"TextApendPosition\":\"\",\"SelectLabel\":\"\",\"SelectSaveField\":\"\",\"SelectSaveFormat\":\"Text\",\"TextAutocomplete\":false,\"AutoNumberFixed\":\"\",\"AutoNumberLength\":1,\"AutoNumberFields\":[],\"DevComponentName\":\"\",\"DevComponentPath\":\"\",\"TableChildTableId\":\"\",\"TableChildSysMenuId\":\"\",\"TableChildSysMenuName\":\"\",\"TableChildFkFieldName\":\"\",\"TableChildCallbackField\":\"\",\"TableChildRowClickV8\":\"\",\"MapCompany\":\"Baidu\"}","TableWidth":100,"NameConfirm":1,"Unique":0,"InTableEdit":0,"Name":"AppPublishTime","Type":"varchar(25)","Id":"3f589b41-d3a1-4b54-8774-669bc8ad4954","CreateTime":"2022-04-08 15:38:19"},{"TableName":"Sys_MicroiStore","AppVisible":1,"Label":"版本号","NotEmpty":1,"Sort":300,"Data":"[]","IsLockField":0,"Visible":1,"Component":"Text","BindRole":"[]","Encrypt":0,"Readonly":0,"TableId":"6cf254f1-edd0-4f04-96bc-c9ad08b5a2c1","Config":"{\"ParamData\":{},\"KeysAddVisible\":false,\"KeysAddVModel\":\"\",\"V8Code\":\"\",\"V8CodeBlur\":\"\",\"TextShowPassword\":false,\"TextIcon\":\"\",\"TextIconPosition\":\"\",\"TextApend\":\"\",\"TextApendPosition\":\"\",\"TextAutocomplete\":false,\"Sql\":\"\",\"EnableSearch\":true,\"NumberTextStep\":1,\"NumberTextPrecision\":0,\"NumberText\":0,\"NumberTextMath\":\"\",\"NumberTextBtn\":true,\"NumberTextBtnPosition\":\"right\",\"DividerPosition\":\"left\",\"DataSource\":\"\",\"DataSourceSqlRemote\":false,\"DataSourceSqlRemoteLoading\":false,\"DataSourceId\":\"\",\"DataSourceApiEngineKey\":\"\",\"SelectLabel\":\"\",\"SelectSaveField\":\"\",\"SelectSaveFormat\":\"Text\",\"DateTimeType\":\"date\",\"AutoNumberFixed\":\"\",\"AutoNumberLength\":1,\"AutoNumberFields\":[],\"DevComponentName\":\"\",\"DevComponentPath\":\"\",\"TableChildTableId\":\"\",\"TableChildSysMenuId\":\"\",\"TableChildSysMenuName\":\"\",\"TableChildFkFieldName\":\"\",\"TableChildCallbackField\":\"\",\"TableChildRowClickV8\":\"\",\"MapCompany\":\"Baidu\"}","TableWidth":100,"NameConfirm":1,"Unique":0,"InTableEdit":0,"Name":"AppVersion","Type":"varchar(50)","Id":"74eafcdd-7220-4006-91c1-e70fd6e7fe7b","CreateTime":"2022-04-08 15:37:23"},{"TableName":"Sys_MicroiStore","AppVisible":1,"Label":"应用名称","NotEmpty":1,"Sort":100,"Data":"[]","IsLockField":0,"Visible":1,"Component":"Text","BindRole":"[]","Encrypt":0,"Readonly":0,"TableId":"6cf254f1-edd0-4f04-96bc-c9ad08b5a2c1","Config":"{\"ParamData\":{},\"KeysAddVisible\":false,\"KeysAddVModel\":\"\",\"V8Code\":\"\",\"V8CodeBlur\":\"\",\"TextShowPassword\":false,\"TextIcon\":\"\",\"TextIconPosition\":\"\",\"TextApend\":\"\",\"TextApendPosition\":\"\",\"TextAutocomplete\":false,\"Sql\":\"\",\"EnableSearch\":true,\"NumberTextStep\":1,\"NumberTextPrecision\":0,\"NumberText\":0,\"NumberTextMath\":\"\",\"NumberTextBtn\":true,\"NumberTextBtnPosition\":\"right\",\"DividerPosition\":\"left\",\"DataSource\":\"\",\"DataSourceSqlRemote\":false,\"DataSourceSqlRemoteLoading\":false,\"DataSourceId\":\"\",\"DataSourceApiEngineKey\":\"\",\"SelectLabel\":\"\",\"SelectSaveField\":\"\",\"SelectSaveFormat\":\"Text\",\"DateTimeType\":\"date\",\"AutoNumberFixed\":\"\",\"AutoNumberLength\":1,\"AutoNumberFields\":[],\"DevComponentName\":\"\",\"DevComponentPath\":\"\",\"TableChildTableId\":\"\",\"TableChildSysMenuId\":\"\",\"TableChildSysMenuName\":\"\",\"TableChildFkFieldName\":\"\",\"TableChildCallbackField\":\"\",\"TableChildRowClickV8\":\"\",\"MapCompany\":\"Baidu\"}","TableWidth":100,"NameConfirm":1,"Unique":0,"InTableEdit":0,"Name":"AppName","Type":"varchar(50)","Id":"b978d8a4-fa96-4856-a8b2-31fa7e2d394c","CreateTime":"2022-04-08 15:36:39"}],"SysApiEngines":[{"LimitRecursion":10000,"LimitMemory":2048,"MaxStatements":100000000,"Timeout":600,"StopHttp":0,"EnableLog":0,"Category":"系统","Files":"[]","ApiAddress":"/apiengine/import-microi-store-package","AllowAnonymous":0,"ResponseFile":0,"Lock":1,"ApiV8Code":"/**\n * 导入应用数据包接口引擎（B系统）\n * \n * 功能：导入应用数据包，根据Id判断新增或修改\n * \n * 业务逻辑：\n * 1. 接收应用数据包\n * 2. 解析数据包中的各类数据\n * 3. 依次处理：diy_table -> diy_field -> sys_menu -> wf_flowdesign -> wf_node -> sys_apiengine\n * 4. 每条数据根据判断规则决定新增或修改：\n *    - diy_table: 根据 Id 和 Name 判断（不修改 Id 和 Name）\n *    - sys_apiengine: 根据 Id 或 ApiEngineKey 判断（不修改 Id 和 ApiEngineKey）\n *    - 其他表: 根据 Id 判断\n * 5. 使用事务保证数据一致性\n * \n * 接口配置：\n * - ApiEngineKey: import-microi-store-package\n * - ApiAddress: /apiengine/import-microi-store-package\n * - 允许匿名调用: 否\n * - 分布式锁: 是（防止并发导入）\n * \n * 前端调用示例：\n * V8.ApiEngine.Run('import-microi-store-package', {\n *   Package: packageData  // 从export-microi-store-package接口导出的数据包\n * })\n * \n * 返回格式：\n * {\n *   Code: 1,\n *   Data: {\n *     MenuInserted: 5,\n *     MenuUpdated: 3,\n *     TableInserted: 2,\n *     TableUpdated: 1,\n *     FieldInserted: 50,\n *     FieldUpdated: 20,\n *     FlowInserted: 1,\n *     FlowUpdated: 0,\n *     NodeInserted: 10,\n *     NodeUpdated: 5,\n *     LineInserted: 8,\n *     LineUpdated: 3,\n *     ApiEngineInserted: 3,\n *     ApiEngineUpdated: 2\n *   },\n *   Msg: '导入成功'\n * }\n */\n\n// ==================== 参数接收与校验 ====================\n\nvar Package = V8.Param.Package;  // 应用数据包\nvar InstallParentSysMenuId = V8.Param.InstallParentSysMenuId;  // 安装在哪个父级系统菜单Id下\n\n// 定义调试模式\nvar isDebug = true;\nvar debugLog = {};\n\n// 参数校验\nif (!Package) {\n    return {\n        Code: 0,\n        Msg: '参数错误：Package不能为空'\n    };\n}\nif (typeof (Package) == 'string') {\n    Package = JSON.parse(Package);\n}\n\nif (!Package.PackageInfo) {\n    return {\n        Code: 0,\n        Msg: '参数错误：Package.PackageInfo不能为空'\n    };\n}\n\ntry {\n    debugLog.startTime = new Date().toISOString();\n    debugLog.packageInfo = Package.PackageInfo;\n\n    // ==================== 辅助函数：判断数据是否存在 ====================\n\n    var checkExists = function (tableName, id) {\n        var result = V8.FormEngine.GetFormData(tableName, {\n            OsClient: V8.OsClient,\n            Id: id\n        });\n        return result.Code == 1 && result.Data;\n    };\n\n    // ==================== 统计变量 ====================\n\n    var stats = {\n        TableInserted: 0,\n        TableUpdated: 0,\n        FieldInserted: 0,\n        FieldUpdated: 0,\n        MenuInserted: 0,\n        MenuUpdated: 0,\n        FlowInserted: 0,\n        FlowUpdated: 0,\n        NodeInserted: 0,\n        NodeUpdated: 0,\n        LineInserted: 0,\n        LineUpdated: 0,\n        ApiEngineInserted: 0,\n        ApiEngineUpdated: 0\n    };\n\n    // ==================== 步骤0：执行DDL创建表和字段 ====================\n\n    debugLog.step0 = '开始执行DDL创建表';\n\n    var ddlStatements = Package.DDLStatements || [];\n    var ddlExecuted = 0;\n    var ddlSkipped = 0;\n    var fieldsAdded = 0;\n\n    // 定义审计字段（与export-package.js保持一致）\n    var fixedDiyField = [\n        { Name: \"Id\", Label: \"Id\", Type: \"varchar(36)\", Component: \"Guid\", Sort: 1, Visible: 0, TableWidth: 150 },\n        { Name: \"CreateTime\", Label: \"创建时间\", Type: \"datetime\", Component: \"DateTime\", Sort: 2, Visible: 1, TableWidth: 150 },\n        { Name: \"UpdateTime\", Label: \"修改时间\", Type: \"datetime\", Component: \"DateTime\", Sort: 3, Visible: 1, TableWidth: 150 },\n        { Name: \"UserId\", Label: \"创建人Id\", Type: \"varchar(36)\", Component: \"Guid\", Sort: 4, Visible: 0, TableWidth: 150 },\n        { Name: \"UserName\", Label: \"创建人\", Type: \"varchar(255)\", Component: \"Text\", Sort: 5, Visible: 1, TableWidth: 150 },\n        { Name: \"IsDeleted\", Label: \"是否已删除\", Type: \"int\", Component: \"Switch\", Sort: 6, Visible: 0, TableWidth: 50 }\n    ];\n\n    // MySQL类型映射函数（与导出保持一致）\n    var mapToMySQLType = function (diyType) {\n        if (!diyType) return 'varchar(255)';\n\n        // 安全转换为字符串并小写\n        var typeStr = '';\n        try {\n            typeStr = String.prototype.toLowerCase.call(String(diyType));\n        } catch (e) {\n            return 'varchar(255)';\n        }\n\n        if (typeStr.match(/^(varchar|int|bigint|datetime|text|longtext|decimal|double|float|tinyint|date|time|timestamp|json)\\(/)) {\n            return String(diyType);\n        }\n        if (typeStr == 'int' || typeStr == 'bigint' || typeStr == 'text' || typeStr == 'longtext' ||\n            typeStr == 'datetime' || typeStr == 'date' || typeStr == 'time' || typeStr == 'timestamp' ||\n            typeStr == 'json' || typeStr == 'tinyint' || typeStr == 'double' || typeStr == 'float') {\n            return String(diyType);\n        }\n\n        if (typeStr.indexOf('varchar') == 0) return String(diyType);\n        if (typeStr.indexOf('decimal') == 0) return String(diyType);\n\n        return 'varchar(255)';\n    };\n\n    for (var i = 0; i < ddlStatements.length; i++) {\n        var ddlItem = ddlStatements[i];\n        if (!ddlItem.DDL || !ddlItem.TableName) continue;\n\n        var tableCreated = false;\n\n        try {\n            // 先尝试创建表（CREATE TABLE IF NOT EXISTS）\n            V8.Db.FromSql(ddlItem.DDL).ExecuteNonQuery();\n            tableCreated = true;\n            ddlExecuted++;\n            debugLog['ddl_create_' + ddlItem.TableName] = '表创建成功';\n        } catch (ddlError) {\n            // 创建失败（表可能已存在）\n            debugLog['ddl_create_error_' + ddlItem.TableName] = ddlError.message;\n            ddlSkipped++;\n        }\n\n        // 无论表是新创建还是已存在，都检查并补充缺失的字段\n        try {\n            // 查询表的所有字段\n            var checkColumnsSQL = \"SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = DATABASE() AND TABLE_NAME = '\" + ddlItem.TableName + \"'\";\n            var columnsData = V8.Db.FromSql(checkColumnsSQL).ToArray();\n\n            if (!columnsData || columnsData.length == 0) {\n                debugLog['ddl_check_columns_' + ddlItem.TableName] = '表不存在或查询字段失败';\n                continue;\n            }\n\n            var existingColumns = {};\n            for (var c = 0; c < columnsData.length; c++) {\n                try {\n                    var colName = columnsData[c].COLUMN_NAME;\n                    if (colName != null && colName !== undefined) {\n                        // 使用String.prototype确保安全\n                        var colNameStr = String.prototype.toLowerCase.call(String(colName));\n                        existingColumns[colNameStr] = true;\n                    }\n                } catch (e) {\n                    debugLog['field_parse_error_' + ddlItem.TableName + '_' + c] = 'Column: ' + JSON.stringify(columnsData[c]) + ', Error: ' + e.message;\n                }\n            }\n\n            // 获取该表应有的所有字段：合并审计字段和自定义字段\n            var diyFields = Package.DiyFields || [];\n            var tableFields = [];\n\n            // 1. 先添加审计字段（fixedDiyField）\n            for (var ff = 0; ff < fixedDiyField.length; ff++) {\n                tableFields.push(fixedDiyField[ff]);\n            }\n\n            // 2. 再添加该表的自定义字段（从Package.DiyFields中筛选）\n            // 排除已在fixedDiyField中的字段名（比较时忽略大小写，但保持原始大小写）\n            var fixedFieldNames = {};\n            for (var ff = 0; ff < fixedDiyField.length; ff++) {\n                if (fixedDiyField[ff].Name) {\n                    // 用小写作为key来判断重复，但不改变原始字段名\n                    var fixedNameKey = ('' + fixedDiyField[ff].Name).toLowerCase();\n                    fixedFieldNames[fixedNameKey] = true;\n                }\n            }\n\n            for (var f = 0; f < diyFields.length; f++) {\n                if (diyFields[f].TableId == ddlItem.TableId && diyFields[f].Name) {\n                    // 用小写key判断是否重复，但添加的是原始对象（保持大驼峰）\n                    var diyNameKey = ('' + diyFields[f].Name).toLowerCase();\n                    if (!fixedFieldNames[diyNameKey]) {\n                        tableFields.push(diyFields[f]);  // 保持原始大小写\n                    }\n                }\n            }\n\n            // 检查缺失的字段并添加\n            var fieldsAddedForTable = 0;\n            for (var f = 0; f < tableFields.length; f++) {\n                var field = tableFields[f];\n                var fieldName = field.Name;\n\n                if (!fieldName) continue;\n\n                // Type为空、null或\"1\"表示虚拟字段，不应存在于物理表\n                var fieldType = field.Type;\n                if (!fieldType || fieldType === '' || fieldType === '1' || fieldType === 1) {\n                    debugLog['field_virtual_' + ddlItem.TableName + '_' + fieldName] = '虚拟字段(Type=' + fieldType + ')，跳过物理表同步';\n                    continue;\n                }\n\n                // 转换为字符串确保安全 - 使用最安全的转换方式\n                var fieldNameStr = ('' + fieldName);\n\n                // MySQL字段名长度限制为64字符\n                if (fieldNameStr.length > 64) {\n                    debugLog['field_name_too_long_' + ddlItem.TableName + '_' + fieldNameStr.substring(0, 30)] = '字段名过长，已跳过：' + fieldNameStr.length + '字符';\n                    continue;\n                }\n\n                // 字段已存在，跳过（忽略大小写）\n                try {\n                    if (existingColumns[fieldNameStr.toLowerCase()]) {\n                        continue;\n                    }\n                } catch (e) {\n                    debugLog['field_check_error_' + ddlItem.TableName + '_' + fieldNameStr] = 'Error checking field: ' + e.message;\n                    continue;\n                }\n\n                var fieldType = mapToMySQLType(field.Type);\n                var alterSQL = 'ALTER TABLE `' + ddlItem.TableName + '` ADD COLUMN `' + fieldName + '` ' + fieldType;\n\n                // Id字段不允许NULL，其他字段允许NULL\n                if (fieldName == 'Id') {\n                    alterSQL += ' NOT NULL PRIMARY KEY';\n                } else {\n                    alterSQL += ' NULL';\n                }\n\n                // 添加字段说明（COMMENT）\n                if (field.Label && field.Label !== fieldName) {\n                    // 转义单引号\n                    var comment = field.Label.replace(/'/g, \"''\");\n                    alterSQL += \" COMMENT '\" + comment + \"'\";\n                }\n\n                try {\n                    V8.Db.FromSql(alterSQL).ExecuteNonQuery();\n                    fieldsAdded++;\n                    fieldsAddedForTable++;\n                    debugLog['field_added_' + ddlItem.TableName + '_' + fieldName] = '字段已添加';\n                } catch (alterError) {\n                    debugLog['field_add_error_' + ddlItem.TableName + '_' + fieldName] = alterError.message;\n                }\n            }\n\n            if (fieldsAddedForTable > 0) {\n                debugLog['ddl_alter_' + ddlItem.TableName] = '添加了' + fieldsAddedForTable + '个字段';\n            }\n\n        } catch (checkError) {\n            debugLog['ddl_check_error_' + ddlItem.TableName] = checkError.message;\n        }\n    }\n\n    stats.DDLExecuted = ddlExecuted;\n    stats.DDLSkipped = ddlSkipped;\n    stats.FieldsAdded = fieldsAdded;\n    debugLog.step0Result = 'DDL执行完成：创建表' + ddlExecuted + '，跳过' + ddlSkipped + '，添加字段' + fieldsAdded;\n\n    // ==================== 步骤1：处理diy_table数据 ====================\n\n    debugLog.step1 = '开始处理diy_table数据';\n\n    var diyTables = Package.DiyTables || [];\n\n    for (var i = 0; i < diyTables.length; i++) {\n        var table = diyTables[i];\n\n        if (!table.Id) {\n            debugLog['table_no_id_' + i] = '跳过无Id的表数据';\n            continue;\n        }\n\n        // 根据Id和Name判断是否存在\n        var existsById = checkExists('diy_table', table.Id);\n        var existsByName = false;\n\n        if (table.Name) {\n            var checkByNameResult = V8.FormEngine.GetFormData('diy_table', {\n                OsClient: V8.OsClient,\n                _Where: [['Name', '=', table.Name]],\n                _PageSize: 1\n            });\n            existsByName = checkByNameResult.Code == 1 && checkByNameResult.Data;\n            //如果存在此tableName，但又不存在taleId，将此tableName的Id修改为应用商城的diy_table的Id\n            if (existsByName && !existsById) {\n                try {\n                    V8.Db.FromSql(\"UPDATE diy_table SET Id = '\" + table.Id + \"' WHERE Name = '\" + table.Name + \"' and IsDeleted<>1\")\n                        .ExecuteNonQuery();\n                } catch (error) {\n\n                }\n                try {\n                    V8.Db.FromSql(\"UPDATE diy_field SET TableId = '\" + table.Id + \"' WHERE TableId = '\" + checkByNameResult.Data.Id + \"' and IsDeleted<>1\")\n                        .ExecuteNonQuery();\n                } catch (error) {\n\n                }\n                try {\n                    V8.Db.FromSql(\"UPDATE sys_menu SET DiyTableId = '\" + table.Id + \"' WHERE DiyTableId = '\" + checkByNameResult.Data.Id + \"' and IsDeleted<>1\")\n                        .ExecuteNonQuery();\n                } catch (error) {\n\n                }\n\n                V8.Cache.Remove(`Microi:${V8.OsClient}:FormData:diy_table:${checkByNameResult.Data.Id.toLowerCase()}`);\n                V8.Cache.Remove(`Microi:${V8.OsClient}:FormData:diy_table:${checkByNameResult.Data.Name.toLowerCase()}`);\n                V8.Cache.Remove(`Microi:${V8.OsClient}:FormData:diy_table_field_list:${checkByNameResult.Data.Id}`);\n                V8.Cache.Remove(`Microi:${V8.OsClient}:FormData:diy_table_field_list:${checkByNameResult.Data.Name.toLowerCase()}`);\n            }\n        }\n\n        var exists = existsById || existsByName;\n        var modelCopy = {\n            _FormData: {}\n        };\n        for (var key in table) {\n            modelCopy._FormData[key] = table[key];\n        }\n        modelCopy.OsClient = V8.OsClient;\n        modelCopy.Id = table.Id;\n        if (exists) {\n            var uptResult = V8.FormEngine.UptFormData('diy_table', modelCopy);\n            if (uptResult.Code == 1) {\n                stats.TableUpdated++;\n            } else {\n                debugLog['table_upt_error_' + table.Id] = uptResult.Msg;\n            }\n        } else {\n            // 不存在则新增\n            var addResult = V8.FormEngine.AddFormData('diy_table', modelCopy);\n            if (addResult.Code == 1) {\n                stats.TableInserted++;\n            } else {\n                debugLog['table_add_error_' + table.Id] = addResult.Msg;\n            }\n        }\n\n        //清除缓存\n        var delCaheResult1 = V8.Cache.Remove(`Microi:${V8.OsClient}:FormData:diy_table:${table.Id.toLowerCase()}`);\n        debugLog['delCaheResult1_' + table.Id] = delCaheResult1;\n\n        var delCaheResult2 = V8.Cache.Remove(`Microi:${V8.OsClient}:FormData:diy_table:${table.Name.toLowerCase()}`);\n        debugLog['delCaheResult2_' + table.Name] = delCaheResult2;\n\n        V8.Cache.Remove(`Microi:${V8.OsClient}:FormData:diy_table_field_list:${table.Id}`);\n        V8.Cache.Remove(`Microi:${V8.OsClient}:FormData:diy_table_field_list:${table.Name.toLowerCase()}`);\n    }\n\n    debugLog.step1Result = '表数据处理完成：新增' + stats.TableInserted + '，修改' + stats.TableUpdated;\n\n    // ==================== 步骤2：处理diy_field数据 ====================\n\n    debugLog.step2 = '开始处理diy_field数据';\n\n    var diyFields = Package.DiyFields || [];\n    var fieldChanges = []; // 记录字段的变化（Name、Type、Label）\n\n    for (var i = 0; i < diyFields.length; i++) {\n        var field = diyFields[i];\n\n        if (!field.Id) {\n            debugLog['field_no_id_' + i] = '跳过无Id的字段数据';\n            continue;\n        }\n\n        var exists = checkExists('diy_field', field.Id);\n\n        if (!exists) {\n            //判断根据Name和TableId是否存在，如果存在，则需要将Id改到以应用商城的为准\n            var checkByNameResult = V8.FormEngine.GetFormData('diy_field', {\n                OsClient: V8.OsClient,\n                _Where: [\n                    ['TableId', '=', field.TableId],\n                    ['Name', '=', field.Name]\n                ]\n            });\n            if (checkByNameResult.Code == 1) {\n                try {\n                    V8.Db.FromSql(\"UPDATE diy_field SET Id = '\" + field.Id + \"' WHERE TableId = '\" + field.TableId + \"' AND Name = '\" + field.Name + \"' and IsDeleted<>1\").ExecuteNonQuery();\n                } catch (error) {\n\n                }\n                V8.Cache.Remove(`Microi:${V8.OsClient}:FormData:diy_table_field_list:${field.TableId.toLowerCase()}`);\n                exists = true;\n            }\n        }\n\n        if (exists) {\n            // 存在则修改 - 先查询旧数据，记录变化\n            var oldFieldResult = V8.FormEngine.GetFormData('diy_field', {\n                OsClient: V8.OsClient,\n                Id: field.Id\n            });\n            if (oldFieldResult.Code == 1 && oldFieldResult.Data) {\n                var oldField = oldFieldResult.Data;\n                var hasChange = false;\n                var changeInfo = {\n                    Id: field.Id,\n                    TableName: oldField.TableName, // 使用旧的TableName\n                    OldName: oldField.Name,\n                    NewName: field.Name,\n                    OldType: oldField.Type,\n                    NewType: field.Type,\n                    OldLabel: oldField.Label,\n                    NewLabel: field.Label\n                };\n\n                // 检测是否有变化\n                if (oldField.Name != field.Name) {\n                    hasChange = true;\n                    debugLog['field_name_changed_' + field.Id] = oldField.Name + ' → ' + field.Name;\n                }\n                if (oldField.Type != field.Type) {\n                    hasChange = true;\n                    debugLog['field_type_changed_' + field.Id] = oldField.Type + ' → ' + field.Type;\n                }\n                if (oldField.Label != field.Label) {\n                    hasChange = true;\n                }\n\n                if (hasChange) {\n                    fieldChanges.push(changeInfo);\n                }\n            }\n\n            // 创建副本，避免污染原始数据（步骤2.5需要用到TableId）\n            var fieldCopy = {\n                _FormData: {}\n            };\n            for (var key in field) {\n                fieldCopy._FormData[key] = field[key];\n            }\n            fieldCopy._Where = [\n                ['TableId', '=', field.TableId],\n                ['Name', '=', field.Name],\n            ];\n            fieldCopy.OsClient = V8.OsClient;\n\n            var uptResult = V8.FormEngine.UptFormDataByWhere('diy_field', fieldCopy);\n            if (uptResult.Code == 1) {\n                stats.FieldUpdated++;\n            } else {\n                debugLog['field_upt_error_' + field.Id] = uptResult.Msg;\n            }\n        } else {\n            var fieldCopy = {\n                _FormData: {}\n            };\n            for (var key in field) {\n                fieldCopy._FormData[key] = field[key];\n            }\n            fieldCopy.OsClient = V8.OsClient;\n            fieldCopy.Id = field.Id;\n            // 不存在则新增\n            var addResult = V8.FormEngine.AddFormData('diy_field', fieldCopy);\n            if (addResult.Code == 1) {\n                stats.FieldInserted++;\n            } else {\n                debugLog['field_add_error_' + field.Id] = addResult.Msg;\n            }\n\n        }\n    }\n\n    for (var i = 0; i < diyTables.length; i++) {\n        var table = diyTables[i];\n\n        if (!table.Id) {\n            debugLog['table_no_id_' + i] = '跳过无Id的表数据';\n            continue;\n        }\n        //清除缓存\n        V8.Cache.Remove(`Microi:${V8.OsClient}:FormData:diy_table_field_list:${table.Id}`);\n        V8.Cache.Remove(`Microi:${V8.OsClient}:FormData:diy_table_field_list:${table.Name.toLowerCase()}`);\n    }\n\n    debugLog.step2Result = '字段数据处理完成：新增' + stats.FieldInserted + '，修改' + stats.FieldUpdated + '，检测到' + fieldChanges.length + '个字段变化';\n\n    // ==================== 步骤2.5：同步物理表字段（补充所有表的缺失字段） ====================\n\n    debugLog.step2_5 = '开始同步物理表字段';\n\n    var physicalFieldsAdded = 0;\n    var physicalFieldsRenamed = 0;\n    var physicalFieldsModified = 0;\n    var diyTables = Package.DiyTables || [];\n    var diyFields = Package.DiyFields || [];\n\n    // 阶段0：执行字段变更（重命名、修改类型/注释）\n    debugLog.step2_5_phase0 = '开始处理字段变更';\n    for (var i = 0; i < fieldChanges.length; i++) {\n        var change = fieldChanges[i];\n        if (!change.TableName || !change.OldName || !change.NewName) continue;\n\n        var tableName = change.TableName;\n        var oldName = change.OldName;\n        var newName = change.NewName;\n        var newType = mapToMySQLType(change.NewType);\n        var newLabel = change.NewLabel;\n\n        try {\n            // 如果字段名发生变化，执行重命名\n            if (oldName != newName) {\n                // MySQL 重命名字段语法：ALTER TABLE table CHANGE COLUMN old_name new_name type\n                var renameSQL = 'ALTER TABLE `' + tableName + '` CHANGE COLUMN `' + oldName + '` `' + newName + '` ' + newType;\n\n                if (newName == 'Id') {\n                    renameSQL += ' NOT NULL PRIMARY KEY';\n                } else {\n                    renameSQL += ' NULL';\n                }\n\n                if (newLabel && newLabel !== newName) {\n                    var comment = newLabel.replace(/'/g, \"''\");\n                    renameSQL += \" COMMENT '\" + comment + \"'\";\n                }\n\n                try {\n                    V8.Db.FromSql(renameSQL).ExecuteNonQuery();\n                    physicalFieldsRenamed++;\n                    debugLog['rename_' + tableName + '_' + oldName] = '重命名为 ' + newName;\n                } catch (renameError) {\n                    debugLog['rename_error_' + tableName + '_' + oldName] = renameError.message;\n                }\n            }\n            // 如果只是类型或注释变化，执行修改\n            else if (change.OldType != change.NewType || change.OldLabel != change.NewLabel) {\n                // MySQL 修改字段类型/注释：ALTER TABLE table MODIFY COLUMN field_name type\n                var modifySQL = 'ALTER TABLE `' + tableName + '` MODIFY COLUMN `' + newName + '` ' + newType;\n\n                if (newName == 'Id') {\n                    modifySQL += ' NOT NULL PRIMARY KEY';\n                } else {\n                    modifySQL += ' NULL';\n                }\n\n                if (newLabel && newLabel !== newName) {\n                    var comment = newLabel.replace(/'/g, \"''\");\n                    modifySQL += \" COMMENT '\" + comment + \"'\";\n                }\n\n                try {\n                    V8.Db.FromSql(modifySQL).ExecuteNonQuery();\n                    physicalFieldsModified++;\n                    debugLog['modify_' + tableName + '_' + newName] = '类型/注释已修改';\n                } catch (modifyError) {\n                    debugLog['modify_error_' + tableName + '_' + newName] = modifyError.message;\n                }\n            }\n        } catch (changeError) {\n            debugLog['change_error_' + tableName + '_' + oldName] = changeError.message;\n        }\n    }\n\n    // 阶段1：按TableId分组字段\n    var fieldsByTable = {};\n    for (var i = 0; i < diyFields.length; i++) {\n        var field = diyFields[i];\n        if (field.TableId && field.Name) {\n            if (!fieldsByTable[field.TableId]) {\n                fieldsByTable[field.TableId] = [];\n            }\n            fieldsByTable[field.TableId].push(field);\n        }\n    }\n\n    // 阶段2：遍历所有表，添加缺失字段\n    debugLog.step2_5_phase1 = '开始添加缺失字段';\n    for (var i = 0; i < diyTables.length; i++) {\n        var table = diyTables[i];\n        if (!table.Name || !table.Id) continue;\n\n        // 使用原始表名（保持大小写）\n        var tableName = table.Name;\n        var tableFields = fieldsByTable[table.Id] || [];\n\n        if (tableFields.length == 0) {\n            debugLog['sync_skip_' + tableName] = '无字段定义，跳过';\n            continue;\n        }\n\n        try {\n            // 查询物理表的所有字段（不区分大小写），同时获取实际表名\n            var checkColumnsSQL = \"SELECT TABLE_NAME, COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = DATABASE() AND LOWER(TABLE_NAME) = LOWER('\" + tableName + \"')\";\n            var columnsData = V8.Db.FromSql(checkColumnsSQL).ToArray();\n\n            if (!columnsData || columnsData.length == 0) {\n                debugLog['sync_table_not_exist_' + tableName] = '表不存在，跳过字段同步';\n                continue;\n            }\n\n            // 获取实际的物理表名（安全转换）\n            var actualTableName = tableName;\n            try {\n                if (columnsData[0] && columnsData[0].TABLE_NAME) {\n                    actualTableName = String(columnsData[0].TABLE_NAME);\n                }\n            } catch (e) {\n                debugLog['sync_tablename_error_' + tableName] = e.message;\n            }\n\n            // 构建已存在的字段Map（小写key）\n            var existingColumns = {};\n            var columnsCount = 0;\n            try {\n                columnsCount = Number(columnsData.length) || 0;\n            } catch (e) {\n                debugLog['sync_count_error_' + tableName] = e.message;\n                continue;\n            }\n\n            for (var c = 0; c < columnsCount; c++) {\n                try {\n                    if (!columnsData[c]) continue;\n                    var colName = columnsData[c].COLUMN_NAME;\n                    if (colName != null && colName !== undefined) {\n                        // 使用最安全的方式转换\n                        var colNameStr = String(colName);\n                        var colNameLower = String.prototype.toLowerCase.call(colNameStr);\n                        existingColumns[colNameLower] = true;\n                    }\n                } catch (e) {\n                    debugLog['sync_parse_error_' + tableName + '_' + c] = e.message;\n                }\n            }\n\n            // 检查并添加缺失的字段\n            var fieldsAddedForTable = 0;\n            for (var f = 0; f < tableFields.length; f++) {\n                try {\n                    var field = tableFields[f];\n                    if (!field) continue;\n\n                    var fieldName = field.Name;\n                    if (!fieldName) continue;\n\n                    // Type为空、null或\"1\"表示虚拟字段，不应存在于物理表\n                    var fieldType = field.Type;\n                    if (!fieldType || fieldType === '' || fieldType === '1' || fieldType === 1) {\n                        debugLog['sync_virtual_' + tableName + '_' + fieldName] = '虚拟字段(Type=' + fieldType + ')，跳过物理表同步';\n                        continue;\n                    }\n\n                    // 安全转换字段名\n                    var fieldNameStr = '';\n                    try {\n                        fieldNameStr = String(fieldName);\n                    } catch (e) {\n                        debugLog['sync_fieldname_convert_error_' + tableName + '_' + f] = e.message;\n                        continue;\n                    }\n\n                    // MySQL字段名长度限制（安全检查）\n                    var fieldNameLength = 0;\n                    try {\n                        fieldNameLength = Number(fieldNameStr.length) || 0;\n                    } catch (e) {\n                        debugLog['sync_length_error_' + tableName + '_' + f] = e.message;\n                        continue;\n                    }\n\n                    if (fieldNameLength > 64) {\n                        try {\n                            var shortName = String.prototype.substring.call(fieldNameStr, 0, 30);\n                            debugLog['sync_name_too_long_' + tableName + '_' + shortName] = '字段名过长：' + fieldNameLength;\n                        } catch (e) {\n                            debugLog['sync_name_too_long_' + tableName + '_' + f] = '字段名过长：' + fieldNameLength;\n                        }\n                        continue;\n                    }\n\n                    // 字段已存在，跳过（忽略大小写比较）\n                    var fieldNameLower = '';\n                    try {\n                        fieldNameLower = String.prototype.toLowerCase.call(fieldNameStr);\n                    } catch (e) {\n                        debugLog['sync_lowercase_error_' + tableName + '_' + f] = e.message;\n                        continue;\n                    }\n\n                    if (existingColumns[fieldNameLower]) {\n                        continue;\n                    }\n                } catch (outerError) {\n                    debugLog['sync_field_loop_error_' + tableName + '_' + f] = outerError.message;\n                    continue;\n                }\n\n                // 字段不存在，需要添加（使用实际的物理表名）\n                try {\n                    var fieldType = mapToMySQLType(field.Type);\n                    var alterSQL = 'ALTER TABLE `' + actualTableName + '` ADD COLUMN `' + fieldNameStr + '` ' + fieldType;\n\n                    // Id字段特殊处理\n                    if (fieldNameStr == 'Id') {\n                        alterSQL += ' NOT NULL PRIMARY KEY';\n                    } else {\n                        alterSQL += ' NULL';\n                    }\n\n                    // 添加字段说明\n                    if (field.Label && field.Label !== fieldNameStr) {\n                        try {\n                            var comment = String(field.Label).replace(/'/g, \"''\");\n                            alterSQL += \" COMMENT '\" + comment + \"'\";\n                        } catch (e) {\n                            debugLog['sync_comment_error_' + tableName + '_' + fieldNameStr] = e.message;\n                        }\n                    }\n\n                    try {\n                        V8.Db.FromSql(alterSQL).ExecuteNonQuery();\n                        physicalFieldsAdded++;\n                        fieldsAddedForTable++;\n                        debugLog['sync_added_' + tableName + '_' + fieldNameStr] = '字段已添加';\n                    } catch (alterError) {\n                        debugLog['sync_add_error_' + tableName + '_' + fieldNameStr] = alterError.message;\n                    }\n                } catch (buildSqlError) {\n                    debugLog['sync_buildsql_error_' + tableName + '_' + f] = buildSqlError.message;\n                }\n            }\n\n            if (fieldsAddedForTable > 0) {\n                debugLog['sync_table_' + tableName] = '添加了' + fieldsAddedForTable + '个字段';\n            }\n\n        } catch (checkError) {\n            debugLog['sync_error_' + tableName] = checkError.message;\n        }\n    }\n\n    stats.PhysicalFieldsAdded = physicalFieldsAdded;\n    stats.PhysicalFieldsRenamed = physicalFieldsRenamed;\n    stats.PhysicalFieldsModified = physicalFieldsModified;\n    debugLog.step2_5Result = '物理表字段同步完成：重命名' + physicalFieldsRenamed + '，修改' + physicalFieldsModified + '，新增' + physicalFieldsAdded;\n\n    // ==================== 步骤3：处理sys_menu数据 ====================\n\n    debugLog.step3 = '开始处理sys_menu数据';\n\n    var sysMenus = Package.SysMenus || [];\n\n    // 按ParentId排序，确保父菜单先导入\n    var sortedMenus = [];\n    var menuMap = {};\n\n    for (var i = 0; i < sysMenus.length; i++) {\n        menuMap[sysMenus[i].Id] = sysMenus[i];\n    }\n\n    // 先导入没有ParentId的根菜单\n    for (var i = 0; i < sysMenus.length; i++) {\n        if (!sysMenus[i].ParentId || sysMenus[i].ParentId == null) {\n            sortedMenus.push(sysMenus[i]);\n        }\n    }\n\n    // 再导入有ParentId的子菜单\n    for (var i = 0; i < sysMenus.length; i++) {\n        if (sysMenus[i].ParentId && sysMenus[i].ParentId !== null) {\n            sortedMenus.push(sysMenus[i]);\n        }\n    }\n\n    for (var i = 0; i < sortedMenus.length; i++) {\n        var menu = sortedMenus[i];\n\n        if (!menu.Id) {\n            debugLog['menu_no_id_' + i] = '跳过无Id的菜单数据';\n            continue;\n        }\n\n        var exists = checkExists('sys_menu', menu.Id);\n\n        //如果传入了 InstallParentSysMenuId，并且当前菜单的ParentId并不存在于待导入的菜单中\n        if (InstallParentSysMenuId && sysMenus.findIndex(m => m.Id === menu.ParentId) === -1) {\n            //并且当前菜单的ParentId等于InstallParentSysMenuId，则将ParentId修改为新导入应用的根菜单Id\n            menu.ParentId = InstallParentSysMenuId;\n        }\n        //如果当前菜单的ParentId并不存在于待导入的菜单中，并且当前菜单的Id不存在于sys_menu表中，则置为顶级\n        else if (menu.ParentId\n            && menu.ParentId != '00000000000000000000000000'\n            && menu.ParentId != '00000000-0000-0000-0000-000000000000'\n            && sysMenus.findIndex(m => m.Id === menu.ParentId) === -1) {\n            var existsParent = checkExists('sys_menu', menu.ParentId);\n            if (!existsParent) {\n                menu.ParentId = '00000000000000000000000000';\n            }\n        }\n        var modelCopy = {\n            _FormData: {}\n        };\n        for (var key in menu) {\n            modelCopy._FormData[key] = menu[key];\n        }\n        modelCopy.OsClient = V8.OsClient;\n        modelCopy.Id = menu.Id;\n        if (exists) {\n            // 存在则修改\n            var uptResult = V8.FormEngine.UptFormData('sys_menu', modelCopy);\n            if (uptResult.Code == 1) {\n                stats.MenuUpdated++;\n            } else {\n                debugLog['menu_upt_error_' + menu.Id] = uptResult.Msg;\n            }\n        } else {\n            // 不存在则新增\n            var addResult = V8.FormEngine.AddFormData('sys_menu', modelCopy);\n            if (addResult.Code == 1) {\n                stats.MenuInserted++;\n            } else {\n                //新增的时候可能会报错【[Url]已存在唯一值：】【[ModuleEngineKey]已存在唯一值：】,暂时不处理，发布包的时候尽量避免重复\n                debugLog['menu_add_error_' + menu.Id] = addResult.Msg;\n            }\n        }\n\n        //清除缓存\n        V8.Cache.Remove(`Microi:${V8.OsClient}:FormData:sys_menu:${menu.Id.toLowerCase()}`);\n        if (menu.ModuleEngineKey) {\n            V8.Cache.Remove(`Microi:${V8.OsClient}:FormData:sys_menu:${menu.ModuleEngineKey.toLowerCase()}`);\n        }\n    }\n\n    debugLog.step3Result = '菜单数据处理完成：新增' + stats.MenuInserted + '，修改' + stats.MenuUpdated;\n\n    // ==================== 步骤4：处理wf_flowdesign数据（可选） ====================\n\n    if (Package.WfFlowDesigns && Package.WfFlowDesigns.length > 0) {\n        debugLog.step4 = '开始处理wf_flowdesign数据';\n\n        var wfFlows = Package.WfFlowDesigns;\n\n        for (var i = 0; i < wfFlows.length; i++) {\n            var flow = wfFlows[i];\n\n            if (!flow.Id) {\n                debugLog['flow_no_id_' + i] = '跳过无Id的工作流数据';\n                continue;\n            }\n\n            var exists = checkExists('wf_flowdesign', flow.Id);\n            var modelCopy = {\n                _FormData: {}\n            };\n            for (var key in flow) {\n                modelCopy._FormData[key] = flow[key];\n            }\n            modelCopy.OsClient = V8.OsClient;\n            modelCopy.Id = flow.Id;\n            if (exists) {\n                var uptResult = V8.FormEngine.UptFormData('wf_flowdesign', modelCopy);\n                if (uptResult.Code == 1) {\n                    stats.FlowUpdated++;\n                } else {\n                    debugLog['flow_upt_error_' + flow.Id] = uptResult.Msg;\n                }\n            } else {\n                // 不存在则新增\n                var addResult = V8.FormEngine.AddFormData('wf_flowdesign', modelCopy);\n                if (addResult.Code == 1) {\n                    stats.FlowInserted++;\n                } else {\n                    debugLog['flow_add_error_' + flow.Id] = addResult.Msg;\n                }\n            }\n        }\n\n        debugLog.step4Result = '工作流数据处理完成：新增' + stats.FlowInserted + '，修改' + stats.FlowUpdated;\n    }\n\n    // ==================== 步骤5：处理wf_node数据（可选） ====================\n\n    if (Package.WfNodes && Package.WfNodes.length > 0) {\n        debugLog.step5 = '开始处理wf_node数据';\n\n        var wfNodes = Package.WfNodes;\n\n        for (var i = 0; i < wfNodes.length; i++) {\n            var node = wfNodes[i];\n\n            if (!node.Id) {\n                debugLog['node_no_id_' + i] = '跳过无Id的节点数据';\n                continue;\n            }\n\n            var exists = checkExists('wf_node', node.Id);\n            var modelCopy = {\n                _FormData: {}\n            };\n            for (var key in node) {\n                modelCopy._FormData[key] = node[key];\n            }\n            modelCopy.OsClient = V8.OsClient;\n            modelCopy.Id = node.Id;\n            if (exists) {\n                var uptResult = V8.FormEngine.UptFormData('wf_node', modelCopy);\n                if (uptResult.Code == 1) {\n                    stats.NodeUpdated++;\n                } else {\n                    debugLog['node_upt_error_' + node.Id] = uptResult.Msg;\n                }\n            } else {\n                // 不存在则新增\n                var addResult = V8.FormEngine.AddFormData('wf_node', modelCopy);\n                if (addResult.Code == 1) {\n                    stats.NodeInserted++;\n                } else {\n                    debugLog['node_add_error_' + node.Id] = addResult.Msg;\n                }\n            }\n        }\n\n        debugLog.step5Result = '节点数据处理完成：新增' + stats.NodeInserted + '，修改' + stats.NodeUpdated;\n    }\n\n    // ==================== 步骤6：处理wf_line数据（可选） ====================\n\n    if (Package.WfLines && Package.WfLines.length > 0) {\n        debugLog.step6 = '开始处理wf_line数据';\n\n        var wfLines = Package.WfLines;\n\n        for (var i = 0; i < wfLines.length; i++) {\n            var line = wfLines[i];\n\n            if (!line.Id) {\n                debugLog['line_no_id_' + i] = '跳过无Id的连线数据';\n                continue;\n            }\n\n            var exists = checkExists('wf_line', line.Id);\n            var modelCopy = {\n                _FormData: {}\n            };\n            for (var key in line) {\n                modelCopy._FormData[key] = line[key];\n            }\n            modelCopy.OsClient = V8.OsClient;\n            modelCopy.Id = line.Id;\n            if (exists) {\n                // 存在则修改\n                var uptResult = V8.FormEngine.UptFormData('wf_line', modelCopy);\n                if (uptResult.Code == 1) {\n                    stats.LineUpdated++;\n                } else {\n                    debugLog['line_upt_error_' + line.Id] = uptResult.Msg;\n                }\n            } else {\n                // 不存在则新增\n                var addResult = V8.FormEngine.AddFormData('wf_line', modelCopy);\n                if (addResult.Code == 1) {\n                    stats.LineInserted++;\n                } else {\n                    debugLog['line_add_error_' + line.Id] = addResult.Msg;\n                }\n            }\n        }\n\n        debugLog.step6Result = '连线数据处理完成：新增' + stats.LineInserted + '，修改' + stats.LineUpdated;\n    }\n\n    // ==================== 步骤7：处理sys_apiengine数据（可选） ====================\n\n    if (Package.SysApiEngines && Package.SysApiEngines.length > 0) {\n        debugLog.step7 = '开始处理sys_apiengine数据';\n\n        var sysApiEngines = Package.SysApiEngines;\n\n        for (var i = 0; i < sysApiEngines.length; i++) {\n            var apiEngine = sysApiEngines[i];\n\n            if (!apiEngine.Id && !apiEngine.ApiEngineKey) {\n                debugLog['apiengine_no_id_key_' + i] = '跳过无Id和ApiEngineKey的接口引擎数据';\n                continue;\n            }\n\n            // 根据Id或ApiEngineKey判断是否存在\n            var existsById = false;\n            var existsByKey = false;\n            var existingId = null;\n\n            if (apiEngine.Id) {\n                existsById = checkExists('sys_apiengine', apiEngine.Id);\n                if (existsById) {\n                    existingId = apiEngine.Id;\n                }\n            }\n\n            if (!existsById && apiEngine.ApiEngineKey) {\n                var checkByKeyResult = V8.FormEngine.GetFormData('sys_apiengine', {\n                    OsClient: V8.OsClient,\n                    _Where: [['ApiEngineKey', '=', apiEngine.ApiEngineKey]],\n                    _PageSize: 1\n                });\n                existsByKey = checkByKeyResult.Code == 1 && checkByKeyResult.Data;\n                //如果存在ApiEngineKey，但不存在Id，将此ApiEngineKey的Id修改为应用商城的sys_apiengine的Id\n                if (existsByKey) {\n                    try {\n                        V8.Db.FromSql(\"UPDATE sys_apiengine SET Id = '\" + apiEngine.Id + \"' WHERE ApiEngineKey = '\" + apiEngine.ApiEngineKey + \"' and IsDeleted<>1\")\n                            .ExecuteNonQuery();\n                    } catch (error) {\n\n                    }\n\n                    //清除缓存\n                    V8.Cache.Remove(`Microi:${V8.OsClient}:FormData:sys_apiengine:${checkByKeyResult.Data.Id.toLowerCase()}`);\n                    V8.Cache.Remove(`Microi:${V8.OsClient}:FormData:sys_apiengine:${checkByKeyResult.Data.ApiEngineKey.toLowerCase()}`);\n                    existingId = apiEngine.Id;\n                }\n            }\n\n            var exists = existsById || existsByKey;\n            var modelCopy = {\n                _FormData: {}\n            };\n            for (var key in apiEngine) {\n                modelCopy._FormData[key] = apiEngine[key];\n            }\n            modelCopy.OsClient = V8.OsClient;\n            modelCopy.Id = apiEngine.Id;\n            if (exists) {\n                var uptResult = V8.FormEngine.UptFormData('sys_apiengine', modelCopy);\n                if (uptResult.Code == 1) {\n                    stats.ApiEngineUpdated++;\n                } else {\n                    debugLog['apiengine_upt_error_' + existingId] = uptResult.Msg;\n                }\n            } else {\n                // 不存在则新增\n                var addResult = V8.FormEngine.AddFormData('sys_apiengine', modelCopy);\n                if (addResult.Code == 1) {\n                    stats.ApiEngineInserted++;\n                } else {\n                    debugLog['apiengine_add_error_' + (apiEngine.Id || apiEngine.ApiEngineKey)] = addResult.Msg;\n                }\n            }\n        }\n\n        debugLog.step7Result = '接口引擎数据处理完成：新增' + stats.ApiEngineInserted + '，修改' + stats.ApiEngineUpdated;\n    }\n\n    debugLog.endTime = new Date().toISOString();\n\n    // ==================== 返回结果 ====================\n    // 注意：平台会根据返回Code自动管理事务\n    // Code=1 时自动提交事务，Code=0 时自动回滚事务\n\n    return {\n        Code: 1,\n        Data: stats,\n        Msg: '导入成功',\n        Debug: isDebug ? debugLog : undefined\n    };\n\n} catch (error) {\n    // ==================== 异常处理 ====================\n    // 注意：返回Code=0时，平台会自动回滚事务\n\n    debugLog.error = {\n        message: error.message,\n        stack: error.stack,\n        endTime: new Date().toISOString()\n    };\n\n    return {\n        Code: 0,\n        Msg: '导入失败：' + error.message,\n        Debug: isDebug ? debugLog : undefined\n    };\n}\n","ApiRole":"[]","IsEnable":1,"ApiEngineKey":"import-microi-store-package","ApiName":"[系统]应用商城导入数据包","Id":"01KGFFG74EZAS9VQTXZKD59X89","CreateTime":"2026-02-02 23:29:18"},{"LimitRecursion":10000,"LimitMemory":2048,"MaxStatements":100000000,"Timeout":600,"StopHttp":0,"EnableLog":0,"Category":"系统","Files":"[]","ApiAddress":"/apiengine/export-microi-store-package","AllowAnonymous":0,"ResponseFile":0,"Lock":0,"ApiV8Code":"/**\n * 导出应用数据包接口引擎（A系统）\n * \n * 功能：导出菜单、表定义、字段定义、工作流、接口引擎等元数据，形成应用数据包\n * \n * 业务逻辑：\n * 1. 接收一个或多个sys_menu的Id，获取它们及所有子菜单数据\n * 2. 获取每个菜单对应的diy_table数据\n * 3. 获取每个diy_table对应的diy_field数据\n * 4. 可选：接收一个或多个wf_flowdesign的Id，获取它们及对应的wf_node数据\n * 5. 可选：接收一个或多个sys_apiengine的ApiEngineKey，获取对应的接口引擎数据\n * 6. 将所有数据打包成一个JSON数据包返回\n * \n * 接口配置：\n * - ApiEngineKey: export-microi-store-package\n * - ApiAddress: /apiengine/export-microi-store-package\n * - 允许匿名调用: 否\n * - 分布式锁: 否\n * \n * 前端调用示例：\n * V8.ApiEngine.Run('export-microi-store-package', {\n *   MenuIds: ['menu-id-1', 'menu-id-2'],  // 可选\n *   FlowIds: ['flow-id-1', 'flow-id-2'],  // 可选\n *   ApiEngineKeys: ['api-key-1', 'api-key-2']  // 可选，传'*'表示导出所有\n * })\n * \n * 注意：MenuIds、FlowIds、ApiEngineKeys 至少要传入一个非空数组\n * \n * 返回格式：\n * {\n *   Code: 1,\n *   Data: {\n *     PackageInfo: { name: '', version: '', createTime: '' },\n *     SysMenus: [...],\n *     DiyTables: [...],\n *     DiyFields: [...],\n *     WfFlowDesigns: [...],  // 可选\n *     WfNodes: [...],  // 可选\n *     WfLines: [...],  // 可选\n *     SysApiEngines: [...]  // 可选\n *   },\n *   Msg: '导出成功'\n * }\n */\n\n// ==================== 参数接收与校验 ====================\n\nvar MenuIds = V8.Param.MenuIds;  // 菜单Id数组\nvar FlowIds = V8.Param.FlowIds;  // 工作流Id数组（可选）\nvar ApiEngineKeys = V8.Param.ApiEngineKeys;  // 接口引擎Key数组（可选）\nvar PackageName = V8.Param.PackageName || '未命名应用包';  // 应用包名称\nvar PackageVersion = V8.Param.PackageVersion || '1.0.0';  // 应用包版本\n\n// 定义调试模式\nvar isDebug = true;\nvar debugLog = {};\n\n// 参数校验：MenuIds、FlowIds、ApiEngineKeys 至少要有一个非空\nvar hasMenuIds = MenuIds && MenuIds.length > 0;\nvar hasFlowIds = FlowIds && FlowIds.length > 0;\nvar hasApiEngineKeys = ApiEngineKeys && ApiEngineKeys.length > 0;\n\nif (!hasMenuIds && !hasFlowIds && !hasApiEngineKeys) {\n    return {\n        Code: 0,\n        Msg: '参数错误：MenuIds、FlowIds、ApiEngineKeys 至少要传入一个非空数组'\n    };\n}\n\ntry {\n    debugLog.startTime = new Date().toISOString();\n    debugLog.inputMenuIds = MenuIds;\n    debugLog.inputFlowIds = FlowIds;\n    debugLog.inputApiEngineKeys = ApiEngineKeys;\n\n    var fixedDiyField = [\n        { Name: \"Id\" , Label: \"Id\", Type: \"varchar(36)\", Component: \"Guid\", Sort: 1, Visible: 0, TableWidth: 150 },\n        { Name: \"CreateTime\" , Label: \"创建时间\", Type: \"datetime\", Component: \"DateTime\", Sort: 2, Visible: 1, TableWidth: 150 },\n        { Name: \"UpdateTime\" , Label: \"修改时间\", Type: \"datetime\", Component: \"DateTime\", Sort: 3, Visible: 1, TableWidth: 150 },\n        { Name: \"UserId\" , Label: \"创建人Id\", Type: \"varchar(36)\", Component: \"Guid\", Sort: 4, Visible: 0, TableWidth: 150 },\n        { Name: \"UserName\" , Label: \"创建人\", Type: \"varchar(255)\", Component: \"Text\", Sort: 5, Visible: 1, TableWidth: 150 },\n        { Name: \"IsDeleted\" , Label: \"是否已删除\", Type: \"int\", Component: \"Switch\", Sort: 6, Visible: 0, TableWidth: 50 }\n    ];\n\n    \n    var someTableList = V8.FormEngine.GetTableData('diy_table', {\n        _Where: [\n            ['Name', 'In', ['sys_menu', 'diy_table', 'diy_field', 'wf_flowdesign', 'wf_node', 'wf_line', 'sys_apiengine']]\n        ]\n    });\n    if(someTableList.Code !=1){\n        return someTableList;\n    }\n    someTableList = someTableList.Data;\n    var someTableIds = someTableList.map(item => item.Id);\n\n    var someFieldList = V8.FormEngine.GetTableData('diy_field', {\n        _Where: [\n            ['TableId', 'In', someTableIds]\n        ]\n    });\n    if(someFieldList.Code !=1){\n        return someFieldList;\n    }\n    someFieldList = someFieldList.Data;\n\n    // 清理函数：移除对象中值为 null 或空字符串的属性，并移除跨租户字段\n    var cleanObject = function(obj) {\n        var cleaned = {};\n        // 需要移除的字段列表（跨租户数据）\n        var excludeFields = {\n            'OsClient': true,\n            'CreateUserId': true,\n            'UpdateUserId': true,\n            'CreateUser': true,\n            'UpdateUser': true\n        };\n        \n        for (var key in obj) {\n            var value = obj[key];\n            // 跳过需要排除的字段\n            if (excludeFields[key]) {\n                continue;\n            }\n            // 只保留有值的字段（排除 null、undefined、空字符串）\n            if (value !== null && value !== undefined && value !== '') {\n                cleaned[key] = value;\n            }\n        }\n        return cleaned;\n    };\n\n    // ==================== 步骤1：查询所有菜单数据 ====================\n    \n    var exportMenus = [];\n    var tableIds = [];\n    var tableIdMap = {};\n    \n    if (hasMenuIds) {\n        // 获取菜单单所有字段 START\n        var sysMenuTableModel = someTableList.find(item => item.Name && item.Name.toLowerCase() == 'sys_menu');\n    var sysMenuTableId = sysMenuTableModel.Id;\n    var sysMenuFields = someFieldList.filter(item => item.TableId == sysMenuTableId);\n    var sysMenuFieldNames = sysMenuFields.map(item => {\n        return item.Name;\n    });\n    \n    // 去重：使用对象键值特性去除重复字段\n    var fieldMap = {};\n    for (var i = 0; i < sysMenuFieldNames.length; i++) {\n        fieldMap[sysMenuFieldNames[i]] = true;\n    }\n    sysMenuFieldNames = [];\n    for (var fieldName in fieldMap) {\n        sysMenuFieldNames.push(fieldName);\n    }\n    \n    // 确保必要字段存在\n    if(sysMenuFieldNames.indexOf('Id') <= -1){\n        sysMenuFieldNames.push('Id');\n    }\n    if(sysMenuFieldNames.indexOf('ParentId') <= -1){\n        sysMenuFieldNames.push('ParentId');\n    }\n    if(sysMenuFieldNames.indexOf('DiyTableId') <= -1){\n        sysMenuFieldNames.push('DiyTableId');\n    }\n    if(sysMenuFieldNames.indexOf('CreateTime') <= -1){\n        sysMenuFieldNames.push('CreateTime');\n    }\n    // 获取菜单单所有字段 END\n    \n    debugLog.sysMenuFieldNames = sysMenuFieldNames;\n    debugLog.sysMenuFieldNamesCount = sysMenuFieldNames.length;\n    \n    var allMenusResult = V8.FormEngine.GetTableData('sys_menu', {\n        _SelectFields: sysMenuFieldNames,\n    });\n\n    if (allMenusResult.Code !== 1) {\n        return {\n            Code: 0,\n            Msg: '查询sys_menu表失败：' + allMenusResult.Msg\n        };\n    }\n\n    var allMenus = allMenusResult.Data || [];\n    debugLog.totalMenusInDb = allMenus.length;\n    \n    // 检查传入的MenuId是否在查询结果中\n    var targetMenu = allMenus.find(m => m.Id == MenuIds[0]);\n    debugLog.targetMenuFound = !!targetMenu;\n    debugLog.targetMenuData = targetMenu;\n\n    // ==================== 步骤2：递归获取所有子菜单 ====================\n    \n    // 递归获取所有子菜单ID（带循环引用检测）\n    var getAllChildMenuIds = function(parentId, allMenus, visited) {\n        // 初始化访问记录\n        if (!visited) {\n            visited = {};\n        }\n        \n        // parentId 必须有值，防止用 null 去匹配导致查询到所有根菜单\n        // 注意：用户传入的 MenuId 永远不会是 null，只有在递归过程中数据异常时才可能出现\n        if (!parentId) {\n            return [];\n        }\n        \n        // 防止循环引用导致死循环\n        if (visited[parentId]) {\n            return [];\n        }\n        \n        visited[parentId] = true;\n        var childIds = [parentId]; // 包含自己\n        \n        for (var i = 0; i < allMenus.length; i++) {\n            // 查找子菜单：ParentId 等于当前 parentId\n            // 必须确保子菜单的 Id 有值，防止递归时传入 null\n            if (allMenus[i].ParentId == parentId && allMenus[i].Id && allMenus[i].Id != parentId) {\n                var subChildIds = getAllChildMenuIds(allMenus[i].Id, allMenus, visited);\n                childIds = childIds.concat(subChildIds);\n            }\n        }\n        return childIds;\n    };\n\n    // 收集所有相关菜单ID\n    var allRelatedMenuIds = [];\n    var menuIdMap = {};\n    \n    for (var i = 0; i < MenuIds.length; i++) {\n        var menuId = MenuIds[i];\n        var childIds = getAllChildMenuIds(menuId, allMenus);\n        for (var j = 0; j < childIds.length; j++) {\n            if (!menuIdMap[childIds[j]]) {\n                allRelatedMenuIds.push(childIds[j]);\n                menuIdMap[childIds[j]] = true;\n            }\n        }\n    }\n\n    debugLog.relatedMenuIdsCount = allRelatedMenuIds.length;\n    debugLog.relatedMenuIds = allRelatedMenuIds;\n\n    // 过滤出所有相关菜单数据并清理空字段\n    var exportMenus = [];\n    for (var i = 0; i < allMenus.length; i++) {\n        if (menuIdMap[allMenus[i].Id]) {\n            exportMenus.push(cleanObject(allMenus[i]));\n        }\n    }\n\n        debugLog.exportMenusCount = exportMenus.length;\n        debugLog.exportMenusSample = exportMenus.slice(0, 3);  // 返回前3条菜单数据样本\n\n        // ==================== 步骤3：获取所有菜单关联的表ID ====================\n        \n        for (var i = 0; i < exportMenus.length; i++) {\n            if (exportMenus[i].DiyTableId) {\n                if (!tableIdMap[exportMenus[i].DiyTableId]) {\n                    tableIds.push(exportMenus[i].DiyTableId);\n                    tableIdMap[exportMenus[i].DiyTableId] = true;\n                }\n            }\n        }\n\n        debugLog.relatedTableIds = tableIds;\n    } else {\n        debugLog.step1Skip = '未传入MenuIds，跳过菜单数据查询';\n    }\n\n    // ==================== 步骤4：查询所有相关的diy_table数据 ====================\n    // 获取 diy_table 所有字段 START\n    var diyTableTableModel = someTableList.find(item => item.Name && item.Name.toLowerCase() == 'diy_table');\n    var diyTableTableId = diyTableTableModel.Id;\n    var diyTableFields = someFieldList.filter(item => item.TableId == diyTableTableId);\n    var diyTableFieldNames = diyTableFields.map(item => {\n        return item.Name;\n    });\n    if(diyTableFieldNames.indexOf('Id') <= -1){\n        diyTableFieldNames.push('Id');\n    }\n    if(diyTableFieldNames.indexOf('CreateTime') <= -1){\n        diyTableFieldNames.push('CreateTime');\n    }\n    // 获取 diy_table 所有字段 END\n\n    var exportTables = [];\n    \n    if (tableIds.length > 0) {\n        var tablesResult = V8.FormEngine.GetTableData('diy_table', {\n            _SelectFields: diyTableFieldNames,\n            _Where: [\n                ['Id', 'In', JSON.stringify(tableIds)]\n            ]\n        });\n\n        if (tablesResult.Code !== 1) {\n            return {\n                Code: 0,\n                Msg: '查询diy_table表失败：' + tablesResult.Msg\n            };\n        }\n\n        exportTables = tablesResult.Data || [];\n    }\n    \n    // 清理 diy_table 数据\n    exportTables = exportTables.map(cleanObject);\n\n    debugLog.exportTablesCount = exportTables.length;\n\n    // ==================== 步骤5：查询所有相关的diy_field数据 ====================\n    // 获取 diy_field 所有字段 START\n    var diyFieldTableModel = someTableList.find(item => item.Name && item.Name.toLowerCase() == 'diy_field');\n    var diyFieldTableId = diyFieldTableModel.Id;\n    var diyFieldFields = someFieldList.filter(item => item.TableId == diyFieldTableId);\n    var diyFieldFieldNames = diyFieldFields.map(item => {\n        return item.Name;\n    });\n    if(diyFieldFieldNames.indexOf('Id') <= -1){\n        diyFieldFieldNames.push('Id');\n    }\n    if(diyFieldFieldNames.indexOf('CreateTime') <= -1){\n        diyFieldFieldNames.push('CreateTime');\n    }\n    // 获取 diy_field 所有字段 END\n    var exportFields = [];\n    \n    if (tableIds.length > 0) {\n        var fieldsResult = V8.FormEngine.GetTableData('diy_field', {\n            _SelectFields: diyFieldFieldNames,\n            _Where: [\n                ['TableId', 'In', JSON.stringify(tableIds)]\n            ],\n        });\n\n        if (fieldsResult.Code !== 1) {\n            return {\n                Code: 0,\n                Msg: '查询diy_field表失败：' + fieldsResult.Msg\n            };\n        }\n\n        exportFields = fieldsResult.Data || [];\n    }\n    \n    // 清理 diy_field 数据\n    exportFields = exportFields.map(cleanObject);\n\n    debugLog.exportFieldsCount = exportFields.length;\n\n    // ==================== 步骤5.5：生成DDL语句 ====================\n    \n    // MySQL类型映射函数\n    var mapToMySQLType = function(diyType) {\n        if (!diyType) return 'varchar(255)';\n        \n        var typeStr = diyType.toLowerCase();\n        \n        // 已经是标准MySQL类型，直接返回\n        if (typeStr.match(/^(varchar|int|bigint|datetime|text|longtext|decimal|double|float|tinyint|date|time|timestamp|json)\\(/)) {\n            return diyType;\n        }\n        if (typeStr == 'int' || typeStr == 'bigint' || typeStr == 'text' || typeStr == 'longtext' || \n            typeStr == 'datetime' || typeStr == 'date' || typeStr == 'time' || typeStr == 'timestamp' || \n            typeStr == 'json' || typeStr == 'tinyint' || typeStr == 'double' || typeStr == 'float') {\n            return diyType;\n        }\n        \n        // 类型映射\n        if (typeStr.indexOf('varchar') == 0) return diyType;\n        if (typeStr.indexOf('decimal') == 0) return diyType;\n        \n        // 默认映射规则\n        return 'varchar(255)';\n    };\n    \n    // 为每个表生成DDL\n    var ddlStatements = [];\n    for (var i = 0; i < exportTables.length; i++) {\n        var table = exportTables[i];\n        var tableName = table.Name;\n        var tableFields = exportFields.filter(f => f.TableId == table.Id);\n        \n        if (!tableName) continue;\n        \n        // 合并审计字段：先添加fixedDiyField，再添加表的自定义字段\n        var allFields = [];\n        \n        // 1. 添加审计字段\n        for (var k = 0; k < fixedDiyField.length; k++) {\n            allFields.push({\n                Name: fixedDiyField[k].Name,\n                Type: fixedDiyField[k].Type,\n                Label: fixedDiyField[k].Label,\n                IsFixed: true\n            });\n        }\n        \n        // 2. 添加表的自定义字段（排除已在fixedDiyField中的字段）\n        var fixedFieldNames = {};\n        for (var k = 0; k < fixedDiyField.length; k++) {\n            fixedFieldNames[fixedDiyField[k].Name] = true;\n        }\n        \n        for (var j = 0; j < tableFields.length; j++) {\n            if (!fixedFieldNames[tableFields[j].Name]) {\n                allFields.push({\n                    Name: tableFields[j].Name,\n                    Type: tableFields[j].Type,\n                    Label: tableFields[j].Label || tableFields[j].Name,\n                    IsFixed: false\n                });\n            }\n        }\n        \n        if (allFields.length == 0) continue;\n        \n        var fieldDefs = [];\n        var fieldNameMap = {};  // 用于字段去重\n        \n        for (var j = 0; j < allFields.length; j++) {\n            var field = allFields[j];\n            var fieldName = field.Name;\n            \n            if (!fieldName) continue;\n            \n            // MySQL字段名长度限制为64字符，超过则截断并记录\n            if (fieldName.length > 64) {\n                debugLog['field_name_too_long_' + table.Name + '_' + fieldName] = '字段名过长，已截断：' + fieldName.length + '字符';\n                fieldName = fieldName.substring(0, 64);\n            }\n            \n            // 字段去重：如果字段名已存在，跳过\n            if (fieldNameMap[fieldName]) {\n                debugLog['field_duplicate_' + table.Name + '_' + fieldName] = '字段重复，已跳过';\n                continue;\n            }\n            fieldNameMap[fieldName] = true;\n            \n            var fieldType = mapToMySQLType(field.Type);\n            var fieldDef = '`' + fieldName + '` ' + fieldType;\n            \n            // 主键不允许NULL\n            if (fieldName == 'Id') {\n                fieldDef += ' NOT NULL PRIMARY KEY';\n            } else {\n                // 其他字段允许NULL\n                fieldDef += ' NULL';\n            }\n            \n            // 添加字段说明（COMMENT）\n            if (field.Label && field.Label !== fieldName) {\n                // 转义单引号\n                var comment = field.Label.replace(/'/g, \"''\");\n                fieldDef += \" COMMENT '\" + comment + \"'\";\n            }\n            \n            fieldDefs.push(fieldDef);\n        }\n        \n        if (fieldDefs.length > 0) {\n            var ddl = 'CREATE TABLE IF NOT EXISTS `' + tableName + '` (\\n  ' + \n                      fieldDefs.join(',\\n  ') + \n                      '\\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;';\n            ddlStatements.push({\n                TableName: tableName,\n                TableId: table.Id,\n                DDL: ddl\n            });\n        }\n    }\n    \n    debugLog.ddlStatementsCount = ddlStatements.length;\n\n    // ==================== 步骤6：查询工作流数据（可选） ====================\n    \n    var exportFlows = [];\n    var exportNodes = [];\n    var exportLines = [];\n\n    // 检查是否要导出所有工作流\n    var exportAllFlows = FlowIds && FlowIds.length == 1 && FlowIds[0] == '*';\n    \n    if (exportAllFlows || (FlowIds && FlowIds.length > 0)) {\n        // 获取 wf_flowdesign 所有字段 START\n        var wfFlowdesignTableModel = someTableList.find(item => item.Name && item.Name.toLowerCase() == 'wf_flowdesign');\n        var wfFlowdesignTableId = wfFlowdesignTableModel.Id;\n        var wfFlowdesignFields = someFieldList.filter(item => item.TableId == wfFlowdesignTableId);\n        var wfFlowdesignFieldNames = wfFlowdesignFields.map(item => {\n            return item.Name;\n        });\n        if(wfFlowdesignFieldNames.indexOf('Id') <= -1){\n            wfFlowdesignFieldNames.push('Id');\n        }\n        if(wfFlowdesignFieldNames.indexOf('CreateTime') <= -1){\n            wfFlowdesignFieldNames.push('CreateTime');\n        }\n        // 获取 wf_flowdesign 所有字段 END\n        \n        // 查询工作流设计数据\n        var flowsWhere = [];\n        if (!exportAllFlows) {\n            // 只导出指定的工作流\n            flowsWhere.push(['Id', 'In', JSON.stringify(FlowIds)]);\n        }\n        // 如果是导出所有工作流，不添加Where条件\n        \n        var flowsResult = V8.FormEngine.GetTableData('wf_flowdesign', {\n            _SelectFields: wfFlowdesignFieldNames,\n            _Where: flowsWhere.length > 0 ? flowsWhere : undefined,\n        });\n\n        if (flowsResult.Code == 1) {\n            exportFlows = flowsResult.Data || [];\n            exportFlows = exportFlows.map(cleanObject);\n            debugLog.exportFlowsCount = exportFlows.length;\n            debugLog.exportAllFlows = exportAllFlows;\n\n            // 查询工作流节点数据\n            if (exportFlows.length > 0) {\n                // 收集实际导出的工作流Id列表\n                var actualFlowIds = exportFlows.map(function(flow) { return flow.Id; });\n                debugLog.actualFlowIds = actualFlowIds;\n                // 获取 wf_node 所有字段 START\n                var wfNodeTableModel = someTableList.find(item => item.Name && item.Name.toLowerCase() == 'wf_node');\n                var wfNodeTableId = wfNodeTableModel.Id;\n                var wfNodeFields = someFieldList.filter(item => item.TableId == wfNodeTableId);\n                var wfNodeFieldNames = wfNodeFields.map(item => {\n                    return item.Name;\n                });\n                if(wfNodeFieldNames.indexOf('Id') <= -1){\n                    wfNodeFieldNames.push('Id');\n                }\n                if(wfNodeFieldNames.indexOf('CreateTime') <= -1){\n                    wfNodeFieldNames.push('CreateTime');\n                }\n                // 获取 wf_node 所有字段 END\n                \n                var nodesResult = V8.FormEngine.GetTableData('wf_node', {\n                    _SelectFields: wfNodeFieldNames,\n                    _Where: [\n                        ['FlowDesignId', 'In', JSON.stringify(actualFlowIds)]\n                    ],\n                });\n\n                if (nodesResult.Code == 1) {\n                    exportNodes = nodesResult.Data || [];\n                    exportNodes = exportNodes.map(cleanObject);\n                    debugLog.exportNodesCount = exportNodes.length;\n                }\n                \n                // 获取 wf_line 所有字段 START\n                var wfLineTableModel = someTableList.find(item => item.Name && item.Name.toLowerCase() == 'wf_line');\n                var wfLineTableId = wfLineTableModel.Id;\n                var wfLineFields = someFieldList.filter(item => item.TableId == wfLineTableId);\n                var wfLineFieldNames = wfLineFields.map(item => {\n                    return item.Name;\n                });\n                if(wfLineFieldNames.indexOf('Id') <= -1){\n                    wfLineFieldNames.push('Id');\n                }\n                if(wfLineFieldNames.indexOf('CreateTime') <= -1){\n                    wfLineFieldNames.push('CreateTime');\n                }\n                // 获取 wf_line 所有字段 END\n                \n                // 查询工作流连线数据\n                var linesResult = V8.FormEngine.GetTableData('wf_line', {\n                    _SelectFields: wfLineFieldNames,\n                    _Where: [\n                        ['FlowDesignId', 'In', JSON.stringify(actualFlowIds)]\n                    ],\n                });\n\n                if (linesResult.Code == 1) {\n                    exportLines = linesResult.Data || [];\n                    exportLines = exportLines.map(cleanObject);\n                    debugLog.exportLinesCount = exportLines.length;\n                }\n            }\n        }\n    }\n\n    // ==================== 步骤7：查询接口引擎数据（可选） ====================\n    \n    var exportApiEngines = [];\n    \n    if (hasApiEngineKeys) {\n        // 获取 sys_apiengine 所有字段 START\n        var sysApiEngineTableModel = someTableList.find(item => item.Name && item.Name.toLowerCase() == 'sys_apiengine');\n        if (sysApiEngineTableModel) {\n            var sysApiEngineTableId = sysApiEngineTableModel.Id;\n            var sysApiEngineFields = someFieldList.filter(item => item.TableId == sysApiEngineTableId);\n            var sysApiEngineFieldNames = sysApiEngineFields.map(item => {\n                return item.Name;\n            });\n            if(sysApiEngineFieldNames.indexOf('Id') <= -1){\n                sysApiEngineFieldNames.push('Id');\n            }\n            if(sysApiEngineFieldNames.indexOf('ApiEngineKey') <= -1){\n                sysApiEngineFieldNames.push('ApiEngineKey');\n            }\n            if(sysApiEngineFieldNames.indexOf('CreateTime') <= -1){\n                sysApiEngineFieldNames.push('CreateTime');\n            }\n            // 获取 sys_apiengine 所有字段 END\n            \n            // 检查是否要导出所有接口引擎\n            var exportAllApiEngines = ApiEngineKeys.length == 1 && ApiEngineKeys[0] == '*';\n            \n            // 查询接口引擎数据\n            var apiEnginesWhere = [];\n            if (!exportAllApiEngines) {\n                // 只导出指定的接口引擎\n                apiEnginesWhere.push(['ApiEngineKey', 'In', JSON.stringify(ApiEngineKeys)]);\n            }\n            // 如果是导出所有接口引擎，不添加Where条件\n            \n            var apiEnginesResult = V8.FormEngine.GetTableData('sys_apiengine', {\n                _SelectFields: sysApiEngineFieldNames,\n                _Where: apiEnginesWhere.length > 0 ? apiEnginesWhere : undefined,\n            });\n\n            if (apiEnginesResult.Code == 1) {\n                exportApiEngines = apiEnginesResult.Data || [];\n                exportApiEngines = exportApiEngines.map(cleanObject);\n                debugLog.exportApiEnginesCount = exportApiEngines.length;\n                debugLog.exportAllApiEngines = exportAllApiEngines;\n            }\n        } else {\n            debugLog.apiEngineTableNotFound = 'sys_apiengine表定义未找到';\n        }\n    }\n\n    // ==================== 步骤8：组装数据包 ====================\n    \n    var packageData = {\n        PackageInfo: {\n            Name: PackageName,\n            Version: PackageVersion,\n            CreateTime: new Date().toISOString(),\n            CreateUser: V8.CurrentUser.Name || '未知',\n            OsClient: V8.OsClient,\n            MenuCount: exportMenus.length,\n            TableCount: exportTables.length,\n            FieldCount: exportFields.length,\n            FlowCount: exportFlows.length,\n            NodeCount: exportNodes.length,\n            LineCount: exportLines.length,\n            DDLCount: ddlStatements.length,\n            ApiEngineCount: exportApiEngines.length\n        },\n        DDLStatements: ddlStatements,  // DDL语句数组\n        SysMenus: exportMenus,\n        DiyTables: exportTables,\n        DiyFields: exportFields\n    };\n\n    // 只有在有工作流数据时才添加\n    if (exportFlows.length > 0) {\n        packageData.WfFlowDesigns = exportFlows;\n        packageData.WfNodes = exportNodes;\n        packageData.WfLines = exportLines;\n    }\n    \n    // 只有在有接口引擎数据时才添加\n    if (exportApiEngines.length > 0) {\n        packageData.SysApiEngines = exportApiEngines;\n    }\n\n    debugLog.endTime = new Date().toISOString();\n    debugLog.packageSize = JSON.stringify(packageData).length;\n\n    // ==================== 返回结果 ====================\n    \n    return {\n        Code: 1,\n        Data: packageData,\n        Msg: '导出成功',\n        Debug: isDebug ? debugLog : undefined\n    };\n\n} catch (error) {\n    // ==================== 异常处理 ====================\n    \n    debugLog.error = {\n        message: error.message,\n        stack: error.stack,\n        endTime: new Date().toISOString()\n    };\n\n    return {\n        Code: 0,\n        Msg: '导出失败：' + error.message,\n        Debug: isDebug ? debugLog : undefined\n    };\n}\n","ApiRole":"[]","IsEnable":1,"ApiEngineKey":"export-microi-store-package","ApiName":"[系统]应用商城导出数据包","Id":"01KGFFEK8P10P1S9SYH9PJNJ77","CreateTime":"2026-02-02 23:28:20"}]}