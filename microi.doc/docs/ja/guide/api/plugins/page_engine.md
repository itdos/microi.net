# ç•Œé¢å¼•æ“

## ä»‹ç»
ç•Œé¢è®¾è®¡å¼•æ“ä¸»è¦è§£å†³äº†ä½ä»£ç å¹³å°é¡µé¢å¿«é€Ÿè®¾è®¡é¡µé¢çš„ç—›ç‚¹ã€‚é€šè¿‡æ‹–æ‹‰æ‹½çš„æ–¹å¼å¿«é€Ÿè®¾è®¡é¡µé¢ï¼Œå¹¶ç”Ÿæˆå¯¹åº”çš„ä»£ç ã€‚å¹³å°ä¸ç•Œé¢å¼•æ“å®Œå…¨åˆ†ç¦»ï¼Œå¯ä»¥ç‹¬ç«‹éƒ¨ç½²ï¼ŒçœŸæ­£å®ç°é›¶è€¦åˆã€æ— æ±¡æŸ“ã€‚

æ¼”ç¤ºåœ°å€ï¼šhttps://www.nbweixin.cn/autopage/

åœ¨çº¿æ¼”ç¤ºæ•ˆæœå›¾ï¼š

![ç•Œé¢å¼•æ“](/api_plugins/page01.png)

## æ’ä»¶ç®€ä»‹ğŸ–ï¸

è®¾è®¡å¼•æ“åˆ†ä¸ºè®¾è®¡å™¨å’Œæ¸²æŸ“å™¨ä¸¤ä¸ªæ ¸å¿ƒç»„ä»¶:

ğŸ”¸è®¾è®¡å™¨  è´Ÿè´£å¿«é€Ÿæ„å»ºç²¾ç¾çš„é¡µé¢,æ¯”å¦‚é¦–é¡µ,åŠ¨æ€çœ‹æ¿,å¤§å±ç­‰,é‡‡ç”¨æç®€çš„è®¾è®¡ç†å¿µ,å‚»ç“œå¼æ“ä½œ,å¯¹å¼€å‘äººå‘˜çš„æŠ€æœ¯è¦æ±‚å¤§å¤§é™ä½

ğŸ”¸æ¸²æŸ“å™¨  è´Ÿè´£æ¸²æŸ“,ä»¥æ•°æ®é©±åŠ¨é¡µé¢å±•ç¤º.ä»¥å¾€å¯èƒ½è¿™éƒ¨åˆ†å·¥ä½œéƒ½æ˜¯å‰ç«¯æˆ–UIæ¥å®Œæˆçš„,ç°åœ¨æ™®é€šçš„åç«¯å¼€å‘äººå‘˜æˆ–è€…è¿ç»´å’Œé”€å”®è§’è‰²éƒ½å¯ä»¥èƒœä»».å¤§å¤§é™ä½äº†å›¢é˜Ÿç ”å‘çš„æˆæœ¬

## å¿«é€Ÿä¸Šæ‰‹ 
ç•Œé¢å¼•æ“å†…ç½®äº†ä¸€äº›å¸¸ç”¨çš„ç»„ä»¶ `widget` ,æ‰€æœ‰æ ·å¼éƒ½å¯ä»¥é€šè¿‡å‚æ•°è®¾ç½®æ¥æ§åˆ¶.ç»“æ„ä¸»è¦åŒ…æ‹¬å®¹å™¨ `container` å’Œç»„ä»¶ã€‚ä¸€ä¸ªå®¹å™¨å¯ä»¥å®¹çº³å¤šä¸ªç»„ä»¶,å®¹å™¨å’Œå®¹å™¨å¯ä»¥è¿› æ‹–æ‹½æ’åº ,ç»„ä»¶å’Œç»„ä»¶å¯ä»¥è¿›è¡Œæ‹–æ‹½æ’åº.å®¹å™¨å’Œç»„ä»¶éƒ½å¯ä»¥è¿›è¡Œ å®½é«˜æ‹–æ‹½ ,éšæ„æ­é…,å¸¦ç”¨äº†ä¸€äº›æŠ€æœ¯è§£å†³äº†æ …æ ¼ç³»ç»Ÿå¡Œé™·çš„é—®é¢˜,å¯ä»¥å®Œç¾å®ç° ç€‘å¸ƒæµå¼æ’ç‰ˆã€‚
 
### åŠŸèƒ½èœå•ä»‹ç» 

åŠŸèƒ½èœå•æ ä½äºå¤´éƒ¨ï¼Œä¸»è¦åŒ…å«æ”¶ç¼©ä¾§è¾¹æ ã€æŸ¥çœ‹é¡µé¢JSONã€æ¸…ç©ºå®¹å™¨ã€æ¼”ç¤ºæ¨¡æ¿ã€‚

![ç•Œé¢å¼•æ“](/api_plugins/page02.gif)

### ç»„ä»¶é¢æ¿ä»‹ç»
ç»„ä»¶é¢æ¿ä¸»è¦åŒ…æ‹¬å†…ç½®ç»„ä»¶ã€è‡ªå®šä¹‰ç»„ä»¶ã€å®¹å™¨ç»„ä»¶ç­‰ã€‚

![ç•Œé¢å¼•æ“](/api_plugins/page03.gif)

### å±æ€§é¢æ¿ä»‹ç»
å±æ€§é¢æ¿ ä½äºé¡µé¢å³ä¾§ï¼Œåˆ†ä¸ºé¡µé¢å‚æ•°è®¾ç½®ã€å®¹å™¨å‚æ•°è®¾ç½®ã€ç»„ä»¶å‚æ•°è®¾ç½®ä¸‰éƒ¨åˆ†ã€‚

- **é¡µé¢**:å‚æ•°ä¸»è¦é…ç½®é¡µé¢çš„åŸºæœ¬ä¿¡æ¯å’Œå…¨å±€å¼€å…³ã€‚
- **å®¹å™¨**:å‚æ•°è®¾ç½®ä¸»è¦é…ç½®å®¹å™¨çš„æ ·å¼å’Œæ ‡é¢˜ç­‰ä¿¡æ¯ã€‚
- **ç»„ä»¶**:å‚æ•°è®¾ç½®åˆ†ä¸ºé€šç”¨é…ç½®å’Œç‰¹è‰²é…ç½®ï¼Œé€šç”¨é…ç½®ä¸»è¦æ˜¯æ§åˆ¶ç»„ä»¶çš„å®½é«˜è¾¹è·ç­‰ã€‚

![ç•Œé¢å¼•æ“](/api_plugins/page04.gif)

### æ‹–æ‹½æ’åºä»‹ç» 
å®¹å™¨å’Œå®¹å™¨å¯ä»¥äº’ç›¸æ‹–æ‹½äº¤æ¢ä½ç½®ï¼Œç»„ä»¶å’Œç»„ä»¶å¯ä»¥äº’ç›¸æ‹–æ‹½äº¤æ¢ä½ç½®ã€‚

![ç•Œé¢å¼•æ“](/api_plugins/page05.gif)

### æ’ç‰ˆåŸç†ä»‹ç»
é‡‡ç”¨çš„ `ElementPlus`ï¼Œæ•´ä½“æ’ç‰ˆæ–¹å¼ç”¨äº† `el-row` æ …æ ¼è‡ªé€‚åº”æ’ç‰ˆï¼Œè¿™é‡Œä¸»è¦ä¸ºäº†æ”¯æŒç§»åŠ¨ç«¯å¯è‡ªé€‚åº”ï¼ŒåŒæ—¶åšäº†ä¸€äº›éªšæ“ä½œå¯ä»¥å®ç°ç€‘å¸ƒæµå¼æ’ç‰ˆï¼Œem~~å®åœ¨æ˜¯ç»! ,æˆ‘éƒ½ä½©æœè‡ªå·±ï¼Œå“ˆå“ˆã€‚

![ç•Œé¢å¼•æ“](/api_plugins/page06.gif)

### æŒä¹…åŒ–ä»‹ç»
å½“å¤§èªæ˜çš„ä½ è®¾è®¡å®Œä¸€ä¸ªç²¾ç¾çš„é¡µé¢åï¼Œå¦‚ä½•æŠŠè¯¥æ¨¡æ¿ä¿å­˜ä¾›ä¸‹æ¬¡ä½¿ç”¨å‘¢ï¼Ÿ

- **æ–¹å¼1**ï¼šä¿å­˜å½“å‰é¡µé¢ `JSON` åˆ°æœ¬åœ°ï¼Œå­˜åˆ° `JSON` æ–‡ä»¶æˆ–è€…æ–‡æœ¬æ–‡ä»¶éƒ½å¯ä»¥ï¼Œä¸‹æ¬¡æ¸²æŸ“æ—¶ç›´æ¥å–å‡ºæ¥è½¬æˆ `JSON` ä¼ æ‰¿ç»™æ¸²æŸ“å™¨å³å¯ã€‚
- **æ–¹å¼2**ï¼šæŒä¹…åŒ–ä¿å­˜åˆ°æ•°æ®åº“ï¼Œä¸‹æ¬¡æ¸²æŸ“å™¨ç›´æ¥é€šè¿‡ `webapi` æ¥å£è¯»å–ã€‚

![ç•Œé¢å¼•æ“](/api_plugins/page07.gif)

### åŠ¨æ€æ•°æ®æº
æ‰€æœ‰çš„è‡ªå®šä¹‰ç»„ä»¶å’Œå†…ç½®ç»„ä»¶éƒ½æ”¯æŒåŠ¨æ€æ•°æ®æºï¼Œé€šè¿‡ `webapi` æ¥å£æ›¿æ¢æˆè‡ªå·±çš„æ•°æ®æºï¼Œæ³¨æ„è§‚å¯Ÿæ ¼å¼ï¼Œä¸€èˆ¬åˆ†ä¸ºå¯¹è±¡æ ¼å¼å’Œæ•°ç»„æ ¼å¼ï¼Œå¦‚æœæ˜¯æ•°ç»„æ ¼å¼ï¼Œè¯´æ˜ç»„ä»¶å†…å®¹æ˜¯ å¯éå†çš„ ã€‚ç»„ä»¶é»˜è®¤æ•°æ®å¯èƒ½å¹¶ä¸æ˜¯æ»¡è¶³æ‰€æœ‰ç”¨æˆ·çš„éœ€æ±‚ï¼Œè‡ªå·±å¯ä»¥å°è¯•åšå‡ ä¸ª `webapi` æ¥å£æ¥è¯•è¯•çœ‹ã€‚

- **æ ¼å¼1**ï¼šå¯¹è±¡ï¼ˆ `object` ï¼‰ä¸‹é¢è¿™ç§æ•°æ®æ ¼å¼å°±æ˜¯ä¸€ç§å…¸å‹çš„å¯¹è±¡æ ¼å¼ã€‚

![ç•Œé¢å¼•æ“](/api_plugins/page08.png)

![ç•Œé¢å¼•æ“](/api_plugins/page09.png)

- **æ ¼å¼2**ï¼šæ•°ç»„ï¼ˆ `array` ï¼‰ ä¸‹é¢è¿™ç§æ•°æ®æ ¼å¼å°±æ˜¯ä¸€ç§å…¸å‹çš„æ•°ç»„æ ¼å¼ã€‚

![ç•Œé¢å¼•æ“](/api_plugins/page10.png)

![ç•Œé¢å¼•æ“](/api_plugins/page11.png)


## é›†æˆæ–¹å¼

è®¾è®¡é™¤äº†å¹³å° å†…ç½® çš„å¸¸ç”¨ç»„ä»¶,ç”¨æˆ·å¯ä»¥è‡ªè¡Œå¼€å‘è‡ªå·±çš„ç»„ä»¶,å¼€å‘ç»„ä»¶éå¸¸ç®€å•,ç»„ä»¶å†…æ‰€æœ‰ä¸šåŠ¡é€»è¾‘å’Œå®¹å™¨éƒ½æ˜¯é›¶è€¦åˆçš„,è®¾è®¡çš„æ—¶å€™æŠŠé€šç”¨ä¸šåŠ¡å’ŒåŠŸèƒ½å…¨éƒ¨æŠ½ç¦»å°è£…äº†,ä¸»æ‰“ä¸€ä¸ªäº’ä¸å¹²æ‰°,è·ç¦»äº§ç”Ÿç¾.æ’ä»¶ç›®å‰é‡‡ç”¨çš„UIæ¡†æ¶æ˜¯ `element plus` , æœ‰ä¸°å¯Œçš„ç¬¬ä¸‰æ–¹ç»„ä»¶åº“å’Œå®Œå–„çš„æ–‡æ¡£ä½“ç³»æ”¯æ’‘äºŒæ¬¡å¼€å‘.

### npmåŒ…é›†æˆ

- ä¼˜ç‚¹ï¼šå¯ä»¥è‡ªå®šä¹‰æ‰©å±•ç»„ä»¶ï¼Œéšå¿ƒæ‰€æ¬²è®¾è®¡è‡ªå·±çš„é¡µé¢ï¼Œä¸ç”¨å†™ä»»ä½•é¢å¤–ä¸šåŠ¡é€»è¾‘ã€‚
- ç¼ºç‚¹ï¼šè¦æ±‚å¿…é¡»åŸºäº `vue3+vite+elementplus+echarts` æ¡†æ¶ï¼Œä¸æ”¯æŒ `Vue2` å’Œå…¶å®ƒå‰ç«¯æ¡†æ¶ã€‚

1. è¡¨ç»“æ„:

ä¸ç®¡å“ªç§æ–¹å¼é›†æˆ,å¦‚æœè¦æŒä¹…åŒ–,é‚£å¿…é¡»å‡†å¤‡ä¸€å¼ æ•°æ®è¡¨,æ ¼å¼å¦‚ä¸‹

```js
{
  Id: '', //é¡µé¢ID
  Title: '',//é¡µé¢æ ‡é¢˜
  Number: '',//é¡µé¢ç¼–å·
  Desc: '',//é¡µé¢æè¿°
  JsonObj: {}|'' //å¯¹è±¡æˆ–è€…å­—ç¬¦ä¸²,è¿™é‡Œä¸»è¦å­˜å‚¨é¡µé¢JSON
}
```
2. å›¾æ ‡åº“å®‰è£…

```bash
npm install @element-plus/icons-vue
```

3. å…¨å±€æ³¨å†Œå›¾æ ‡

```js
// main.js
import * as ElementPlusIconsVue from '@element-plus/icons-vue'
const app = createApp(App)
for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
  app.component(key, component)
}
```

4. è®¾ç½®æš—é»‘ä¸»é¢˜

```js
// main.js å¼•ç”¨æš—é»‘æ¨¡å¼æ ·å¼
import 'element-plus/theme-chalk/dark/css-vars.css'
```
5. npmåŒ…ä¾èµ–

```bash
npm i microi-pageengine@latest
```

> è¿™é‡Œæ˜¯æ‰€æœ‰çš„ç¬¬ä¸‰æ–¹ä¾èµ–åŒ…ï¼Œä½†ä¸å¿…å…¨éƒ¨å®‰è£…ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼ŒnpmåŒ…å†…ç½®äº†ä¸€äº›ï¼Œåªéœ€ä¾èµ–å¦‚ä¸‹å³å¯ã€‚

```js
   // æˆ‘æ‰“åŒ…æ—¶æ’é™¤äº†è¿™äº›ï¼Œæ‰€ä»¥ä½ ä»¬é›†æˆæ—¶å¿…é¡»è¦æœ‰è¿™äº›ä¾èµ–åŒ…
      external: [
        'vue',
        'axios',
        'echarts',
        'element-plus',
        '@element-plus/icons-vue',
        'pinia',
        'sass',
        'sass-loader',
        'vue-router',
      ],
```

6. å®Œæ•´demo

```html
<template>
  <!-- é¡µé¢è®¾è®¡å™¨ -->
  <formDesigner :remoteObj="remoteObj"/>
  <!-- é¡µé¢æ¸²æŸ“å™¨ -->
  <!-- <formRenderer :remoteObj="remoteObj" /> -->
</template>
<script setup>
  
//å¼•å…¥ç»„ä»¶
import { formDesigner, EventBus, usePageEngineStore } from 'microi-pageengine' 
//å¼•å…¥æ ·å¼
import 'microi-pageengine/style.css' 
 
 
//æœ¬åœ°ç»„ä»¶
import { useRouter } from 'vue-router'
import { createPinia } from 'pinia'
import { onMounted, onBeforeUnmount, ref } from 'vue'
 
//ç”¨è‡ªå·±çš„è·¯ç”±å¤„ç†ç»„ä»¶å†…éƒ¨è·³è½¬,é€šè¿‡EventBusç›‘å¬å¤„ç†å†…éƒ¨äº‹ä»¶,ä¸»æ‰“ä¸€ä¸ªè‡ªç”±è‡ªåœ¨,éšå¿ƒæ‰€æ¬².
const router = useRouter()
 
//çŠ¶æ€æœºä¼ å‚,npmåŒ…æ²¡åŒ…æŠŠpiniaæ‰“åŒ…è¿›å»,æ­£æ‰€è°“å·§å¦‡éš¾ä¸ºæ— ç±³ä¹‹ç‚Š,ç»™å¥¹ä¼ ä¸€ä¸ªå®Œäº‹
const pinia = createPinia()
const pageEngineStore = usePageEngineStore(pinia)
 
//ä¼ å…¥æ•°æ®,è¿™ä¸ªæ•°æ®ä¸çŸ¥é“ä»€ä¹ˆæ ¼å¼,å¯ä»¥åœ¨è®¾è®¡å™¨æ‹–æ‹½å‡ ä¸ªç»„ä»¶æŸ¥çœ‹ä¸‹é¡µé¢JSON ,å’Œæ¸²æŸ“JSONä¸€æ¯›ä¸€æ ·çš„
const remoteObj = ref({
  Id: '', //è‡ªå®šä¹‰é¡µé¢ID
  Title: '',//è‡ªå®šä¹‰é¡µé¢æ ‡é¢˜
  Number: '',//è‡ªå®šä¹‰é¡µé¢ç¼–å·
  Desc: '',//è‡ªå®šä¹‰é¡µé¢æè¿°
  JsonObj: {}|'' //å¯¹è±¡æˆ–è€…å­—ç¬¦ä¸²
})
 
 
//æ¨¡æ‹ŸåŠ è½½è¿œç¨‹æ•°æ®
const loadFormData = () => {}
 
onMounted(() => {
  
  //å¦‚æœéœ€è¦token,è®¾ç½®token,è¯¥tokenä¸€ç»æ¥æ”¶å³åˆ»å­˜å…¥piniaçŠ¶æ€æœº,æ¯æ¬¡è°ƒç”¨æ¥å£é€šè¿‡æ‹¦æˆªå™¨è‡ªåŠ¨å¤„ç†tokenå¤´,æ— éœ€æ¯æ¬¡æ‰‹åŠ¨å†™,æŒä¹…åŒ–ç”¨çš„localStorage ,å¯ä»¥F12æŸ¥çœ‹
  pageEngineStore.setToken('')
  
  //ä¸‹é¢è¿™ä¸€å¤§ä¸²ç›‘å¬,å…¶å®ä¹Ÿå¯ä»¥å†™åˆ°ä¸€ä¸ªäº‹ä»¶é‡Œ,é€šè¿‡key value é”®å€¼å¯¹æ¥åŒºåˆ†,æš‚æ—¶å…ˆè¿™ä¹ˆç€å§
  
  //ç›‘å¬ä¿å­˜é¡µé¢JSONäº‹ä»¶
  EventBus.on('saveFormJson', (saveFormJson) => {
    console.log('ç›‘å¬saveFormJson', saveFormJson)
  })
 
  //ç›‘å¬æ—¥å†é€‰æ‹©æ—¥æœŸäº‹ä»¶
  EventBus.on('calendarSelDate', (data) => {
    console.log('ç›‘å¬calendarSelDate', data)
  })
 
  //å¡ç‰‡æ›´å¤šè·³è½¬
  EventBus.on('cartMoreLink', (linkurl, linktype) => {
    console.log('ç›‘å¬cartMoreLink', linkurl, linktype)
    if (linktype == 'router') {
      router.push(linkurl)
    }
  })
 
  //é“¾æ¥ç»„ä»¶è·³è½¬
  EventBus.on('linkWidget', (linkurl, linktype) => {
    console.log('ç›‘å¬linkWidget', linkurl, linktype)
    if (linktype == 'router') {
      router.push(linkurl)
    }
  })
 
  //é±¼éª¨å›¾è·³è½¬
  EventBus.on('fishWidget', (linkurl) => {
    console.log('ç›‘å¬fishWidget', linkurl)
    router.push(linkurl)
  })
 
  //æ­¥éª¤è·³è½¬
  EventBus.on('stepsWidget', (id, linkurl) => {
    console.log('ç›‘å¬stepsWidget', id, linkurl)
    router.push(linkurl)
  })
 
})
 
//é”€æ¯
onBeforeUnmount(() => {
  EventBus.off('saveFormJson')
  EventBus.off('calendarSelDate')
  EventBus.off('cartMoreLink')
  EventBus.off('linkWidget')
  EventBus.off('fishWidget')
  EventBus.off('stepsWidget')
})
</scrip>
 
<style>
.dark {
  background: #252525;
  color: white;
}
.light {
  background-color: white;
  color: black;
}
</style>
```

### iframe å¤–æŒ‚å½¢å¼é›†æˆ 

ä»»ä½•å‰ç«¯æ¡†æ¶éƒ½å¯ä»¥é›†æˆï¼Œè¿™ç§æ¨¡å¼è¯´ç™½äº†å°±æ˜¯ç™¾æ­ï¼Œå®ƒæ˜¯æ— çŠ¶æ€çš„,ä¸ä¾èµ–ä»»ä½•å‰ç«¯å’Œåç«¯,é«˜å†…èšä½è€¦åˆ,å¯é›†æˆä»»æ„å¹³å°ã€‚

- ä¼˜ç‚¹ï¼šå¯ä»¥å¯¹æ¥ä»»ä½•å¹³å°ï¼Œæ— çŠ¶æ€ï¼Œæ— ä¾µæŸ“ï¼Œé›¶è€¦åˆï¼Œæ–¹ä¾¿å¿«æ·ã€‚
- ç¼ºç‚¹ï¼šåªèƒ½ä½¿ç”¨å†…ç½®ç»„ä»¶ï¼Œä¸èƒ½è‡ªå®šä¹‰ç»„ä»¶ã€‚

1. æ ¸å¿ƒåŸç†
å¹³å°é›†æˆä½¿ç”¨ `frame` ï¼ŒæŠŠé¡µé¢è®¾è®¡å™¨åµŒå…¥åˆ°è‡ªå·±é¡µé¢ä¸­,é€šè¿‡ `postMessage` æ–¹å¼ä¸çˆ¶é¡µé¢è¿›è¡Œé€šä¿¡,çˆ¶é¡µé¢å¯ä»¥è·å–åˆ°è®¾è®¡å™¨ç”Ÿæˆçš„é¡µé¢ `JSON` ,ä¹Ÿå¯ä»¥æŠŠ `token` ä¼ ç»™è®¾è®¡å™¨ã€‚

2. å®Œæ•´demo
```html
### Vue3ç»„åˆå¼ é›†æˆdemo
 
```vue
<template>
  <div v-loading="loading" class="iframe-container">
    <iframe
      ref="myIframe"
      id="iframe"
      :src="src"
      frameborder="0"
      width="100%"
      height="730px"
      @load="onIframeLoad"
    ></iframe>
  </div>
</template>
 
<script setup>
import { ref, onMounted, onBeforeUnmount } from 'vue'
const loading = ref(true)
const src = ref('https://www.nbweixin.cn/autopage/')
 
const myIframe = ref(null)
 
//æ¨¡æ‹Ÿæ•°æ®åº“æ•°æ®
const demoObj = {
  Id: 31908,
  Title: 'æµ‹è¯•æ ‡é¢˜',
  Number: 'page_31908',
  Desc: 'è¿™æ˜¯ä¸€ä¸ªç©ºçš„é¡µé¢æ¨¡æ¿',
  JsonObj: {} //å¯¹è±¡æˆ–è€…å­—ç¬¦ä¸²
}
 
// ç›‘å¬ iframe æ˜¯å¦åŠ è½½å®Œæˆ
const onIframeLoad = () => {
  console.log('Iframe å·²åŠ è½½å®Œæˆ')
  loading.value = false
  sendMessageToIframe()
}
 
const sendMessageToIframe = () => {
  // è¦å‘é€çš„æ•°æ®
  const dataToSend = {
    iframeToken: 'token_test', //è‡ªå®šä¹‰token
    iframeFormData: JSON.stringify(demoObj), //é¡µé¢JSONï¼Œæ–°å¢çš„è¯JsonObjç•™ç©ºå°±è¡Œ
  }
  // ä½¿ç”¨ postMessage å‘é€æ•°æ®ç»™ iframe
  myIframe.value.contentWindow.postMessage(dataToSend, '*')
}
 
//ç›‘å¬iframe å†…éƒ¨é€ä¼ äº‹ä»¶
let pageengineEvent = null
pageengineEvent = function (event) {
  if (event.data) {
    switch (event.data.key) {
      //ä¿å­˜é¡µé¢json
      case 'saveFormJson':
        console.log('å·²æ¥åˆ°åˆ°æ¥è‡ªiframeæ¶ˆæ¯,saveFormJson', event.data.value)
        let obj = JSON.parse(event.data.value)
        console.log(obj)
        break
      //ç›‘å¬æ—¥å†é€‰æ‹©æ—¥æœŸäº‹ä»¶
      case 'calendarSelDate':
        console.log('å·²æ¥åˆ°åˆ°æ¥è‡ªiframeæ¶ˆæ¯,calendarSelDate', event.data.value)
        break
      //ç›‘å¬æ—¥å†é€‰æ‹©æ—¥æœŸäº‹ä»¶
      case 'calendarSelDate':
        console.log('å·²æ¥åˆ°åˆ°æ¥è‡ªiframeæ¶ˆæ¯,calendarSelDate', event.data.value)
        break
      //å¡ç‰‡æ›´å¤šè·³è½¬
      case 'cartMoreLink':
        console.log(
          'å·²æ¥åˆ°åˆ°æ¥è‡ªiframeæ¶ˆæ¯,cartMoreLink ç›‘å¬',
          event.data.value
        )
        break
      //é“¾æ¥ç»„ä»¶è·³è½¬
      case 'linkWidget':
        console.log('å·²æ¥åˆ°åˆ°æ¥è‡ªiframeæ¶ˆæ¯,linkWidget', event.data.value)
        break
      //é±¼éª¨å›¾è·³è½¬
      case 'fishWidget':
        console.log('å·²æ¥åˆ°åˆ°æ¥è‡ªiframeæ¶ˆæ¯,fishWidget', event.data.value)
        break
      //æ­¥éª¤è·³è½¬
      case 'stepsWidget':
        console.log('å·²æ¥åˆ°åˆ°æ¥è‡ªiframeæ¶ˆæ¯,stepsWidget', event.data.value)
        break
      default:
        break
    }
  }
}
window.addEventListener('message', pageengineEvent)
onMounted(() => {})
 
onBeforeUnmount(() => {
  window.removeEventListener('message', pageengineEvent)
})
</script>
 
<style lang="scss" scoped></style>
```

## é¡µé¢æ•ˆæœå›¾

![ç•Œé¢å¼•æ“](/api_plugins/page12.png)

![ç•Œé¢å¼•æ“](/api_plugins/page13.png)