# Microi吾码平台首页 - 使用说明文档

## 项目概述

本项目为Microi吾码低代码平台的首页Dashboard，包含：
1. **接口引擎代码**：`平台首页接口引擎.js`
2. **界面引擎JSON**：`平台首页界面引擎.json`

## 功能特性

### 数据展示模块

1. **我的待办** - 展示当前用户的待办事项
2. **我的流程发起** - 展示用户发起的工作流
3. **通知公告** - 显示最新的系统公告
4. **常用模块** - 快捷访问常用功能模块
5. **日历** - 显示个人日历事件（预留）
6. **系统信息**
   - 操作系统及版本
   - 前端版本号
   - 后端版本号
   - 版本类型（开源版/个人版/企业版）
   - 处理器核心数
   - 主机名
7. **性能监控**
   - CPU使用率
   - 内存使用率
   - 磁盘使用率
8. **数据统计**
   - 表单数量
   - 模块数量
   - 接口引擎数量
   - SaaS引擎数量
   - 用户数量
   - DIY表总数据量
   - 接口请求次数（近30天）
9. **最近登录用户** - 显示最近登录的用户、IP和时间
10. **接口调用频率排行** - 近30天接口调用统计
11. **表单数据量排行** - 各表单数据量统计
12. **服务器网络流量** - 上下行流量监控
13. **磁盘IO** - 磁盘读写速度监控
14. **个人备忘录** - 个人待办事项记录

## 安装步骤

### 第一步：创建接口引擎

1. 登录Microi吾码平台
2. 进入【接口引擎】菜单
3. 点击【新建接口引擎】
4. 配置以下信息：
   - **接口引擎Key**：`platform_dashboard`
   - **接口引擎名称**：`平台首页数据接口`
   - **自定义接口地址**：`/apiengine/platform-dashboard`
   - **是否允许匿名调用**：`否`（需要登录）
   - **V8代码**：将 `平台首页接口引擎.js` 文件的内容复制粘贴到代码编辑器中
5. 保存接口引擎

### 第二步：创建必要的数据表

接口引擎需要以下数据表支持（如果不存在，需要创建）：

1. **diy_workflow_todo** - 工作流待办表
   - UserId（用户ID）
   - Status（状态）
   - CreateTime（创建时间）

2. **diy_workflow** - 工作流表
   - CreateUserId（创建用户ID）
   - CreateTime（创建时间）

3. **diy_notice** - 通知公告表
   - Status（状态）
   - PublishTime（发布时间）

4. **diy_user_favorite** - 用户收藏表
   - UserId（用户ID）
   - Type（类型）
   - UseCount（使用次数）

5. **diy_calendar** - 日历事件表
   - UserId（用户ID）
   - EventDate（事件日期）

6. **diy_system_config** - 系统配置表
   - ConfigKey（配置键）
   - ConfigValue（配置值）

7. **diy_table** - 表定义表（系统自带）
   - Name（表名）
   - Description（表说明）

8. **diy_apiengine** - 接口引擎表（系统自带）

9. **sys_user** - 用户表（系统自带）

10. **sys_login_log** - 登录日志表
    - UserName（用户名）
    - IP（IP地址）
    - LoginTime（登录时间）

11. **diy_api_request_log** - 接口请求日志表
    - ApiKey（接口标识）
    - ApiName（接口名称）
    - ApiUrl（接口地址）
    - CreateTime（创建时间）

12. **diy_user_memo** - 用户备忘录表
    - UserId（用户ID）
    - Content（内容）
    - IsDeleted（是否删除）
    - CreateTime（创建时间）

### 第三步：导入界面引擎JSON

1. 进入【界面引擎】菜单
2. 点击【导入】按钮
3. 选择 `平台首页界面引擎.json` 文件
4. 确认导入

或者：

1. 点击【新建界面引擎】
2. 将 `平台首页界面引擎.json` 文件内容复制到JSON编辑器中
3. 保存

### 第四步：配置系统版本信息

在 `diy_system_config` 表中添加一条记录：

```json
{
  "ConfigKey": "SystemVersion",
  "ConfigValue": {
    "FrontendVersion": "3.0.0",
    "BackendVersion": "3.0.2",
    "Edition": "开源版"
  }
}
```

## 接口调用方式

### 获取所有数据

```
GET/POST: /apiengine/platform-dashboard
或
GET/POST: /apiengine/platform-dashboard?type=all
```

### 获取特定模块数据

通过 `type` 参数指定要获取的数据模块：

```
# 我的待办
GET: /apiengine/platform-dashboard?type=todo

# 通知公告
GET: /apiengine/platform-dashboard?type=notice

# 系统信息
GET: /apiengine/platform-dashboard?type=systeminfo

# 性能数据
GET: /apiengine/platform-dashboard?type=performance

# 统计数据
GET: /apiengine/platform-dashboard?type=statistics
```

### 支持的type参数值

- `todo` - 我的待办
- `workflow` - 我的流程发起
- `notice` - 通知公告
- `modules` - 常用模块
- `calendar` - 日历事件
- `systeminfo` - 系统信息
- `performance` - 性能指标
- `statistics` - 数据统计
- `loginlogs` - 最近登录用户
- `apirank` - 接口调用频率排行
- `datarank` - 表单数据量排行
- `network` - 服务器网络流量
- `diskio` - 磁盘IO
- `memo` - 个人备忘录
- `all` - 获取所有数据（默认）

## 返回数据格式

```json
{
  "Code": 1,
  "Data": {
    "todo": {
      "total": 5,
      "list": [...]
    },
    "systemInfo": {
      "os": {...},
      "version": {...}
    },
    "performance": {
      "cpu": 25.5,
      "memory": 68.2,
      "disk": [...]
    },
    ...
  },
  "Msg": "获取成功"
}
```

## 界面引擎使用

### 在菜单中配置

1. 进入【系统菜单】管理
2. 新建或编辑一个菜单
3. 设置菜单类型为【界面引擎】
4. 选择刚才导入的【平台首页】界面引擎
5. 保存菜单

### 直接访问

如果界面引擎编号为 `page_dashboard`，可以通过以下URL访问：

```
/page-engine/renderer?number=page_dashboard
```

## 自定义配置

### 修改颜色主题

在界面引擎JSON中，可以修改以下配置来改变颜色主题：

```json
{
  "dynamicStyle": {
    "backgroundColor": "linear-gradient(135deg, #667eea 0%, #764ba2 100%)"
  }
}
```

### 调整布局

通过修改 `span`、`height`、`margin` 等参数调整组件布局：

```json
{
  "wrapperOption": {
    "span": 12,  // 占据12列（总共24列）
    "height": 300,  // 高度300px
    "margin": "0px 15px 15px 0px"  // 外边距
  }
}
```

### 添加新的统计卡片

复制现有的 `stat-card` 配置，修改数据源和显示内容：

```json
{
  "type": "stat-card",
  "widgetParams": [
    {
      "typeOptions": {
        "dataJson": {
          "title": "新指标",
          "value": "${newMetric}",
          "icon": "el-icon-xxx",
          "color": "#409EFF"
        }
      }
    }
  ]
}
```

## 性能优化建议

1. **缓存优化**
   - 对于统计数据，建议在接口引擎中增加缓存逻辑
   - 缓存时间可设置为5-10分钟

2. **分页加载**
   - 对于列表类数据，建议分页加载
   - 默认每页显示10条记录

3. **异步加载**
   - 可以将不同模块的数据分开加载
   - 使用 `type` 参数按需获取数据

4. **数据预聚合**
   - 对于统计数据，建议使用定时任务预先聚合
   - 存储到缓存或汇总表中

## 常见问题

### Q1: 接口返回Code=0，提示表不存在

**A**: 检查数据库中是否存在相应的表，参考"第二步：创建必要的数据表"创建缺失的表。

### Q2: 性能监控数据显示为0

**A**: 
- 确保服务器环境支持V8.System.SystemInfo扩展
- Linux环境需要有读取系统信息的权限
- Windows环境部分功能可能受限

### Q3: 如何自定义统计指标

**A**: 
1. 在接口引擎中添加新的统计函数
2. 在界面引擎JSON中添加对应的展示组件
3. 配置数据源指向新的接口

### Q4: 如何调整刷新频率

**A**: 
- 在界面引擎渲染器中配置自动刷新时间
- 或在组件级别配置轮询间隔

## 技术支持

- 官网：https://www.itdos.com
- 文档：https://microi.itdos.com
- 问题反馈：通过平台内的问题反馈功能

## 更新日志

### v1.0.0 (2026-02-09)
- ✅ 初始版本发布
- ✅ 支持14个数据模块
- ✅ 支持通过type参数按需获取数据
- ✅ 响应式布局设计
- ✅ 性能监控功能
- ✅ 数据统计与排行

## 许可证

本项目遵循Microi吾码平台的开源协议。
