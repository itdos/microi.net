<template>
	<view class="short-video">
		<!-- é¡¶éƒ¨è‡ªå®šä¹‰å¯¼èˆª -->
		<tn-nav-bar v-if="PageType == 'List'" :isBack="false" :bottomShadow="false"
			style="position: fixed;top: env(safe-area-inset-top);top: constant(safe-area-inset-top);left: 20rpx;z-index: 9999;background-color: transparent !important;opacity:0.9;">
			<view class="custom-nav tn-flex tn-flex-col-center tn-flex-row-left"
				style="background-color: transparent; !important">
				<!-- <view class="custom-nav__back" @click="tn('/pageA/navigation/navigation')">
					<view class="tn-icon-deploy"></view>
				</view> -->
				<!-- class="tn-margin-top" -->
				<view 
					style="text-shadow:  1rpx 0 0 #333, 0 1rpx 0 #333, -1rpx 0 0 #333 , 0 -1rpx 0 #333;background-color: transparent !important;"
					@click="ClickTabs()"
					>
					<tn-tabs :list="scrollList" :current="CurrentSortIndex" inactiveColor="#fff" @change="tabChange" activeColor="#fff" :bold="true"
						:showBar="true" :fontSize="36"
						style="background-color: transparent !important;"
						></tn-tabs>
				</view>
			</view>
		</tn-nav-bar>
		<tn-nav-bar v-else fixed alpha customBack>
			<view slot="back" class='tn-custom-nav-bar__back' @click="goBack()">
				<text class='icon tn-icon-left'></text>
				<text class='icon tn-icon-home-capsule-fill'></text>
			</view>
		</tn-nav-bar>
		<!-- 
		https://ext.dcloud.net.cn/plugin?id=5656
		æ³¨æ„ï¼šè¿™æ˜¯ H5ã€å¾®ä¿¡å°ç¨‹åºç•Œé¢ï¼Œè¯·å‹¿å’Œ new_index.nvueã€index.nvue æ··ç”¨
		1. new_index.nvueã€index.nvueè¿™ä¸¤ä¸ªæ˜¯Appé¡µé¢
		2. å¦å¤–ï¼šdata.js æ˜¯ä¸Šä¸€ç‰ˆæœ¬ç•™ä¸‹çš„å‡æ•°æ®ï¼Œè¿™ä¸€ç‰ˆæ”¹æˆäº† URL è¯·æ±‚äº†ï¼ˆå¦‚ä¸éœ€è¦å¯ä»¥åˆ é™¤ï¼Œä¹Ÿå¯ä½œä¸ºåç«¯è¯·æ±‚å‚è€ƒï¼‰
		3. è¯·å„ä½å¤§ç¥å¤šå¤šç•™æ‰‹ï¼Œæˆ‘å·²ç»æŠŠè¯·æ±‚å†…å­˜å¼€åˆ°æœ€å¤§äº†
		4. è§†é¢‘ id åˆ‡è®°æ˜¯å­—ç¬¦ä¸²ç±»å‹ 
		 -->
		<!-- #ifdef MP -->
		<swiper :style="'width: '+ windowWidth +'px; height: '+ windowHeightStr +';height: '+ windowHeightStr2 +'; background-color: #000000;'"
			:vertical="true" @animationfinish="animationfinish" @change="change" :current="current"
			:indicator-dots="false" @touchstart="mpTouchstart" @touchend="mpTouchend">
			<swiper-item v-for="(list,index) in dataList" :key="index">
				<view v-if="Math.abs(k-index)<=1">
					<view>
						<!-- 
						1.v-ifï¼šç”¨äºæ§åˆ¶è§†é¢‘åœ¨èŠ‚ç‚¹çš„æ¸²æŸ“æ•°
						2.mutedçš„é»˜è®¤å€¼æ˜¯ falseï¼Œä»£è¡¨é»˜è®¤æ˜¯ç¦éŸ³è§†é¢‘çš„
						3.http-cacheé»˜è®¤å¼€å¯è§†é¢‘ç¼“å­˜
						4.posterï¼ˆå°é¢ï¼ˆæ–¹æ¡ˆä¸€ï¼‰ï¼‰ï¼šè¿™é‡Œçš„å°é¢é»˜è®¤å¤„ç†å­˜å‚¨åœ¨é˜¿é‡Œäº‘çš„è§†é¢‘
						5.show-loadingï¼šè¿™é‡Œé»˜è®¤å»æ‰æ’­æ”¾è½¬åœˆçš„æ ‡å¿—
						v-if="Math.abs(k-index)<=1"
						:poster="list.src+'?x-oss-process=video/snapshot,t_100,f_jpg'"
						 -->
						<video v-if="isShow" :id="list._id+''+index" :loop="true" :muted="list.isplay" :controls="false"
							:http-cache="true" :page-gesture="false" :show-fullscreen-btn="false" :show-loading="false"
							:show-center-play-btn="false" :enable-progress-gesture="false" 
							:src="list.src"
							@ended="ended" @click="tapVideoHover(list.state,$event)"
							@timeupdate="timeupdate($event,index)"
							:style="'width: '+ windowWidth +'px; height: '+ windowHeightStr +';height: '+ windowHeightStr2 +'; background-color: #000000; z-index: -1;object-fit: '+ (list.HengxiangSP ? 'contain' : 'cover') +';'"
							:object-fit="list.HengxiangSP ? 'contain' : 'cover'"
							:poster="list.YulanT"
							></video>
						<!-- 
						1.è¿™é‡Œæ˜¯å°é¢ï¼ˆæ–¹æ¡ˆäºŒï¼‰ï¼šè¿™é‡Œçš„å°é¢å¯ä»¥è‡ªå®šä¹‰ã€‚
						2.ä¹Ÿåœ¨ä»£ç ä¸­åšäº†æ‰¹æ³¨ï¼Œä¸¤ç§æ–¹æ¡ˆå¯ä»¥å…±å­˜ï¼Œä¸ä¼šç›¸äº’å½±å“ã€‚
						:src="list.src+'?x-oss-process=video/snapshot,t_100,f_jpg'"
						-->
						<image v-if="!list.playIng" 
							:src="list.YulanT"
							:style="'width: '+ windowWidth +'px; height: '+ windowHeightStr +';height: '+ windowHeightStr2 +'; position: absolute;object-fit: cover;'"
							:mode="list.HengxiangSP ? 'aspectFit' : 'aspectFill'"></image>
					</view>
					<!-- æ’­æ”¾çŠ¶æ€ï¼špause çš„æ—¶å€™å°±ä¼šæš‚åœ -->
					<view class="videoHover" @click="tapVideoHover(list.state,$event)"
						:style="'width: '+ windowWidth +'px; height: '+ windowHeightStr +';height: '+ windowHeightStr2 +';'"
						
						>
						<image v-if="list.state=='pause'" class="playState" 
						style="position: absolute; left: calc(50% - 80rpx); top: calc(50% - 80rpx);"
						:src="Microi.FileServer + '/jsnzk/img/upload/play.png'"></image>
					</view>
					<view class="userInfo">
						<!-- 1.å¤´åƒ -->
						<image @click="tozuozhe" class="userAvatar" :src="list.href" mode="aspectFill"></image>
						<!-- 2.ç‚¹èµ -->
						<view class="right-item" @click="cLike(list);" style="opacity: 0.9; margin-top: 17px;">
							<image v-if="list._IsFavorite" :src="Microi.FileServer + '/jsnzk/img/upload/xin.png'"
								style="width: 40px; height: 40px; position: absolute; right: 9px;"></image>
							<image v-if="!list._IsFavorite" :src="Microi.FileServer + '/jsnzk/img/upload/xin-2.png'"
								style="width: 40px; height: 40px; position: absolute; right: 9px;"></image>
							<text
								style="color: #FFFFFF; margin-top: 5px; font-size: 14px; text-align: center; margin-top: 40px; font-weight: bold;"
								:class="{'likeNumActive':list._IsFavorite}">{{list.ShoucangL || 0}}</text>
						</view>
						<!-- 3.è¯„è®º -->
						<!-- @click="toComment(index)" -->
						<view @click="OpenEdit(list)" class="comment right-item"  style="opacity: 0.9; margin-top: 17px;
							">
							<!-- <image :src="Microi.FileServer + '/jsnzk/img/upload/liaotian-2.png'"
								style="width: 40px; height: 40px; position: absolute; right: 9px;"></image> -->
							<view style="width: 40px; height: 40px; position: absolute; right: 9px;font-size: 40px;color:#fff;">
								<text class="tn-icon-eye-fill"></text>
							</view>
							<text
								style="color: #FFFFFF; margin-top: 5px; font-size: 14px; font-weight: bold; text-align: center; margin-top: 45px;">
								{{Microi.GetCountStr(list.Hits)}}
							</text>
						</view>
						<!-- 4.åˆ†äº« -->
						<button 
							:plain="true" open-type="share"
							class="right-item" @click="share(list)" style="opacity: 0.9; margin-top: 17px;border: none;">
							<image :src="Microi.FileServer + '/jsnzk/img/upload/share-fill.png'"
								style="width: 40px; height: 40px; position: absolute; right: 9px;"></image>
							<text
								style="color: #FFFFFF; margin-top: 5px; font-size: 14px; text-align: center; font-weight: bold; margin-top: 30px;">åˆ†äº«</text>
						</button>
					</view>
					<!-- æœ€åº•ä¸‹çš„æ–‡å­—éƒ¨åˆ† -->
					<view class="content"
						:style="PageType == 'List' ? 'bottom:15px;' : 'bottom: calc(env(safe-area-inset-bottom) + 20px);bottom: calc(constant(safe-area-inset-bottom) + 20px);'">
						<text class="userName"
							:style="'width: '+ (windowWidth - 90) +'px;'">{{list.title}}</text><!-- i={{i}} -->
						<text class="words"
							:style="'width: '+ (windowWidth - 90) +'px;'">
							{{list.msg}}
							<!-- -{{k+1}} -->
						</text><!-- k={{k}} -->
					</view>
					<!-- è¿›åº¦æ¡ -->
					<view v-if="k === index" @touchstart="touchstart" @touchmove="touchmove" @touchend="touchend"
						:class="PageType == 'List' ? 'bottom-0px' : 'safe-bottom'"
						:style="'width: '+ (windowWidth - (windowWidth*0.10)) +'px; margin-left: '+ (windowWidth * 0.05) +'px; height: 20px; position: absolute;'">
						<!-- ä¸æ‹–åŠ¨æƒ…å†µä¸‹ -->
						<view>
							<!-- 1.åº•éƒ¨èƒŒæ™¯è¿›åº¦æ¡ -->
							<view
								:style="'width: '+ (windowWidth - (windowWidth*0.10)) +'px; margin-top: 0px; height: 5px; border-radius: 10px; background-color: #999999; opacity: 0.6;position: absolute;'">
							</view>
							<!-- 2.æ’­æ”¾çš„è¿›åº¦æ¡ -->
							<view v-if="!isTouch"
								:style="'width: '+ ((windowWidth - (windowWidth*0.10)) * progressBarPercent) +'px; position: absolute; margin-top: 0px; height: 5px; border-radius: 10px; background-color: #e6e4e7;transition: width 0.5s ease;'">
							</view>
							<!--  -->
							<view v-if="isTouch"
								:style="'width: '+ (videoStartPositon + addPositon) +'px; position: absolute; margin-top: 0px; height: 5px; border-radius: 10px; background-color: #e6e4e7; '">
							</view>
						</view>
					</view>
				</view>
			</swiper-item>
			<swiper-item v-if="dataList.length == 0">
				<view style="height: 100%;width: 100%;display: flex;align-items: center;justify-content: center;">
					<view class="loader">
						<view class="circle loading1"></view>
						<view class="circle loading2"></view>
						<view class="circle loading3"></view>
						<view class="circle loading4"></view>
						<view class="circle loading5"></view>
						<view class="circle loading6"></view>
						<view class="circle loading7"></view>
						<view class="circle loading8"></view>
					</view>
				</view>
			</swiper-item>
		</swiper>
		<!-- #endif -->
		<!-- #ifdef H5 -->
		<swiper :style="'width: '+ windowWidth +'px; height: '+ windowHeight +'px; background-color: #000000;'"
			:vertical="true" @animationfinish="animationfinish" @change="change" :current="current"
			:indicator-dots="false" :duration="duration">
			<swiper-item v-for="(list,index) in dataList" :key="index">
				<view v-if="Math.abs(k-index)<=1">
					<view>
						<!-- 
						1.v-ifï¼šç”¨äºæ§åˆ¶è§†é¢‘åœ¨èŠ‚ç‚¹çš„æ¸²æŸ“æ•°
						2.mutedçš„é»˜è®¤å€¼æ˜¯ falseï¼Œä»£è¡¨é»˜è®¤æ˜¯ç¦éŸ³è§†é¢‘çš„
						3.http-cacheé»˜è®¤å¼€å¯è§†é¢‘ç¼“å­˜
						4.posterï¼ˆå°é¢ï¼ˆæ–¹æ¡ˆä¸€ï¼‰ï¼‰ï¼šè¿™é‡Œçš„å°é¢é»˜è®¤å¤„ç†å­˜å‚¨åœ¨é˜¿é‡Œäº‘çš„è§†é¢‘
						5.show-loadingï¼šè¿™é‡Œé»˜è®¤å»æ‰æ’­æ”¾è½¬åœˆçš„æ ‡å¿—
						v-if="Math.abs(k-index)<=1"
						:poster="list.src+'?x-oss-process=video/snapshot,t_100,f_jpg'"
						 -->
						<video v-if="isShow" :id="list._id+''+index" :loop="true" :muted="list.isplay" :controls="false"
							:http-cache="true" :page-gesture="false" :show-fullscreen-btn="false" :show-loading="false"
							:show-center-play-btn="false" :enable-progress-gesture="false" :src="list.src"
							@ended="ended" @click="tapVideoHover(list.state,$event)"
							@timeupdate="timeupdate($event,index)"
							:style="'width: '+ windowWidth +'px; height: '+ windowHeight +'px; background-color: #000000; z-index: -1;'"
							:poster="list.YulanT"
							:object-fit="list.HengxiangSP ? 'contain' : 'cover'"
							></video>
						<!-- 
						1.è¿™é‡Œæ˜¯å°é¢ï¼ˆæ–¹æ¡ˆäºŒï¼‰ï¼šè¿™é‡Œçš„å°é¢å¯ä»¥è‡ªå®šä¹‰ã€‚
						2.ä¹Ÿåœ¨ä»£ç ä¸­åšäº†æ‰¹æ³¨ï¼Œä¸¤ç§æ–¹æ¡ˆå¯ä»¥å…±å­˜ï¼Œä¸ä¼šç›¸äº’å½±å“ã€‚
						:src="list.src+'?x-oss-process=video/snapshot,t_100,f_jpg'"
						-->
						<image v-if="!list.playIng" 
							:src="list.YulanT"
							:style="'width: '+ windowWidth +'px; height: '+ windowHeight +'px; position: absolute;'"
							:mode="list.HengxiangSP ? 'aspectFit' : 'aspectFill'"></image>
					</view>
					<!-- æ’­æ”¾çŠ¶æ€ï¼špause çš„æ—¶å€™å°±ä¼šæš‚åœ -->
					<view class="videoHover" @click="tapVideoHover(list.state,$event)"
						:style="'width: '+ windowWidth +'px; height: '+ windowHeight +'px;'">
						<image v-if="list.state=='pause'" class="playState" 
						:src="Microi.FileServer + '/jsnzk/img/upload/play.png'"></image>
					</view>
					<view class="userInfo">
						<!-- 1.å¤´åƒ -->
						<image @click="tozuozhe" class="userAvatar" :src="list.href" mode="aspectFill"></image>
						<!-- 2.ç‚¹èµ -->
						<view @click="cLike(list);" style="opacity: 0.9; margin-top: 17px;">
							<image v-if="list._IsFavorite" :src="Microi.FileServer + '/jsnzk/img/upload/xin.png'"
								style="width: 40px; height: 40px; position: absolute; right: 9px;"></image>
							<image v-if="!list._IsFavorite" :src="Microi.FileServer + '/jsnzk/img/upload/xin-2.png'"
								style="width: 40px; height: 40px; position: absolute; right: 9px;"></image>
							<text
								style="color: #FFFFFF; margin-top: 5px; font-size: 14px; text-align: center; margin-top: 40px; font-weight: bold;"
								:class="{'likeNumActive':list._IsFavorite}">{{list.ShoucangL}}</text>
						</view>
						<!-- 3.è¯„è®º -->
						<view class="comment" @click="toComment(index)" style="opacity: 0.9; margin-top: 17px;">
							<!-- <image :src="Microi.FileServer + '/jsnzk/img/upload/liaotian-2.png'"
								style="width: 40px; height: 40px; position: absolute; right: 9px;"></image> -->
							<view style="width: 40px; height: 40px; position: absolute; right: 9px;font-size: 40px;color:#fff;">
								<text class="tn-icon-eye-fill"></text>
							</view>
							<text
								style="color: #FFFFFF; margin-top: 5px; font-size: 14px; font-weight: bold; text-align: center; margin-top: 40px;">{{Microi.GetCountStr(list.Hits)}}</text> 
						</view>
						<!-- 4.åˆ†äº« -->
						<view @click="share" style="opacity: 0.9; margin-top: 17px;">
							<image :src="Microi.FileServer + '/jsnzk/img/upload/share-fill.png'"
								style="width: 40px; height: 40px; position: absolute; right: 9px;"></image>
							<text
								style="color: #FFFFFF; margin-top: 5px; font-size: 14px; text-align: center; font-weight: bold; margin-top: 40px;">åˆ†äº«</text>
						</view>
						<view @click="dealVoice" style="margin-top: 17px;">
							<view
								style="width: 48px; height: 48px; border-radius: 50px; position: absolute; right: 2.5px;">
								<image
									:style="'width: 48px; height: 48px; border-radius: 50px; transform: rotate('+ rotates +'deg);'"
									:src="Microi.FileServer + '/jsnzk/img/upload/bfq.png'" mode="aspectFill"></image>
								<image v-if="showPlay"
									:style="'width: 30px; height: 30px; margin-top: 9px; margin-left: 9px; position: absolute; border-radius: 50px; transform: rotate('+ rotates +'deg);'"
									:src="list.href" mode="aspectFill"></image>
							</view>
						</view>
					</view>
					<!-- æœ€åº•ä¸‹çš„æ–‡å­—éƒ¨åˆ† -->
					<view class="content">
						<text class="userName"
							:style="'width: '+ (windowWidth - 90) +'px;'">{{list.title}}</text><!-- i={{i}} -->
						<text class="words"
							:style="'width: '+ (windowWidth - 90) +'px;'">{{list.msg}}-{{k+1}}</text><!-- k={{k}} -->
					</view>
					<!-- è¿›åº¦æ¡ -->
					<view v-if="k === index" @touchstart="touchstart" @touchmove="touchmove" @touchend="touchend"
						class="safe-bottom"
						:style="'width: '+ (windowWidth - (windowWidth*0.10)) +'px; margin-left: '+ (windowWidth * 0.05) +'px; height: 20px; position: absolute;'">
						<!-- ä¸æ‹–åŠ¨æƒ…å†µä¸‹ -->
						<view>
							<!-- 1.åº•éƒ¨èƒŒæ™¯è¿›åº¦æ¡ -->
							<view
								:style="'width: '+ (windowWidth - (windowWidth*0.10)) +'px; margin-top: 18px; height: 5px; border-radius: 10px; background-color: #999999; opacity: 0.6;'">
							</view>
							<!-- 2.æ’­æ”¾çš„è¿›åº¦æ¡ -->
							<view v-if="!isTouch"
								:style="'width: '+ ((windowWidth - (windowWidth*0.10)) * progressBarPercent) +'px; position: absolute; margin-top: 18px; height: 5px; border-radius: 10px; background-color: #e6e4e7;transition: width 0.5s ease;'">
							</view>
							<!--  -->
							<view v-if="isTouch"
								:style="'width: '+ (videoStartPositon + addPositon) +'px; position: absolute; margin-top: 18px; height: 5px; border-radius: 10px; background-color: #e6e4e7; '">
							</view>
						</view>
					</view>
				</view>
			</swiper-item>
		</swiper>
		<!-- #endif -->
		<tn-modal v-model="ShowEdit"
			:custom="true" 
			:showCloseBtn="true"
			:title="'ç¼–è¾‘'"
			:safeAreaInsetBottom="true"
			>
			<tn-form :labelWidth="300" style="text-align: right;">
				<tn-form-item label="åŠ æµè§ˆ" style="text-align: right;">
					<tn-button size="sm" @click="AddHits()" backgroundColor="#01BEFF" fontColor="#ffffff"
						style="width: 180rpx;">
						<text class="tn-icon-add-circle" style="margin-right: 2rpx;"></text> åŠ æµè§ˆ
					</tn-button>
				</tn-form-item>
				<tn-form-item label="æ˜¯å¦å…è´¹" style="text-align: right;">
					<!-- @change="(value) => { return SwitchContent(value, 'ShifouMF'); }" -->
					<tn-switch v-model="ContentDetail.ShifouMF" @change="SwitchContentShifouMF"></tn-switch>
				</tn-form-item>
				<tn-form-item label="æ˜¯å¦æ¨èé¦–é¡µ">
					<tn-switch v-model="ContentDetail.ShifouTJ" @change="SwitchContentShifouTJ"></tn-switch>
				</tn-form-item>
				<tn-form-item label="å°ç¨‹åºä¸å¯è§">
					<tn-switch v-model="ContentDetail.WeixinXCXBKJ" @change="SwitchContentWeixinXCXBKJ"></tn-switch>
				</tn-form-item>
				<tn-form-item label="æœªç™»å½•ä¸å¯è§">
					<tn-switch v-model="ContentDetail.WeidengLBKJ" @change="SwitchContentWeidengLBKJ"></tn-switch>
				</tn-form-item>
				<tn-form-item label="éæ‰‹æœºå·ä¼šå‘˜ä¸å¯è§">
					<tn-switch v-model="ContentDetail.FeishouJHHYBKJ" @change="SwitchContentFeishouJHHYBKJ"></tn-switch>
				</tn-form-item>
				<tn-form-item label="æ˜¯å¦ç½®é¡¶">
					<tn-switch v-model="ContentDetail.ShifouZD" @change="SwitchContentShifouZD"></tn-switch>
				</tn-form-item>
				<tn-form-item label="å…è´¹ä¼šå‘˜ä¸å¯è§">
					<tn-switch v-model="ContentDetail.MianfeiHYBKJ" @change="SwitchContentMianfeiHYBKJ"></tn-switch>
				</tn-form-item>
				<tn-form-item label="éç«–å±å†…å®¹">
					<tn-switch v-model="ContentDetail.HengxiangSP" @change="SwitchContentHengxiangSP"></tn-switch>
				</tn-form-item>
				<tn-form-item label="ä¸æ¨èè¿‘æœŸçƒ­é—¨">
					<tn-switch v-model="ContentDetail.ButuiJJQRM" @change="SwitchContentButuiJJQRM"></tn-switch>
				</tn-form-item>
				<tn-form-item label="æ˜¯å¦å‘å¸ƒ">
					<tn-switch v-model="ContentDetail.ShifouFB" @change="SwitchContentShifouFB"></tn-switch>
				</tn-form-item>
			</tn-form>
		</tn-modal>
	</view>
</template>

<script>
	import {
		mapState
	} from 'vuex'
	// import userList from '../new_index/data.js'//è¿™ä¸ªæ˜¯å‡æ•°æ®
	// import { Microi } from "@/common/microi.uniapp.js"
	import template_page_mixin from '@/libs/mixin/template_page_mixin.js'
	let audo = uni.createInnerAudioContext()
	audo.loop = true
	export default {
		mixins: [template_page_mixin],
		computed: {
			...mapState({
				CurrentUser: function() {
					return this.$MicroiStore.state.CurrentUser;
				},
				IsLogin: function() {
					return this.$MicroiStore.state.IsLogin;
				},
			}),
		},
		props:{
			PageType: {
			  type: String,
			  default: ''
			},
		},
		data() {
			return {
				Microi: this.Microi,
				CurrentSortIndex:0,
				LastCurrentSortIndex : 0,
				scrollList: [{
						name: 'äº¤å‹å¹¿åœº'//éšæœº
					},
					{
						name: 'æœ€æ–°'
					},
					{
						name: 'çƒ­é—¨'
					}
				],
				ShowEdit: false,
				PageIndex : 1,
				ContentDetail:{},
				windowWidth: 0,
				windowHeight: 0,
				windowHeightStr: '',
				windowHeightStr2: '',
				platform: "",
				model: "",
				deleteHeight: 110,//é»˜è®¤0
				dataList: [],
				k: 0,
				oldVideo: "",
				voice: "",
				timeout: "",
				current: 0,
				boxStyle: { //è§†é¢‘ï¼Œå›¾ç‰‡å°é¢æ ·å¼ğŸŒŸğŸ’—
					'height': 0,
					'width': 0,
				},

				videoID: "",
				isShow: false,

				showPlay: false, //è½¬è½®æ˜¾ç¤ºæ§åˆ¶
				rotates: 0, //è½¬è½®æ—‹è½¬è§’åº¦
				rotateTime: "", //è½¬è½®é€’å½’äº‹ä»¶æ§åˆ¶
				xrotats: "",

				mpcleartime: "",

				isClick: false,

				changeTimeout: "",
				mptime: 0,
				mpstartTime: 0,

				duration: 500,
				// -- è¿›åº¦æ¡ç›¸å…³ -- start
				videoStartPositon: 0,
				progressBarPercent: 0,
				touchStartPosition: 0,
				addPositon: 0,
				timeduration: 0,
				isTouch: false,
				// -- è¿›åº¦æ¡ç›¸å…³ -- end
			}
		},
		components: {

		},
		/**
		 * Type=Detailæ—¶ï¼ˆè§†é¢‘è¯¦æƒ…ï¼‰æ­¤æ–¹æ³•ä¼šæ‰§è¡Œ
		 * Type=Listæ—¶ï¼ˆçŸ­è§†é¢‘ï¼‰æ­¤æ–¹æ³•ä¼šæ‰§è¡Œ
		 */
		created() {
			var self = this;
			if(self.PageType == 'List'){
				self.Init();
			}
		},
		watch: {
			async k(k, old_k) {
				// console.log(k, old_k)
				this.progressBarPercent = 0;
				// #ifndef MP
				this.clearToTime();
				// #endif
				this.isShow = false
				this.dataList[old_k].playIng = false //å¦‚æœè§†é¢‘æš‚åœï¼Œå°±åŠ è½½å°é¢
				this.dataList[old_k].isplay = true
				this.dataList[old_k].state = 'pause'
				console.log('é¢„ç•™ç¬¬' + (old_k + 1) + 'ä¸ªè§†é¢‘ï¼š' + this.dataList[old_k]._id + '' + old_k)
				// 2.0ç‰ˆæœ¬å·²ç»å»æ‰äº†ä¸‹é¢è¿™ä¸€å¥ï¼Œè§†é¢‘ä¸ç”¨æš‚åœï¼Œåªéœ€è¦æŠŠå£°éŸ³ç¦æ­¢å°±è¡Œ
				uni.createVideoContext(this.dataList[old_k]._id + '' + old_k, this)
				.stop() //å¦‚æœè§†é¢‘æš‚åœï¼Œé‚£ä¹ˆæ—§è§†é¢‘åœæ­¢ï¼Œè¿™é‡Œçš„this.dataList[old_k]._id + '' + old_kï¼Œåé¢åŠ  old_k æ˜¯ä¸ºäº†æ¯ä¸€ä¸ªè§†é¢‘çš„ id å€¼ä¸åŒï¼Œè¿™æ ·å°±å¯ä»¥å¤§ç¨‹åº¦çš„é¿å…ä¸²éŸ³é—®é¢˜
				console.log('å·²ç»æš‚åœ --> ç¬¬' + (old_k + 1) + 'ä¸ªè§†é¢‘ï½') //æç¤º
				this.dataList[k].state = 'play'
				this.isShow = true
				this.xrotats = setTimeout(() => {
					this.showPlay = true;
					// #ifndef MP
					this.rotateX();
					// #endif
				}, 200)
				// #ifdef MP
				// å¦‚æœæ˜¯å°ç¨‹åºç«¯
				clearTimeout(this.changeTimeout);
				this.dataList[k].isplay = false
				setTimeout(() => {
					this.dataList[k].playIng = true
				}, 250)
				if (this.mptime < 0.2) {
					this.changeTimeout = setTimeout(() => {
						uni.createVideoContext(this.dataList[this.k]._id + '' + this.k, this).play()
					}, 1400)
				} else {
					uni.createVideoContext(this.dataList[this.k]._id + '' + this.k, this).play()
				}
				// #endif
				// #ifdef H5
				this.dataList[k].isplay = true
				audo.src = this.dataList[k].src
				if (this.isClick) {
					setTimeout(() => {
						if (typeof WeixinJSBridge == "undefined") {
							setTimeout(() => {
								audo.play()
								uni.createVideoContext(this.dataList[k]._id + '' + k, this).seek(0)
								uni.createVideoContext(this.dataList[k]._id + '' + k, this).play()
								setTimeout(() => {
									this.dataList[k].playIng = true
								}, 650)
							}, 500)
						} else {
							WeixinJSBridge.invoke('getNetworkType', {}, e => {
								setTimeout(() => {
									audo.play()
									uni.createVideoContext(this.dataList[k]._id + '' + k, this)
										.seek(0)
									uni.createVideoContext(this.dataList[k]._id + '' + k, this)
										.play()
									setTimeout(() => {
										this.dataList[k].playIng = true
									}, 850)
								}, 200)
							})
						}
					}, 200)
				} else {
					audo.pause()
					this.dataList[k].state = 'pause'
					uni.createVideoContext(this.dataList[k]._id + '' + k, this).seek(0)
					uni.createVideoContext(this.dataList[k]._id + '' + k, this).pause()
				}
				// #endif
				var p = k + 1;
				if(this.dataList.length < (p + 1) ){
					console.log('é¢„åŠ è½½ç¬¬' + (p + 1) + 'ä¸ªè§†é¢‘å¤±è´¥ï¼Œæ²¡æœ‰æ›´å¤šè§†é¢‘äº†ï¼')
				}else{
					console.log('é¢„åŠ è½½ç¬¬' + (p + 1) + 'ä¸ªè§†é¢‘ï¼š' + this.dataList[p]._id + '' + p)
				}
			}
		},
		/**
		 * Type=Detailæ—¶ï¼ˆè§†é¢‘è¯¦æƒ…ï¼‰æ­¤æ–¹æ³•ä¼šæ‰§è¡Œ
		 * Type=Listæ—¶ï¼ˆçŸ­è§†é¢‘ï¼‰æ­¤æ–¹æ³•ä¸ä¼šæ‰§è¡Œ
		 */
		onLoad() {
			var self = this
			if(self.PageType != 'List'){
				self.Init();
			}
		},
		onShow() {
			console.log('å›åˆ°å‰å°');
			if (this.dataList.length !== 0) {
				// #ifdef MP
				this.dataList[this.k].state = 'play';
				uni.createVideoContext(this.dataList[this.k]._id + '' + this.k, this).play()
				// #endif
				// #ifdef H5
				if (this.isClick) {
					this.dataList[this.k].state = 'play';
					uni.createVideoContext(this.dataList[this.k]._id + '' + this.k, this).play()
					audo.play()
				}
				// #endif
			}
		},
		onHide() {
			// #ifdef MP
			this.dataList[this.k].state = 'pause';
			uni.createVideoContext(this.dataList[this.k]._id + '' + this.k, this).pause()
			// #endif
			// #ifdef H5
			if (this.isClick) {
				this.dataList[this.k].state = 'pause';
				uni.createVideoContext(this.dataList[this.k]._id + '' + this.k, this).pause()
				audo.pause()
			}
			// #endif
			console.log('åˆ°åå°');
		},
		/**
		 * æ³¨æ„ï¼šå°ç¨‹åºçš„ã€çŸ­è§†é¢‘ã€‘èœå•åˆ†äº«å¹¶ä¸ä¼šè§¦å‘è¿™ä¸ªäº‹ä»¶ï¼Œè€Œæ˜¯pages/index/index.vueçš„onShareAppMessage
		 */
		onShareAppMessage(e){
			var self = this;
			var contentModel = self.dataList[self.current];
			
			// åŸå§‹å›¾ç‰‡è·¯å¾„
			const originalImagePath = contentModel.YulanT;
			// ç›®æ ‡å›¾ç‰‡å°ºå¯¸
			const targetWidth = 300;
			const targetHeight = 300;
			
			uni.getImageInfo({
			  src: originalImagePath,
			  success: (info) => {
				const { width, height } = info;
		
				// è®¡ç®—ç¼©æ”¾æ¯”ä¾‹å’Œè£å‰ªä½ç½®
				const scale = Math.max(targetWidth / width, targetHeight / height);
				const scaledWidth = width * scale;
				const scaledHeight = height * scale;
				const x = (scaledWidth - targetWidth) / 2;
				const y = (scaledHeight - targetHeight) / 2;
		
				// è·å– canvas ä¸Šä¸‹æ–‡
				const ctx = uni.createCanvasContext('myCanvas', this);
		
				// ç»˜åˆ¶è£å‰ªåçš„å›¾ç‰‡
				ctx.drawImage(
				  info.path,
				  x, y, scaledWidth, scaledHeight,
				  0, 0, targetWidth, targetHeight
				);
		
				// å°†ç»˜åˆ¶ç»“æœå¯¼å‡ºä¸ºä¸´æ—¶æ–‡ä»¶è·¯å¾„
				ctx.draw(false, () => {
				  uni.canvasToTempFilePath({
					canvasId: 'myCanvas',
					success: (res) => {
					  // æ›´æ–° coverImage
					  originalImagePath = res.tempFilePath;
					  debugger;
					},
					fail: (error) => {
					  console.error('è£å‰ªå›¾ç‰‡å¤±è´¥:', error);
					}
				  }, this);
				});
			  },
			  fail: (error) => {
				console.error('è·å–å›¾ç‰‡ä¿¡æ¯å¤±è´¥:', error);
			  }
			});
			
			debugger;
			var result = {
			  // åˆ†äº«çš„æ ‡é¢˜ï¼Œé»˜è®¤ä¸ºå°ç¨‹åºåç§°
			  // title: '',
			  // åˆ†äº«çš„è·¯å¾„ï¼Œé»˜è®¤ä¸ºå½“å‰é¡µé¢
			  // path: '',
			  // åˆ†äº«æ—¶æ˜¾ç¤ºçš„å›¾ç‰‡ï¼Œé»˜è®¤ä¸ºå½“å‰é¡µé¢æˆªå›¾
			  imageUrl: originalImagePath,
			  // å½“å‰é¡µé¢æ˜¯å¦å¯ä»¥åˆ†äº«
			  share: true,
			  success: (res) => {
				console.log('åˆ†äº«æˆåŠŸ:', res);
			  },
			  fail: (error) => {
				console.error('åˆ†äº«å¤±è´¥:', error);
			  }
			};
			return result;
		},
		methods: {
			Init(){
				var self = this;
				this.platform = uni.getSystemInfoSync().platform
				this.model = uni.getSystemInfoSync().model
				var model = this.model
				if (this.platform == 'ios' && (model !== 'iPhone6' || model !== 'iPhone6s' || model !== 'iPhone7' || model !==
						'iPhone8')) {
					this.deleteHeight = 0 //æœ‰ tabbarçš„ ä¿®æ”¹è¿™é‡Œå¯ä»¥æ”¹å˜è§†é¢‘é«˜åº¦
				}
				if(self.PageType == 'List'){
					this.windowWidth = uni.getSystemInfoSync().windowWidth
					this.windowHeight = uni.getSystemInfoSync().windowHeight;// - this.deleteHeight
					self.windowHeightStr = `calc(${self.windowHeight}px - env(safe-area-inset-bottom) - 110rpx)`;// - env(safe-area-inset-top)
					self.windowHeightStr2 = `calc(${self.windowHeight}px - constant(safe-area-inset-bottom) - 110rpx)`;// - constant(safe-area-inset-top)
				}else{
					this.windowWidth = uni.getSystemInfoSync().windowWidth
					this.windowHeight = uni.getSystemInfoSync().windowHeight
					self.windowHeightStr = `${self.windowHeight}px`;
					self.windowHeightStr2 = `${self.windowHeight}px`;
				}
				
				this.boxStyle.width = this.windowWidth + 'px' //ç»™å®½åº¦åŠ px
				this.boxStyle.height = (this.windowHeight - this.deleteHeight) + 'px'; //æœ‰ tabbarçš„ ä¿®æ”¹è¿™é‡Œå¯ä»¥æ”¹å˜è§†é¢‘é«˜åº¦
				
				this.get() //åˆšè¿›å…¥é¡µé¢åŠ è½½æ•°æ®
				// #ifndef MP
				this.rotateX();
				// #endif
			},
			ClickTabs(){
				var self = this;
				if(self.LastCurrentSortIndex != self.CurrentSortIndex){
					self.LastCurrentSortIndex = parseInt(self.CurrentSortIndex)
				}else{
					self.dataList = [];
					self.PageIndex = 1;
					self.current = 0;
					self.k = 0;
					self.get();
				}
			},
			tabChange(index) {
				var self = this;
				self.LastCurrentSortIndex = parseInt(self.CurrentSortIndex)
				self.CurrentSortIndex = index
				self.dataList = [];
				self.PageIndex = 1;
				self.current = 0;
				self.k = 0;
				self.get();
			},
			SwitchContentShifouMF(value){
				var self = this;
				self.SwitchContent(value, 'ShifouMF');
			},
			SwitchContentShifouTJ(value){
				var self = this;
				self.SwitchContent(value, 'ShifouTJ');
			},
			SwitchContentWeixinXCXBKJ(value){
				var self = this;
				self.SwitchContent(value, 'WeixinXCXBKJ');
			},
			SwitchContentWeidengLBKJ(value){
				var self = this;
				self.SwitchContent(value, 'WeidengLBKJ');
			},
			SwitchContentFeishouJHHYBKJ(value){
				var self = this;
				self.SwitchContent(value, 'FeishouJHHYBKJ');
			},
			SwitchContentShifouZD(value){
				var self = this;
				self.SwitchContent(value, 'ShifouZD');
			},
			SwitchContentMianfeiHYBKJ(value){
				var self = this;
				self.SwitchContent(value, 'MianfeiHYBKJ');
			},
			SwitchContentHengxiangSP(value){
				var self = this;
				self.SwitchContent(value, 'HengxiangSP');
			},
			SwitchContentButuiJJQRM(value){
				var self = this;
				self.SwitchContent(value, 'ButuiJJQRM');
			},
			SwitchContentShifouFB(value){
				var self = this;
				self.SwitchContent(value, 'ShifouFB');
			},
			SwitchContent(value, type){
				var self = this;
				var param = {
					Id : self.ContentDetail.Id,//self.Microi.GetUrlQuery(self, 'ContentId')
				};
				param[type] = value ? 1 : 0;
				self.Microi.ApiEngine.Run('upt_content', param, function(result){
					if(self.Microi.CheckResult(result)){
						self.Microi.Tips('ä¿®æ”¹æˆåŠŸï¼');
					}
				});
			},
			OpenEdit(content){
				var self = this;
				if(self.Microi.GetCurrentUser().YunxuZJLLS){
					self.ContentDetail = content;
					self.ShowEdit = true;
				}
			},
			async AddHits(content){
				var self = this;
				if(self.Microi.GetCurrentUser().YunxuZJLLS){
					var result = await self.Microi.ApiEngine.Run('upt_content_hits_add', {
						Id : self.ContentDetail.Id,//content.Id
					});
					if(self.Microi.CheckResult(result)){
						// content.Hits = result.DataAppend.Hits;
						self.ContentDetail.Hits = Microi.GetCountStr(result.DataAppend.Hits);
						self.Microi.Tips('å½“å‰æµè§ˆé‡' + result.DataAppend.Hits);
					}
				}
			},
			mpTouchend() {
				this.mptime = (new Date() / 1000) - this.mpstartTime;
			},
			mpTouchstart() {
				this.mpstartTime = (new Date() / 1000);
			},
			dealVoice() {
				uni.showToast({
					title: 'å¤„ç†å£°éŸ³',
					icon: 'none'
				})
			},
			clearToTime() {
				//æ¸…ç†å®šæ—¶å™¨
				for (let i = 0; i < 20; i++) {
					clearTimeout(this.rotateTime);
					clearTimeout(this.xrotats);
					this.showPlay = false;
					this.rotates = 0;
				}
			},
			clearTime() {
				//æ¸…ç†å®šæ—¶å™¨
				for (let i = 0; i < 20; i++) {
					clearTimeout(this.rotateTime);
					clearTimeout(this.xrotats);
				}
			},
			rotateX() {
				// clearTimeout(this.rotateTime);
				this.rotateTime = setTimeout(() => {
					this.rotateX();
					this.showPlay = true;
					this.rotates += 1;
				}, 30)
			},
			closeScrollview() {
				// ç‚¹å‡»è¯„è®ºé‡Œé¢çš„å‰å‰ï¼Œå°±ä¼šå…³é—­è¯„è®º
				this.$refs.pinglun.close();
			},
			ended() {
				// 1.æ’­æ”¾å½“å‰è§†é¢‘ç»“æŸæ—¶è§¦å‘ï¼Œè‡ªåŠ¨åˆ‡æ¢ä¸‹ä¸€ä¸ªè§†é¢‘
				// this.current = this.k+1
			},
			// ---- è¿›åº¦æ¡ç›¸å…³ --- start
			touchstart(e) {
				// console.log(e);
				this.isTouch = true;
				// #ifdef H5
				if (this.isClick) {
					this.addPositon = 0;
					this.videoStartPositon = (this.windowWidth - (this.windowWidth * 0.10)) * this.progressBarPercent;
					this.touchStartPosition = e.changedTouches[0].clientX;
				}
				// #endif
				// #ifdef MP
				this.addPositon = 0;
				this.videoStartPositon = (this.windowWidth - (this.windowWidth * 0.10)) * this.progressBarPercent;
				this.touchStartPosition = e.changedTouches[0].clientX;
				// #endif
			},
			touchmove(e) {
				// console.log(e);
				// #ifdef H5
				if (this.isClick) {
					let num = e.changedTouches[0].clientX - this.touchStartPosition;
					if ((this.videoStartPositon + num) <= (this.windowWidth - (this.windowWidth * 0.10))) {
						this.addPositon = e.changedTouches[0].clientX - this.touchStartPosition;
					} else {
						this.addPositon = 0;
						this.videoStartPositon = (this.windowWidth - (this.windowWidth * 0.10));
					}
				}
				// #endif
				// #ifdef MP
				let num = e.changedTouches[0].clientX - this.touchStartPosition;
				if ((this.videoStartPositon + num) <= (this.windowWidth - (this.windowWidth * 0.10))) {
					this.addPositon = e.changedTouches[0].clientX - this.touchStartPosition;
				} else {
					this.addPositon = 0;
					this.videoStartPositon = (this.windowWidth - (this.windowWidth * 0.10));
				}
				// #endif
			},
			touchend(e) {
				// #ifdef H5
				if (this.isClick) {
					let per = Number((this.videoStartPositon + this.addPositon) / (this.windowWidth - (this.windowWidth *
						0.10)));
					let timeSubmit = parseInt(this.timeduration * per)
					audo.seek(timeSubmit)
					audo.play()
					uni.createVideoContext(this.dataList[this.k]._id + '' + this.k, this).seek(timeSubmit)
					uni.createVideoContext(this.dataList[this.k]._id + '' + this.k, this).play()
					this.dataList[this.k].state = 'play'
					setTimeout(() => {
						this.isTouch = false;
					}, 500)
				}
				// #endif
				// #ifdef MP
				let per = Number((this.videoStartPositon + this.addPositon) / (this.windowWidth - (this.windowWidth *
					0.10)));
				let timeSubmit = parseInt(this.timeduration * per)
				audo.seek(timeSubmit)
				audo.play()
				uni.createVideoContext(this.dataList[this.k]._id + '' + this.k, this).seek(timeSubmit)
				uni.createVideoContext(this.dataList[this.k]._id + '' + this.k, this).play()
				setTimeout(() => {
					this.isTouch = false;
				}, 500)
				// #endif
			},
			timeupdate(event, index) {
				// è§¦å‘è¿›åº¦æ¡æ›´æ–°
				// console.log(event,index);
				if (index === this.k) {
					this.timeduration = event.detail.duration;
					this.progressBarPercent = parseFloat(Number(event.detail.currentTime / event.detail.duration));
				}
			},
			// ---- è¿›åº¦æ¡ç›¸å…³ --- ending
			//ç‚¹å‡»æ’­æ”¾&&æš‚åœ
			tapVideoHover(state, event) {
				console.log('state--', state);
				if (state == 'play' || state == 'continue') {
					this.dataList[this.k].state = 'pause';
				} else {
					this.dataList[this.k].state = 'continue';
				}
				if (this.dataList[this.k].state == 'continue') {
					this.isClick = true;
					this.dataList[this.k].playIng = true
					uni.createVideoContext(this.dataList[this.k]._id + '' + this.k, this).play(); //æš‚åœä»¥åç»§ç»­æ’­æ”¾
					// #ifdef MP
					this.dataList[this.k].isplay = false
					// #endif
					// #ifdef H5
					audo.play()
					// #endif
				}
				if (this.dataList[this.k].state == 'pause') {
					uni.createVideoContext(this.dataList[this.k]._id + '' + this.k, this).pause(); //æš‚åœä»¥åç»§ç»­æ’­æ”¾
					// #ifdef MP
					this.dataList[this.k].isplay = true
					// #endif
					// #ifdef H5
					audo.pause()
					// #endif
				}
			},
			change(event) {
				this.k = event.detail.current
			},
			animationfinish(event) {
				// 1.è¿™é‡Œè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ˜¯æœ€åä¸€ä¸ªè§†é¢‘å°±è¿›å…¥ get() æ–¹æ³•åŠ è½½è§†é¢‘è¿›å…¥åˆ—è¡¨
				if (this.k == this.dataList.length - 1) {
					this.GET()
				}
			},
			//æ¯ä¸€ç»„ç»“æŸæ—¶æ–°çš„è¯·æ±‚
			GET() {
				var self = this;
				self.PageIndex++;
				
				var _orderBy = '';
				if(self.PageType == 'List'){
					if (self.CurrentSortIndex == 1) {
						_orderBy = 'Latest';
					} else if (self.CurrentSortIndex == 2) {
						_orderBy = 'Hottest';
					}else if (self.CurrentSortIndex == 0) {
						_orderBy = 'Random';
					}
				}
				
				var contentId = self.Microi.GetUrlQuery(self, 'ContentId');
				var _sortType = self.Microi.GetUrlQuery(self, 'SortType');
				if(_sortType){
					_orderBy = _sortType;
				}
				var neirongFL = self.Microi.GetUrlQuery(self, 'NeirongFL');
				
				self.Microi.ApiEngine.Run('get_short_video', {
					Id : contentId,
					_PageIndex : self.PageIndex,
					_SortType : _orderBy,
					NeirongFL : neirongFL,
				}, function(result) {
					if (self.Microi.CheckResult(result)) {
						var realResult = 
						{
							"affectedDocs": result.Data.length,
							"data": []
						};
						result.Data.forEach(item => {
							realResult.data.push({
								...item,
								"_id": item.Id,
								"username": item.UserName,
								"href": self.Microi.FileServer + item.YulanT,//å¤´åƒ
								YulanT : self.Microi.FileServer + item.YulanT,//å°é¢
								"title": item.Biaoti,
								"msg": '',//self.ContentDetail.Biaoti,
								"state": "pause",
								"src": item.Path,
								"playNumber": 0,
								"pinlun": [],
								"playIng": false,
								"isShowimage": false,
								"isShowProgressBarTime": false,
								"isplay": true,
								"userID": item.UserId
							});
						});
						var msg = realResult.data;
						// 2.è¿™é‡ŒæŠŠè§†é¢‘æ·»åŠ åˆ°è§†é¢‘åˆ—è¡¨
						for (let i = 0; i < msg.length; i++) {
							self.dataList.push(msg[i])
						}
					}
				})
				
				// uni.request({
				// 	url: 'https://bdb24c6d-8c19-4f80-8e7e-c9c9f037f131.bspapp.com/video',
				// 	method: 'POST',
				// 	data: {
				// 		info: 'get_video'
				// 	},
				// 	success: (res) => {
				// 		var msg = res.data.data
				// 		// 2.è¿™é‡ŒæŠŠè§†é¢‘æ·»åŠ åˆ°è§†é¢‘åˆ—è¡¨
				// 		for (let i = 0; i < msg.length; i++) {
				// 			this.dataList.push(msg[i])
				// 		}
				// 	}
				// })
			},
			get() {
				// 1.è¿™é‡Œå¼•å…¥åç«¯è¯·æ±‚æ•°æ®
				// var msg = userList
				//by itdos.com
				var self = this;
				
				var _orderBy = '';
				if(self.PageType == 'List'){
					if (self.CurrentSortIndex == 1) {
						_orderBy = 'Latest';
					} else if (self.CurrentSortIndex == 2) {
						_orderBy = 'Hottest';
					}else if (self.CurrentSortIndex == 0) {
						_orderBy = 'Random';
					}
				}
				
				var contentId = self.Microi.GetUrlQuery(self, 'ContentId');
				var apiEngineKey = 'get_short_video';
				if(contentId){
					apiEngineKey = 'get_content_detail';
				}
				var _sortType = self.Microi.GetUrlQuery(self, 'SortType');
				if(_sortType){
					_orderBy = _sortType;
				}
				var neirongFL = self.Microi.GetUrlQuery(self, 'NeirongFL');
				
				
				self.Microi.ApiEngine.Run(apiEngineKey, {
					Id : contentId,
					_PageIndex : self.PageIndex,
					_SortType : _orderBy,
					NeirongFL : neirongFL,
				}, function(result) {
					if (self.Microi.CheckResult(result)) {
						var realResult = 
						{
							"data": []
						};
						var videoList = [];
						if(self.PageType == 'List'){
							videoList = result.Data;
						}else{
							result.Data.WenjianDZ.forEach(item => {
								videoList.push({
									...result.Data,
									_Id : item.Id,
									Path : item.Path
								})
							})
							if(result.DataAppend.MoreShortVideo && result.DataAppend.MoreShortVideo.Code == 1){
								result.DataAppend.MoreShortVideo.Data.forEach(item => {
									videoList.push(item)
								})
							}
						}
						videoList.forEach(item => {
							realResult.data.push({
								...item,
								"_id": item._Id || item.Id,
								"username": item.UserName,
								"href": self.Microi.FileServer + item.YulanT,//å¤´åƒ
								YulanT : self.Microi.FileServer + item.YulanT,//å°é¢
								"title": item.Biaoti,
								"msg": '',//self.ContentDetail.Biaoti,
								"state": "pause",
								"src": item.Path,
								"playNumber": 0,
								"pinlun": [],
								"playIng": false,
								"isShowimage": false,
								"isShowProgressBarTime": false,
								"isplay": true,
								"userID": item.UserId
							});
						});
						
						self.isShow = false;
						var msg = realResult.data;
						// 2.è¿™é‡ŒæŠŠè§†é¢‘æ·»åŠ åˆ°è§†é¢‘åˆ—è¡¨
						for (let i = 0; i < msg.length; i++) {
							self.dataList.push(msg[i])
						}
						// 3.æ’­æ”¾å½“å‰è§†é¢‘
						setTimeout(() => {
							self.isShow = true;
							// #ifdef H5
							self.dataList[self.k].isplay = true
							// #endif
							// #ifdef MP
							// å¦‚æœæ˜¯å°ç¨‹åºç«¯
							self.dataList[self.k].isplay = false
							self.dataList[self.k].state = 'play'
							// #endif
							self.dataList[self.k].playIng = true
							setTimeout(() => {
								// #ifdef H5
								uni.createVideoContext(self.dataList[self.k]._id + '' +
									self.k, self).seek(0)
								uni.createVideoContext(self.dataList[self.k]._id + '' +
									self.k, self).pause()
								self.dataList[self.k].state = 'pause';
								audo.src = self.dataList[self.k].src;
								// #endif
								// #ifdef MP
								uni.createVideoContext(self.dataList[self.k]._id + '' +
									self.k, self).play()
								// #endif
							}, 500)
						}, 200)
						self.videoID = self.dataList[self.k]._id
					}
				})
				
			},
			share(content) {
				uni.share({
					// title: 'åˆ†äº«æ ‡é¢˜',
					// content: 'åˆ†äº«å†…å®¹',
					// imageUrl: 'åˆ†äº«å›¾ç‰‡çš„é“¾æ¥',
					success() {
					  console.log('åˆ†äº«æˆåŠŸ');
					},
					fail(err) {
					  console.log('åˆ†äº«å¤±è´¥', err);
					}
			  });
			},
			toComment(index) {
				// æ³¨æ„ç‚¹å‡»è¯„è®ºä¹‹åä¼šæ‰§è¡Œè¿™é‡Œ
				/*
				ï¼ˆ1ï¼‰å…ˆåŠ è½½ç¼“å†²
				ï¼ˆ2ï¼‰è·å–å½“å‰è§†é¢‘ ID ä¿¡æ¯
				ï¼ˆ3ï¼‰ğŸŒŸğŸŒŸğŸŒŸğŸŒŸé‡è¦ğŸŒŸğŸŒŸğŸŒŸğŸŒŸ
					- ä¸€å®šè¦è®°å¾—çœ‹ index.vue é‡Œé¢
					 uni.setStorageSync("user",this.peopleList[i]);
					 è¿™ä¸ªä¸œè¥¿ï¼Œç”¨äºå­˜å‚¨å½“å‰ç”¨æˆ·ä¿¡æ¯ã€‚åœ¨ æ’ä»¶é‡Œé¢ä¼šä½¿ç”¨åˆ°è¿™ä¸ªä¸œè¥¿ï¼Œ
					 è®°å¾—å†™ä¸€ä¸‹ã€‚
					 
				ï¼ˆ4ï¼‰æ‰“å¼€è¯„è®º
				*/
				uni.showToast({
					title: 'åŠ è½½ä¸­...',
					icon: 'none',
					position: 'bottom',
					duration: 300
				})
				uni.setStorageSync("videoID", this.dataList[index]._id);
				this.videoID = this.dataList[index]._id;
				this.$refs.pinglun.open('bottom')
			},
			cLike(content) {
				var self = this;
				var isFavorite = content._IsFavorite;
				//åˆ¤æ–­æ˜¯å¦å·²ç™»é™†
				if(!self.IsLogin){
					self.Microi.ConfirmTips('æ˜¯å¦å»ç™»å½•ï¼Ÿ', function(){
						uni.navigateTo({
							url: '/pages/common/login'
						})
					});
					return;
				}else{
					this.dataList[this.k]._IsFavorite = !this.dataList[this.k]._IsFavorite
					const video = this.dataList[this.k];
					isFavorite ? video.ShoucangL -= 1 : video.ShoucangL += 1;
					//æ·»åŠ æ”¶è—è®°å½•
					self.Microi.ApiEngine.Run('add_content_favorite', {
						Id : content.Id, //self.Microi.GetUrlQuery(self, 'ContentId'),
						Favorite : isFavorite ? 0 : 1
					}, function(result){
						if(self.Microi.CheckResult(result)){
							self.Microi.Tips(isFavorite ? 'å–æ¶ˆæ”¶è—æˆåŠŸï¼' : 'æ”¶è—æˆåŠŸï¼');
						}
					});
				}
			}
		}
	}
</script>

<style lang="scss">
	/*2023-12-22æ–°å¢å…¼å®¹æ€§å¤„ç†*/
	view, image, input, scroll-view, swiper, swiper-item, text, textarea, video{
		display: block;
		flex-direction: unset;
		flex-shrink: unset;
		border: unset;
	}
	text{
		display: unset;
	}
	.short-video{
		.tn-custom-nav-bar__bar{
			background-color: transparent !important;
		}
		.right-item{
			display: flex;
			flex-direction: column;
			flex-shrink: 0;
			flex-grow: 0;
			flex-basis: auto;
			align-items: stretch;
			align-content: flex-start;
		}
		/* èƒ¶å›Š*/
		.tn-custom-nav-bar__back {
			width: 100%;
			height: 100%;
			position: relative;
			display: flex;
			justify-content: space-evenly;
			align-items: center;
			box-sizing: border-box;
			background-color: rgba(0, 0, 0, 0.15);
			border-radius: 1000rpx;
			border: 1rpx solid rgba(255, 255, 255, 0.5);
			color: #FFFFFF;
			font-size: 18px;
		
			.icon {
				display: block;
				flex: 1;
				margin: auto;
				text-align: center;
			}
		
			&:before {
				content: " ";
				width: 1rpx;
				height: 110%;
				position: absolute;
				top: 22.5%;
				left: 0;
				right: 0;
				margin: auto;
				transform: scale(0.5);
				transform-origin: 0 0;
				pointer-events: none;
				box-sizing: border-box;
				opacity: 0.7;
				background-color: #FFFFFF;
			}
		}
		
		.container {
			background-color: #000000;
		}

		.item {
			background-color: #000000;
			position: relative;
		}

		.videoHover {
			position: absolute;
			top: 0;
			left: 0;
			flex: 1;
			background-color: rgba(0, 0, 0, 0.1);
			justify-content: center;
			align-items: center;
		}

		.playState {
			width: 160rpx;
			height: 160rpx;
			opacity: 0.2;
		}

		.userInfo {
			position: absolute;
			bottom: 110px;
			right: 10px;
			flex-direction: column;
			opacity: 0.8;
		}

		.userAvatar {
			border-radius: 500%;
			margin-bottom: 15px;
			border-style: solid;
			border-width: 2px;
			border-color: #ffffff;
		}

		.userAvatar {
			width: 100rpx;
			height: 100rpx;
		}

		.likeIco,
		.shareIco,
		.commentIco {
			width: 60rpx;
			height: 60rpx;
			margin-top: 15px;
		}

		.likeNum,
		.commentNum,
		.shareTex {
			color: #ffffff;
			font-size: 30rpx;
			text-align: center;
			margin: 5px;
		}

		.likeNumActive {
			color: red;
		}

		.content {
			opacity: 0.8;
			width: 620rpx;
			z-index: 99;
			position: absolute;
			// bottom: 60px;
			// bottom: calc(env(safe-area-inset-bottom) + 110rpx + 20px);
			// bottom: calc(constant(safe-area-inset-bottom) + 110rpx + 20px);
			// bottom: 15px;
			// bottom: calc(env(safe-area-inset-bottom) + 10px);
			// bottom: calc(constant(safe-area-inset-bottom) + 10px);
			left: 15px;
			padding: 15rpx;
			flex-direction: column;
			justify-content: flex-start;
			color: #ffffff;
			max-height: 90rpx;
			overflow: hidden;
			text-overflow: ellipsis;
			margin-bottom: 15rpx;
		}

		.safe-bottom{
			// bottom: calc(env(safe-area-inset-bottom) + 20px);
			bottom: calc(env(safe-area-inset-bottom) + 0px);
			// bottom: calc(constant(safe-area-inset-bottom) + 20px);
			bottom: calc(constant(safe-area-inset-bottom) + 0px);
		}
		.bottom-0px{
			bottom: 0;
		}

		.userName {
			font-size: 26rpx;
			color: #ffffff;
			margin-top: 80upx;
		}

		.words {
			margin-top: 10rpx;
			font-size: 30rpx;
			color: #ffffff;
		}

		.root {
			background-color: #000000;
		}
	}
	
	/* åŠ è½½åŠ¨ç”»   by itdos.com*/
	.loader {
		position: absolute;
		width: 120rpx;
		height: 120rpx;
		top: 50%;
		left: 50%;
		transform: translate(-50%, -50%);
	}
	
	.circle {
		color: #01BEFF;
		position: absolute;
		border-radius: 100%;
		width: 30rpx;
		height: 30rpx;
		display: inline-block;
		float: none;
		background-color: currentColor;
		border: 0 solid currentColor;
		-webkit-animation: spin 1s infinite ease-in-out;
		-moz-animation: spin 1s infinite ease-in-out;
		-o-animation: spin 1s infinite ease-in-out;
		animation: spin 1s infinite ease-in-out
	}
	
	.loader :nth-child(1) {
		top: 5%;
		left: 50%;
		-webkit-animation-delay: -.875s;
		-moz-animation-delay: -.875s;
		-o-animation-delay: -.875s;
		animation-delay: -.875s
	}
	
	.loader :nth-child(2) {
		top: 18.1801948466%;
		left: 81.8198051534%;
		-webkit-animation-delay: -.75s;
		-moz-animation-delay: -.75s;
		-o-animation-delay: -.75s;
		animation-delay: -.75s
	}
	
	.loader :nth-child(3) {
		top: 50%;
		left: 95%;
		-webkit-animation-delay: -.625s;
		-moz-animation-delay: -.625s;
		-o-animation-delay: -.625s;
		animation-delay: -.625s
	}
	
	.loader :nth-child(4) {
		top: 81.8198051534%;
		left: 81.8198051534%;
		-webkit-animation-delay: -.5s;
		-moz-animation-delay: -.5s;
		-o-animation-delay: -.5s;
		animation-delay: -.5s
	}
	
	.loader :nth-child(5) {
		top: 94.9999999966%;
		left: 50.0000000005%;
		-webkit-animation-delay: -.375s;
		-moz-animation-delay: -.375s;
		-o-animation-delay: -.375s;
		animation-delay: -.375s
	}
	
	.loader :nth-child(6) {
		top: 81.8198046966%;
		left: 18.1801949248%;
		-webkit-animation-delay: -.25s;
		-moz-animation-delay: -.25s;
		-o-animation-delay: -.25s;
		animation-delay: -.25s
	}
	
	.loader :nth-child(7) {
		top: 49.9999750815%;
		left: 5.0000051215%;
		-webkit-animation-delay: -.125s;
		-moz-animation-delay: -.125s;
		-o-animation-delay: -.125s;
		animation-delay: -.125s
	}
	
	.loader :nth-child(8) {
		top: 18.179464974%;
		left: 18.1803700518%;
		-webkit-animation-delay: 0s;
		-moz-animation-delay: 0s;
		-o-animation-delay: 0s;
		animation-delay: 0s
	}
	
	@-webkit-keyframes spin {
	
		0%,
		100% {
			opacity: 1;
			-webkit-transform: scale(1);
			transform: scale(1)
		}
	
		20% {
			opacity: 1
		}
	
		80% {
			opacity: 0;
			-webkit-transform: scale(0);
			transform: scale(0)
		}
	}
	
	@-moz-keyframes spin {
	
		0%,
		100% {
			opacity: 1;
			-moz-transform: scale(1);
			transform: scale(1)
		}
	
		20% {
			opacity: 1
		}
	
		80% {
			opacity: 0;
			-moz-transform: scale(0);
			transform: scale(0)
		}
	}
	
	@-o-keyframes spin {
	
		0%,
		100% {
			opacity: 1;
			-o-transform: scale(1);
			transform: scale(1)
		}
	
		20% {
			opacity: 1
		}
	
		80% {
			opacity: 0;
			-o-transform: scale(0);
			transform: scale(0)
		}
	}
	
	@keyframes spin {
	
		0%,
		100% {
			opacity: 1;
			-webkit-transform: scale(1);
			-moz-transform: scale(1);
			-o-transform: scale(1);
			transform: scale(1)
		}
	
		20% {
			opacity: 1
		}
	
		80% {
			opacity: 0;
			-webkit-transform: scale(0);
			-moz-transform: scale(0);
			-o-transform: scale(0);
			transform: scale(0)
		}
	}
</style>