import{K as O,L as P,_ as k,r as I,w as x,a as _,o as j,b as C,d as J,e as N,E as U}from"./index.js";import{u as S}from"./useWidget.js";import"./axiosInstance.js";var L={exports:{}};(function(b,y){(function(w,M){b.exports=M()})(O,function(){function w(e){var l=[];return e.AMapUI&&l.push(M(e.AMapUI)),e.Loca&&l.push(d(e.Loca)),Promise.all(l)}function M(e){return new Promise(function(l,s){var o=[];if(e.plugins)for(var t=0;t<e.plugins.length;t+=1)r.AMapUI.plugins.indexOf(e.plugins[t])==-1&&o.push(e.plugins[t]);if(u.AMapUI===i.failed)s("前次请求 AMapUI 失败");else if(u.AMapUI===i.notload){u.AMapUI=i.loading,r.AMapUI.version=e.version||r.AMapUI.version,t=r.AMapUI.version;var a=document.body||document.head,p=document.createElement("script");p.type="text/javascript",p.src="https://webapi.amap.com/ui/"+t+"/main.js",p.onerror=function(n){u.AMapUI=i.failed,s("请求 AMapUI 失败")},p.onload=function(){if(u.AMapUI=i.loaded,o.length)window.AMapUI.loadUI(o,function(){for(var n=0,g=o.length;n<g;n++){var v=o[n].split("/").slice(-1)[0];window.AMapUI[v]=arguments[n]}for(l();f.AMapUI.length;)f.AMapUI.splice(0,1)[0]()});else for(l();f.AMapUI.length;)f.AMapUI.splice(0,1)[0]()},a.appendChild(p)}else u.AMapUI===i.loaded?e.version&&e.version!==r.AMapUI.version?s("不允许多个版本 AMapUI 混用"):o.length?window.AMapUI.loadUI(o,function(){for(var n=0,g=o.length;n<g;n++){var v=o[n].split("/").slice(-1)[0];window.AMapUI[v]=arguments[n]}l()}):l():e.version&&e.version!==r.AMapUI.version?s("不允许多个版本 AMapUI 混用"):f.AMapUI.push(function(n){n?s(n):o.length?window.AMapUI.loadUI(o,function(){for(var g=0,v=o.length;g<v;g++){var h=o[g].split("/").slice(-1)[0];window.AMapUI[h]=arguments[g]}l()}):l()})})}function d(e){return new Promise(function(l,s){if(u.Loca===i.failed)s("前次请求 Loca 失败");else if(u.Loca===i.notload){u.Loca=i.loading,r.Loca.version=e.version||r.Loca.version;var o=r.Loca.version,t=r.AMap.version.startsWith("2"),a=o.startsWith("2");if(t&&!a||!t&&a)s("JSAPI 与 Loca 版本不对应！！");else{t=r.key,a=document.body||document.head;var p=document.createElement("script");p.type="text/javascript",p.src="https://webapi.amap.com/loca?v="+o+"&key="+t,p.onerror=function(n){u.Loca=i.failed,s("请求 AMapUI 失败")},p.onload=function(){for(u.Loca=i.loaded,l();f.Loca.length;)f.Loca.splice(0,1)[0]()},a.appendChild(p)}}else u.Loca===i.loaded?e.version&&e.version!==r.Loca.version?s("不允许多个版本 Loca 混用"):l():e.version&&e.version!==r.Loca.version?s("不允许多个版本 Loca 混用"):f.Loca.push(function(n){n?s(n):s()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var i;(function(e){e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed"})(i||(i={}));var r={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},u={AMap:i.notload,AMapUI:i.notload,Loca:i.notload},f={AMap:[],AMapUI:[],Loca:[]},m=[],c=function(e){typeof e=="function"&&(u.AMap===i.loaded?e(window.AMap):m.push(e))};return{load:function(e){return new Promise(function(l,s){if(u.AMap==i.failed)s("");else if(u.AMap==i.notload){var o=e.key,t=e.version,a=e.plugins;o?(window.AMap&&location.host!=="lbs.amap.com"&&s("禁止多种API加载方式混用"),r.key=o,r.AMap.version=t||r.AMap.version,r.AMap.plugins=a||r.AMap.plugins,u.AMap=i.loading,t=document.body||document.head,window.___onAPILoaded=function(n){if(delete window.___onAPILoaded,n)u.AMap=i.failed,s(n);else for(u.AMap=i.loaded,w(e).then(function(){l(window.AMap)}).catch(s);m.length;)m.splice(0,1)[0]()},a=document.createElement("script"),a.type="text/javascript",a.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+r.AMap.version+"&key="+o+"&plugin="+r.AMap.plugins.join(","),a.onerror=function(n){u.AMap=i.failed,s(n)},t.appendChild(a)):s("请填写key")}else if(u.AMap==i.loaded)if(e.key&&e.key!==r.key)s("多个不一致的 key");else if(e.version&&e.version!==r.AMap.version)s("不允许多个版本 JSAPI 混用");else{if(o=[],e.plugins)for(t=0;t<e.plugins.length;t+=1)r.AMap.plugins.indexOf(e.plugins[t])==-1&&o.push(e.plugins[t]);o.length?window.AMap.plugin(o,function(){w(e).then(function(){l(window.AMap)}).catch(s)}):w(e).then(function(){l(window.AMap)}).catch(s)}else if(e.key&&e.key!==r.key)s("多个不一致的 key");else if(e.version&&e.version!==r.AMap.version)s("不允许多个版本 JSAPI 混用");else{var p=[];if(e.plugins)for(t=0;t<e.plugins.length;t+=1)r.AMap.plugins.indexOf(e.plugins[t])==-1&&p.push(e.plugins[t]);c(function(){p.length?window.AMap.plugin(p,function(){w(e).then(function(){l(window.AMap)}).catch(s)}):w(e).then(function(){l(window.AMap)}).catch(s)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,r={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},u={AMap:i.notload,AMapUI:i.notload,Loca:i.notload},f={AMap:[],AMapUI:[],Loca:[]}}}})})(L);var E=L.exports;const T=P(E),B={id:"container",style:{width:"100%",height:"100%"}},F={__name:"map-widget",props:{widgetObj:{type:Object,required:!0}},async setup(b,{expose:y}){let w,M;const d=b,i=I(),r=I(!1),u=(o,t)=>{let a;return function(...p){clearTimeout(a),a=setTimeout(()=>o.apply(this,p),t)}},f=()=>{const t=new URLSearchParams(window.location.search).get("center");if(t){const a=t.split(",");if(a.length===2&&!isNaN(parseFloat(a[0]))&&!isNaN(parseFloat(a[1])))return t}return null},{loadRemoteData:m}=S(d.widgetObj,d.widgetObj.widgetParams[0].typeOptions.dataJson,i,r);[w,M]=x(()=>m()),await w,M();let c;const e=()=>{T.load({key:"44a64ccfb659299ca8be07d7d0839830",version:"2.0",plugins:[]}).then(o=>{var p;let t=f(),a;t?(a=t.split(","),console.log("使用URL参数中的center值:",t)):(a=d.widgetObj.widgetParams[1].value.split(","),d.widgetObj.widgetParams[0].typeOptions.dataJson&&(a=(p=d.widgetObj.widgetParams[0].typeOptions.dataJson[0])==null?void 0:p.position.split(",")),console.log("使用配置参数中的center值:",a)),c=new o.Map("container",{zoom:d.widgetObj.widgetParams[2].value,center:a}),d.widgetObj.widgetParams[3].value&&o.plugin("AMap.ToolBar",function(){var n=new o.ToolBar;c.addControl(n)}),d.widgetObj.widgetParams[4].value&&o.plugin("AMap.Scale",function(){var n=new o.Scale;c.addControl(n)}),d.widgetObj.widgetParams[5].value&&o.plugin("AMap.HawkEye",function(){var n=new o.HawkEye;c.addControl(n)}),d.widgetObj.widgetParams[6].value&&o.plugin("AMap.MapType",function(){var n=new o.MapType;c.addControl(n)}),d.widgetObj.widgetParams[7].value&&o.plugin("AMap.Geolocation",function(){var n=new o.Geolocation({enableHighAccuracy:!0,timeout:1e4,offset:[20,100],zoomToAccuracy:!0,position:"RB"});c.addControl(n)}),d.widgetObj.widgetParams[0].typeOptions.dataJson&&d.widgetObj.widgetParams[0].typeOptions.dataJson.forEach(n=>{console.log("item",n);let g=new o.Marker({offset:new o.Pixel(-10,-10),position:n.position.split(","),icon:n.icon,title:n.title,content:n.content});if(g.on("click",function(h){var A;console.log("点击了地图maker：",JSON.stringify(n)),U.emit("mapMarkerClick",JSON.stringify(n)),(A=window.parent)==null||A.postMessage({key:"mapWidget",value:JSON.stringify(n)},"*")}),c.add(g),d.widgetObj.widgetParams[8].value){var v=new o.Text({text:n.title,anchor:"center",draggable:!1,cursor:"pointer",angle:0,style:{padding:"4px 8px","margin-bottom":"3.2rem","margin-left":"3.5rem","border-radius":".25rem","background-color":"white","border-width":0,"box-shadow":"0 2px 6px 0 rgba(114, 124, 245, .5)","text-align":"center","font-size":"12px",color:"#409eff",cursor:"pointer"},position:n.position.split(",")});v.on("click",function(h){var A;console.log("点击了地图maker：",JSON.stringify(n)),U.emit("mapMarkerClick",JSON.stringify(n)),(A=window.parent)==null||A.postMessage({key:"mapWidget",value:JSON.stringify(n)},"*")}),v.setMap(c)}})}).catch(o=>{console.error(o)})},l=u(()=>{c&&c.destroy(),e()},1e3);return y({updateMapCenter:o=>{if(c&&o){let t;if(typeof o=="string"){const a=o.split(",");if(a.length===2&&!isNaN(parseFloat(a[0]))&&!isNaN(parseFloat(a[1])))t=a;else{console.error('center参数格式错误，应为"经度,纬度"格式');return}}else if(Array.isArray(o)&&o.length===2)t=o;else{console.error("center参数格式错误");return}c.setCenter(t),console.log("地图中心点已更新为:",t)}}}),_(()=>{e()}),j(()=>{c&&c.destroy()}),C([()=>d.widgetObj.widgetParams],()=>{l()},{deep:!0}),(o,t)=>(J(),N("div",B))}},G=k(F,[["__scopeId","data-v-5a44b5b5"]]);export{G as default};
